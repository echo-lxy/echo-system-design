<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ф╕╗ф╗ОхдНхИ╢ | Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.3b389ff4.css" as="style"><link rel="preload" href="/assets/js/app.fbf7e221.js" as="script"><link rel="preload" href="/assets/js/2.c1dbdf51.js" as="script"><link rel="preload" href="/assets/js/53.e4e2486c.js" as="script"><link rel="prefetch" href="/assets/js/10.6c7d28d0.js"><link rel="prefetch" href="/assets/js/11.c372b80d.js"><link rel="prefetch" href="/assets/js/12.6b2cf973.js"><link rel="prefetch" href="/assets/js/13.b0f89bbe.js"><link rel="prefetch" href="/assets/js/14.8629214f.js"><link rel="prefetch" href="/assets/js/15.bc159dd0.js"><link rel="prefetch" href="/assets/js/16.d3eb4a3f.js"><link rel="prefetch" href="/assets/js/17.15b93a95.js"><link rel="prefetch" href="/assets/js/18.8dfa2b07.js"><link rel="prefetch" href="/assets/js/19.8e0bafbb.js"><link rel="prefetch" href="/assets/js/20.0268c6d8.js"><link rel="prefetch" href="/assets/js/21.83e582a8.js"><link rel="prefetch" href="/assets/js/22.16471982.js"><link rel="prefetch" href="/assets/js/23.a14342c1.js"><link rel="prefetch" href="/assets/js/24.b5f14fb3.js"><link rel="prefetch" href="/assets/js/25.798ced8c.js"><link rel="prefetch" href="/assets/js/26.e96db7ea.js"><link rel="prefetch" href="/assets/js/27.9673a601.js"><link rel="prefetch" href="/assets/js/28.090e581b.js"><link rel="prefetch" href="/assets/js/29.5aa092d1.js"><link rel="prefetch" href="/assets/js/3.2b25e526.js"><link rel="prefetch" href="/assets/js/30.ae404549.js"><link rel="prefetch" href="/assets/js/31.e5a189db.js"><link rel="prefetch" href="/assets/js/32.38b2048b.js"><link rel="prefetch" href="/assets/js/33.3fe8ad47.js"><link rel="prefetch" href="/assets/js/34.85eec564.js"><link rel="prefetch" href="/assets/js/35.52c2af2e.js"><link rel="prefetch" href="/assets/js/36.bf86964c.js"><link rel="prefetch" href="/assets/js/37.afb12a8e.js"><link rel="prefetch" href="/assets/js/38.2469c653.js"><link rel="prefetch" href="/assets/js/39.3c30da21.js"><link rel="prefetch" href="/assets/js/4.5ed0c364.js"><link rel="prefetch" href="/assets/js/40.2c4c84b8.js"><link rel="prefetch" href="/assets/js/41.9eed16ad.js"><link rel="prefetch" href="/assets/js/42.b88826d2.js"><link rel="prefetch" href="/assets/js/43.2e930808.js"><link rel="prefetch" href="/assets/js/44.f3c18f65.js"><link rel="prefetch" href="/assets/js/45.04a1bab7.js"><link rel="prefetch" href="/assets/js/46.6ceffc01.js"><link rel="prefetch" href="/assets/js/47.8a5aba11.js"><link rel="prefetch" href="/assets/js/48.415b6fec.js"><link rel="prefetch" href="/assets/js/49.ad503f3f.js"><link rel="prefetch" href="/assets/js/5.39afb5af.js"><link rel="prefetch" href="/assets/js/50.420fa8a8.js"><link rel="prefetch" href="/assets/js/51.2052bb92.js"><link rel="prefetch" href="/assets/js/52.0b2962a0.js"><link rel="prefetch" href="/assets/js/54.29dab498.js"><link rel="prefetch" href="/assets/js/55.50e40851.js"><link rel="prefetch" href="/assets/js/6.d52263f6.js"><link rel="prefetch" href="/assets/js/7.359569b8.js"><link rel="prefetch" href="/assets/js/8.6e500a6b.js"><link rel="prefetch" href="/assets/js/9.358816f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3b389ff4.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Echo ч│╗ч╗Яшо╛шобф╣Лч╛О" class="logo"> <span class="site-name can-hide">Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>цМЗхНЧ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>хЯ║чбА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕╗ч║┐</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>цФпч║┐</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>щЫЖч╛д</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ebc8dc/" aria-current="page" class="active sidebar-link">ф╕╗ф╗ОхдНхИ╢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#хЙНшиА" class="sidebar-link">хЙНшиА</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#цЧзчЙИхдНхИ╢" class="sidebar-link">цЧзчЙИхдНхИ╢</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#цЦ░чЙИхдНхИ╢" class="sidebar-link">цЦ░чЙИхдНхИ╢</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#хдНхИ╢ц╡БчиЛф╕▓шБФ" class="sidebar-link">хдНхИ╢ц╡БчиЛф╕▓шБФ</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#х┐Гш╖│цгАц╡Л" class="sidebar-link">х┐Гш╖│цгАц╡Л</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#ф╕╗ф╗ОхдНхИ╢чЪДшзжхПСцЧ╢цЬ║" class="sidebar-link">ф╕╗ф╗ОхдНхИ╢чЪДшзжхПСцЧ╢цЬ║</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#цА╗ч╗У" class="sidebar-link">цА╗ч╗У</a></li><li class="sidebar-sub-header level2"><a href="/pages/ebc8dc/#хПВшАГцЦЗчМо" class="sidebar-link">хПВшАГцЦЗчМо</a></li></ul></li><li><a href="/pages/af8752/" class="sidebar-link">хУихЕ╡</a></li><li><a href="/pages/040403/" class="sidebar-link">cluster</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Redis ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>щЫЖч╛д</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">ф╕╗ф╗ОхдНхИ╢<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><div class="custom-block danger"><p class="custom-block-title">цПРхЗ║щЧощвШцШпф╕АхИЗцЩ║цЕзчЪДх╝Ачлп</p> <ol><li>ф╕║ф╗Аф╣И Redis цЧйцЬЯчЪД <code>SYNC</code> цУНф╜ЬхЬицЦнч║┐щЗНш┐ЮцЧ╢цХИчОЗф╜Оф╕Ля╝Я</li> <li>хжВф╜ХщАЪш┐З <code>replication offset</code> хТМ <code>replication backlog</code> хоЮчО░щлШцХИчЪДщГихИЖщЗНхРМцнея╝Я</li> <li>ш┐РшбМIDхЬиф╕╗ф╗ОцЦнч║┐щЗНш┐ЮцЧ╢хжВф╜Хх╕охКйчбохоЪхРМцнецЦ╣х╝Пя╝Я</li> <li><code>PSYNC</code> хжВф╜Хф╝ШхМЦцЦнч║┐хРОщЗНш┐ЮцЧ╢чЪДф╕╗ф╗ОхдНхИ╢цХИчОЗя╝Я</li> <li>ф╕║ф╗Аф╣ИхН│ф╜┐цЬЙTCPф╝аш╛Уя╝МRedis ф╗НщЬАщАЪш┐Зх┐Гш╖│цЬ║хИ╢чбоф┐ЭцХ░цНоф╕АшЗ┤я╝Я</li></ol></div> <h2 id="хЙНшиА"><a href="#хЙНшиА" class="header-anchor">#</a> хЙНшиА</h2> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162154182.png" alt="image-20240916215426114"></p> <p>Redis ф╕ня╝МчФицИ╖хПпф╗ещАЪш┐З <em>SLAVEOF</em> хС╜ф╗дцИЦшАЕшо╛ч╜о slaveof щАЙщб╣я╝МхО╗шойф╕Аф╕к redis server хО╗хдНхИ╢ хПжф╕Аф╕к redis serverя╝МцИСф╗мхоГф╗мхИЖхИлчз░ф╕║ slaveя╝Иф╗ОцЬ║я╝Йф╕О masterя╝Иф╕╗цЬ║я╝Й</p> <p>х╝АхзЛф╣ЛхЙНя╝МцИСхБЗшо╛ф╜ах╖▓ч╗Пф║Жшзг ф╕╗ф╗ОхдНхИ╢чЪДчЙ╣цАзф╕Оф╜┐чФицЦ╣ц│Х</p> <h2 id="цЧзчЙИхдНхИ╢"><a href="#цЧзчЙИхдНхИ╢" class="header-anchor">#</a> цЧзчЙИхдНхИ╢</h2> <p>Redis чЪДхдНхИ╢хКЯшГ╜хИЖф╕║</p> <ul><li><strong>хРМцне</strong>я╝ЪчФиф║Ох░Жф╗ОцЬНхКбхЩичЪДцХ░цНох║УчК╢цАБцЫ┤цЦ░шЗ│ф╕╗цЬНхКбхЩих╜УхЙНцЙАхдДчЪДцХ░цНох║УчК╢цАБ</li> <li><strong>хС╜ф╗дф╝ацТн</strong>я╝ЪчФиф║ОхЬиф╕╗цЬНхКбхЩичЪДчК╢цАБшвлф┐оцФ╣цЧ╢я╝МхоЮцЧ╢х░Жф┐оцФ╣хС╜ф╗дхСКчЯеф╗ОцЬНхКбхЩи</li></ul> <h3 id="чммф╕Ацне-хРМцне"><a href="#чммф╕Ацне-хРМцне" class="header-anchor">#</a> чммф╕Ацнея╝ЪхРМцне</h3> <p>х╜УховцИ╖члпщжЦцмбцГ│ф╗ОцЬНхКбхЩихПСщАБ SLAVEOF хС╜ф╗дчЪДцЧ╢хАЩя╝МшжБ slave хдНхИ╢ master цЧ╢я╝Мх░▒шжБцЙзшбМ хРМцне SYNC  цУНф╜Ь</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162300726.png" alt="image-20240916230021699"></p> <p>цЙзшбМцнещкдя╝Ъ</p> <ol><li>slave хРС master хПСщАБ SYNC хС╜ф╗д</li> <li>цФ╢хИ░ SYNC хС╜ф╗дхРОчЪДф╕╗цЬНхКбхЩицЙзшбМ BGSAVE хС╜ф╗дя╝Мх╣╢чФич╝УхЖ▓хМ║шо░х╜Хф╗Ох╜УхЙНх╝АхзЛчЪДцЙАцЬЙхЖЩхС╜ф╗д</li> <li>BGSAVE цЙзшбМхоМцпХцЧ╢я╝Мmaster ф╝Ъх░Ж BGSAVE хС╜ф╗дчФЯцИРчЪД RDB цЦЗф╗╢хПСщАБч╗Щ slave</li> <li>slave цОехПЧх╣╢ш╜╜хЕеш┐Щф╕к RDB цЦЗф╗╢</li> <li>master  х░ЖхЕИхЙНч╝УхЖ▓хМ║ф╕нчЪДцЙАцЬЙхЖЩхС╜ф╗дхПСщАБч╗Щ slaveя╝Мslave цЙзшбМхРОх░ЖчК╢цАБцЫ┤цЦ░шЗ│ master х╜УхЙНчК╢цАБ</li></ol> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162235256.png" alt="image-20240916223511189"></p> <h3 id="чммф║Мцне-хС╜ф╗дф╝ацТн"><a href="#чммф║Мцне-хС╜ф╗дф╝ацТн" class="header-anchor">#</a> чммф║Мцнея╝ЪхС╜ф╗дф╝ацТн</h3> <p>х╜УщжЦцмбхРМцнеф╣ЛхРОя╝Мф╕╗цЬ║чК╢цАБхПСчФЯхПШхМЦцЧ╢я╝Мф╕╗цЬ║ф╝ЪхПСщАБхоЮцЧ╢ф╝ацТнхЖЩхС╜ф╗дч╗Щф╗ОцЬ║я╝Мф╜┐хЕ╢чК╢цАБф╕АшЗ┤</p> <h3 id="цЧзчЙИчЪДч╝║щЩ╖"><a href="#цЧзчЙИчЪДч╝║щЩ╖" class="header-anchor">#</a> цЧзчЙИчЪДч╝║щЩ╖</h3> <p>хЬихРМцнеф╕нхнШхЬиф╗еф╕Лф╕дчзНцГЕхЖ╡</p> <ul><li>хИЭцмбхдНхИ╢я╝Ъф╗ОцЬ║х╝АхзЛхп╣ф╕Аф╕кф╗ехЙНц▓бцЬЙхдНхИ╢ш┐ЗчЪДф╕╗цЬ║ш┐ЫшбМхдНхИ╢</li> <li>цЦнч║┐хРОщЗНхдНхИ╢я╝ЪхдДф║ОхС╜ф╗дф╝ацТнщШ╢цо╡чЪДф╗ОцЬ║ф╕Оф╕╗цЬ║цЦнш┐ЮчД╢хРОшЗкхКицЦ░ш┐ЮцОеф╕Кф║Жф╣ЛхРОя╝Мхп╣ф╕╗цЬ║ш┐ЫшбМчЪДхдНхИ╢</li></ul> <p>цИСф╗мхПпф╗ещвДцЦЩя╝МцЦнч║┐хРОщЗНхдНхИ╢ц▓бцЬЙх┐ЕшжБхРМцнехЕищЗПчЪДRDBцЦЗф╗╢я╝МхПкщЬАшжБхРМцнецЦнч║┐цЬЯщЧ┤ч╝║хд▒чЪДхС╜ф╗дхН│хПп</p> <div class="custom-block warning"><p class="custom-block-title">SYNC хС╜ф╗дцШпф╕Аф╕кщЭЮх╕╕шАЧш┤╣ш╡Дц║РчЪДцУНф╜Ь</p> <p>цпПцмбцЙзшбМSYNCхС╜ф╗дя╝Мф╕╗ф╗ОцЬНхКбхЩищЬАшжБцЙзшбМф╗еф╕ЛхКиф╜Ь:</p> <ol><li>ф╕╗цЬНхКбхЩищЬАшжБцЙзшбМBGSAVEхС╜ф╗дцЭечФЯцИР RDB цЦЗф╗╢я╝Мш┐Щф╕кчФЯцИРцУНф╜Ьф╝ЪшАЧш┤╣ф╕╗цЬНхКб
хЩихдзщЗПчЪД CPUуАБхЖЕхнШхТМчгБчЫШ I/O ш╡Дц║РуАВ</li> <li>ф╕╗цЬНхКбхЩищЬАшжБх░ЖшЗкх╖▒чФЯцИРчЪД RDB цЦЗф╗╢хПСщАБч╗Щф╗ОцЬНхКбхЩия╝Мш┐Щф╕кхПСщАБцУНф╜Ьф╝ЪшАЧш┤╣ф╕╗ф╗ОцЬНхКбхЩихдзщЗПчЪДч╜Сч╗Ьш╡Дц║Р(х╕жхо╜хТМц╡БщЗП)я╝Мх╣╢хп╣ф╕╗цЬНхКбхЩихУНх║ФхС╜ф╗дшп╖ц▒ВчЪДцЧ╢щЧ┤ф║зчФЯх╜▒хУНуАВ</li> <li>цОецФ╢хИ░ RDB цЦЗф╗╢чЪДф╗ОцЬНхКбхЩищЬАшжБш╜╜хЕеф╕╗цЬНхКбхЩихПСцЭечЪДRDBцЦЗф╗╢я╝Мх╣╢ф╕ФхЬиш╜╜хЕецЬЯщЧ┤я╝Мф╗ОцЬНхКбхЩиф╝ЪхЫаф╕║щШ╗хпТшАМц▓бхКЮц│ХхдДчРЖхС╜ф╗дшп╖ц▒В</li></ol> <p>хЫаф╕║ SYNC хС╜ф╗дцШпф╕Аф╕кхжВцндшАЧш┤╣ш╡Дц║РчЪДцУНф╜Ья╝МцЙАф╗е Redis цЬЙх┐ЕшжБф┐ЭшпБхЬичЬЯцнгцЬЙщЬАшжБцЧ╢цЙНцЙзшбМSYNC хС╜ф╗д</p></div> <h2 id="цЦ░чЙИхдНхИ╢"><a href="#цЦ░чЙИхдНхИ╢" class="header-anchor">#</a> цЦ░чЙИхдНхИ╢</h2> <p>цЦ░чЙИхдНхИ╢чЪДхЗ║чО░цШпф╕║ф║ЖшзгхЖ│ цЧзчЙИхдНхИ╢хКЯшГ╜хЬицЦнч║┐щЗНхдНхИ╢ цГЕхЖ╡цЧ╢чЪДф╜ОцХИщЧощвШ</p> <blockquote><p>Redis ф╗О2.8х╝АхзЛя╝Мф╜┐чФи PSYNC хС╜ф╗дф╗гцЫ┐ SYNC хС╜ф╗дцЭецЙзшбМхдНхИ╢цЧ╢чЪДхРМцнецУНф╜Ь</p></blockquote> <p>PSYNC цЬЙф╕дчзНцибх╝П</p> <ul><li>хоМцХ┤щЗНхРМцнея╝ЪчФиф║ОхдДчРЖхИЭцмбхдНхИ╢цГЕхЖ╡я╝МхТМ SYNC хС╜ф╗дцЙзшбМцнещкдхЯ║цЬмф╕Аца╖</li> <li>щГихИЖщЗНхРМцнея╝ЪчФиф║ОхдДчРЖцЦнч║┐хРОщЗНхдНхА╝цГЕхЖ╡я╝Мх╜Уф╗ОцЬНхКбхЩихЬицЦнч║┐хРОщЗНцЦ░ш┐ЮцОеф╕╗цЬНхКбхЩицЧ╢я╝МхжВцЮЬцЭбф╗╢хЕБшо╕я╝Мф╕╗цЬНхКбхЩихПпф╗ех░Жф╕╗ф╗ОцЬНхКбхЩиш┐ЮцОецЦнх╝АцЬЯщЧ┤цЙзшбМчЪДхЖЩхС╜ф╗дхПСщАБч╗Щф╗ОцЬНхКбхЩия╝Мф╗ОцЬНхКбхЩихПкшжБцОецФ╢х╣╢цЙзшбМш┐Щф║ЫхЖЩхС╜ф╗дя╝Мх░▒хПпф╗ех░ЖцХ░цНох║УцЫ┤цЦ░шЗ│ф╕╗цЬНхКбхЩих╜УхЙНцЙАхдДчЪДчК╢цАБуАВ</li></ul> <p>PSYNC ф╕нчЪДщГихИЖщЗНхРМцнецибх╝П цЬЙцХИшзгхЖ│ф║ЖцЧзчЙИхдНхИ╢хКЯшГ╜хЬихдДчРЖцЦнч║┐хРОщЗНхдНхИ╢хЗ║чО░чЪДф╜ОцХИщЧощвШ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162300714.png" alt="image-20240916230006676"></p> <h3 id="щГихИЖщЗНхРМцнечЪДхоЮчО░"><a href="#щГихИЖщЗНхРМцнечЪДхоЮчО░" class="header-anchor">#</a> щГихИЖщЗНхРМцнечЪДхоЮчО░</h3> <p>щГихИЖщЗНхРМцнехКЯшГ╜чЪДхЕ│щФоф╕ЙщГихИЖ</p> <ul><li><em>replication offset</em>я╝Ъф╕╗цЬ║чЪДхдНхИ╢хБПчз╗щЗП хТМ ф╗ОцЬ║чЪДхдНхИ╢хБПчз╗щЗП</li> <li><em>replication backlog</em>я╝Ъф╕╗цЬ║чЪДхдНхИ╢чзпхОЛч╝УхнШхМ║</li> <li><em>run ID</em>я╝Ъф╕╗цЬ║чЪДш┐РшбМ ID</li></ul> <h4 id="хдНхИ╢хБПчз╗щЗП"><a href="#хдНхИ╢хБПчз╗щЗП" class="header-anchor">#</a> хдНхИ╢хБПчз╗щЗП</h4> <p>цЙзшбМхдНхИ╢чЪДхПМцЦ╣щГ╜ф╝ЪхИЖхИлч╗┤цКдф╕Аф╕к хдНхИ╢хБПчз╗щЗП</p> <ul><li>ф╕╗цЬНхКбхЩицпПцмбхРСф╗ОцЬНхКбхЩиф╝ацТнNф╕кхнЧшКВчЪДцХ░цНоцЧ╢я╝Мх░▒х░ЖшЗкх╖▒чЪДхдНхИ╢хБПчз╗щЗПчЪДхА╝хКаф╕КNуАВ</li> <li>ф╗ОцЬНхКбхЩицпПцмбцФ╢хИ░ф╕╗цЬНхКбхЩиф╝ацТнцЭечЪДNф╕кхнЧшКВчЪДцХ░цНоцЧ╢я╝Мх░▒х░ЖшЗкх╖▒чЪДхдНхИ╢хБПчз╗щЗПчЪДхА╝хКаф╕КN</li></ul> <p>чд║ф╛ЛхЫ╛хжВф╕Ля╝Ъ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162304188.png" alt="image-20240916230453157"></p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162309988.png" alt="image-20240916230903948"></p> <p>щАЪш┐Зхп╣цпФф╕╗ф╗ОцЬНхКбхЩичЪДхдНхИ╢хБПчз╗щЗПя╝МчиЛх║ПхПпф╗ех╛Ихо╣цШУхЬ░чЯещБУф╕╗ф╗ОцЬНхКбхЩицШпхРжхдДф║Оф╕АшЗ┤чК╢цАБ:хжВцЮЬф╕╗ф╗ОцЬНхКбхЩихдДф║Оф╕АшЗ┤чК╢цАБя╝МщВгф╣Иф╕╗ф╗ОцЬНхКбхЩиф╕дшАЕчЪДхБПчз╗щЗПцА╗цШпчЫ╕хРМчЪДуАВчЫ╕хПНя╝МхжВцЮЬф╕╗ф╗ОцЬНхКбхЩиф╕дшАЕчЪДхБПчз╗щЗПх╣╢ф╕НчЫ╕хРМя╝МщВгф╣Ишп┤цШОф╕╗ф╗ОцЬНхКбхЩих╣╢цЬкхдДф║Оф╕АшЗ┤чК╢цАБ</p> <h4 id="хдНхИ╢чзпхОЛч╝УхЖ▓хМ║"><a href="#хдНхИ╢чзпхОЛч╝УхЖ▓хМ║" class="header-anchor">#</a> хдНхИ╢чзпхОЛч╝УхЖ▓хМ║</h4> <p>хдНхИ╢чзпхОЛч╝УхЖ▓хМ║ цШпчФ▒ф╕╗цЬНхКбхЩич╗┤цКдчЪДф╕Аф╕кхЫ║хоЪщХ┐х║жчЪДхЕИш┐ЫхЕИхЗ║щШЯхИЧя╝Мщ╗Шшодхдзх░Пф╕║ 1MB</p> <p>х╜Уф╕╗цЬ║ш┐ЫшбМхС╜ф╗дф╝ацТнчЪДцЧ╢хАЩя╝Мф╗Цф╕Нф╗Еф╝Ъх░ЖхЖЩхС╜ф╗дхПСщАБч╗ЩцЙАцЬЙф╗ОцЬНхКбхЩия╝Мш┐Шф╝Ъх░ЖхЖЩхС╜ф╗дхЕещШЯхИ░хдНхИ╢чзпхОЛч╝УхЖ▓хМ║щЗМщЭв</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162311457.png" alt="image-20240916231101419"></p> <p>хЫацндя╝Мф╕╗цЬНхКбхЩичЪДхдНхИ╢чзпхОЛч╝УхЖ▓хМ║щЗМщЭвф╝Ъф┐ЭхнШчЭАф╕АщГихИЖцЬАш┐Сф╝ацТнчЪДхЖЩхС╜ф╗дя╝Мх╣╢ф╕ФхдНхИ╢чзпхОЛч╝УхЖ▓хМ║ф╝Ъф╕║щШЯхИЧф╕нчЪДцпПф╕кхнЧшКВшо░х╜ХчЫ╕х║ФчЪДхдНхИ╢хБПчз╗щЗП</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162311697.png" alt="image-20240916231138657"></p> <p>х╜Уф╗ОцЬНхКбхЩищЗНцЦ░ш┐Юф╕Кф╕╗цЬНхКбхЩицЧ╢я╝Мф╗ОцЬНхКбхЩиф╝ЪщАЪш┐ЗPSYNCхС╜ф╗дх░ЖшЗкх╖▒чЪДхдНхИ╢хБПчз╗щЗПoffsetхПСщАБч╗Щф╕╗цЬНхКбхЩия╝Мф╕╗цЬНхКбхЩиф╝Ъца╣цНош┐Щф╕кхдНхИ╢хБПчз╗щЗПцЭехЖ│хоЪхп╣ф╗ОцЬНхКбхЩицЙзшбМф╜ХчзНхРМцнецУНф╜Ь</p> <ul><li>хжВцЮЬ offset хБПчз╗щЗПф╣ЛхРОчЪДцХ░цНо(ф╣ЯхН│цШпхБПчз╗щЗПoffset+1х╝АхзЛчЪДцХ░цНо)ф╗НчД╢хнШхЬиф║ОхдНхИ╢чзпхОЛч╝УхЖ▓хМ║щЗМщЭвя╝МщВгф╣Иф╕╗цЬНхКбхЩих░Жхп╣ф╗ОцЬНхКбхЩицЙзшбМщГихИЖщЗНхРМцнецУНф╜Ь</li> <li>чЫ╕хПНя╝МхжВцЮЬoffsetхБПчз╗щЗПф╣ЛхРОчЪДцХ░цНох╖▓ч╗Пф╕НхнШхЬиф║ОхдНхИ╢чзпхОЛч╝УхЖ▓хМ║я╝МщВгф╣Иф╕╗цЬНхКбхЩих░Жхп╣ф╗ОцЬНхКбхЩицЙзшбМхоМцХ┤щЗНхРМцнецУНф╜ЬуАВ</li></ul> <p>хЫЮхИ░ф╣ЛхЙНцИСф╗мх▒Хчд║чЪДцЦнч║┐щЗНш┐ЮчЪДф╛ЛхнРя╝Ъ</p> <ol><li><p>х╜Уф╗ОцЬНхКбхЩи A цЦнч║┐ф╣ЛхРОя╝МхоГчлЛхН│щЗНцЦ░ш┐ЮцОеф╕╗цЬНхКбхЩия╝Мх╣╢хРСф╕╗цЬНхКбхЩихПСщАБPSYNCхС╜ф╗дя╝МцКехСКшЗкх╖▒чЪДхдНхИ╢хБПчз╗щЗПф╕║10086</p></li> <li><p>ф╕╗цЬНхКбхЩицФ╢хИ░ф╗ОцЬНхКбхЩихПСцЭечЪДPSYNCхС╜ф╗дф╗ехПКхБПчз╗щЗП10086ф╣ЛхРОя╝Мф╕╗цЬНхКбхЩих░ЖцгАцЯехБПчз╗щЗП10086ф╣ЛхРОчЪДцХ░цНоцШпхРжхнШхЬиф║ОхдНхИ╢чзпхОЛч╝УхЖ▓хМ║щЗМщЭвя╝Мч╗УцЮЬхПСчО░ш┐Щф║ЫцХ░цНоф╗НчД╢хнШхЬия╝Мф║ОцШпф╕╗цЬНхКбхЩихРСф╗ОцЬНхКбхЩихПСщАБ+CONTINUEхЫЮхдНя╝Мшбичд║цХ░цНохРМцнех░Жф╗ещГихИЖщЗНхРМцнецибх╝ПцЭеш┐ЫшбМ</p></li> <li><p>цОечЭАф╕╗цЬНхКбхЩиф╝Ъх░ЖхдНхИ╢чзпхОЛч╝УхЖ▓хМ║10086хБПчз╗щЗПф╣ЛхРОчЪДцЙАцЬЙцХ░цНо(хБПчз╗щЗПф╕║10087шЗ│10119)щГ╜хПСщАБч╗Щф╗ОцЬНхКбхЩи</p></li> <li><p>ф╗ОцЬНхКбхЩихПкшжБцОецФ╢ш┐Щ33хнЧшКВчЪДч╝║хд▒цХ░цНоя╝Мх░▒хПпф╗ехЫЮхИ░ф╕Оф╕╗цЬНхКбхЩиф╕АшЗ┤чЪДчК╢цАБ</p></li></ol> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162314022.png" alt="image-20240916231429983"></p> <h4 id="цЬНхКбхЩиш┐РшбМ-id"><a href="#цЬНхКбхЩиш┐РшбМ-id" class="header-anchor">#</a> цЬНхКбхЩиш┐РшбМ ID</h4> <p>щЩдф║ЖхдНхИ╢хБПчз╗щЗПхТМхдНхИ╢чзпхОЛч╝УхЖ▓хМ║ф╣ЛхдЦя╝МхоЮчО░щГихИЖщЗНхРМцнеш┐ШщЬАшжБчФихИ░цЬНхКбхЩиш┐РшбМID</p> <ul><li>цпПф╕кRedisцЬНхКбхЩия╝Мф╕Ншо║ф╕╗цЬНхКбхЩиш┐ШцШпф╗ОцЬНхКбя╝МщГ╜ф╝ЪцЬЙшЗкх╖▒чЪДш┐РшбМIDуАВ</li> <li>ш┐РшбМIDхЬицЬНхКбхЩихРпхКицЧ╢шЗкхКичФЯцИРя╝МчФ▒40ф╕кщЪПцЬ║чЪДхНБхЕнш┐ЫхИ╢хнЧчмжч╗ДцИРя╝Мф╛ЛхжВ53b9b28df8042fdc9ab5e3fcbbbabff1d5dce2b3</li></ul> <p>х╜Уф╗ОцЬНхКбхЩихп╣ф╕╗цЬНхКбхЩиш┐ЫшбМхИЭцмбхдНхИ╢цЧ╢я╝Мф╕╗цЬНхКбхЩиф╝Ъх░ЖшЗкх╖▒чЪДш┐РшбМIDф╝ащАБч╗Щф╗ОцЬНхКбхЩишАМф╗ОцЬНхКбхЩихИЩф╝Ъх░Жш┐Щф╕кш┐РшбМ ID ф┐ЭхнШш╡╖цЭеуАВ</p> <p>х╜Уф╗ОцЬНхКбхЩицЦнч║┐х╣╢щЗНцЦ░ш┐Юф╕Кф╕Аф╕кф╕╗цЬНхКбхЩицЧ╢я╝Мф╗ОцЬНхКбхЩих░ЖхРСх╜УхЙНш┐ЮцОечЪДф╕╗цЬНхКбхЩихПСщАБф╣ЛхЙНф┐ЭхнШчЪДш┐РшбМ ID:</p> <ul><li>хжВцЮЬф╗ОцЬНхКбхЩиф┐ЭхнШчЪДш┐РшбМIDхТМх╜УхЙНш┐ЮцОечЪДф╕╗цЬНхКбхЩичЪДш┐РшбМIDчЫ╕хРМя╝МщВгф╣Ишп┤цШОф╗ОцЬНхКбхЩицЦнч║┐ф╣ЛхЙНхдНхИ╢чЪДх░▒цШпх╜УхЙНш┐ЮцОечЪДш┐Щф╕кф╕╗цЬНхКбхЩия╝Мф╕╗цЬНхКбхЩихПпф╗еч╗зч╗нх░ЭшпХцЙзшбМщГихИЖщЗНхРМцнецУНф╜ЬуАВ</li> <li>чЫ╕хПНхЬ░я╝МхжВцЮЬф╗ОцЬНхКбхЩиф┐ЭхнШчЪДш┐РшбМIDхТМх╜УхЙНш┐ЮцОечЪДф╕╗цЬНхКбхЩичЪДш┐РшбМIDх╣╢ф╕НчЫ╕хРМщВгф╣Ишп┤цШОф╗ОцЬНхКбхЩицЦнч║┐ф╣ЛхЙНхдНхИ╢чЪДф╕╗цЬНхКбхЩих╣╢ф╕НцШпх╜УхЙНш┐ЮцОечЪДш┐Щф╕кф╕╗цЬНхКбхЩия╝Мф╕╗цЬНхКбхЩих░Жхп╣ф╗ОцЬНхКбхЩицЙзшбМхоМцХ┤щЗНхРМцнецУНф╜ЬуАВ</li></ul> <p>ф╕╛ф╕кф╛ЛхнРя╝МхБЗшо╛ф╗ОцЬНхКбхЩихОЯцЬмцнгхЬихдНхИ╢ф╕Аф╕кш┐РшбМIDф╕║53b9b28df8042fdc9ab5e3fcbbbabff1d5dce2b3чЪДф╕╗цЬНхКбхЩия╝МщВгф╣ИхЬич╜Сч╗ЬцЦнх╝Ая╝Мф╗ОцЬНхКбхЩищЗНцЦ░ш┐ЮцОеф╕Кф╕╗цЬНхКбхЩиф╣ЛхРОя╝Мф╗ОцЬНхКбхЩих░ЖхРСф╕╗цЬНхКбхЩихПСщАБш┐Щф╕кш┐РшбМIDя╝Мф╕╗цЬНхКбхЩица╣цНошЗкх╖▒чЪДш┐РшбМIDцШпхРж53b9b28df8042fdc9ab5e3fcbbbabff1d5dce2b3цЭехИдцЦнцШпцЙзшбМщГихИЖщЗНхРМцнеш┐ШцШпцЙзшбМхоМцХ┤щЗНхРМцне</p> <h3 id="psync-хС╜ф╗дчЪДхоЮчО░"><a href="#psync-хС╜ф╗дчЪДхоЮчО░" class="header-anchor">#</a> PSYNC хС╜ф╗дчЪДхоЮчО░</h3> <p>цИСф╗мх╖▓ч╗Пхнжф╣аф║Ж replication offsetуАБreplication backlogуАБrun ID</p> <p>цОеф╕ЛцЭецИСф╗мцЭехнжф╣а PSYNC чЪДхоМцХ┤ч╗ЖшКВ</p> <p>PSYNC хС╜ф╗дчЪДш░ГчФицЦ╣ц│ХцЬЙф╕дчзН</p> <ul><li>ф╗ОцЬНхКбхЩичЪДхИЭцмбхдНхИ╢я╝ЪхжВцЮЬф╗ОцЬНхКбхЩиф╗ехЙНц▓бцЬЙхдНхИ╢ш┐Зф╗╗ф╜Хф╕╗цЬНхКбхЩия╝МцИЦшАЕф╣ЛхЙНцЙзшбМш┐ЗSLAVEOF no oneхС╜ф╗дя╝МщВгф╣Иф╗ОцЬНхКбхЩихЬих╝АхзЛф╕АцмбцЦ░чЪДхдНхИ╢цЧ╢х░ЖхРСф╕╗цЬНхКбхЩихПСщАБ<code>PSYNC ? -1</code>хС╜ф╗дф╕╗хКишп╖ц▒Вф╕╗цЬНхКбхЩиш┐ЫшбМхоМцХ┤щЗНхРМцне(хЫаф╕║ш┐ЩцЧ╢ф╕НхПпшГ╜цЙзшбМщГихИЖщЗНхРМцне)</li> <li>ф╗ОцЬНхКбхЩичЪДхЖНцмбхдНхИ╢я╝ЪчЫ╕хПНхЬ░я╝МхжВцЮЬф╗ОцЬНхКбхЩих╖▓ч╗ПхдНхИ╢ш┐ЗцЯРф╕кф╕╗цЬНхКбхЩия╝МщВгф╣Иф╗ОцЬНхКбхЩихЬих╝АхзЛф╕АцмбцЦ░чЪДхдНхИ╢цЧ╢х░ЖхРСф╕╗цЬНхКбхЩихПСщАБ <code>PSYNC &lt;runid&gt; &lt;offset&gt;</code> хС╜ф╗дя╝ЪхЕ╢ф╕нrunidцШпф╕Кф╕АцмбхдНхИ╢чЪДф╕╗цЬНхКбхЩичЪДш┐РшбМIDя╝МшАМoffsetхИЩцШпф╗ОцЬНхКбхЩих╜УхЙНчЪДхдНхИ╢хБПчз╗щЗПя╝МцОецФ╢хИ░ш┐Щф╕кхС╜ф╗дчЪДф╕╗цЬНхКбхЩиф╝ЪщАЪш┐Зш┐Щф╕дф╕кхПВцХ░цЭехИдцЦнх║Фшпехп╣ф╗ОцЬНхКбхЩицЙзшбМхУкчзНхРМцнецУНф╜ЬуАВ</li></ul> <p>ца╣цНоцГЕхЖ╡я╝МцОецФ╢хИ░PSYNCхС╜ф╗дчЪДф╕╗цЬНхКбхЩиф╝ЪхРСф╗ОцЬНхКбхЩиш┐ФхЫЮф╗еф╕Лф╕ЙчзНхЫЮхдНчЪДхЕ╢ф╕нф╕АчзНя╝Ъ</p> <ul><li>хжВцЮЬф╕╗цЬНхКбхЩиш┐ФхЫЮ<code>+FULLRESYNC &lt;runid&gt; &lt;offset&gt;</code>хЫЮхдНя╝МщВгф╣Ишбичд║ф╕╗цЬНхКбхЩих░Жф╕Оф╗ОцЬНхКбхЩицЙзшбМхоМцХ┤щЗНхРМцнецУНф╜Ья╝ЪхЕ╢ф╕нrunidцШпш┐Щф╕кф╕╗цЬНхКбхЩичЪДш┐РшбМIDя╝Мф╗ОцЬНхКбхЩиф╝Ъх░Жш┐Щф╕кIDф┐ЭхнШш╡╖цЭея╝МхЬиф╕Лф╕АцмбхПСщАБPSYNCхС╜ф╗дцЧ╢ф╜┐чФи;шАМoffsetхИЩцШпф╕╗цЬНхКбхЩих╜УхЙНчЪДхдНхИ╢хБПчз╗щЗПя╝Мф╗ОцЬНхКбхЩиф╝Ъх░Жш┐Щф╕кхА╝ф╜Ьф╕║шЗкх╖▒чЪДхИЭхзЛхМЦхБПчз╗щЗПуАВ</li> <li>хжВцЮЬф╕╗цЬНхКбхЩиш┐ФхЫЮ<code>+CONTINUE</code>хЫЮхдНя╝МщВгф╣Ишбичд║ф╕╗цЬНхКбхЩих░Жф╕Оф╗ОцЬНхКбхЩицЙзшбМщГихИЖщЗНхРМцнецУНф╜Ья╝Мф╗ОцЬНхКбхЩихПкшжБчнЙчЭАф╕╗цЬНхКбхЩих░ЖшЗкх╖▒ч╝║х░СчЪДщВгщГихИЖцХ░цНохПСщАБш┐ЗцЭех░▒хПпф╗еф║ЖуАВ</li> <li>хжВцЮЬф╕╗цЬНхКбхЩиш┐ФхЫЮ<code>-ERR</code>хЫЮхдНя╝МщВгф╣Ишбичд║ф╕╗цЬНхКбхЩичЪДчЙИцЬмф╜Оф║ОRedis 2.8я╝МхоГшпЖхИлф╕Нф║ЖPSYNCхС╜ф╗дя╝Мф╗ОцЬНхКбхЩих░ЖхРСф╕╗цЬНхКбхЩихПСщАБSYNCхС╜ф╗дя╝Мх╣╢ф╕Оф╕╗цЬНхКбхЩицЙзшбМхоМцХ┤хРМцнецУНф╜ЬуАВ</li></ul> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162321766.png" alt="image-20240916232103714"></p> <h2 id="хдНхИ╢ц╡БчиЛф╕▓шБФ"><a href="#хдНхИ╢ц╡БчиЛф╕▓шБФ" class="header-anchor">#</a> хдНхИ╢ц╡БчиЛф╕▓шБФ</h2> <p>ф╣ЛхЙНцИСф╗мшо▓ш┐░ф║ЖцЦ░цЧзчЙИцЬмчЪДхдНхИ╢ч╗ЖшКВя╝МчО░хЬицИСф╗мх░ЖцХ┤ф╕кхдНхИ╢ц╡БчиЛф╕▓шБФхИ░ Redis ф╕╗ч║┐ф╣Лф╕н</p> <h4 id="цнещкд-1-шо╛ч╜оф╕╗цЬНхКбхЩичЪДхЬ░хЭАхТМчлпхПг"><a href="#цнещкд-1-шо╛ч╜оф╕╗цЬНхКбхЩичЪДхЬ░хЭАхТМчлпхПг" class="header-anchor">#</a> цнещкд 1я╝Ъшо╛ч╜оф╕╗цЬНхКбхЩичЪДхЬ░хЭАхТМчлпхПг</h4> <p>х╜УховцИ╖члпхРСф╗ОцЬ║хПСщАБ <code>SLAVEOF 127.0.0.16379</code> хС╜ф╗дчЪДцЧ╢хАЩя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">redisServer</span><span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
    <span class="token comment">//ф╕╗цЬНхКбхЩичЪДхЬ░хЭА</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>masterhost<span class="token punctuation">;</span>
    <span class="token comment">//ф╕╗цЬНхКбхЩичЪДчлпхПг</span>
    <span class="token keyword">int</span> masterport<span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ф╗ОцЬ║хЬи redisServer ч╗УцЮДф╜У ф╕ншо╛ч╜оф╕╗цЬНхКбхЩичЪДхЬ░хЭАхТМчлпхПг</p> <div class="custom-block warning"><p class="custom-block-title">ц│ицДП</p> <p>SLAVEOFхС╜ф╗дцШпф╕Аф╕кх╝ВцнехС╜ф╗дя╝МхЬихоМцИРmasterhostх▒ЮцАзхТМmasterportх▒ЮцАзчЪДшо╛ч╜ох╖еф╜Ьф╣ЛхРОя╝Мф╗ОцЬНхКбхЩих░ЖхРСхПСщАБSLAVEOFхС╜ф╗дчЪДховцИ╖члпш┐ФхЫЮOKя╝Мшбичд║хдНхИ╢цМЗф╗дх╖▓ч╗ПшвлцОецФ╢я╝МшАМхоЮщЩЕчЪДхдНхИ╢х╖еф╜Ьх░ЖхЬи OKш┐ФхЫЮф╣ЛхРОцЙНчЬЯцнгх╝АхзЛцЙзшбМуАВ</p></div> <h4 id="цнещкд-2-х╗║члЛхеЧцОехнЧш┐ЮцОе"><a href="#цнещкд-2-х╗║члЛхеЧцОехнЧш┐ЮцОе" class="header-anchor">#</a> цнещкд 2я╝Ъх╗║члЛхеЧцОехнЧш┐ЮцОе</h4> <p>хЬиSLAVEOFхС╜ф╗дцЙзшбМф╣ЛхРОя╝Мф╗ОцЬНхКбхЩих░Жца╣цНохС╜ф╗дцЙАшо╛ч╜очЪДIPхЬ░хЭАхТМчлпхПгя╝МхИЫх╗║ш┐ЮхРСф╕╗цЬНхКбхЩичЪДхеЧцОехнЧш┐ЮцОе</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162326318.png" alt="image-20240916232654277"></p> <p>хжВцЮЬф╗ОцЬНхКбхЩихИЫх╗║чЪДхеЧцОехнЧшГ╜цИРхКЯш┐ЮцОе(connect)хИ░ф╕╗цЬНхКбхЩия╝МщВгф╣Иф╗ОцЬНхКбхЩих░Жф╕║ш┐Щф╕кхеЧцОехнЧхЕ│шБФф╕Аф╕кф╕УщЧичФиф║ОхдДчРЖхдНхИ╢х╖еф╜ЬчЪДцЦЗф╗╢ф║Лф╗╢хдДчРЖхЩия╝Мш┐Щф╕кхдДчРЖхЩих░Жш┤Яш┤гцЙзшбМхРОч╗нчЪДхдНхИ╢х╖еф╜Ья╝МцпФхжВцОецФ╢RDBцЦЗф╗╢я╝Мф╗ехПКцОецФ╢ф╕╗цЬНхКбхЩиф╝ацТнцЭечЪДхЖЩхС╜ф╗дя╝Мшп╕хжВцндч▒╗</p> <p>шАМф╕╗цЬНхКбхЩихЬицОехПЧ(accept)ф╗ОцЬНхКбхЩичЪДхеЧцОехнЧш┐ЮцОеф╣ЛхРОя╝Мх░Жф╕║шпехеЧцОехнЧхИЫх╗║чЫ╕х║ФчЪДховцИ╖члпчК╢цАБя╝Мх╣╢х░Жф╗ОцЬНхКбхЩи<strong>чЬЛф╜ЬцШпф╕Аф╕кш┐ЮцОехИ░ф╕╗цЬНхКбхЩичЪДховцИ╖члпцЭехп╣х╛Е</strong>я╝Мш┐ЩцЧ╢ф╗ОцЬНхКбхЩих░ЖхРМцЧ╢хЕ╖цЬЙцЬНхКбхЩи(server)хТМховцИ╖члп(client)ф╕дф╕кш║лф╗╜:ф╗ОцЬНхКбхЩихПпф╗ехРСф╕╗цЬНхКбхЩихПСщАБхС╜ф╗дшп╖ц▒Вя╝МшАМф╕╗цЬНхКбхЩихИЩф╝ЪхРСф╗ОцЬНхКбхЩиш┐ФхЫЮхС╜ф╗дхЫЮхдНя╝М</p> <h4 id="цнещкд-3-хПСщАБ-ping-хС╜ф╗д"><a href="#цнещкд-3-хПСщАБ-ping-хС╜ф╗д" class="header-anchor">#</a> цнещкд 3я╝ЪхПСщАБ PING хС╜ф╗д</h4> <p><strong>ф╕АхЫ╛ф╗ешФ╜ф╣Л</strong></p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162329994.png" alt="image-20240916232918955"></p> <h4 id="цнещкд4-ш║лф╗╜щкМшпБ"><a href="#цнещкд4-ш║лф╗╜щкМшпБ" class="header-anchor">#</a> цнещкд4 ш║лф╗╜щкМшпБ</h4> <p>ф╗ОцЬНхКбхЩихЬицФ╢хИ░ф╕╗цЬНхКбхЩиш┐ФхЫЮчЪД&quot;PONG&quot;хЫЮхдНф╣ЛхРОя╝Мф╕Лф╕АцнешжБхБЪчЪДх░▒цШпхЖ│хоЪцШпхРжш┐ЫшбМш║лф╗╜щкМшпБ:</p> <ul><li>хжВцЮЬф╗ОцЬНхКбхЩишо╛ч╜оф║ЖmasterauthщАЙщб╣я╝МщВгф╣Иш┐ЫшбМш║лф╗╜щкМшпБ</li> <li>хжВцЮЬф╗ОцЬНхКбхЩиц▓бцЬЙшо╛ч╜оmasterauthщАЙщб╣я╝МщВгф╣Иф╕Нш┐ЫшбМш║лф╗╜щкМшпБ</li></ul> <p>хЬищЬАшжБш┐ЫшбМш║лф╗╜щкМшпБчЪДцГЕхЖ╡ф╕Ля╝Мф╗ОцЬНхКбхЩи<strong>ф╕╗хКи</strong>х░ЖхРСф╕╗цЬНхКбхЩихПСщАБф╕АцЭбAUTHхС╜ф╗дя╝МхС╜ф╗дчЪДхПВцХ░ф╕║ф╗ОцЬНхКбхЩиmasterauthщАЙщб╣чЪДхА╝</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162330372.png" alt="image-20240916233047333"></p> <p>цХ┤ф╕кц╡БчиЛхжВф╕ЛцЙАчд║</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162331709.png" alt="image-20240916233107656"></p> <h4 id="цнещкд5-хПСщАБчлпхПгф┐бцБп"><a href="#цнещкд5-хПСщАБчлпхПгф┐бцБп" class="header-anchor">#</a> цнещкд5я╝ЪхПСщАБчлпхПгф┐бцБп</h4> <p>хЬиш║лф╗╜щкМшпБцнещкдф╣ЛхРОя╝Мф╗ОцЬНхКбхЩих░ЖцЙзшбМхС╜ф╗д<code>REPLCONF listening-port &lt;port-number&gt;</code>я╝МхРСф╕╗цЬНхКбхЩи<strong>хПСщАБф╗ОцЬНхКбхЩичЪДчЫСхРмчлпхПгхП╖</strong> <img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162332673.png" alt="image-20240916233230639"></p> <p>ф╕╗цЬНхКбхЩихЬицОецФ╢хИ░ш┐Щф╕кхС╜ф╗дф╣ЛхРОя╝Мф╝Ъх░ЖчлпхПгхП╖шо░х╜ХхЬиф╗ОцЬНхКбхЩицЙАхп╣х║ФчЪДховцИ╖члпчК╢цАБчЪДslave listening portх▒ЮцАзф╕н:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisClient</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">//ф╗ОцЬНхКбхЩичЪДчЫСхРмчлпхПгхП╖</span>
    <span class="token keyword">int</span> slave listening port<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>redisClient<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>slave_listening_port х▒ЮцАзчЫохЙНхФпф╕АчЪДф╜ЬчФих░▒цШпхЬиф╕╗цЬНхКбхЩицЙзшбМINFO replication хС╜ф╗дцЧ╢цЙУхН░хЗ║ф╗ОцЬНхКбхЩичЪДчлпхПгхП╖</p></blockquote> <h4 id="цнещкд6-хРМцне"><a href="#цнещкд6-хРМцне" class="header-anchor">#</a> цнещкд6я╝ЪхРМцне</h4> <p>хЬиш┐Щф╕Ацнея╝Мф╗ОцЬНхКбхЩих░ЖхРСф╕╗цЬНхКбхЩихПСщАБPSYNCхС╜ф╗дя╝МцЙзшбМхРМцнецУНф╜Ья╝Мх╣╢х░ЖшЗкх╖▒чЪДцХ░цНох║УцЫ┤цЦ░шЗ│ф╕╗цЬНхКбхЩицХ░цНох║Ух╜УхЙНцЙАхдДчЪДчК╢цАБуАВ
хА╝х╛Чф╕АцПРчЪДцШпя╝МхЬихРМцнецУНф╜ЬцЙзшбМф╣ЛхЙНя╝МхПкцЬЙф╗ОцЬНхКбхЩицШпф╕╗цЬНхКбхЩичЪДховцИ╖члпя╝Мф╜ЖцШпхЬицЙзшбМхРМцнецУНф╜Ьф╣ЛхРОя╝Мф╕╗цЬНхКбхЩиф╣Яф╝ЪцИРф╕║ф╗ОцЬНхКбхЩичЪДховцИ╖члп</p> <ul><li>хжВцЮЬPSYNCхС╜ф╗дцЙзшбМчЪДцШпхоМцХ┤щЗНхРМцнецУНф╜Ья╝МщВгф╣Иф╕╗цЬНхКбхЩищЬАшжБцИРф╕║ф╗ОцЬНхКбхЩичЪДховцИ╖члпя╝МцЙНшГ╜х░Жф┐ЭхнШхЬич╝УхЖ▓хМ║щЗМщЭвчЪДхЖЩхС╜ф╗дхПСщАБч╗Щф╗ОцЬНхКбхЩицЙзшбМуАВ</li> <li>хжВцЮЬPSYNCхС╜ф╗дцЙзшбМчЪДцШпщГихИЖщЗНхРМцнецУНф╜Ья╝МщВгф╣Иф╕╗цЬНхКбхЩищЬАшжБцИРф╕║ф╗ОцЬНхКбхЩичЪДховцИ╖члпя╝МцЙНшГ╜хРСф╗ОцЬНхКбхЩихПСщАБф┐ЭхнШхЬихдНхИ╢чзпхОЛч╝УхЖ▓хМ║щЗМщЭвчЪДхЖЩхС╜ф╗дуАВ</li></ul> <p>хЫацндя╝МхЬихРМцнецУНф╜ЬцЙзшбМф╣ЛхРОя╝М<strong>ф╕╗ф╗ОцЬНхКбхЩихПМцЦ╣щГ╜цШпхп╣цЦ╣чЪДховцИ╖члп</strong>я╝МхоГф╗мхПпф╗еф║ТчЫ╕хРСхп╣цЦ╣хПСщАБхС╜ф╗дшп╖ц▒Вя╝МцИЦшАЕф║ТчЫ╕хРСхп╣цЦ╣ш┐ФхЫЮхС╜ф╗дхЫЮхдН</p> <p><strong>цнгхЫаф╕║ф╕╗цЬНхКбхЩицИРф╕║ф║Жф╗ОцЬНхКбхЩичЪДховцИ╖члп</strong>я╝МцЙАф╗еф╕╗цЬНхКбхЩицЙНхПпф╗ещАЪш┐ЗхПСщАБхЖЩхС╜ф╗дцЭецФ╣хПШф╗ОцЬНхКбхЩичЪДцХ░цНох║УчК╢цАБя╝Мф╕Нф╗ЕхРМцнецУНф╜ЬщЬАшжБчФихИ░ш┐Щф╕АчВ╣я╝Мш┐Щф╣ЯцШпф╕╗цЬНхКбхЩихп╣ф╗ОцЬНхКбхЩицЙзшбМхС╜ф╗дф╝ацТнчЪДхЯ║чбАцУНф╜Ь</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409162335542.png" alt="image-20240916233549490"></p> <h4 id="цнещкд-7-хС╜ф╗дф╝ацТн"><a href="#цнещкд-7-хС╜ф╗дф╝ацТн" class="header-anchor">#</a> цнещкд 7я╝ЪхС╜ф╗дф╝ацТн</h4> <p>х╜УхоМцИРф║ЖхРМцнеф╣ЛхРОя╝Мф╕╗ф╗ОцЬНхКбхЩих░▒ф╝Ъш┐ЫхЕехС╜ф╗дф╝ацТнщШ╢цо╡я╝Мш┐ЩцЧ╢ф╕╗цЬНхКбхЩихПкшжБф╕АчЫ┤х░ЖшЗкх╖▒цЙзшбМчЪДхЖЩхС╜ф╗дхПСщАБч╗Щф╗ОцЬНхКбхЩия╝МшАМф╗ОцЬНхКбхЩихПкшжБф╕АчЫ┤цОецФ╢х╣╢цЙзшбМф╕╗цЬНхКбхЩихПСцЭечЪДхЖЩхС╜ф╗дя╝Мх░▒хПпф╗еф┐ЭшпБф╕╗ф╗ОцЬНхКбхЩиф╕АчЫ┤ф┐ЭцМБф╕АшЗ┤ф║Ж</p> <h2 id="х┐Гш╖│цгАц╡Л"><a href="#х┐Гш╖│цгАц╡Л" class="header-anchor">#</a> х┐Гш╖│цгАц╡Л</h2> <p>хЬихС╜ф╗дф╝ацТнщШ╢цо╡я╝Мф╗ОцЬНхКбхЩищ╗Шшодф╝Ъф╗ецпПчзТф╕АцмбчЪДщвСчОЗя╝МхРСф╕╗цЬНхКбхЩихПСщАБхС╜ф╗д<code>REPLCONF ACK &lt;replication offset&gt;</code></p> <p>хЕ╢ф╕нreplication offsetцШпф╗ОцЬНхКбхЩих╜УхЙНчЪДхдНхИ╢хБПчз╗щЗПуАВ</p> <p>хПСщАБREPLCONFACKхС╜ф╗дхп╣ф║Оф╕╗ф╗ОцЬНхКбхЩицЬЙф╕Йф╕кф╜ЬчФи</p> <ul><li>цгАц╡Лф╕╗ф╗ОцЬНхКбхЩичЪДч╜Сч╗Ьш┐ЮцОечК╢цАБ</li> <li>ш╛ЕхКйхоЮчО░ min-slaves щАЙщб╣</li> <li>цгАц╡ЛхС╜ф╗дф╕вхд▒</li></ul> <h4 id="цгАц╡Лф╕╗ф╗ОцЬНхКбхЩичЪДч╜Сч╗Ьш┐ЮцОечК╢цАБ"><a href="#цгАц╡Лф╕╗ф╗ОцЬНхКбхЩичЪДч╜Сч╗Ьш┐ЮцОечК╢цАБ" class="header-anchor">#</a> цгАц╡Лф╕╗ф╗ОцЬНхКбхЩичЪДч╜Сч╗Ьш┐ЮцОечК╢цАБ</h4> <p>ф╕╗ф╗ОцЬНхКбхЩихПпф╗ещАЪш┐ЗхПСщАБхТМцОецФ╢REPLCONFACKхС╜ф╗дцЭецгАцЯеф╕дшАЕф╣ЛщЧ┤чЪДч╜Сч╗Ьш┐ЮцОецШпхРжцнгх╕╕:хжВцЮЬф╕╗цЬНхКбхЩиш╢Еш┐Зф╕АчзТщТЯц▓бцЬЙцФ╢хИ░ф╗ОцЬНхКбхЩихПСцЭечЪДREPLCONFACKхС╜ф╗дя╝МщВгф╣Иф╕╗цЬНхКбхЩих░▒чЯещБУф╕╗ф╗ОцЬНхКбхЩиф╣ЛщЧ┤чЪДш┐ЮцОехЗ║чО░щЧощвШф║Ж</p> <h4 id="ш╛ЕхКйхоЮчО░-min-slaves-щЕНч╜ощАЙщб╣"><a href="#ш╛ЕхКйхоЮчО░-min-slaves-щЕНч╜ощАЙщб╣" class="header-anchor">#</a> ш╛ЕхКйхоЮчО░ min-slaves щЕНч╜ощАЙщб╣</h4> <p>Redis чЪД <code>min-slaves-to-write</code> хТМ <code>min-slaves-max-lag</code> ф╕дф╕кщАЙщб╣хПпф╗ещШ▓цнвф╕╗цЬНхКбхЩихЬиф╕НхоЙхЕичЪДцГЕхЖ╡ф╕ЛцЙзшбМхЖЩхС╜ф╗д</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬцИСф╗мхРСф╕╗цЬНхКбхЩицПРф╛Ыф╗еф╕Лшо╛ч╜о</p> <ul><li>min-slaves-to-write 3</li> <li>min-slaves-max-lag 10</li></ul> <p>щВгф╣ИхЬиф╗ОцЬНхКбхЩичЪДцХ░щЗПх░Сф║О3ф╕кя╝МцИЦшАЕф╕Йф╕кф╗ОцЬНхКбхЩичЪДх╗╢ш┐Я(lag)хА╝щГ╜хдзф║ОцИЦчнЙф║О10чзТцЧ╢я╝Мф╕╗цЬНхКбхЩих░ЖцЛТч╗ЭцЙзшбМхЖЩхС╜ф╗д</p> <h4 id="цгАц╡ЛхС╜ф╗дф╕вхд▒"><a href="#цгАц╡ЛхС╜ф╗дф╕вхд▒" class="header-anchor">#</a> цгАц╡ЛхС╜ф╗дф╕вхд▒</h4> <p>хжВцЮЬхЫаф╕║ч╜Сч╗ЬцХЕщЪЬя╝Мф╕╗цЬНхКбхЩиф╝ацТнч╗Щф╗ОцЬНхКбхЩичЪДхЖЩхС╜ф╗дхЬихНКш╖пф╕вхд▒я╝МщВгф╣Их╜Уф╗ОцЬНхКбхЩихРСф╕╗цЬНхКбхЩихПСщАБ REPLCONF ACK хС╜ф╗дцЧ╢я╝Мф╕╗цЬНхКбхЩих░ЖхПСшзЙф╗ОцЬНхКбхЩих╜УхЙНчЪДхдНхИ╢хБПчз╗щЗПх░Сф║ОшЗкх╖▒чЪДхдНхИ╢хБПчз╗щЗПя╝МчД╢хРОф╕╗цЬНхКбхЩих░▒ф╝Ъца╣цНоф╗ОцЬНхКбхЩицПРф║дчЪДхдНхИ╢хБПчз╗щЗПя╝МхЬихдНхИ╢чзпхОЛч╝УхЖ▓хМ║щЗМщЭвцЙ╛хИ░ф╗ОцЬНхКбхЩич╝║х░СчЪДцХ░цНоя╝Мх╣╢х░Жш┐Щф║ЫцХ░цНощЗНцЦ░хПСщАБч╗Щф╗ОцЬНхКбхЩи</p> <p><strong>х╖▓ч╗Пф╜┐чФи TCP ф║Жя╝Мф╕║ф╗Аф╣Иш┐ШшжБф┐ЭшпБц╢ИцБпхПпщЭаф╝аш╛╛?</strong></p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409170039124.png" alt="цЬЙф║ЖTCPф╕║ф╗Аф╣Иш┐ШшжБф┐ЭшпБхПпщЭацАзф╝аш╛╛"></p> <div class="custom-block warning"><p class="custom-block-title">ц│ицДП</p> <ul><li>хЬиф╝аш╛Ух▒Вя╝МTCPчЪДф╕ЙцмбцПбцЙЛф┐ЭшпБф║ЖхПМцЦ╣щАЪшопчЪДхПпщЭацАзя╝Мчи│хоЪцАзуАВчоАшАМшиАф╣Ля╝МчФицИ╖хПСщАБчЪДц╢ИцБпя╝М хЬих┐╜шзЖх║ФчФих▒ВчЪДцГЕхЖ╡ф╕Ля╝МцЧашо║хжВф╜ХщГ╜ф╝Ъф╗ОшЗкш║лф╕╗цЬ║чЪД тАЬхПСщАБч╝УхЖ▓хМ║тАЭ цК╡ш╛╛хп╣цЦ╣ф╕╗цЬ║чЪД тАЬцОецФ╢ч╝УхЖ▓хМ║тАЭ</li> <li>хЬих║ФчФих▒Вя╝МцХ░цНохМЕцЬЙхПпшГ╜хЫаф╕║чФицИ╖чкБчД╢чЪДхИЗхРОхП░цИЦшАЕцШпх╝▒ч╜СчК╢цАБхп╝шЗ┤ц▓бц│Хф╗ОцУНф╜Ьч│╗ч╗ЯхЖЕца╕цК╡ш╛╛х║ФчФих▒Вя╝МхПНф╣Лф╣ЯцШпхжВцнд, ф╕║цнд,цИСф╗мщЬАшжБхЬих║ФчФих▒ВхБЪхе╜хПпщЭаф╝аш╛УхНПшоочЪДф┐ЭшпБя╝МщШ▓цнвцХ░цНоф╕вхд▒чЪДцГЕхЖ╡</li></ul></div> <h2 id="ф╕╗ф╗ОхдНхИ╢чЪДшзжхПСцЧ╢цЬ║"><a href="#ф╕╗ф╗ОхдНхИ╢чЪДшзжхПСцЧ╢цЬ║" class="header-anchor">#</a> ф╕╗ф╗ОхдНхИ╢чЪДшзжхПСцЧ╢цЬ║</h2> <ol><li><strong>ф╗ОшКВчВ╣щжЦцмбхРпхКицИЦщЗНцЦ░ш┐ЮцОецЧ╢</strong>я╝Ъф╗ОшКВчВ╣ш┐ЮцОехИ░ф╕╗шКВчВ╣хРОя╝МшзжхПСхЕищЗПцИЦхвЮщЗПхРМцнеуАВ</li> <li><strong>ф╕╗шКВчВ╣цЬЙцХ░цНоцЫ┤цЦ░цЧ╢</strong>я╝Ъф╕╗шКВчВ╣цпПцмбцЙзшбМхЖЩцУНф╜ЬхРОя╝МхвЮщЗПцХ░цНоф╝ЪхоЮцЧ╢хРМцнеч╗Щф╗ОшКВчВ╣уАВ</li> <li><strong>ф╕╗шКВчВ╣чЪДцЙЛхКицИЦшЗкхКихдЗф╗╜цУНф╜Ь</strong>я╝ЪцЙзшбМ <code>BGSAVE</code>уАБ<code>BGREWRITEAOF</code> чнЙхС╜ф╗дцЧ╢я╝МхПпшГ╜шзжхПСф╕╗ф╗ОцХ░цНохРМцнеуАВ</li> <li><strong>ф╕╗ф╗ОщЕНч╜охПШцЫ┤цИЦцХЕщЪЬш╜мчз╗цЧ╢</strong>я╝ЪхжВщАЪш┐З Sentinel цИЦщЫЖч╛дцибх╝Пш┐ЫшбМцХЕщЪЬш╜мчз╗я╝МцИЦшАЕцЙЛхКицЙзшбМ <code>SLAVEOF</code> хС╜ф╗дцЧ╢я╝Мф╗ОшКВчВ╣ф╝ЪщЗНцЦ░ф╕ОцЦ░чЪДф╕╗шКВчВ╣хРМцнеуАВ</li> <li><strong>ф╗ОшКВчВ╣ф╕╗хКишп╖ц▒ВхРМцне</strong>я╝Ъф╗ОшКВчВ╣шР╜хРОф║Оф╕╗шКВчВ╣чЪДцХ░цНоцИЦхЗ║чО░ф╕Нф╕АшЗ┤цЧ╢я╝Мф╝Ъф╕╗хКишп╖ц▒Вф╕╗шКВчВ╣щЗНцЦ░хРМцнеуАВ</li> <li><strong>хдНхИ╢чзпхОЛч╝УхЖ▓хМ║ц║вхЗ║</strong>я╝ЪхжВцЮЬф╗ОшКВчВ╣щХ┐цЧ╢щЧ┤цЬкхРМцнея╝Мф╕╗шКВчВ╣чЪДч╝УхЖ▓хМ║ц║вхЗ║я╝МшзжхПСхЕищЗПхРМцнеуАВ</li></ol> <h2 id="цА╗ч╗У"><a href="#цА╗ч╗У" class="header-anchor">#</a> цА╗ч╗У</h2> <ul><li>Redis 2.8 ф╗ехЙНчЪДхдНхИ╢хКЯшГ╜ф╕НшГ╜щлШцХИхЬ░хдДчРЖцЦнч║┐хРОщЗНхдНхИ╢цГЕхЖ╡я╝Мф╜ЖRedis 2.8цЦ░ц╖╗хКачЪДщГихИЖщЗНхРМцнехКЯшГ╜хПпф╗ешзгхЖ│ш┐Щф╕кщЧощвШуАВ</li> <li>щГихИЖщЗНхРМцнещАЪш┐ЗхдНхИ╢хБПчз╗щЗПуАБхдНхИ╢чзпхОЛч╝УхЖ▓хМ║уАБцЬНхКбхЩиш┐РшбМIDф╕Йф╕кщГихИЖцЭехоЮчО░</li> <li>хЬихдНхИ╢цУНф╜ЬхИЪх╝АхзЛчЪДцЧ╢хАЩя╝Мф╗ОцЬНхКбхЩиф╝ЪцИРф╕║ф╕╗цЬНхКбхЩичЪДховцИ╖члпя╝Мх╣╢щАЪш┐ЗхРСф╕╗цЬНхКбхЩихПСщАБхС╜ф╗дшп╖ц▒ВцЭецЙзшбМхдНхИ╢цнещкдя╝МшАМхЬихдНхИ╢цУНф╜ЬчЪДхРОцЬЯя╝Мф╕╗ф╗ОцЬНхКбхЩиф╝Ъф║ТчЫ╕цИРф╕║хп╣цЦ╣чЪДховцИ╖члпуАВ</li> <li>ф╕╗цЬНхКбхЩищАЪш┐ЗхРСф╗ОцЬНхКбхЩиф╝ацТнхС╜ф╗дцЭецЫ┤цЦ░ф╗ОцЬНхКбхЩичЪДчК╢цАБя╝Мф┐ЭцМБф╕╗ф╗ОцЬНхКбхЩиф╕АшЗ┤шАМф╗ОцЬНхКбхЩихИЩщАЪш┐ЗхРСф╕╗цЬНхКбхЩихПСщАБхС╜ф╗дцЭеш┐ЫшбМх┐Гш╖│цгАц╡Ля╝Мф╗ехПКхС╜ф╗дф╕вхд▒цгАц╡ЛуАВ</li></ul> <h2 id="хПВшАГцЦЗчМо"><a href="#хПВшАГцЦЗчМо" class="header-anchor">#</a> хПВшАГцЦЗчМо</h2> <p><a href="https://www.cnblogs.com/cooffeeli/p/redis_master_slave.html" target="_blank" rel="noopener noreferrer">х╜╗х║ХцРЮцЗВRedisф╕╗ф╗ОхдНхИ╢хОЯчРЖхПКхоЮцИШ - cooffeeli - хНЪховхЫн (cnblogs.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/kismetv/p/9236731.html" target="_blank" rel="noopener noreferrer">ц╖▒хЕехнжф╣аRedisя╝И3я╝Йя╝Ъф╕╗ф╗ОхдНхИ╢ - ч╝ЦчиЛш┐╖цАЭ - хНЪховхЫн (cnblogs.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Redis ч│╗ч╗Яшо╛шоб/05.щЫЖч╛д/25.ф╕╗ф╗ОхдНхИ╢.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/16, 16:44:31</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/aa75e9/" class="prev">Redis ф╕нчЪДх╗╢ш┐ЯчЫСцОз</a></span> <span class="next"><a href="/pages/af8752/">хУихЕ╡</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fbf7e221.js" defer></script><script src="/assets/js/2.c1dbdf51.js" defer></script><script src="/assets/js/53.e4e2486c.js" defer></script>
  </body>
</html>
