<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis Server хИЭхзЛхМЦ | Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.473bdd25.css" as="style"><link rel="preload" href="/assets/js/app.3449399e.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/45.52725702.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.8539d2c4.js"><link rel="prefetch" href="/assets/js/11.71fe9642.js"><link rel="prefetch" href="/assets/js/12.915fdd22.js"><link rel="prefetch" href="/assets/js/13.d9d26d25.js"><link rel="prefetch" href="/assets/js/14.397b7600.js"><link rel="prefetch" href="/assets/js/15.13af8159.js"><link rel="prefetch" href="/assets/js/16.2b4d4184.js"><link rel="prefetch" href="/assets/js/17.1f44d5e0.js"><link rel="prefetch" href="/assets/js/18.504b80bb.js"><link rel="prefetch" href="/assets/js/19.c5a27579.js"><link rel="prefetch" href="/assets/js/20.b5e0fdf1.js"><link rel="prefetch" href="/assets/js/21.af1069aa.js"><link rel="prefetch" href="/assets/js/22.af583a75.js"><link rel="prefetch" href="/assets/js/23.f8a8e8e0.js"><link rel="prefetch" href="/assets/js/24.88b84218.js"><link rel="prefetch" href="/assets/js/25.db0f299d.js"><link rel="prefetch" href="/assets/js/26.dc5ac22f.js"><link rel="prefetch" href="/assets/js/27.e82ff876.js"><link rel="prefetch" href="/assets/js/28.6b737928.js"><link rel="prefetch" href="/assets/js/29.ebd14054.js"><link rel="prefetch" href="/assets/js/3.aa815192.js"><link rel="prefetch" href="/assets/js/30.ed6ead0e.js"><link rel="prefetch" href="/assets/js/31.89a26765.js"><link rel="prefetch" href="/assets/js/32.f1016cda.js"><link rel="prefetch" href="/assets/js/33.fa9fdf81.js"><link rel="prefetch" href="/assets/js/34.9740832c.js"><link rel="prefetch" href="/assets/js/35.ac8dd46f.js"><link rel="prefetch" href="/assets/js/36.8aa375d9.js"><link rel="prefetch" href="/assets/js/37.381f3758.js"><link rel="prefetch" href="/assets/js/38.b82e8635.js"><link rel="prefetch" href="/assets/js/39.5259c5c3.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.92a2ab0c.js"><link rel="prefetch" href="/assets/js/41.5525b2c4.js"><link rel="prefetch" href="/assets/js/42.825c6423.js"><link rel="prefetch" href="/assets/js/43.1f07064b.js"><link rel="prefetch" href="/assets/js/44.f4a3c564.js"><link rel="prefetch" href="/assets/js/46.73e4ddcb.js"><link rel="prefetch" href="/assets/js/47.7372c922.js"><link rel="prefetch" href="/assets/js/48.4ae5a7da.js"><link rel="prefetch" href="/assets/js/49.5d33831c.js"><link rel="prefetch" href="/assets/js/5.1875cdb3.js"><link rel="prefetch" href="/assets/js/50.ededdb64.js"><link rel="prefetch" href="/assets/js/51.88874359.js"><link rel="prefetch" href="/assets/js/52.a86508e6.js"><link rel="prefetch" href="/assets/js/53.a8d66d87.js"><link rel="prefetch" href="/assets/js/54.89dcf983.js"><link rel="prefetch" href="/assets/js/55.30c89211.js"><link rel="prefetch" href="/assets/js/56.249d1e23.js"><link rel="prefetch" href="/assets/js/57.ae215963.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/assets/js/9.6e274fca.js">
    <link rel="stylesheet" href="/assets/css/0.styles.473bdd25.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Echo ч│╗ч╗Яшо╛шобф╣Лч╛О" class="logo"> <span class="site-name can-hide">Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>цМЗхНЧ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>хЯ║чбА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ф╕╗ч║┐</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/34fa27/" class="sidebar-link">Linux ф╕нчЪД IO хдЪш╖пхдНчФи</a></li><li><a href="/pages/d4ecb9/" aria-current="page" class="active sidebar-link">Redis Server хИЭхзЛхМЦ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d4ecb9/#хЙНшиА" class="sidebar-link">хЙНшиА</a></li><li class="sidebar-sub-header level2"><a href="/pages/d4ecb9/#main-хЗ╜цХ░-redis-server-чЪДхЕехПг" class="sidebar-link">main хЗ╜цХ░я╝ЪRedis server чЪДхЕехПг</a></li><li class="sidebar-sub-header level2"><a href="/pages/d4ecb9/#redis-ш┐РшбМхПВцХ░шзгцЮРф╕Ошо╛ч╜о" class="sidebar-link">Redis ш┐РшбМхПВцХ░шзгцЮРф╕Ошо╛ч╜о</a></li><li class="sidebar-sub-header level2"><a href="/pages/d4ecb9/#initserver-хИЭхзЛхМЦ-redis-server" class="sidebar-link">initServerя╝ЪхИЭхзЛхМЦ Redis server</a></li><li class="sidebar-sub-header level2"><a href="/pages/d4ecb9/#цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢" class="sidebar-link">цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢</a></li><li class="sidebar-sub-header level2"><a href="/pages/d4ecb9/#цА╗ч╗У" class="sidebar-link">цА╗ч╗У</a></li></ul></li><li><a href="/pages/d6b00d/" class="sidebar-link">Redis чЪД Reactor цибхЮЛ</a></li><li><a href="/pages/264b06/" class="sidebar-link">ц╖▒хЕе Redis ф║Лф╗╢щй▒хКицбЖцЮ╢</a></li><li><a href="/pages/e6d8ef/" class="sidebar-link">Redis чЪДцЙзшбМцибх╝П</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>цФпч║┐</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>щЫЖч╛д</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Redis ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>ф╕╗ч║┐</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Redis Server хИЭхзЛхМЦ<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><div class="custom-block danger"><p class="custom-block-title">цПРхЗ║щЧощвШцШпф╕АхИЗцЩ║цЕзчЪДх╝Ачлп</p> <ol><li>хЬих╝АхПСф╕Аф╕кч╜Сч╗ЬцЬНхКбхЩицЧ╢я╝Мф╜ацШпхРжцЫ╛шАГшЩСш┐ЗцЬНхКбхЩихРпхКицЧ╢чЪДцпПф╕АцнецУНф╜ЬшпехжВф╜ХщлШцХИцЙзшбМя╝ЯRedis чЪД <code>main</code> хЗ╜цХ░ф╝Ъч╗Щф╜аф╗Аф╣ИхРпчд║я╝Я</li> <li>х╜У Redis Server хРпхКихРОя╝МхоГцШпхжВф╜Хчбоф┐ЭхЕ│щФохПВцХ░цнгчбохКаш╜╜х╣╢хоМцИРхИЭхзЛхМЦчЪДя╝ЯцЬЙхУкф║Ых╕╕шзБчЪДщЩ╖щШ▒щЬАшжБц│ицДПя╝Я</li> <li>ф╜ачЯещБУ Redis цШпхжВф╜ХщАЪш┐Зф║Лф╗╢щй▒хКицибхЮЛхдДчРЖщлШх╣╢хПСховцИ╖члпшп╖ц▒ВчЪДхРЧя╝Яф╗О Redis чЪД <code>main</code> хЗ╜цХ░ф╕нцИСф╗мхПпф╗ехнжхИ░хУкф║ЫхЕ│щФохоЮчО░я╝Я</li> <li>Redis Server чЪДхРпхКиш┐ЗчиЛф╕ня╝Мф╕║ф╜ХхИЭхзЛхМЦхТМхКаш╜╜щЕНч╜охПВцХ░хжВцндщЗНшжБя╝ЯхоГхжВф╜Хх╜▒хУНхРОч╗нчЪДховцИ╖члпшп╖ц▒ВхдДчРЖя╝Я</li> <li>Redis цПРф╛Ыф║ЖхдЪчзНщЕНч╜охПВцХ░цЭецПРхНЗцАзшГ╜хТМф╝ШхМЦхЖЕхнШф╜┐чФия╝МхжВф╜ХщАЪш┐ЗчРЖшзг <code>initServer</code> хЗ╜цХ░чЪДцУНф╜ЬцЭеш░Гф╝Ш Redis хоЮф╛Ля╝Я</li> <li>хЬи Redis хРпхКицЧ╢я╝МхоГцШпхжВф╜ХхЖ│хоЪф╝ШхЕИхКаш╜╜ AOF ш┐ШцШп RDB цЦЗф╗╢я╝Яш┐ЩчзНшо╛шобхп╣цХ░цНоцБвхдНцЬЙхУкф║Ыхе╜хдДхТМх▒АщЩРя╝Я</li></ol></div> <h2 id="хЙНшиА"><a href="#хЙНшиА" class="header-anchor">#</a> хЙНшиА</h2> <p>цИСф╗мчЯещБУя╝Мmain хЗ╜цХ░цШп Redis цХ┤ф╕кш┐РшбМчиЛх║ПчЪДхЕехПгя╝Мх╣╢ф╕Ф Redis хоЮф╛ЛхЬиш┐РшбМцЧ╢я╝Мф╣Яф╝Ъф╗Ош┐Щф╕к main хЗ╜цХ░х╝АхзЛцЙзшбМуАВхРМцЧ╢я╝МчФ▒ф║О Redis цШпхЕ╕хЮЛчЪД Client-Server цЮ╢цЮДя╝Мф╕АцЧж Redis хоЮф╛Лх╝АхзЛш┐РшбМя╝МRedis server ф╣Ях░▒ф╝ЪхРпхКия╝МшАМ main хЗ╜цХ░хЕ╢хоЮф╣Яф╝Ъш┤Яш┤г Redis server чЪДхРпхКиш┐РшбМуАВ</p> <blockquote><p>main хЗ╜цХ░цШпхЬи server.c ф╕н</p></blockquote> <p>ф╜ах╣│х╕╕хЬишо╛шобцИЦхоЮчО░ф╕Аф╕кч╜Сч╗ЬцЬНхКбхЩичиЛх║ПцЧ╢я╝МхПпшГ╜ф╝ЪщБЗхИ░ф╕Аф╕кщЧощвШя╝МщВгх░▒цШп</p> <p>тАЛ <strong>цЬНхКбхЩихРпхКицЧ╢я╝Мх║ФшпехБЪхУкф║ЫцУНф╜ЬуАБцЬЙц▓бцЬЙф╕Аф╕кхЕ╕хЮЛчЪДхПВшАГхоЮчО░</strong></p> <p>цЙАф╗еф╗Кхдйш┐ЩшКВшп╛я╝МцИСх░▒ф╗О main хЗ╜цХ░х╝АхзЛя╝Мч╗Щф╜аф╗Лч╗Нф╕Л Redis server цШпхжВф╜ХхЬи main хЗ╜цХ░ф╕нхРпхКих╣╢хоМцИРхИЭхзЛхМЦчЪДуАВщАЪш┐Зш┐ЩшКВшп╛хЖЕхо╣чЪДхнжф╣ая╝Мф╜ахПпф╗ецОМцПб Redis щТИхп╣ф╗еф╕Лф╕Йф╕кщЧощвШчЪДхоЮчО░цАЭш╖пя╝Ъ</p> <ol><li><strong>Redis server хРпхКихРОхЕ╖ф╜Уф╝ЪхБЪхУкф║ЫхИЭхзЛхМЦцУНф╜Ья╝Я</strong></li> <li><strong>Redis server хИЭхзЛхМЦцЧ╢цЬЙхУкф║ЫхЕ│щФощЕНч╜ощб╣я╝Я</strong></li> <li><strong>Redis server хжВф╜Хх╝АхзЛхдДчРЖховцИ╖члпшп╖ц▒Вя╝Я</strong></li></ol> <h2 id="main-хЗ╜цХ░-redis-server-чЪДхЕехПг"><a href="#main-хЗ╜цХ░-redis-server-чЪДхЕехПг" class="header-anchor">#</a> main хЗ╜цХ░я╝ЪRedis server чЪДхЕехПг</h2> <p>ф╕АшИмцЭешп┤я╝Мф╕Аф╕кф╜┐чФи C х╝АхПСчЪДч│╗ч╗Яш╜пф╗╢хРпхКиш┐РшбМчЪДф╗гчаБщА╗ш╛Ся╝МщГ╜цШпхоЮчО░хЬиф║Ж main хЗ╜цХ░х╜Уф╕ня╝МцЙАф╗е echo цЙ╛хИ░ф║Ж main хЗ╜цХ░я╝МчЬЛчЬЛхоГчЪДцЙзшбМш┐ЗчиЛ</p> <p>щВгф╣Ия╝Мхп╣ф║О Redis чЪД main хЗ╜цХ░цЭешп┤я╝МцИСцККхоГцЙзшбМчЪДх╖еф╜ЬхИЖцИРф║Жф║Фф╕кщШ╢цо╡уАВ</p> <h3 id="щШ╢цо╡ф╕А-хЯ║цЬмхИЭхзЛхМЦ"><a href="#щШ╢цо╡ф╕А-хЯ║цЬмхИЭхзЛхМЦ" class="header-anchor">#</a> <strong>щШ╢цо╡ф╕Ая╝ЪхЯ║цЬмхИЭхзЛхМЦ</strong></h3> <p>хЬиш┐Щф╕кщШ╢цо╡я╝Мmain хЗ╜цХ░ф╕╗шжБцШпхоМцИРф╕Аф║ЫхЯ║цЬмчЪДхИЭхзЛхМЦх╖еф╜Ья╝МхМЕцЛмшо╛ч╜о server ш┐РшбМчЪДцЧ╢хМ║уАБшо╛ч╜охУИх╕МхЗ╜цХ░чЪДщЪПцЬ║чзНхнРчнЙуАВш┐ЩщГихИЖх╖еф╜ЬчЪДф╕╗шжБш░ГчФихЗ╜цХ░хжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//шо╛ч╜оцЧ╢хМ║</span>
<span class="token function">setlocale</span><span class="token punctuation">(</span>LC_COLLATE<span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">tzset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//шо╛ч╜ощЪПцЬ║чзНхнР</span>
<span class="token keyword">char</span> hashseed<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">getRandomHexChars</span><span class="token punctuation">(</span>hashseed<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>hashseed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">dictSetHashFunctionSeed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>hashseed<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ш┐ЩщЗМя╝Мф╜ащЬАшжБц│ицДПчЪДцШпя╝МхЬи main хЗ╜цХ░чЪДх╝АхзЛщГихИЖя╝МцЬЙф╕Ацо╡хоПхоЪф╣ЙшжЖчЫЦчЪДф╗гчаБуАВш┐ЩщГихИЖф╗гчаБчЪДф╜ЬчФицШпя╝МхжВцЮЬхоЪф╣Йф║Ж REDIS_TEST хоПхоЪф╣Йя╝Мх╣╢ф╕Ф Redis server хРпхКицЧ╢чЪДхПВцХ░чмжхРИц╡ЛшпХхПВцХ░я╝МщВгф╣И main хЗ╜цХ░х░▒ф╝ЪцЙзшбМчЫ╕х║ФчЪДц╡ЛшпХчиЛх║ПуАВ</p> <p>ш┐Щцо╡хоПхоЪф╣ЙчЪДф╗гчаБхжВф╗еф╕ЛцЙАчд║я╝МхЕ╢ф╕нчЪДчд║ф╛Лф╗гчаБх░▒цШпш░ГчФи ziplist чЪДц╡ЛшпХхЗ╜цХ░ ziplistTestя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">REDIS_TEST</span></span>
<span class="token comment">//хжВцЮЬхРпхКихПВцХ░цЬЙtestхТМziplistя╝МщВгф╣Их░▒ш░ГчФиziplistTestхЗ╜цХ░ш┐ЫшбМziplistчЪДц╡ЛшпХ</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;ziplist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token function">ziplistTest</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></div><h3 id="щШ╢цо╡ф║М-цгАцЯехУихЕ╡цибх╝П-х╣╢цгАцЯецШпхРжшжБцЙзшбМ-rdb-цгАц╡ЛцИЦ-aof-цгАц╡Л"><a href="#щШ╢цо╡ф║М-цгАцЯехУихЕ╡цибх╝П-х╣╢цгАцЯецШпхРжшжБцЙзшбМ-rdb-цгАц╡ЛцИЦ-aof-цгАц╡Л" class="header-anchor">#</a> щШ╢цо╡ф║Мя╝ЪцгАцЯехУихЕ╡цибх╝Пя╝Мх╣╢цгАцЯецШпхРжшжБцЙзшбМ RDB цгАц╡ЛцИЦ AOF цгАц╡Л</h3> <p>Redis server хРпхКихРОя╝МхПпшГ╜цШпф╗ехУихЕ╡цибх╝Пш┐РшбМчЪДя╝МшАМхУихЕ╡цибх╝Пш┐РшбМчЪД server хЬихПВцХ░хИЭхзЛхМЦуАБхПВцХ░шо╛ч╜оя╝Мф╗ехПК server хРпхКиш┐ЗчиЛф╕ншжБцЙзшбМчЪДцУНф╜ЬчнЙцЦ╣щЭвя╝Мф╕ОцЩощАЪцибх╝П server цЬЙцЙАх╖охИлуАВцЙАф╗ея╝Мmain хЗ╜цХ░хЬицЙзшбМш┐ЗчиЛф╕нщЬАшжБца╣цНо Redis щЕНч╜очЪДхПВцХ░я╝МцгАцЯецШпхРжшо╛ч╜оф║ЖхУихЕ╡цибх╝ПуАВ</p> <p>хжВцЮЬцЬЙшо╛ч╜охУихЕ╡цибх╝ПчЪДшпЭя╝Мmain хЗ╜цХ░ф╝Ъш░ГчФи initSentinelConfig хЗ╜цХ░я╝Мхп╣хУихЕ╡цибх╝ПчЪДхПВцХ░ш┐ЫшбМхИЭхзЛхМЦшо╛ч╜оя╝Мф╗ехПКш░ГчФи initSentinel хЗ╜цХ░я╝МхИЭхзЛхМЦшо╛ч╜охУихЕ╡цибх╝Пш┐РшбМчЪД serverуАВцЬЙхЕ│хУихЕ╡цибх╝Пш┐РшбМчЪД Redis server чЫ╕хЕ│цЬ║хИ╢я╝МцИСф╝ЪхЬичмм 21 шо▓ф╕нч╗Щф╜ашпжч╗Жф╗Лч╗НуАВ</p> <p>ф╕ЛщЭвчЪДф╗гчаБх▒Хчд║ф║Ж main хЗ╜цХ░ф╕нхп╣хУихЕ╡цибх╝ПчЪДцгАцЯея╝Мф╗ехПКхп╣хУихЕ╡цибх╝ПчЪДхИЭхзЛхМЦя╝Мф╜ахПпф╗ечЬЛф╕Ля╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//хИдцЦнserverцШпхРжшо╛ч╜оф╕║хУихЕ╡цибх╝П</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span>sentinel_mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initSentinelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//хИЭхзЛхМЦхУихЕ╡чЪДщЕНч╜о</span>
    <span class="token function">initSentinel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//хИЭхзЛхМЦхУихЕ╡цибх╝П</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>щЩдф║ЖцгАцЯехУихЕ╡цибх╝Пф╗ехдЦя╝Мmain хЗ╜цХ░ш┐Шф╝ЪцгАцЯецШпхРжшжБцЙзшбМ RDB цгАц╡ЛцИЦ AOF цгАцЯея╝Мш┐Щхп╣х║Фф║ЖхоЮщЩЕш┐РшбМчЪДчиЛх║ПцШп redis-check-rdb цИЦ redis-check-aofуАВхЬиш┐ЩчзНцГЕхЖ╡ф╕Ля╝Мmain хЗ╜цХ░ф╝Ъш░ГчФи redis_check_rdb_main хЗ╜цХ░цИЦ redis_check_aof_main хЗ╜цХ░я╝МцгАц╡Л RDB цЦЗф╗╢цИЦ AOF цЦЗф╗╢уАВф╜ахПпф╗ечЬЛчЬЛф╕ЛщЭвчЪДф╗гчаБя╝МхЕ╢ф╕нх░▒х▒Хчд║ф║Ж main хЗ╜цХ░хп╣ш┐ЩщГихИЖхЖЕхо╣чЪДцгАцЯехТМш░ГчФия╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//хжВцЮЬш┐РшбМчЪДцШпredis-check-rdbчиЛх║Пя╝Мш░ГчФиredis_check_rdb_mainхЗ╜цХ░цгАц╡ЛRDBцЦЗф╗╢</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;redis-check-rdb&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
   <span class="token function">redis_check_rdb_main</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span>argv<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//хжВцЮЬш┐РшбМчЪДцШпredis-check-aofчиЛх║Пя╝Мш░ГчФиredis_check_aof_mainхЗ╜цХ░цгАц╡ЛAOFцЦЗф╗╢</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;redis-check-aof&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
   <span class="token function">redis_check_aof_main</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><h3 id="щШ╢цо╡ф╕Й-ш┐РшбМхПВцХ░шзгцЮР"><a href="#щШ╢цо╡ф╕Й-ш┐РшбМхПВцХ░шзгцЮР" class="header-anchor">#</a> щШ╢цо╡ф╕Йя╝Ъш┐РшбМхПВцХ░шзгцЮР</h3> <p>хЬиш┐Щф╕АщШ╢цо╡я╝Мmain хЗ╜цХ░ф╝Ъхп╣хС╜ф╗дшбМф╝ахЕечЪДхПВцХ░ш┐ЫшбМшзгцЮРя╝Мх╣╢ф╕Фш░ГчФи loadServerConfig хЗ╜цХ░я╝Мхп╣хС╜ф╗дшбМхПВцХ░хТМщЕНч╜оцЦЗф╗╢ф╕нчЪДхПВцХ░ш┐ЫшбМхРИх╣╢хдДчРЖя╝МчД╢хРОф╕║ Redis хРДхКЯшГ╜цибхЭЧчЪДхЕ│щФохПВцХ░шо╛ч╜охРИщАВчЪДхПЦхА╝я╝Мф╗еф╛┐ server шГ╜щлШцХИхЬ░ш┐РшбМуАВ</p> <h3 id="щШ╢цо╡хЫЫ-хИЭхзЛхМЦ-server"><a href="#щШ╢цо╡хЫЫ-хИЭхзЛхМЦ-server" class="header-anchor">#</a> щШ╢цо╡хЫЫя╝ЪхИЭхзЛхМЦ server</h3> <p>хЬихоМцИРхп╣ш┐РшбМхПВцХ░чЪДшзгцЮРхТМшо╛ч╜охРОя╝Мmain хЗ╜цХ░ф╝Ъш░ГчФи initServer хЗ╜цХ░я╝Мхп╣ server ш┐РшбМцЧ╢чЪДхРДчзНш╡Дц║Рш┐ЫшбМхИЭхзЛхМЦх╖еф╜ЬуАВш┐Щф╕╗шжБхМЕцЛмф║Ж server ш╡Дц║РчобчРЖцЙАщЬАчЪДцХ░цНоч╗УцЮДхИЭхзЛхМЦуАБщФохА╝хп╣цХ░цНох║УхИЭхзЛхМЦуАБserver ч╜Сч╗ЬцбЖцЮ╢хИЭхзЛхМЦчнЙуАВ</p> <p>шАМхЬиш░ГчФихоМ initServer хРОя╝Мmain хЗ╜цХ░ш┐Шф╝ЪхЖНцмбхИдцЦнх╜УхЙН server цШпхРжф╕║хУихЕ╡цибх╝ПуАВхжВцЮЬцШпхУихЕ╡цибх╝Пя╝Мmain хЗ╜цХ░ф╝Ъш░ГчФи sentinelIsRunning хЗ╜цХ░я╝Мшо╛ч╜охРпхКихУихЕ╡цибх╝ПуАВхРжхИЩчЪДшпЭя╝Мmain хЗ╜цХ░ф╝Ъш░ГчФи loadDataFromDisk хЗ╜цХ░я╝Мф╗ОчгБчЫШф╕КхКаш╜╜ AOF цИЦшАЕцШп RDB цЦЗф╗╢я╝Мф╗еф╛┐цБвхдНф╣ЛхЙНчЪДцХ░цНоуАВ</p> <h3 id="щШ╢цо╡ф║Ф-цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢"><a href="#щШ╢цо╡ф║Ф-цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢" class="header-anchor">#</a> щШ╢цо╡ф║Фя╝ЪцЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢</h3> <p>ф╕║ф║ЖшГ╜щлШцХИхдДчРЖщлШх╣╢хПСчЪДховцИ╖члпш┐ЮцОешп╖ц▒Вя╝МRedis щЗЗчФиф║Жф║Лф╗╢щй▒хКицбЖцЮ╢я╝МцЭех╣╢хПСхдДчРЖф╕НхРМховцИ╖члпчЪДш┐ЮцОехТМшп╗хЖЩшп╖ц▒ВуАВцЙАф╗ея╝Мmain хЗ╜цХ░цЙзшбМхИ░цЬАхРОцЧ╢я╝Мф╝Ъш░ГчФи aeMain хЗ╜цХ░ш┐ЫхЕеф║Лф╗╢щй▒хКицбЖцЮ╢я╝Мх╝АхзЛх╛кчОпхдДчРЖхРДчзНшзжхПСчЪДф║Лф╗╢уАВ</p> <p>цИСцККхИЪцЙНф╗Лч╗НчЪДф║Фф╕кщШ╢цо╡ц╢ЙхПКхИ░чЪДхЕ│щФоцУНф╜Ья╝МчФ╗хЬиф║Жф╕ЛщЭвчЪДхЫ╛ф╕ня╝Мф╜ахПпф╗ехЖНхЫЮщб╛ф╕ЛуАВ</p> <p>щВгф╣Ия╝МхЬиш┐Щф║Фф╕кщШ╢цо╡х╜Уф╕ня╝МщШ╢цо╡ф╕ЙуАБхЫЫхТМф║ФхЕ╢хоЮх░▒хМЕцЛмф║Ж Redis server хРпхКиш┐ЗчиЛф╕нчЪДхЕ│щФоцУНф╜ЬуАВцЙАф╗ецОеф╕ЛцЭея╝МцИСф╗мх░▒цЭеф╛Эцмбхнжф╣аф╕Лш┐Щф╕Йф╕кщШ╢цо╡ф╕нчЪДф╕╗шжБх╖еф╜ЬуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409160315788.png" alt="image-20240916031546695"></p> <h2 id="redis-ш┐РшбМхПВцХ░шзгцЮРф╕Ошо╛ч╜о"><a href="#redis-ш┐РшбМхПВцХ░шзгцЮРф╕Ошо╛ч╜о" class="header-anchor">#</a> Redis ш┐РшбМхПВцХ░шзгцЮРф╕Ошо╛ч╜о</h2> <p>цИСф╗мчЯещБУя╝МRedis цПРф╛Ыф║Жф╕░хпМчЪДхКЯшГ╜я╝МцЧвцФпцМБхдЪчзНщФохА╝хп╣цХ░цНоч▒╗хЮЛчЪДшп╗хЖЩшо┐щЧоя╝Мш┐ШцФпцМБцХ░цНоцМБф╣ЕхМЦф┐ЭхнШуАБф╕╗ф╗ОхдНхИ╢уАБхИЗчЙЗщЫЖч╛дчнЙуАВшАМш┐Щф║ЫхКЯшГ╜чЪДщлШцХИш┐РшбМя╝МхЕ╢хоЮщГ╜чж╗ф╕Нх╝АчЫ╕хЕ│хКЯшГ╜цибхЭЧчЪДхЕ│щФохПВцХ░щЕНч╜оуАВ</p> <p>ф╕╛ф╛ЛцЭешп┤я╝МRedis ф╕║ф║ЖшКВчЬБхЖЕхнШя╝Мшо╛шобф║ЖхЖЕхнШч┤зхЗСхЮЛчЪДцХ░цНоч╗УцЮДцЭеф┐ЭхнШ HashуАБSorted Set чнЙщФохА╝хп╣ч▒╗хЮЛуАВф╜ЖцШпхЬиф╜┐чФиф║ЖхЖЕхнШч┤зхЗСхЮЛчЪДцХ░цНоч╗УцЮДф╣ЛхРОя╝МхжВцЮЬх╛АцХ░цНоч╗УцЮДхнШхЕечЪДхЕГч┤аф╕кцХ░ш┐ЗхдЪцИЦхЕГч┤аш┐ЗхдзчЪДшпЭя╝МщФохА╝хп╣чЪДшо┐щЧоцАзшГ╜хПНшАМф╝ЪхПЧхИ░х╜▒хУНуАВхЫацндя╝Мф╕║ф║Жх╣│шббхЖЕхнШф╜┐чФищЗПхТМч│╗ч╗Яшо┐щЧоцАзшГ╜я╝МцИСф╗мх░▒хПпф╗ещАЪш┐ЗхПВцХ░я╝МцЭешо╛ч╜охТМш░ГшКВхЖЕхнШч┤зхЗСхЮЛцХ░цНоч╗УцЮДчЪДф╜┐чФицЭбф╗╢уАВ</p> <p>ф╣Ях░▒цШпшп┤я╝М<strong>цОМцПбш┐Щф║ЫхЕ│щФохПВцХ░чЪДшо╛ч╜оя╝МхПпф╗ех╕охКйцИСф╗мцПРхНЗ Redis хоЮф╛ЛчЪДш┐РшбМцХИчОЗуАВ</strong></p> <p>ф╕Нш┐Зя╝МRedis чЪДхПВцХ░цЬЙх╛ИхдЪя╝МцИСф╗мцЧац│ХхЬиф╕АшКВшп╛ф╕нцОМцПбцЙАцЬЙчЪДхПВцХ░шо╛ч╜оуАВцЙАф╗еф╕ЛщЭвя╝МцИСф╗мхПпф╗ехЕИцЭехнжф╣аф╕Л Redis чЪДф╕╗шжБхПВцХ░ч▒╗хЮЛя╝Мш┐Щца╖х░▒шГ╜хп╣хРДчзНхПВцХ░х╜вцИРф╕Аф╕кхЕищЭвчЪДф║ЖшзгуАВхРМцЧ╢я╝МцИСф╣Яф╝Ъч╗Щф╜аф╗Лч╗Нф╕Аф║ЫхТМ server ш┐РшбМхЕ│ч│╗хпЖхИЗчЪДхПВцХ░хПКхЕ╢шо╛ч╜оцЦ╣ц│Хя╝Мф╗еф╛┐ф╜ахПпф╗ещЕНч╜охе╜ш┐Щф║ЫхПВцХ░я╝Мшой server щлШцХИш┐РшбМш╡╖цЭеуАВ</p> <h3 id="redis-чЪДф╕╗шжБхПВцХ░ч▒╗хЮЛ"><a href="#redis-чЪДф╕╗шжБхПВцХ░ч▒╗хЮЛ" class="header-anchor">#</a> Redis чЪДф╕╗шжБхПВцХ░ч▒╗хЮЛ</h3> <p>щжЦхЕИя╝МRedis ш┐РшбМцЙАщЬАчЪДхРДчзНхПВцХ░я╝МщГ╜ч╗Яф╕АхоЪф╣ЙхЬиф║Ж<a href="https://github.com/redis/redis/blob/5.0/src/server.h" target="_blank" rel="noopener noreferrer">server.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>цЦЗф╗╢чЪД redisServer ч╗УцЮДф╜Уф╕нуАВца╣цНохПВцХ░ф╜ЬчФичЪДшМГхЫ┤я╝МцИСцККхРДчзНхПВцХ░хИТхИЖф╕║ф║Жф╕Гхдзч▒╗хЮЛя╝МхМЕцЛмщАЪчФихПВцХ░уАБцХ░цНоч╗УцЮДхПВцХ░уАБч╜Сч╗ЬхПВцХ░уАБцМБф╣ЕхМЦхПВцХ░уАБф╕╗ф╗ОхдНхИ╢хПВцХ░уАБхИЗчЙЗщЫЖч╛дхПВцХ░уАБцАзшГ╜ф╝ШхМЦхПВцХ░уАВхЕ╖ф╜Уф╜ахПпф╗ехПВшАГф╕ЛщЭвшбица╝ф╕нчЪДхЖЕхо╣уАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409160316885.png" alt="image-20240916031656769"></p> <p>ш┐Щца╖я╝МхжВцЮЬф╜ашГ╜цМЙчЕзф╕КщЭвчЪДхИТхИЖцЦ╣ц│Хч╗Щ Redis хПВцХ░ш┐ЫшбМх╜Тч▒╗я╝МщВгф╣Иф╜ах░▒хПпф╗ехПСчО░я╝Мш┐Щф║ЫхПВцХ░хоЮщЩЕхТМ Redis чЪДф╕╗шжБхКЯшГ╜цЬ║хИ╢цШпчЫ╕хп╣х║ФчЪДуАВцЙАф╗ея╝МхжВцЮЬф╜ашжБц╖▒хЕецОМцПбш┐Щф║ЫхПВцХ░чЪДхЕ╕хЮЛщЕНч╜охА╝я╝Мф╜ах░▒щЬАшжБхп╣чЫ╕х║ФхКЯшГ╜цЬ║хИ╢чЪДх╖еф╜ЬхОЯчРЖцЬЙцЙАф║ЖшзгуАВцИСхЬицОеф╕ЛцЭечЪДшп╛чиЛф╕ня╝Мф╣Яф╝ЪхЬиф╗Лч╗Н Redis хКЯшГ╜цибхЭЧшо╛шобчЪДхРМцЧ╢я╝Мх╕жф╜аф║Жшзгф╕ЛхЕ╢чЫ╕х║ФчЪДхЕ╕хЮЛхПВцХ░щЕНч╜оуАВ</p> <p>хе╜я╝МчО░хЬицИСф╗мх░▒ф║Жшзгф║Ж Redis чЪДф╕ГхдзхПВцХ░ч▒╗хЮЛя╝Мф╗ехПКхоГф╗мхЯ║цЬмчЪДф╜ЬчФишМГхЫ┤я╝МщВгф╣Иф╕ЛщЭвцИСф╗мх░▒цОечЭАцЭехнжф╣аф╕Ля╝МRedis цШпхжВф╜ХщТИхп╣ш┐Щф║ЫхПВцХ░ш┐ЫшбМшо╛ч╜очЪДуАВ</p> <h3 id="redis-хПВцХ░чЪДшо╛ч╜оцЦ╣ц│Х"><a href="#redis-хПВцХ░чЪДшо╛ч╜оцЦ╣ц│Х" class="header-anchor">#</a> Redis хПВцХ░чЪДшо╛ч╜оцЦ╣ц│Х</h3> <p>Redis хп╣ш┐РшбМхПВцХ░чЪДшо╛ч╜охоЮщЩЕф╕Кф╝Ъч╗Пш┐Зф╕Йш╜ош╡ЛхА╝я╝МхИЖхИлцШпщ╗ШшодщЕНч╜охА╝уАБхС╜ф╗дшбМхРпхКихПВцХ░я╝Мф╗ехПКщЕНч╜оцЦЗф╗╢щЕНч╜охА╝уАВ</p> <p>щжЦхЕИя╝МRedis хЬи main хЗ╜цХ░ф╕нф╝Ъ<strong>хЕИш░ГчФи initServerConfig хЗ╜цХ░я╝Мф╕║хРДчзНхПВцХ░шо╛ч╜ощ╗ШшодхА╝</strong>уАВхПВцХ░чЪДщ╗ШшодхА╝ч╗Яф╕АхоЪф╣ЙхЬи server.h цЦЗф╗╢ф╕ня╝МщГ╜цШпф╗е CONFIG_DEFAULT х╝Ахд┤чЪДхоПхоЪф╣ЙхПШщЗПуАВф╕ЛщЭвчЪДф╗гчаБцШ╛чд║чЪДцШпщГихИЖхПВцХ░чЪДщ╗ШшодхА╝я╝Мф╜ахПпф╗ечЬЛф╕ЛуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_DEFAULT_HZ</span>        <span class="token expression"><span class="token number">10</span>   </span><span class="token comment">//serverхРОхП░ф╗╗хКбчЪДщ╗Шшодш┐РшбМщвСчОЗ</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_MIN_HZ</span>            <span class="token expression"><span class="token number">1</span>    </span><span class="token comment">// serverхРОхП░ф╗╗хКбчЪДцЬАх░Пш┐РшбМщвСчОЗ</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_MAX_HZ</span>            <span class="token expression"><span class="token number">500</span> </span><span class="token comment">// serverхРОхП░ф╗╗хКбчЪДцЬАхдзш┐РшбМщвСчОЗ</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_DEFAULT_SERVER_PORT</span>  <span class="token expression"><span class="token number">6379</span>  </span><span class="token comment">//serverчЫСхРмчЪДщ╗ШшодTCPчлпхПг</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_DEFAULT_CLIENT_TIMEOUT</span>  <span class="token expression"><span class="token number">0</span>  </span><span class="token comment">//ховцИ╖члпш╢ЕцЧ╢цЧ╢щЧ┤я╝Мщ╗Шшодф╕║0я╝Мшбичд║ц▓бцЬЙш╢ЕцЧ╢щЩРхИ╢</span></span>
</code></pre></div><p>хЬи server.h ф╕нцПРф╛ЫчЪДщ╗ШшодхПВцХ░хА╝я╝Мф╕АшИмщГ╜цШпхЕ╕хЮЛчЪДщЕНч╜охА╝уАВхЫацндя╝МхжВцЮЬф╜ахЬищГич╜▓ф╜┐чФи Redis хоЮф╛ЛчЪДш┐ЗчиЛф╕ня╝Мхп╣ Redis чЪДх╖еф╜ЬхОЯчРЖф╕НцШпх╛Иф║Жшзгя╝Мх░▒хПпф╗еф╜┐чФиф╗гчаБф╕нцПРф╛ЫчЪДщ╗ШшодщЕНч╜оуАВ</p> <p>х╜УчД╢я╝МхжВцЮЬф╜ахп╣ Redis хРДхКЯшГ╜цибхЭЧчЪДх╖еф╜ЬцЬ║хИ╢цпФш╛ГчЖЯцВЙчЪДшпЭя╝Мф╣ЯхПпф╗ешЗкшбМшо╛ч╜ош┐РшбМхПВцХ░уАВф╜ахПпф╗ехЬихРпхКи Redis чиЛх║ПцЧ╢я╝МхЬихС╜ф╗дшбМф╕Кшо╛ч╜ош┐РшбМхПВцХ░чЪДхА╝уАВцпФхжВя╝МхжВцЮЬф╜ацГ│х░Ж Redis server чЫСхРмчлпхПгф╗Ощ╗ШшодчЪД 6379 ф┐оцФ╣ф╕║ 7379я╝Мх░▒хПпф╗ехЬихС╜ф╗дшбМф╕Кшо╛ч╜о port хПВцХ░ф╕║ 7379я╝МхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token punctuation">.</span><span class="token operator">/</span>redis<span class="token operator">-</span>server <span class="token operator">--</span>port <span class="token number">7379</span>
</code></pre></div><p>ш┐ЩщЗМя╝Мф╜ащЬАшжБц│ицДПчЪДцШпя╝МRedis чЪДхС╜ф╗дшбМхПВцХ░шо╛ч╜ощЬАшжБф╜┐чФи**ф╕дф╕кхЗПхП╖тАЬтАУтАЭ**цЭешбичд║чЫ╕х║ФчЪДхПВцХ░хРНя╝МхРжхИЩчЪДшпЭя╝МRedis х░▒цЧац│ХшпЖхИлцЙАшо╛ч╜очЪДш┐РшбМхПВцХ░уАВ</p> <p>Redis хЬиф╜┐чФи initServerConfig хЗ╜цХ░хп╣хПВцХ░шо╛ч╜ощ╗ШшодщЕНч╜охА╝хРОя╝МцОеф╕ЛцЭея╝Мmain хЗ╜цХ░х░▒ф╝Ъ<strong>хп╣ Redis чиЛх║ПхРпхКицЧ╢чЪДхС╜ф╗дшбМхПВцХ░ш┐ЫшбМщАРф╕АшзгцЮР</strong>уАВ</p> <p>main хЗ╜цХ░ф╝ЪцККшзгцЮРхРОчЪДхПВцХ░хПКхПВцХ░хА╝ф┐ЭхнШцИРхнЧчмжф╕▓я╝МцОечЭАя╝Мmain хЗ╜цХ░ф╝Ъ<strong>ш░ГчФи loadServerConfig хЗ╜цХ░ш┐ЫшбМчммф║МхТМчммф╕Йш╜очЪДш╡ЛхА╝</strong>уАВф╗еф╕Лф╗гчаБцШ╛чд║ф║Ж main хЗ╜цХ░хп╣хС╜ф╗дшбМхПВцХ░чЪДшзгцЮРя╝Мф╗ехПКш░ГчФи loadServerConfig хЗ╜цХ░чЪДш┐ЗчиЛя╝Мф╜ахПпф╗ечЬЛф╕ЛуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
тАж
<span class="token comment">//ф┐ЭхнШхС╜ф╗дшбМхПВцХ░</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> argc<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> server<span class="token punctuation">.</span>exec_argv<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">zstrdup</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
тАж
<span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   тАж
   <span class="token comment">//хп╣цпПф╕кш┐РшбМцЧ╢хПВцХ░ш┐ЫшбМшзгцЮР</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">!=</span> argc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      тАж
   <span class="token punctuation">}</span>
   тАж
   <span class="token comment">//</span>
   <span class="token function">loadServerConfig</span><span class="token punctuation">(</span>configfile<span class="token punctuation">,</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐ЩщЗМф╜ашжБчЯещБУчЪДцШпя╝МloadServerConfig хЗ╜цХ░цШпхЬи<a href="https://github.com/redis/redis/blob/5.0/src/config.c" target="_blank" rel="noopener noreferrer">config.c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>цЦЗф╗╢ф╕нхоЮчО░чЪДя╝МшпехЗ╜цХ░цШпф╗е Redis щЕНч╜оцЦЗф╗╢хТМхС╜ф╗дшбМхПВцХ░чЪДшзгцЮРхнЧчмжф╕▓ф╕║хПВцХ░я╝Мх░ЖщЕНч╜оцЦЗф╗╢ф╕нчЪДцЙАцЬЙщЕНч╜ощб╣шп╗хПЦхЗ║цЭея╝Мх╜вцИРхнЧчмжф╕▓уАВч┤зцОечЭАя╝МloadServerConfig хЗ╜цХ░ф╝ЪцККшзгцЮРхРОчЪДхС╜ф╗дшбМхПВцХ░я╝Мш┐╜хКахИ░щЕНч╜оцЦЗф╗╢х╜вцИРчЪДщЕНч╜ощб╣хнЧчмжф╕▓уАВ</p> <p>ш┐Щца╖ф╕АцЭея╝МщЕНч╜ощб╣хнЧчмжф╕▓х░▒хРМцЧ╢хМЕхРлф║ЖщЕНч╜оцЦЗф╗╢ф╕ншо╛ч╜очЪДхПВцХ░я╝Мф╗ехПКхС╜ф╗дшбМшо╛ч╜очЪДхПВцХ░уАВ</p> <p>цЬАхРОя╝МloadServerConfig хЗ╜цХ░ф╝Ъш┐Ыф╕Ацне<strong>ш░ГчФи loadServerConfigFromString хЗ╜цХ░я╝Мхп╣щЕНч╜ощб╣хнЧчмжф╕▓ф╕нчЪДцпПф╕Аф╕кщЕНч╜ощб╣ш┐ЫшбМхМ╣щЕН</strong>уАВф╕АцЧжхМ╣щЕНцИРхКЯя╝МloadServerConfigFromString хЗ╜цХ░х░▒ф╝ЪцМЙчЕзщЕНч╜ощб╣чЪДхА╝шо╛ч╜о server чЪДхПВцХ░уАВ</p> <p>ф╗еф╕Лф╗гчаБцШ╛чд║ф║Ж loadServerConfigFromString хЗ╜цХ░чЪДщГихИЖхЖЕхо╣уАВш┐ЩщГихИЖф╗гчаБцШпф╜┐чФиф║ЖцЭбф╗╢хИЖцФпя╝МцЭеф╛ЭцмбцпФш╛ГщЕНч╜ощб╣цШпхРжцШптАЬtimeoutтАЭхТМтАЬtcp-keepaliveтАЭя╝МхжВцЮЬхМ╣щЕНф╕Кф║Жя╝Мх░▒х░Ж server хПВцХ░шо╛ч╜оф╕║щЕНч╜ощб╣чЪДхА╝уАВ</p> <p>хРМцЧ╢я╝Мф╗гчаБш┐Шф╝ЪцгАцЯещЕНч╜ощб╣чЪДхА╝цШпхРжхРИчРЖя╝МцпФхжВцШпхРжх░Пф║О 0уАВхжВцЮЬхПВцХ░хА╝ф╕НхРИчРЖя╝МчиЛх║ПхЬиш┐РшбМцЧ╢х░▒ф╝ЪцКещФЩуАВхПжхдЦхп╣ф║ОхЕ╢ф╗ЦчЪДщЕНч╜ощб╣я╝МloadServerConfigFromString хЗ╜цХ░ш┐Шф╝Ъч╗зч╗нф╜┐чФи elseif хИЖцФпш┐ЫшбМхИдцЦнуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">loadServerConfigFromString</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   тАж
   <span class="token comment">//хПВцХ░хРНхМ╣щЕНя╝МцгАцЯехПВцХ░цШпхРжф╕║тАЬtimeoutтАЬ</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> argc <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//шо╛ч╜оserverчЪДmaxidletimeхПВцХ░</span>
  server<span class="token punctuation">.</span>maxidletime <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//цгАцЯехПВцХ░хА╝цШпхРжх░Пф║О0я╝Мх░Пф║О0хИЩцКещФЩ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span>maxidletime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                err <span class="token operator">=</span> <span class="token string">&quot;Invalid timeout value&quot;</span><span class="token punctuation">;</span> <span class="token keyword">goto</span> loaderr<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
  <span class="token comment">//хПВцХ░хРНхМ╣щЕНя╝МцгАцЯехПВцХ░цШпхРжф╕║тАЬtcp-keepaliveтАЬ</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;tcp-keepalive&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> argc <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//шо╛ч╜оserverчЪДtcpkeepaliveхПВцХ░</span>
  server<span class="token punctuation">.</span>tcpkeepalive <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//цгАцЯехПВцХ░хА╝цШпхРжх░Пф║О0я╝Мх░Пф║О0хИЩцКещФЩ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span>tcpkeepalive <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                err <span class="token operator">=</span> <span class="token string">&quot;Invalid tcp-keepalive value&quot;</span><span class="token punctuation">;</span> <span class="token keyword">goto</span> loaderr<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   тАж
<span class="token punctuation">}</span>
</code></pre></div><p>хе╜ф║Жя╝МхИ░ш┐ЩщЗМя╝Мф╜ах║Фшпех░▒ф║Жшзгф║Ж Redis server ш┐РшбМхПВцХ░щЕНч╜очЪДцнещкдя╝МцИСф╣ЯчФ╗ф║Жф╕Ах╝ахЫ╛я╝Мф╗еф╛┐ф╜ацЫ┤чЫ┤шзВхЬ░чРЖшзгш┐Щф╕кш┐ЗчиЛуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409160317578.png" alt="image-20240916031722508"></p> <p>хЬихоМцИРхПВцХ░щЕНч╜охРОя╝Мmain хЗ╜цХ░ф╝Ъх╝АхзЛш░ГчФи initServer хЗ╜цХ░я╝Мхп╣ server ш┐ЫшбМхИЭхзЛхМЦуАВцЙАф╗ецОеф╕ЛцЭея╝МцИСф╗мч╗зч╗нцЭеф║Жшзг Redis server хИЭхзЛхМЦцЧ╢чЪДхЕ│щФоцУНф╜ЬуАВ</p> <h2 id="initserver-хИЭхзЛхМЦ-redis-server"><a href="#initserver-хИЭхзЛхМЦ-redis-server" class="header-anchor">#</a> initServerя╝ЪхИЭхзЛхМЦ Redis server</h2> <p>Redis server чЪДхИЭхзЛхМЦцУНф╜Ья╝Мф╕╗шжБхПпф╗ехИЖцИРф╕Йф╕кцнещкдуАВ</p> <ul><li><strong>чммф╕Ацнея╝МRedis server ш┐РшбМцЧ╢щЬАшжБхп╣хдЪчзНш╡Дц║Рш┐ЫшбМчобчРЖуАВ</strong></li></ul> <p>цпФхжВшп┤я╝МхТМ server ш┐ЮцОечЪДховцИ╖члпуАБф╗Ох║УчнЙя╝МRedis чФиф╜Ьч╝УхнШцЧ╢чЪДцЫ┐цНвхАЩщАЙщЫЖя╝Мф╗ехПК server ш┐РшбМцЧ╢чЪДчК╢цАБф┐бцБпя╝Мш┐Щф║Ыш╡Дц║РчЪДчобчРЖф┐бцБпщГ╜ф╝ЪхЬи <strong>initServer хЗ╜цХ░</strong>ф╕нш┐ЫшбМхИЭхзЛхМЦуАВ</p> <p>цИСч╗Щф╜аф╕╛ф╕кф╛ЛхнРя╝МinitServer хЗ╜цХ░ф╝ЪхИЫх╗║щУ╛шбицЭехИЖхИлч╗┤цКдховцИ╖члпхТМф╗Ох║Уя╝Мх╣╢ш░ГчФи evictionPoolAlloc хЗ╜цХ░я╝ИхЬи<a href="https://github.com/redis/redis/blob/5.0/src/evict.c" target="_blank" rel="noopener noreferrer">evict.c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ф╕ня╝ЙщЗЗца╖чФЯцИРчФиф║Оц╖Шц▒░чЪДхАЩщАЙ key щЫЖхРИуАВхРМцЧ╢я╝МinitServer хЗ╜цХ░ш┐Шф╝Ъш░ГчФи resetServerStats хЗ╜цХ░я╝ИхЬи server.c ф╕ня╝ЙщЗНч╜о server ш┐РшбМчК╢цАБф┐бцБпуАВ</p> <ul><li><strong>чммф║Мцнея╝МхЬихоМцИРш╡Дц║РчобчРЖф┐бцБпчЪДхИЭхзЛхМЦхРОя╝МinitServer хЗ╜цХ░ф╝Ъхп╣ Redis цХ░цНох║Уш┐ЫшбМхИЭхзЛхМЦуАВ</strong></li></ul> <p>хЫаф╕║ф╕Аф╕к Redis хоЮф╛ЛхПпф╗ехРМцЧ╢ш┐РшбМхдЪф╕кцХ░цНох║Уя╝МцЙАф╗е initServer хЗ╜цХ░ф╝Ъф╜┐чФиф╕Аф╕кх╛кчОпя╝Мф╛Эцмбф╕║цпПф╕кцХ░цНох║УхИЫх╗║чЫ╕х║ФчЪДцХ░цНоч╗УцЮДуАВ</p> <p>ш┐Щф╕кф╗гчаБщА╗ш╛СцШпхоЮчО░хЬи initServer хЗ╜цХ░ф╕ня╝М<strong>хоГф╝Ъф╕║цпПф╕кцХ░цНох║УцЙзшбМхИЭхзЛхМЦцУНф╜Ь</strong>я╝МхМЕцЛмхИЫх╗║хЕих▒АхУИх╕Мшбия╝Мф╕║ш┐ЗцЬЯ keyуАБшвл BLPOP щШ╗хбЮчЪД keyуАБх░Жшвл PUSH чЪД key хТМшвлчЫСхРмчЪД key хИЫх╗║чЫ╕х║ФчЪДф┐бцБпшбиуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> server<span class="token punctuation">.</span>dbnum<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//хИЫх╗║хЕих▒АхУИх╕Мшби</span>
    server<span class="token punctuation">.</span>db<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>dict <span class="token operator">=</span> <span class="token function">dictCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dbDictType<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//хИЫх╗║ш┐ЗцЬЯkeyчЪДф┐бцБпшби</span>
    server<span class="token punctuation">.</span>db<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>expires <span class="token operator">=</span> <span class="token function">dictCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>keyptrDictType<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ф╕║швлBLPOPщШ╗хбЮчЪДkeyхИЫх╗║ф┐бцБпшби</span>
    server<span class="token punctuation">.</span>db<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>blocking_keys <span class="token operator">=</span> <span class="token function">dictCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>keylistDictType<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ф╕║х░ЖцЙзшбМPUSHчЪДщШ╗хбЮkeyхИЫх╗║ф┐бцБпшби</span>
    server<span class="token punctuation">.</span>db<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ready_keys <span class="token operator">=</span> <span class="token function">dictCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>objectKeyPointerValueDictType<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ф╕║швлMULTI/WATCHцУНф╜ЬчЫСхРмчЪДkeyхИЫх╗║ф┐бцБпшби</span>
    server<span class="token punctuation">.</span>db<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>watched_keys <span class="token operator">=</span> <span class="token function">dictCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>keylistDictType<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    тАж
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>чммф╕Йцнея╝МinitServer хЗ╜цХ░ф╝Ъф╕║ш┐РшбМчЪД Redis server хИЫх╗║ф║Лф╗╢щй▒хКицбЖцЮ╢я╝Мх╣╢х╝АхзЛхРпхКичлпхПгчЫСхРмя╝МчФиф║ОцОецФ╢хдЦщГишп╖ц▒ВуАВ</strong></li></ul> <p>ц│ицДПя╝Мф╕║ф║ЖщлШцХИхдДчРЖщлШх╣╢хПСчЪДхдЦщГишп╖ц▒Вя╝МinitServer хЬихИЫх╗║чЪДф║Лф╗╢цбЖцЮ╢ф╕ня╝МщТИхп╣цпПф╕кчЫСхРм IP ф╕КхПпшГ╜хПСчФЯчЪДховцИ╖члпш┐ЮцОея╝МщГ╜хИЫх╗║ф║ЖчЫСхРмф║Лф╗╢я╝МчФицЭечЫСхРмховцИ╖члпш┐ЮцОешп╖ц▒ВуАВхРМцЧ╢я╝МinitServer ф╕║чЫСхРмф║Лф╗╢шо╛ч╜оф║ЖчЫ╕х║ФчЪД<strong>хдДчРЖхЗ╜цХ░ acceptTcpHandler</strong>уАВ</p> <p>ш┐Щца╖ф╕АцЭея╝МхПкшжБцЬЙховцИ╖члпш┐ЮцОехИ░ server чЫСхРмчЪД IP хТМчлпхПгя╝Мф║Лф╗╢щй▒хКицбЖцЮ╢х░▒ф╝ЪцгАц╡ЛхИ░цЬЙш┐ЮцОеф║Лф╗╢хПСчФЯя╝МчД╢хРОш░ГчФи acceptTcpHandler хЗ╜цХ░цЭехдДчРЖхЕ╖ф╜УчЪДш┐ЮцОеуАВф╜ахПпф╗ехПВшАГф╗еф╕Лф╗гчаБф╕нх▒Хчд║чЪДхдДчРЖщА╗ш╛Ся╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//хИЫх╗║ф║Лф╗╢х╛кчОпцбЖцЮ╢</span>
server<span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token function">aeCreateEventLoop</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>maxclients<span class="token operator">+</span>CONFIG_FDSET_INCR<span class="token punctuation">)</span><span class="token punctuation">;</span>
тАж
<span class="token comment">//х╝АхзЛчЫСхРмшо╛ч╜очЪДч╜Сч╗ЬчлпхПг</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>server<span class="token punctuation">.</span>port <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">listenToPort</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>port<span class="token punctuation">,</span>server<span class="token punctuation">.</span>ipfd<span class="token punctuation">,</span><span class="token operator">&amp;</span>server<span class="token punctuation">.</span>ipfd_count<span class="token punctuation">)</span> <span class="token operator">==</span> C_ERR<span class="token punctuation">)</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
тАж
<span class="token comment">//ф╕║serverхРОхП░ф╗╗хКбхИЫх╗║хоЪцЧ╢ф║Лф╗╢</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">aeCreateTimeEvent</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> serverCron<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> AE_ERR<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">serverPanic</span><span class="token punctuation">(</span><span class="token string">&quot;Can't create event loop timers.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
тАж
<span class="token comment">//ф╕║цпПф╕Аф╕кчЫСхРмчЪДIPшо╛ч╜ош┐ЮцОеф║Лф╗╢чЪДхдДчРЖхЗ╜цХ░acceptTcpHandler</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> server<span class="token punctuation">.</span>ipfd_count<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">aeCreateFileEvent</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">,</span> server<span class="token punctuation">.</span>ipfd<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> AE_READABLE<span class="token punctuation">,</span>
            acceptTcpHandler<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> AE_ERR<span class="token punctuation">)</span>
       <span class="token punctuation">{</span> тАж <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>щВгф╣ИхИ░ш┐ЩщЗМя╝МRedis server хЬихоМцИРш┐РшбМхПВцХ░шо╛ч╜охТМхИЭхзЛхМЦхРОя╝Мх░▒хПпф╗ех╝АхзЛхдДчРЖховцИ╖члпшп╖ц▒Вф║ЖуАВф╕║ф║ЖшГ╜цМБч╗нхЬ░хдДчРЖх╣╢хПСчЪДховцИ╖члпшп╖ц▒Вя╝М<strong>server хЬи main хЗ╜цХ░чЪДцЬАхРОя╝Мф╝Ъш┐ЫхЕеф║Лф╗╢щй▒хКих╛кчОпцЬ║хИ╢</strong>уАВшАМш┐Щх░▒цШпцОеф╕ЛцЭея╝МцИСф╗мшжБф║ЖшзгчЪДф║Лф╗╢щй▒хКицбЖцЮ╢чЪДцЙзшбМш┐ЗчиЛуАВ</p> <h2 id="цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢"><a href="#цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢" class="header-anchor">#</a> цЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢</h2> <p>ф║Лф╗╢щй▒хКицбЖцЮ╢цШп Redis server ш┐РшбМчЪДца╕х┐ГуАВшпецбЖцЮ╢ф╕АцЧжхРпхКихРОя╝Мх░▒ф╝Ъф╕АчЫ┤х╛кчОпцЙзшбМя╝МцпПцмбх╛кчОпф╝ЪхдДчРЖф╕АцЙ╣шзжхПСчЪДч╜Сч╗Ьшп╗хЖЩф║Лф╗╢уАВхЕ│ф║Оф║Лф╗╢щй▒хКицбЖцЮ╢цЬмш║лчЪДшо╛шобцАЭцГ│ф╕ОхоЮчО░цЦ╣ц│Хя╝МцИСф╝ЪхЬичмм 9 шЗ│ 11 шо▓ч╗Щф╜ахЕ╖ф╜Уф╗Лч╗НуАВш┐ЩшКВшп╛я╝МцИСф╗мф╕╗шжБцШпхнжф╣а Redis хЕехПгчЪД main хЗ╜цХ░ф╕ня╝МцШпхжВф╜Хш╜мцНвхИ░ф║Лф╗╢щй▒хКицбЖцЮ╢ш┐ЫшбМцЙзшбМчЪДуАВ</p> <p>хЕ╢хоЮя╝Мш┐ЫхЕеф║Лф╗╢щй▒хКицбЖцЮ╢х╝АхзЛцЙзшбМх╣╢ф╕НхдНцЭВя╝Мmain хЗ╜цХ░чЫ┤цОеш░ГчФиф║Лф╗╢цбЖцЮ╢чЪД<strong>ф╕╗ф╜УхЗ╜цХ░ aeMain</strong>я╝ИхЬи<a href="https://github.com/redis/redis/tree/5.0/src/ae.c" target="_blank" rel="noopener noreferrer">ae.c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>цЦЗф╗╢ф╕ня╝ЙхРОя╝Мх░▒ш┐ЫхЕеф║Лф╗╢хдДчРЖх╛кчОпф║ЖуАВ</p> <p>х╜УчД╢я╝МхЬиш┐ЫхЕеф║Лф╗╢щй▒хКих╛кчОпхЙНя╝Мmain хЗ╜цХ░ф╝ЪхИЖхИлш░ГчФи aeSetBeforeSleepProc хТМ aeSetAfterSleepProc ф╕дф╕кхЗ╜цХ░я╝МцЭешо╛ч╜оцпПцмбш┐ЫхЕеф║Лф╗╢х╛кчОпхЙН server щЬАшжБцЙзшбМчЪДцУНф╜Ья╝Мф╗ехПКцпПцмбф║Лф╗╢х╛кчОпч╗УцЭЯхРО server щЬАшжБцЙзшбМчЪДцУНф╜ЬуАВф╕ЛщЭвф╗гчаБцШ╛чд║ф║Жш┐ЩщГихИЖчЪДцЙзшбМщА╗ш╛Ся╝Мф╜ахПпф╗ечЬЛф╕ЛуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ┬╖┬╖┬╖
    <span class="token function">aeSetBeforeSleepProc</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">,</span>beforeSleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">aeSetAfterSleepProc</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">,</span>afterSleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">aeMain</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">aeDeleteEventLoop</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
	┬╖┬╖┬╖
<span class="token punctuation">}</span>
</code></pre></div><h2 id="цА╗ч╗У"><a href="#цА╗ч╗У" class="header-anchor">#</a> цА╗ч╗У</h2> <p>ф╗Кхдйш┐ЩшКВшп╛я╝МцИСф╗мщАЪш┐З server.c цЦЗф╗╢ф╕н main хЗ╜цХ░чЪДшо╛шобхТМхоЮчО░цАЭш╖пя╝Мф║Жшзгф║Ж Redis server хРпхКихРОчЪДф║Фф╕кф╕╗шжБщШ╢цо╡уАВхЬиш┐Щф║Фф╕кщШ╢цо╡ф╕ня╝Мш┐РшбМхПВцХ░шзгцЮРуАБserver хИЭхзЛхМЦхТМцЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢хИЩцШп Redis sever хРпхКиш┐ЗчиЛф╕нчЪДф╕Йф╕кхЕ│щФощШ╢цо╡уАВцЙАф╗ечЫ╕х║ФчЪДя╝МцИСф╗мщЬАшжБщЗНчВ╣хЕ│ц│иф╗еф╕Лф╕Йф╕кшжБчВ╣уАВ</p> <p>чммф╕Ая╝Мmain хЗ╜цХ░цШпф╜┐чФи initServerConfig ч╗Щ server ш┐РшбМхПВцХ░шо╛ч╜ощ╗ШшодхА╝я╝МчД╢хРОф╝ЪшзгцЮРхС╜ф╗дшбМхПВцХ░я╝Мх╣╢щАЪш┐З loadServerConfig шп╗хПЦщЕНч╜оцЦЗф╗╢хПВцХ░хА╝я╝Мх░ЖхС╜ф╗дшбМхПВцХ░ш┐╜хКашЗ│щЕНч╜ощб╣хнЧчмжф╕▓уАВцЬАхРОя╝МRedis ф╝Ъш░ГчФи loadServerConfigFromString хЗ╜цХ░я╝МцЭехоМцИРщЕНч╜оцЦЗф╗╢хПВцХ░хТМхС╜ф╗дшбМхПВцХ░чЪДшо╛ч╜оуАВ</p> <p>чммф║Мя╝МхЬи Redis server хоМцИРхПВцХ░шо╛ч╜охРОя╝МinitServer хЗ╜цХ░ф╝Ъшвлш░ГчФия╝МчФицЭехИЭхзЛхМЦ server ш╡Дц║РчобчРЖчЪДф╕╗шжБч╗УцЮДя╝МхРМцЧ╢ф╝ЪхИЭхзЛхМЦцХ░цНох║УхРпхКичК╢цАБя╝Мф╗ехПКхоМцИР server чЫСхРм IP хТМчлпхПгчЪДшо╛ч╜оуАВ</p> <p>чммф╕Йя╝Мф╕АцЧж server хПпф╗ецОецФ╢хдЦщГиховцИ╖члпчЪДшп╖ц▒ВхРОя╝Мmain хЗ╜цХ░ф╝ЪцККчиЛх║ПчЪДф╕╗ф╜УцОзхИ╢цЭГя╝Мф║дч╗Щф║Лф╗╢щй▒хКицбЖцЮ╢чЪДхЕехПгхЗ╜цХ░я╝Мф╣Ях░▒ aeMain хЗ╜цХ░уАВaeMain хЗ╜цХ░ф╝Ъф╕АчЫ┤х╛кчОпцЙзшбМя╝МхдДчРЖцФ╢хИ░чЪДховцИ╖члпшп╖ц▒ВуАВхИ░цндф╕║цнвя╝Мserver.c ф╕нчЪД main хЗ╜цХ░хКЯшГ╜х░▒х╖▓ч╗ПхЕищГихоМцИРф║Жя╝МчиЛх║ПцОзхИ╢цЭГф╣Яф║дч╗Щф║Жф║Лф╗╢щй▒хКих╛кчОпцбЖцЮ╢я╝МRedis ф╣Ях░▒хПпф╗ецнгх╕╕хдДчРЖховцИ╖члпшп╖ц▒Вф║ЖуАВ</p> <p>хоЮщЩЕф╕Кя╝МRedis server чЪДхРпхКиш┐ЗчиЛф╗ОхЯ║цЬмчЪДхИЭхзЛхМЦцУНф╜Ья╝МхИ░хС╜ф╗дшбМхТМщЕНч╜оцЦЗф╗╢чЪДхПВцХ░шзгцЮРшо╛ч╜оя╝МхЖНхИ░хИЭхзЛхМЦ server хРДчзНцХ░цНоч╗УцЮДя╝Мф╗ехПКцЬАхРОчЪДцЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢я╝Мш┐ЩцШпф╕Аф╕кхЕ╕хЮЛчЪДч╜Сч╗ЬцЬНхКбхЩицЙзшбМш┐ЗчиЛя╝Мф╜ахЬих╝АхПСч╜Сч╗ЬцЬНхКбхЩицЧ╢я╝Мх░▒хПпф╗еф╜Ьф╕║хПВшАГуАВ</p> <p>шАМф╕Фя╝МцОМцПбф║ЖхРпхКиш┐ЗчиЛф╕нчЪДхИЭхзЛхМЦцУНф╜Ья╝Мш┐ШхПпф╗ех╕оф╜ашзгчнФф╕Аф║Ыф╜┐чФиф╕нчЪДчЦСцГСуАВцпФхжВя╝МRedis хРпхКицЧ╢цШпхЕИшп╗хПЦ RDB цЦЗф╗╢я╝Мш┐ШцШпхЕИшп╗хПЦ AOF цЦЗф╗╢уАВхжВцЮЬф╜аф║Жшзгф║Ж Redis server чЪДхРпхКиш┐ЗчиЛя╝Мх░▒хПпф╗еф╗О loadDataFromDisk хЗ╜цХ░ф╕нчЬЛхИ░я╝МRedis server ф╝ЪхЕИшп╗хПЦ AOFя╝ЫшАМхжВцЮЬц▓бцЬЙ AOFя╝МхИЩхЖНшп╗хПЦ RDBуАВ</p> <p>цЙАф╗ея╝МцОМцПб Redis server хРпхКиш┐ЗчиЛя╝МцЬЙхКйф║Оф╜ацЫ┤хе╜хЬ░ф║Жшзг Redis ш┐РшбМч╗ЖшКВя╝Мш┐Щца╖х╜Уф╜ащБЗхИ░щЧощвШцЧ╢я╝Мх░▒чЯещБУш┐ШхПпф╗еф╗ОхРпхКиш┐ЗчиЛф╕нхО╗ц║пц║Р server чЪДхРДчзНхИЭхзЛчК╢цАБя╝Мф╗ОшАМхКйхКЫф╜ацЫ┤хе╜хЬ░шзгхЖ│щЧощвШуАВ</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Redis ч│╗ч╗Яшо╛шоб/03.ф╕╗ч║┐/03.Redis Server хИЭхзЛхМЦ.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/17, 05:13:55</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/34fa27/" class="prev">Linux ф╕нчЪД IO хдЪш╖пхдНчФи</a></span> <span class="next"><a href="/pages/d6b00d/">Redis чЪД Reactor цибхЮЛ</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.3449399e.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/45.52725702.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
