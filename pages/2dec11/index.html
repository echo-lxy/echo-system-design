<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>щлШхПпчФицОвчй╢ | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ч│╗ч╗Яшо╛шобф╣ЛуАМшо▓шзг + щЭвшпХцМЗхНЧуАНя╝Мц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣я╝Б">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.f82a82e9.css" as="style"><link rel="preload" href="/assets/js/app.78f2b9cc.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/31.21bd2de1.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.b313d17c.js"><link rel="prefetch" href="/assets/js/100.a9558091.js"><link rel="prefetch" href="/assets/js/101.007aa479.js"><link rel="prefetch" href="/assets/js/102.57bca734.js"><link rel="prefetch" href="/assets/js/11.c7521a10.js"><link rel="prefetch" href="/assets/js/12.f57a12da.js"><link rel="prefetch" href="/assets/js/13.d9d26d25.js"><link rel="prefetch" href="/assets/js/14.09cf8a64.js"><link rel="prefetch" href="/assets/js/15.d5a34c66.js"><link rel="prefetch" href="/assets/js/16.8cea924c.js"><link rel="prefetch" href="/assets/js/17.8d94c5e8.js"><link rel="prefetch" href="/assets/js/18.baad837c.js"><link rel="prefetch" href="/assets/js/19.571eaed1.js"><link rel="prefetch" href="/assets/js/20.d70e5281.js"><link rel="prefetch" href="/assets/js/21.0e0ed140.js"><link rel="prefetch" href="/assets/js/22.1ccaa6f3.js"><link rel="prefetch" href="/assets/js/23.623f0b5d.js"><link rel="prefetch" href="/assets/js/24.891fe6fb.js"><link rel="prefetch" href="/assets/js/25.41dca26b.js"><link rel="prefetch" href="/assets/js/26.6337eac0.js"><link rel="prefetch" href="/assets/js/27.de80589e.js"><link rel="prefetch" href="/assets/js/28.95a1fb6b.js"><link rel="prefetch" href="/assets/js/29.371a40e1.js"><link rel="prefetch" href="/assets/js/3.e62a71e4.js"><link rel="prefetch" href="/assets/js/30.e32f6b31.js"><link rel="prefetch" href="/assets/js/32.f1174703.js"><link rel="prefetch" href="/assets/js/33.eab858f3.js"><link rel="prefetch" href="/assets/js/34.4ba0e53e.js"><link rel="prefetch" href="/assets/js/35.8287c9dc.js"><link rel="prefetch" href="/assets/js/36.b5f133ca.js"><link rel="prefetch" href="/assets/js/37.82be3556.js"><link rel="prefetch" href="/assets/js/38.40fe2658.js"><link rel="prefetch" href="/assets/js/39.6450065f.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.591baf2a.js"><link rel="prefetch" href="/assets/js/41.f961e422.js"><link rel="prefetch" href="/assets/js/42.b34f1599.js"><link rel="prefetch" href="/assets/js/43.5a509601.js"><link rel="prefetch" href="/assets/js/44.64fd3383.js"><link rel="prefetch" href="/assets/js/45.685623ac.js"><link rel="prefetch" href="/assets/js/46.b7523f9c.js"><link rel="prefetch" href="/assets/js/47.9bed4c1b.js"><link rel="prefetch" href="/assets/js/48.a1b270df.js"><link rel="prefetch" href="/assets/js/49.ee9681bc.js"><link rel="prefetch" href="/assets/js/5.b472a9bb.js"><link rel="prefetch" href="/assets/js/50.b424b2c0.js"><link rel="prefetch" href="/assets/js/51.53684c6e.js"><link rel="prefetch" href="/assets/js/52.a45a9bb1.js"><link rel="prefetch" href="/assets/js/53.6f165300.js"><link rel="prefetch" href="/assets/js/54.61a6a81b.js"><link rel="prefetch" href="/assets/js/55.5391018d.js"><link rel="prefetch" href="/assets/js/56.e0b862ae.js"><link rel="prefetch" href="/assets/js/57.374534af.js"><link rel="prefetch" href="/assets/js/58.bb9706ba.js"><link rel="prefetch" href="/assets/js/59.6d5a538f.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/60.99b51260.js"><link rel="prefetch" href="/assets/js/61.33893dab.js"><link rel="prefetch" href="/assets/js/62.e6604fa3.js"><link rel="prefetch" href="/assets/js/63.e753bb13.js"><link rel="prefetch" href="/assets/js/64.59e76eda.js"><link rel="prefetch" href="/assets/js/65.66728f4b.js"><link rel="prefetch" href="/assets/js/66.30cbe3ea.js"><link rel="prefetch" href="/assets/js/67.9aea7c9b.js"><link rel="prefetch" href="/assets/js/68.79ee7ba7.js"><link rel="prefetch" href="/assets/js/69.a776cc2e.js"><link rel="prefetch" href="/assets/js/70.13d90b76.js"><link rel="prefetch" href="/assets/js/71.4f4c7733.js"><link rel="prefetch" href="/assets/js/72.b0948cb0.js"><link rel="prefetch" href="/assets/js/73.d7ed15dc.js"><link rel="prefetch" href="/assets/js/74.6884119c.js"><link rel="prefetch" href="/assets/js/75.b70b8a0c.js"><link rel="prefetch" href="/assets/js/76.2766fd7c.js"><link rel="prefetch" href="/assets/js/77.c9b76e03.js"><link rel="prefetch" href="/assets/js/78.9aa9da2e.js"><link rel="prefetch" href="/assets/js/79.ea5b4888.js"><link rel="prefetch" href="/assets/js/8.77b795dd.js"><link rel="prefetch" href="/assets/js/80.3c3f7534.js"><link rel="prefetch" href="/assets/js/81.76b7b1ed.js"><link rel="prefetch" href="/assets/js/82.7b7a2f1c.js"><link rel="prefetch" href="/assets/js/83.44c820ac.js"><link rel="prefetch" href="/assets/js/84.f53c8839.js"><link rel="prefetch" href="/assets/js/85.8c526118.js"><link rel="prefetch" href="/assets/js/86.e17eab25.js"><link rel="prefetch" href="/assets/js/87.a09f72d3.js"><link rel="prefetch" href="/assets/js/88.0f27b036.js"><link rel="prefetch" href="/assets/js/89.2fd11d59.js"><link rel="prefetch" href="/assets/js/9.36f81190.js"><link rel="prefetch" href="/assets/js/90.e60814ad.js"><link rel="prefetch" href="/assets/js/91.08cfa575.js"><link rel="prefetch" href="/assets/js/92.81c822a0.js"><link rel="prefetch" href="/assets/js/93.5f199263.js"><link rel="prefetch" href="/assets/js/94.266b7d71.js"><link rel="prefetch" href="/assets/js/95.0899dfb4.js"><link rel="prefetch" href="/assets/js/96.c1156914.js"><link rel="prefetch" href="/assets/js/97.18525931.js"><link rel="prefetch" href="/assets/js/98.ee554b1a.js"><link rel="prefetch" href="/assets/js/99.f0fb67c2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f82a82e9.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">JUC ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">JUC ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕АуАБхЙНшиА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>хЫЫуАБшо╛шобчЫоцаЗ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/2dec11/" aria-current="page" class="active sidebar-link">щлШхПпчФицОвчй╢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/2dec11/#хЙНшиА" class="sidebar-link">хЙНшиА</a></li><li class="sidebar-sub-header level2"><a href="/pages/2dec11/#щЫЖч╛дцЮ╢цЮД" class="sidebar-link">щЫЖч╛дцЮ╢цЮД</a></li><li class="sidebar-sub-header level2"><a href="/pages/2dec11/#kafkaщЫЖч╛дщАЙф╕╛" class="sidebar-link">KafkaщЫЖч╛дщАЙф╕╛</a></li><li class="sidebar-sub-header level2"><a href="/pages/2dec11/#хЙпцЬмцЬ║хИ╢-replication" class="sidebar-link">хЙпцЬмцЬ║хИ╢(Replicationя╝Й</a></li><li class="sidebar-sub-header level2"><a href="/pages/2dec11/#ц╢Иш┤╣шАЕч╗ДхТМхЖНхЭЗшбб" class="sidebar-link">ц╢Иш┤╣шАЕч╗ДхТМхЖНхЭЗшбб</a></li><li class="sidebar-sub-header level2"><a href="/pages/2dec11/#хПВшАГш╡ДцЦЩ" class="sidebar-link">хПВшАГш╡ДцЦЩ</a></li></ul></li><li><a href="/pages/168766/" class="sidebar-link">щлШцЙйх▒ХцОвчй╢</a></li><li><a href="/pages/dd50fc/" class="sidebar-link">щлШх╣╢хПСцОвчй╢</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Kafka  ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>хЫЫуАБшо╛шобчЫоцаЗ</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><!---->щлШхПпчФицОвчй╢<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="хЙНшиА"><a href="#хЙНшиА" class="header-anchor">#</a> хЙНшиА</h2> <p>Apache Kafka чЪДщлШхПпчФишо╛шобф╕╗шжБщАЪш┐Зф╗еф╕ЛхЗаф╕кцЦ╣щЭвцЭехоЮчО░я╝Ъ</p> <ul><li>хЙпцЬмцЬ║хИ╢я╝ИReplicationя╝Йя╝ЪхЬи Kafka ф╕ня╝МцпПф╕к partition щГ╜цЬЙхдЪф╕кхЙпцЬмя╝МхЕ╢ф╕нф╕Аф╕кф╜Ьф╕║ leaderя╝МхЕ╢ф╗ЦчЪДф╜Ьф╕║followerуАВцЙАцЬЙчЪДшп╗хЖЩцУНф╜ЬщГ╜цШпщАЪш┐З leader цЭеш┐ЫшбМчЪДя╝Мfollower хИЩш┤Яш┤гф╗О leader хРМцнецХ░цНоуАВх╜У leaderхЗ║чО░цХЕщЪЬцЧ╢я╝Мф╝Ъф╗О follower ф╕нщАЙф╕╛хЗ║цЦ░чЪД leaderя╝Мф╗еф┐ЭшпБцЬНхКбчЪДхПпчФицАзуАВ</li> <li>хИЖхМ║цЬ║хИ╢я╝ИPartitioningя╝Йя╝ЪKafka чЪД topic хПпф╗ехИЖф╕║хдЪф╕к partitionя╝МцпПф╕к partitionхПпф╗ехЬиф╕НхРМчЪДцЬНхКбхЩиф╕Кя╝Мш┐Щца╖хН│ф╜┐цЯРф╕кцЬНхКбхЩихЗ║чО░цХЕщЪЬя╝Мф╣Яф╕Нф╝Ъх╜▒хУНхИ░хЕ╢ф╗Ц partition чЪДцнгх╕╕цЬНхКбуАВ</li> <li>ц╢Иш┤╣шАЕч╗Дя╝ИConsumer Groupsя╝Йя╝ЪKafka хЕБшо╕хдЪф╕кц╢Иш┤╣шАЕч╗ДхРМцЧ╢ц╢Иш┤╣хРМф╕Аф╕к topicя╝МцпПф╕кц╢Иш┤╣шАЕч╗ДщГ╜ф╝Ъч╗┤цКдшЗкх╖▒чЪДoffsetя╝Мш┐Щца╖хН│ф╜┐цЯРф╕кц╢Иш┤╣шАЕч╗ДхЗ║чО░цХЕщЪЬя╝Мф╣Яф╕Нф╝Ъх╜▒хУНхИ░хЕ╢ф╗Цц╢Иш┤╣шАЕч╗ДчЪДц╢Иш┤╣</li> <li>ZooKeeper щЫЖч╛дя╝ЪKafka ф╜┐чФи ZooKeeper цЭечобчРЖщЫЖч╛дчЪДхЕГцХ░цНоф┐бцБпя╝МхжВ brokerуАБtopic хТМ
partition чЪДф┐бцБпчнЙуАВZooKeeper цЬмш║лф╣ЯцШпф╕Аф╕кхИЖх╕Гх╝ПцЬНхКбя╝МхПпф╗ещАЪш┐ЗхдЪф╕кшКВчВ╣ч╗ДцИРщЫЖч╛дя╝МцПРф╛ЫщлШхПпчФицАзуАВ</li> <li>ISRя╝ИIn-Sync Replicasя╝ЙцЬ║хИ╢я╝ЪKafka щАЪш┐З ISR цЬ║хИ╢цЭеф┐ЭшпБцХ░цНочЪДф╕АшЗ┤цАзуАВхПкцЬЙхЬи ISR хИЧшбиф╕нчЪД
follower цЙНцЬЙш╡Дца╝швлщАЙф╕║цЦ░чЪД leaderя╝Мш┐Щца╖хПпф╗еф┐ЭшпБцЦ░чЪД leader цЛецЬЙцЙАцЬЙчЪДцХ░цНохЙпцЬмуАВ</li></ul> <p>щАЪш┐Зф╗еф╕КчЪДшо╛шобя╝МKafka шГ╜хдЯхЬищЭвхп╣цХЕщЪЬцЧ╢я╝Мф╗НшГ╜ф┐ЭшпБцЬНхКбчЪДхПпчФицАзхТМцХ░цНочЪДф╕АшЗ┤цАзуАВ</p> <h2 id="щЫЖч╛дцЮ╢цЮД"><a href="#щЫЖч╛дцЮ╢цЮД" class="header-anchor">#</a> щЫЖч╛дцЮ╢цЮД</h2> <p>Kafka чЪДцЬНхКбхЩичлпчФ▒швлчз░ф╕║ Broker чЪДцЬНхКбш┐ЫчиЛцЮДцИРя╝МхН│ф╕Аф╕к Kafka щЫЖч╛дчФ▒хдЪф╕к Broker ч╗ДцИР
ш┐Щца╖хжВцЮЬщЫЖч╛дф╕нцЯРф╕АхП░цЬ║хЩихоХцЬ║я╝МхЕ╢ф╗ЦцЬ║хЩиф╕КчЪД Broker ф╣Яф╛ЭчД╢шГ╜хдЯхп╣хдЦцПРф╛ЫцЬНхКбуАВш┐ЩхЕ╢хоЮх░▒цШп Kafka цПРф╛ЫщлШхПпчФичЪДхЯ║чбА</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181832683.png" alt="img"></p> <h2 id="kafkaщЫЖч╛дщАЙф╕╛"><a href="#kafkaщЫЖч╛дщАЙф╕╛" class="header-anchor">#</a> KafkaщЫЖч╛дщАЙф╕╛</h2> <h3 id="isr-ф╕О-osr"><a href="#isr-ф╕О-osr" class="header-anchor">#</a> ISR ф╕О OSR</h3> <p>Kafkaф╕║ф║Жхп╣ц╢ИцБпш┐ЫшбМхИЖч▒╗я╝Мх╝ХхЕеф║ЖTopicя╝Иф╕╗щвШя╝ЙчЪДцжВх┐╡уАВчФЯф║зшАЕхЬихПСщАБц╢ИцБпчЪДцЧ╢хАЩя╝МщЬАшжБцМЗхоЪхПСщАБхИ░цЯРф╕кTopicя╝МчД╢хРОц╢ИцБпшАЕшовщШЕш┐Щф╕кTopicх╣╢ш┐ЫшбМц╢Иш┤╣ц╢ИцБпуАВ</p> <p>Kafkaф╕║ф║ЖцПРхНЗцАзшГ╜я╝МхПИхЬиTopicчЪДхЯ║чбАф╕Кя╝Мх╝ХхЕеф║ЖPartitionя╝ИхИЖхМ║я╝ЙчЪДцжВх┐╡уАВTopicцШпщА╗ш╛СцжВх┐╡я╝МшАМPartitionцШпчЙйчРЖхИЖч╗ДуАВф╕Аф╕кTopicхПпф╗ехМЕхРлхдЪф╕кPartitionя╝МчФЯф║зшАЕхЬихПСщАБц╢ИцБпчЪДцЧ╢хАЩя╝МщЬАшжБцМЗхоЪхПСщАБхИ░цЯРф╕кTopicчЪДцЯРф╕кPartitionя╝МчД╢хРОц╢ИцБпшАЕшовщШЕш┐Щф╕кTopicх╣╢ц╢Иш┤╣ш┐Щф╕кPartitionф╕нчЪДц╢ИцБпуАВ</p> <p>Kafkaф╕║ф║ЖцПРщлШч│╗ч╗ЯчЪДхРЮхРРщЗПхТМхПпцЙйх▒ХцАзя╝МцККф╕Аф╕кTopicчЪДф╕НхРМPartitionцФ╛хИ░хдЪф╕кBrokerшКВчВ╣ф╕Кя╝МхЕЕхИЖхИйчФицЬ║хЩиш╡Дц║Ря╝Мф╣Яф╛┐ф║ОцЙйх▒ХPartitionуАВ</p> <p>Kafkaф╕║ф║Жф┐ЭшпБцХ░цНочЪДхоЙхЕицАзхТМцЬНхКбчЪДщлШхПпчФия╝МхПИхЬиPartitionчЪДхЯ║чбАф╕Кя╝Мх╝ХхЕеReplicaя╝ИхЙпцЬмя╝ЙчЪДцжВх┐╡уАВф╕Аф╕кPartitionхМЕхРлхдЪф╕кReplicaя╝МReplicaф╣ЛщЧ┤цШпф╕Аф╕╗хдЪф╗ОчЪДхЕ│ч│╗я╝МцЬЙф╕дчзНч▒╗хЮЛLeader Replicaя╝ИщвЖхп╝шАЕхЙпцЬмя╝ЙхТМFollower Replicaя╝Иш╖ЯщЪПшАЕхЙпцЬмя╝Йя╝МReplicaхИЖх╕ГхЬиф╕НхРМчЪДBrokerшКВчВ╣ф╕КуАВ</p> <p>Leader Replicaш┤Яш┤гшп╗хЖЩшп╖ц▒Вя╝МFollower ReplicaхПкш┤Яш┤гхРМцнеLeader ReplicaцХ░цНоя╝Мф╕Нхп╣хдЦцПРф╛ЫцЬНхКбуАВх╜УLeader ReplicaхПСчФЯцХЕщЪЬя╝Мх░▒ф╗ОFollower ReplicaщАЙф╕╛хЗ║ф╕Аф╕кцЦ░чЪДLeader Replicaч╗зч╗нхп╣хдЦцПРф╛ЫцЬНхКбя╝МхоЮчО░ф║ЖцХЕщЪЬшЗкхКиш╜мчз╗уАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181833354.png" alt="image.png"></p> <p>Kafkaф╕║ф║ЖцПРхНЗReplicaчЪДхРМцнецХИчОЗхТМцХ░цНохЖЩхЕецХИчОЗя╝МхПИхп╣Replicaш┐ЫшбМхИЖч▒╗уАВщТИхп╣ф╕Аф╕кPartitionчЪДцЙАцЬЙReplicaщЫЖхРИч╗Ячз░ф╕║ARя╝ИAssigned Replicasя╝Мх╖▓хИЖщЕНчЪДхЙпцЬмя╝Йя╝МхМЕхРлLeader ReplicaхТМFollower ReplicaуАВф╕ОLeader Replicaф┐ЭцМБхРМцнечЪДReplicaщЫЖхРИчз░ф╕║ISRя╝ИIn-Sync Replicasя╝МхРМцнехЙпцЬмя╝Йя╝Мф╕ОLeader Replicaф┐ЭцМБхд▒хО╗хРМцнечЪДReplicaщЫЖхРИчз░ф╕║OSRя╝ИOut-of-Sync Replicasя╝Мхд▒хО╗хРМцнечЪДхЙпцЬмя╝Йя╝МAR = ISR + OSRуАВ
Leader Replicaх░Жц╢ИцБпхЖЩхЕечгБчЫШхЙНя╝МщЬАшжБчнЙISRф╕нчЪДцЙАцЬЙхЙпцЬмхРМцнехоМцИРуАВхжВцЮЬISRф╕нцЯРф╕кFollower ReplicaхРМцнецХ░цНошР╜хРОLeader Replicaш┐ЗхдЪя╝Мф╝Ъшвлш╜мчз╗хИ░OSRф╕нуАВхжВцЮЬOSRф╕нчЪДцЯРф╕кFollower ReplicaхРМцнецХ░цНош┐╜ф╕Кф║ЖLeader Replicaя╝Мф╝Ъшвлш╜мчз╗хИ░ISRф╕нуАВх╜УLeader ReplicaхПСчФЯцХЕщЪЬчЪДцЧ╢хАЩя╝МхПкф╝Ъф╗ОISRф╕нщАЙф╕╛хЗ║цЦ░чЪДLeader Replica</p> <h3 id="leoхТМhw"><a href="#leoхТМhw" class="header-anchor">#</a> LEOхТМHW</h3> <p>Kafkaф╕║ф║Жшо░х╜ХхЙпцЬмчЪДхРМцнечК╢цАБя╝Мф╗ехПКцОзхИ╢ц╢Иш┤╣шАЕц╢Иш┤╣ц╢ИцБпчЪДшМГхЫ┤я╝Мф║ОцШпх╝ХхЕеф║ЖLEOя╝ИLog End Offsetя╝МцЧех┐Чч╗УцЭЯхБПчз╗щЗПя╝ЙхТМHWя╝ИHigh Watermarkя╝МщлШц░┤ф╜Ня╝ЙуАВ
LEOшбичд║хИЖхМ║ф╕нчЪДф╕Лф╕Аф╕кшвлхЖЩхЕец╢ИцБпчЪДхБПчз╗щЗПя╝Мф╣ЯцШпхИЖхМ║ф╕нчЪДцЬАхдзхБПчз╗щЗПуАВLEOчФиф║Ошо░х╜ХLeader ReplicaхТМFollower Replicaф╣ЛщЧ┤чЪДцХ░цНохРМцнеш┐Ых║жя╝МцпПф╕кхЙпцЬмф╕нхРДцЬЙф╕Аф╗╜уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Leader</span> <span class="token operator">:</span> <span class="token constant">LEO</span> <span class="token number">1000</span> <span class="token constant">HW</span> <span class="token operator">:</span> <span class="token number">950</span>
<span class="token class-name">Follower1</span> <span class="token operator">:</span> <span class="token constant">LEO</span> <span class="token number">980</span>
<span class="token class-name">Follower2</span> <span class="token operator">:</span> <span class="token constant">LEO</span> <span class="token number">1000</span>
<span class="token class-name">Follower3</span> <span class="token operator">:</span> <span class="token constant">LEO</span> <span class="token number">950</span>
</code></pre></div><p>HWшбичд║цЙАцЬЙхЙпцЬмя╝ИLeaderхТМFollowerя╝ЙщГ╜х╖▓цИРхКЯхдНхИ╢чЪДцЬАх░ПхБПчз╗щЗПя╝МцШпцЙАцЬЙхЙпцЬмхЕ▒ф║лчЪДцХ░цНохА╝уАВцНвхПешпЭшп┤я╝МHWф╣ЛхЙНчЪДц╢ИцБпщГ╜швлшзЖф╕║х╖▓цПРф║дя╝Мц╢Иш┤╣шАЕхПпф╗ец╢Иш┤╣ш┐Щф║Ыц╢ИцБпуАВчФиф║Очбоф┐Эц╢ИцБпчЪДф╕АшЗ┤цАзхТМхПкшп╗ф╕АцмбуАВ</p> <p>LEOхТМHWчЪДцЫ┤цЦ░ц╡БчиЛя╝Ъ</p> <ol><li><p>хИЭхзЛчК╢цАБя╝Мф╕Йф╕кхЙпцЬмф╕нхРДцЬЙ0хТМ1ф╕дцЭбц╢ИцБпя╝МLEOщГ╜цШп2я╝Мф╜Нч╜о2цШпчй║чЪДя╝Мшбичд║цШпхН│х░ЖшвлхЖЩхЕец╢ИцБпчЪДф╜Нч╜оуАВHWф╣ЯщГ╜цШп2я╝Мшбичд║Leader Replicaф╕нчЪДцЙАцЬЙц╢ИцБпх╖▓ч╗ПхЕищГихРМцнехИ░Follower Replicaф╕ня╝Мц╢Иш┤╣шАЕхПпф╗ец╢Иш┤╣0хТМ1ф╕дцЭбц╢ИцБпуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181835723.png" alt="image.png"></p></li> <li><p>чФЯф║зшАЕх╛АLeader Replicaф╕нхПСщАБф╕дцЭбц╢ИцБпя╝МцндцЧ╢Leader ReplicaчЪДLEOчЪДхА╝хвЮхКа2я╝МхПШцИР4уАВчФ▒ф║Ош┐Шц▓бцЬЙх╝АхзЛх╛АFollower ReplicaхРМцнец╢ИцБпя╝МцЙАф╗еHWхА╝хТМFollower Replicaф╕нLEOхА╝щГ╜ц▓бцЬЙхПШуАВчФ▒ф║Оц╢Иш┤╣шАЕхПкшГ╜ц╢Иш┤╣HWф╣ЛхЙНчЪДц╢ИцБпя╝Мф╣Ях░▒цШп0хТМ1ф╕дцЭбц╢ИцБп</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181835548.png" alt="image.png"></p></li> <li><p>Leader Replicaх╝АхзЛхРСFollower ReplicaхРМцнец╢ИцБпя╝МхРМцнещАЯчОЗф╕НхРМя╝МFollower1чЪДф╕дцЭбц╢ИцБп2хТМ3х╖▓ч╗ПхРМцнехоМцИРя╝МшАМFollower2хПкхРМцнеф║Жф╕АцЭбц╢ИцБп2уАВцндцЧ╢я╝МLeaderхТМFollower1чЪДLEOщГ╜цШп4я╝МшАМFollower2чЪДLEOцШп3я╝МHWшбичд║х╖▓цИРхКЯхРМцнечЪДцЬАх░ПхБПчз╗щЗПя╝МхА╝цШп3я╝Мшбичд║цндцЧ╢ц╢Иш┤╣шАЕхПкшГ╜шп╗хИ░0уАБ1уАБ2я╝Мф╕ЙцЭбц╢ИцБп</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181835749.png" alt="image.png"></p></li> <li><p>цЙАцЬЙц╢ИцБпщГ╜хРМцнехоМцИРя╝Мф╕Йф╕кхЙпцЬмчЪДLEOщГ╜цШп4я╝МHWф╣ЯцШп4я╝Мц╢Иш┤╣шАЕхПпф╗ешп╗хИ░0уАБ1уАБ2уАБ3я╝МхЫЫцЭбц╢ИцБп</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181835749.png" alt=""></p></li></ol> <h3 id="kafkaхИЖхМ║leaderщАЙф╕╛"><a href="#kafkaхИЖхМ║leaderщАЙф╕╛" class="header-anchor">#</a> KafkaхИЖхМ║LeaderщАЙф╕╛</h3> <p>х╕╕шзБчЪДцЬЙф╗еф╕ЛхЗачзНцГЕхЖ╡ф╝ЪшзжхПСPartitionчЪДLeader ReplicaщАЙф╕╛я╝Ъ</p> <ol><li>Leader Replica хд▒цХИя╝Ъх╜У Leader Replica хЗ║чО░цХЕщЪЬцИЦшАЕхд▒хО╗ш┐ЮцОецЧ╢я╝МKafka ф╝ЪшзжхПС Leader Replica щАЙф╕╛уАВ</li> <li>Broker хоХцЬ║я╝Ъх╜У Leader Replica цЙАхЬичЪД Broker шКВчВ╣хПСчФЯцХЕщЪЬцИЦшАЕхоХцЬ║цЧ╢я╝МKafka ф╣Яф╝ЪшзжхПС Leader Replica щАЙф╕╛уАВ</li> <li>цЦ░хвЮ Brokerя╝Ъх╜УщЫЖч╛дф╕нцЦ░хвЮ Broker шКВчВ╣цЧ╢я╝МKafka ш┐Шф╝ЪшзжхПС Leader Replica щАЙф╕╛я╝Мф╗ещЗНцЦ░хИЖщЕН Partition чЪД LeaderуАВ</li> <li>цЦ░х╗║хИЖхМ║я╝Ъх╜Уф╕Аф╕кцЦ░чЪДхИЖхМ║швлхИЫх╗║цЧ╢я╝МщЬАшжБщАЙф╕╛ф╕Аф╕к Leader ReplicaуАВ</li> <li>SR хИЧшбицХ░щЗПхЗПх░Ся╝Ъх╜У Partition чЪД ISR хИЧшбицХ░щЗПхЗПх░СцЧ╢я╝МхПпшГ╜ф╝ЪшзжхПС Leader Replica щАЙф╕╛уАВх╜У ISR хИЧшбиф╕нхЙпцЬмцХ░щЗПх░Пф║ОReplication Factorя╝ИхЙпцЬмхЫахнРя╝ЙцЧ╢я╝Мф╕║ф║Жф┐ЭшпБцХ░цНочЪДхоЙхЕицАзя╝Мх░▒ф╝ЪшзжхПС Leader Replica щАЙф╕╛уАВ</li> <li>цЙЛхКишзжхПСя╝ЪщАЪш┐З Kafka чобчРЖх╖ехЕ╖я╝Иkafka-preferred-replica-election.shя╝Йя╝МхПпф╗ецЙЛхКишзжхПСщАЙф╕╛я╝Мф╗ех╣│шббш┤Яш╜╜цИЦхоЮчО░щЫЖч╛дч╗┤цКд</li></ol> <h4 id="leader-replicaщАЙф╕╛чнЦчХе"><a href="#leader-replicaщАЙф╕╛чнЦчХе" class="header-anchor">#</a> Leader ReplicaщАЙф╕╛чнЦчХе</h4> <p>хЬи Kafka щЫЖч╛дф╕ня╝Мх╕╕шзБчЪД Leader Replica щАЙф╕╛чнЦчХецЬЙф╗еф╕Лф╕ЙчзНя╝Ъ</p> <ol><li>ISR щАЙф╕╛чнЦчХея╝Ъщ╗ШшодцГЕхЖ╡ф╕Ля╝МKafka хПкф╝Ъф╗О ISR щЫЖхРИчЪДхЙпцЬмф╕нщАЙф╕╛хЗ║цЦ░чЪД Leader Replicaя╝МOSR щЫЖхРИф╕нчЪДхЙпцЬмф╕НхЕ╖хдЗхПВщАЙш╡Дца╝уАВ</li> <li>ф╕Нх╣▓хЗАхЙпцЬмщАЙф╕╛чнЦчХея╝ИUnclean Leader Electionя╝Йя╝ЪхЬицЯРф║ЫцГЕхЖ╡ф╕Ля╝МISR щАЙф╕╛чнЦчХехПпшГ╜ф╝Ъхд▒ш┤ея╝Мф╛ЛхжВх╜УцЙАцЬЙ ISR хЙпцЬмщГ╜ф╕НхПпчФицЧ╢уАВхЬиш┐ЩчзНцГЕхЖ╡ф╕Ля╝МхПпф╗еф╜┐чФи Unclean Leader щАЙф╕╛чнЦчХеуАВUnclean Leader щАЙф╕╛чнЦчХеф╝Ъф╗ОцЙАцЬЙхЙпцЬмф╕ня╝ИхМЕхРлOSRщЫЖхРИя╝ЙщАЙцЛйф╕Аф╕кхЙпцЬмф╜Ьф╕║цЦ░чЪД Leader хЙпцЬмя╝МхН│ф╜┐ш┐Щф╕кхЙпцЬмф╕Ох╜УхЙН Leader хЙпцЬмф╕НхРМцнеуАВш┐ЩчзНщАЙф╕╛чнЦчХехПпшГ╜ф╝Ъхп╝шЗ┤цХ░цНоф╕вхд▒я╝Мщ╗ШшодхЕ│щЧн</li> <li>щжЦщАЙхЙпцЬмщАЙф╕╛чнЦчХея╝ИPreferred Replica Electionя╝Йя╝ЪщжЦщАЙхЙпцЬмщАЙф╕╛чнЦчХеф╣ЯцШп Kafka щ╗ШшодчЪДщАЙф╕╛чнЦчХеуАВхЬиш┐ЩчзНчнЦчХеф╕Ля╝МцпПф╕кхИЖхМ║щГ╜цЬЙф╕Аф╕кщжЦщАЙхЙпцЬмя╝ИPreferred Replicaя╝Йя╝МщАЪх╕╕цШпхЙпцЬмщЫЖхРИф╕нчЪДчммф╕Аф╕кхЙпцЬмуАВх╜УшзжхПСщАЙф╕╛цЧ╢я╝МцОзхИ╢хЩиф╝Ъф╝ШхЕИщАЙцЛйшпещжЦщАЙхЙпцЬмф╜Ьф╕║цЦ░чЪД Leader Replicaя╝МхПкцЬЙхЬищжЦщАЙхЙпцЬмф╕НхПпчФичЪДцГЕхЖ╡ф╕Ля╝МцЙНф╝ЪшАГшЩСхЕ╢ф╗ЦхЙпцЬмуАВ
х╜УчД╢я╝МхПпф╗еф╜┐чФихС╜ф╗дцЙЛхКицМЗхоЪцпПф╕кхИЖхМ║чЪДщжЦщАЙхЙпцЬмя╝Ъ</li></ol> <blockquote><p>bin/kafka-topics.sh --zookeeper localhost:2181 --topic my-topic-name --replica-assignment 0:1,1:2,2:0 --partitions 3
цДПцАЭцШпя╝Ъmy-topic-nameцЬЙ3ф╕кpartitionя╝Мpartition0чЪДщжЦщАЙхЙпцЬмцШпBroker1я╝Мpartition1щжЦщАЙхЙпцЬмцШпBroker2я╝Мpartition2чЪДщжЦщАЙхЙпцЬмцШпBroker0</p></blockquote> <h4 id="leader-replicaщАЙф╕╛ш┐ЗчиЛ"><a href="#leader-replicaщАЙф╕╛ш┐ЗчиЛ" class="header-anchor">#</a> Leader ReplicaщАЙф╕╛ш┐ЗчиЛ</h4> <p>ш░БцЭеф╕╗цМБщАЙф╕╛я╝Я</p> <p>kafkaхЕИхЬиbrokersщЗМщЭвщАЙф╕Аф╕кbrokerф╜Ьф╕║Controllerф╕╗цМБщАЙф╕╛уАВControllerцШпф╜┐чФиzookeeperщАЙф╕╛хЗ║цЭечЪДя╝МцпПф╕кbrokerщГ╜х╛АzkщЗМщЭвхЖЩф╕Аф╕к/controllerшКВчВ╣я╝Мш░БхЕИхЖЩцИРхКЯя╝Мш░Бх░▒цИРф╕║ControllerуАВхжВцЮЬControllerхд▒хО╗ш┐ЮцОея╝Мzkф╕КчЪДф╕┤цЧ╢шКВчВ╣х░▒ф╝Ъц╢Ихд▒уАВхЕ╢хоГчЪДbrokerщАЪш┐ЗwatcherчЫСхРмхИ░Controllerф╕Лч║┐чЪДц╢ИцБпхРОя╝Мх╝АхзЛщАЙф╕╛цЦ░чЪДControllerуАВ</p> <blockquote><p>ф╕Аф╕кBrokerшКВчВ╣чЫ╕х╜Уф║Оф╕АхП░цЬ║хЩия╝МхдЪф╕кBrokerшКВчВ╣ч╗ДцИРф╕Аф╕кKafkaщЫЖч╛дуАВControllerшКВчВ╣ф╣ЯхПлцОзхИ╢хЩишКВчВ╣ , ф╗Цш┤Яш┤гчЫ┤цОеф╕Оzookeeperш┐ЫшбМщАЪф┐бя╝Мх╣╢ш┤Яш┤гчобчРЖцХ┤ф╕кщЫЖч╛дчЪДчК╢цАБхТМхЕГцХ░цНоф┐бцБп</p></blockquote> <p><strong>ControllerчЪДш┤гф╗╗</strong></p> <ul><li>чЫСхРмBrokerчЪДхПШхМЦ</li> <li>чЫСхРмTopicхПШхМЦ</li> <li>чЫСхРмPartitionхПШхМЦ</li> <li>шО╖хПЦхТМчобчРЖBrokerуАБTopicуАБPartitionчЪДф┐бцБп</li> <li>чобчРЖPartitionчЪДф╕╗ф╗Оф┐бцБп</li></ul> <p>х╜УLeader ReplicaхоХцЬ║цИЦхд▒цХИцЧ╢я╝Мх░▒ф╝ЪшзжхПС Leader Replica щАЙф╕╛я╝МхИЖф╕║ф╕дф╕кщШ╢цо╡я╝Мчммф╕Аф╕кщШ╢цо╡цШпхАЩщАЙф║║чЪДцПРхРНхТМцКХчеищШ╢цо╡я╝Мчммф║Мф╕кщШ╢цо╡цШпLeaderчЪДчбошодщШ╢цо╡уАВхЕ╖ф╜Уш┐ЗчиЛхжВф╕Ля╝Ъ</p> <blockquote><p>lag(ц╗ЮхРОя╝ЙцШпkafkaц╢Иш┤╣щШЯхИЧцАзшГ╜чЫСцОзчЪДщЗНшжБцМЗцаЗя╝МlagчЪДхА╝ш╢Кхдзя╝Мшбичд║kafkaчЪДц╢ИцБпхаЖчзпш╢Кф╕ещЗН</p></blockquote> <ol><li>хАЩщАЙф║║цПРхРНхТМцКХчеищШ╢цо╡
хЬиLeader Replicaхд▒цХИцЧ╢я╝МISRщЫЖхРИф╕нцЙАцЬЙFollower ReplicaщГ╜хПпф╗ецИРф╕║цЦ░чЪДLeader ReplicaхАЩщАЙф║║уАВцпПф╕кFollower Replicaф╝ЪхЬищАЙф╕╛х╝АхзЛцЧ╢хРСхЕ╢ф╗ЦFollower ReplicaхПСщАБцИРф╕║хАЩщАЙф║║чЪДшп╖ц▒Вя╝Мх╣╢щЩДх╕жшЗкх╖▒чЪДхЕГцХ░цНоф┐бцБпя╝МхМЕцЛмшЗкх╖▒чЪДх╜УхЙНчК╢цАБхТМLagхА╝уАВшАМPreferred replicaф╝ШхЕИцИРф╕║хАЩщАЙф║║уАВ
хЕ╢ф╗ЦFollower ReplicaхЬицФ╢хИ░хАЩщАЙф║║шп╖ц▒ВхРОя╝Мф╝Ъца╣цНошп╖ц▒Вф╕нчЪДхЕГцХ░цНоф┐бцБпя╝МшобчоЧцпПф╕кхАЩщАЙф║║чЪДLagхА╝я╝Мх╣╢х░ЖшЗкх╖▒чЪДщАЙчеицКХч╗ЩLagцЬАх░ПчЪДхАЩщАЙф║║уАВхжВцЮЬхдЪф╕кхАЩщАЙф║║чЪДLagхА╝чЫ╕хРМя╝МхИЩщЪПцЬ║щАЙцЛйф╕Аф╕кхАЩщАЙф║║уАВ</li> <li>LeaderчбошодщШ╢цо╡
хЬичммф╕АщШ╢цо╡ч╗УцЭЯхРОя╝МцЙАцЬЙчЪДFollower Replicaф╝ЪщЗНцЦ░шобчоЧцпПф╜НхАЩщАЙф║║чЪДLagхА╝я╝Мх╣╢цКХчеич╗ЩLagхА╝цЬАх░ПчЪДхАЩщАЙф║║уАВцндцЧ╢я╝МщАЙф╕╛чЪДч╗УцЮЬх╣╢ф╕Нф╕АхоЪхЗ║чО░хп╣хАЩщАЙф║║чЪДхЕих▒АхЕ▒шпЖуАВф╕║ф║ЖщБ┐хЕНхЗ║чО░ш┐ЩчзНцГЕхЖ╡я╝МKafkaф╕нф╜┐чФиф║ЖZooKeeperцЭехоЮчО░хИЖх╕Гх╝ПщФБя╝Мчбоф┐ЭхПкцЬЙф╕Аф╕кхАЩщАЙф║║шГ╜хдЯцИРф╕║цЦ░чЪДLeader ReplicaуАВ
х╜УZooKeeperчбошодцЬЙф╕Аф╕кхАЩщАЙф║║х╖▓ч╗ПшО╖х╛Чф║ЖхИЖх╕Гх╝ПщФБцЧ╢я╝МшпехАЩщАЙф║║х░▒цИРф╕║ф║ЖцЦ░чЪДLeader Replicaя╝Мх╣╢хРСцЙАцЬЙчЪДFollower ReplicaхПСщАБф╕Аф╕кLeaderAndIsrRequestшп╖ц▒Вя╝МцЫ┤цЦ░PartitionчЪДхЕГцХ░цНоф┐бцБпуАВхЕ╢ф╗ЦFollower ReplicaцОецФ╢хИ░шп╖ц▒ВхРОя╝Мф╝ЪцЫ┤цЦ░шЗкх╖▒чЪДPartitionхЕГцХ░цНоф┐бцБпя╝Мх░ЖцЦ░чЪДLeader ReplicaчЪДIDц╖╗хКахИ░ISRхИЧшбиф╕н</li></ol> <h2 id="хЙпцЬмцЬ║хИ╢-replication"><a href="#хЙпцЬмцЬ║хИ╢-replication" class="header-anchor">#</a> хЙпцЬмцЬ║хИ╢(Replicationя╝Й</h2> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181839286.jpeg" alt="img"></p> <p>Kafka ф╕нц╢ИцБпчЪДхдЗф╗╜хПИхПлхБЪ хЙпцЬмя╝ИReplicaя╝Й</p> <p>Kafka хоЪф╣Йф║Жф╕дч▒╗хЙпцЬмя╝Ъ</p> <ul><li>щвЖхп╝шАЕхЙпцЬмя╝ИLeader Replicaя╝Й: ш┤Яш┤гцХ░цНошп╗хЖЩ</li> <li>ш┐╜щЪПшАЕхЙпцЬмя╝ИFollower Replicaя╝Й: хПкш┤Яш┤гцХ░цНохдЗф╗╜</li> <li>х╜УщвЖхп╝шАЕхЙпцЬмцЙАхЬишКВчВ╣хоХцЬ║ф╣ЛхРО, ф╝Ъф╗Ош┐╜щЪПшАЕхЙпцЬмф╕нщАЙф╕╛ф╕Аф╕кшКВчВ╣, хНЗч║зф╕║щвЖхп╝шАЕхЙпцЬм , хп╣хдЦцПРф╛ЫцХ░цНошп╗хЖЩцЬНхКб, ф┐ЭшпБцХ░цНохоЙхЕи</li></ul> <h2 id="ц╢Иш┤╣шАЕч╗ДхТМхЖНхЭЗшбб"><a href="#ц╢Иш┤╣шАЕч╗ДхТМхЖНхЭЗшбб" class="header-anchor">#</a> ц╢Иш┤╣шАЕч╗ДхТМхЖНхЭЗшбб</h2> <h3 id="ц╢Иш┤╣шАЕч╗Д"><a href="#ц╢Иш┤╣шАЕч╗Д" class="header-anchor">#</a> ц╢Иш┤╣шАЕч╗Д</h3> <p>ц╢Иш┤╣шАЕч╗Дя╝ИConsumer Groupя╝ЙцШпчФ▒ф╕Аф╕кцИЦхдЪф╕кц╢Иш┤╣шАЕхоЮф╛Ля╝ИConsumer Instanceя╝Йч╗ДцИРчЪДч╛дч╗Дя╝МхЕ╖цЬЙхПпцЙйх▒ХцАзхТМхПпхо╣щФЩцАзчЪДф╕АчзНцЬ║хИ╢уАВц╢Иш┤╣шАЕч╗ДхЖЕчЪДц╢Иш┤╣шАЕхЕ▒ф║лф╕Аф╕кц╢Иш┤╣шАЕч╗ДIDя╝Мш┐Щф╕кID ф╣ЯхПлхБЪ Group IDя╝Мч╗ДхЖЕчЪДц╢Иш┤╣шАЕхЕ▒хРМхп╣ф╕Аф╕кф╕╗щвШш┐ЫшбМшовщШЕхТМц╢Иш┤╣я╝МхРМф╕Аф╕кч╗Дф╕нхПкшГ╜хдЯчФ▒ф╕Аф╕кц╢Иш┤╣шАЕхО╗ц╢Иш┤╣цЯРф╕Аф╕кхИЖхМ║чЪДцХ░цНоя╝МхдЪф╜ЩчЪДц╢Иш┤╣шАЕф╝ЪщЧ▓ч╜оя╝Мц┤╛ф╕Нф╕КчФихЬ║уАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181839132.jpeg" alt="img"></p> <blockquote><p>хРМф╕Аф╕кхИЖхМ║хПкшГ╜швлф╕Аф╕кц╢Иш┤╣шАЕч╗Дф╕нчЪДф╕Аф╕кц╢Иш┤╣шАЕц╢Иш┤╣ , ф╕Аф╕кц╢Иш┤╣шАЕч╗Дф╕нчЪДцЯРф╕Аф╕кц╢Иш┤╣шАЕ, хПпф╗ец╢Иш┤╣хдЪф╕кхИЖхМ║</p></blockquote> <p><strong>ф╕Аф╕кчФЯф║зшАЕхПСщАБф╕АцЭбц╢ИцБпхПкшГ╜швлф╕Аф╕кц╢Иш┤╣шАЕц╢Иш┤╣ : шойц╢Иш┤╣шАЕхдДф║ОхРМф╕Аф╕кч╗Дф╕нхН│хПп</strong> <strong>ф╕Аф╕кчФЯф║зшАЕхПСщАБф╕АцЭбц╢ИцБпщЬАшжБшвлхдЪф╕кц╢Иш┤╣шАЕц╢Иш┤╣ : шойц╢Иш┤╣шАЕхдДф║Оф╕НхРМчЪДч╗Дф╕н</strong></p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KafkaConsumerListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">&quot;kafka.topic.my-topic1&quot;</span><span class="token punctuation">,</span>groupId <span class="token operator">=</span> <span class="token string">&quot;group1&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopic1group1</span><span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;group1ф╕нчЪДц╢Иш┤╣шАЕцОецФ╢хИ░ц╢ИцБп:&quot;</span><span class="token operator">+</span>key <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">&quot;kafka.topic.my-topic1&quot;</span><span class="token punctuation">,</span>groupId <span class="token operator">=</span> <span class="token string">&quot;group2&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listenTopic1group2</span><span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;group2ф╕нчЪДц╢Иш┤╣шАЕцОецФ╢хИ░ц╢ИцБп:&quot;</span><span class="token operator">+</span>key <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="хЖНхЭЗшбб-щЗНх╣│шбб"><a href="#хЖНхЭЗшбб-щЗНх╣│шбб" class="header-anchor">#</a> хЖНхЭЗшбб(щЗНх╣│шбб)</h3> <blockquote><p>хЖНхЭЗшббх░▒цШпцМЗ х╜Уц╢Иш┤╣шАЕч╗Дф╕нчЪДц╢Иш┤╣шАЕхПСчФЯхПШцЫ┤чЪДцЧ╢хАЩ(цЦ░хвЮц╢Иш┤╣шАЕ, ц╢Иш┤╣шАЕхоХцЬ║) , щЗНцЦ░ф╕║ц╢Иш┤╣шАЕхИЖщЕНц╢Иш┤╣хИЖхМ║чЪДш┐ЗчиЛ</p></blockquote> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181840102.jpeg" alt="img"></p> <p>х╜Уц╢Иш┤╣шАЕч╗Дф╕нщЗНцЦ░хКахЕец╢Иш┤╣шАЕ , цИЦшАЕц╢Иш┤╣шАЕч╗Дф╕нцЬЙц╢Иш┤╣шАЕхоХцЬ║ , ш┐Щф╕кцЧ╢хАЩKafkaф╝Ъф╕║ц╢Иш┤╣шАЕч╗Дф╕нчЪДц╢Иш┤╣шАЕф╗ОцЦ░хИЖщЕНц╢Иш┤╣хИЖхМ║чЪДш┐ЗчиЛх░▒цШпхЖНхЭЗшбб</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181841753.jpeg" alt=""></p> <p>щЗНх╣│шбб(хЖНхЭЗшбб)щЭЮх╕╕щЗНшжБя╝МхоГф╕║ц╢Иш┤╣шАЕч╛дч╗Дх╕жцЭеф║Ж<code>щлШхПпчФицАз</code> хТМ <code>ф╝╕ч╝йцАз</code>я╝МцИСф╗мхПпф╗ецФ╛х┐ГчЪДц╖╗хКац╢Иш┤╣шАЕцИЦчз╗щЩдц╢Иш┤╣шАЕя╝Мф╕Нш┐ЗхЬицнгх╕╕цГЕхЖ╡ф╕ЛцИСф╗мх╣╢ф╕Нх╕МцЬЫхПСчФЯш┐Щца╖чЪДшбМф╕║уАВ<strong>хЬищЗНх╣│шббцЬЯщЧ┤я╝Мц╢Иш┤╣шАЕцЧац│Хшп╗хПЦц╢ИцБпя╝МщАацИРцХ┤ф╕кц╢Иш┤╣шАЕч╗ДхЬищЗНх╣│шббчЪДцЬЯщЧ┤щГ╜ф╕НхПпчФи , х╣╢ф╕ФхЬихПСчФЯхЖНхЭЗшббчЪДцЧ╢хАЩцЬЙхПпшГ╜хп╝шЗ┤ц╢ИцБпчЪДф╕вхд▒хТМщЗНхдНц╢Иш┤╣</strong></p> <h2 id="хПВшАГш╡ДцЦЩ"><a href="#хПВшАГш╡ДцЦЩ" class="header-anchor">#</a> хПВшАГш╡ДцЦЩ</h2> <p><a href="https://blog.csdn.net/Aaaaaaatwl/article/details/139859673" target="_blank" rel="noopener noreferrer">kafka-щлШхПпчФишо╛шобшпжшзгя╝ИщЫЖч╛дцЮ╢цЮДуАБхдЗф╗╜цЬ║хИ╢уАБц╢Иш┤╣шАЕч╗ДуАБщЗНх╣│шббя╝Й_kafkaщлШхПпчФи-CSDNхНЪхов<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/02.Kafka  ч│╗ч╗Яшо╛шоб/08.хЫЫуАБшо╛шобчЫоцаЗ/20.щлШхПпчФицОвчй╢.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/18, 11:29:27</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/f57330/" class="prev">хЙпцЬмчобчРЖхЩи</a></span> <span class="next"><a href="/pages/168766/">щлШцЙйх▒ХцОвчй╢</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.78f2b9cc.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/31.21bd2de1.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
