<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>cluster | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ч│╗ч╗Яшо╛шобф╣ЛуАМшо▓шзг + щЭвшпХцМЗхНЧуАНя╝Мц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣я╝Б">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.c76c3453.css" as="style"><link rel="preload" href="/assets/js/app.ed657d66.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/80.d8713e74.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.9aeb5f9f.js"><link rel="prefetch" href="/assets/js/100.46e695d9.js"><link rel="prefetch" href="/assets/js/101.96ca71f6.js"><link rel="prefetch" href="/assets/js/11.71fe9642.js"><link rel="prefetch" href="/assets/js/12.915fdd22.js"><link rel="prefetch" href="/assets/js/13.d9d26d25.js"><link rel="prefetch" href="/assets/js/14.ae63dfd6.js"><link rel="prefetch" href="/assets/js/15.b3c76984.js"><link rel="prefetch" href="/assets/js/16.60cde607.js"><link rel="prefetch" href="/assets/js/17.acb3bf3d.js"><link rel="prefetch" href="/assets/js/18.baad837c.js"><link rel="prefetch" href="/assets/js/19.a22c1d8c.js"><link rel="prefetch" href="/assets/js/20.57cd4530.js"><link rel="prefetch" href="/assets/js/21.24c0f101.js"><link rel="prefetch" href="/assets/js/22.dd779f94.js"><link rel="prefetch" href="/assets/js/23.f2441cb8.js"><link rel="prefetch" href="/assets/js/24.6ba53300.js"><link rel="prefetch" href="/assets/js/25.e916760a.js"><link rel="prefetch" href="/assets/js/26.d629b8b1.js"><link rel="prefetch" href="/assets/js/27.054f34cc.js"><link rel="prefetch" href="/assets/js/28.95a1fb6b.js"><link rel="prefetch" href="/assets/js/29.371a40e1.js"><link rel="prefetch" href="/assets/js/3.e62a71e4.js"><link rel="prefetch" href="/assets/js/30.e32f6b31.js"><link rel="prefetch" href="/assets/js/31.a532917f.js"><link rel="prefetch" href="/assets/js/32.fb8340ca.js"><link rel="prefetch" href="/assets/js/33.eab858f3.js"><link rel="prefetch" href="/assets/js/34.6d3cc288.js"><link rel="prefetch" href="/assets/js/35.2760ed8d.js"><link rel="prefetch" href="/assets/js/36.4fd54c47.js"><link rel="prefetch" href="/assets/js/37.51145580.js"><link rel="prefetch" href="/assets/js/38.40fe2658.js"><link rel="prefetch" href="/assets/js/39.84b6e82e.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.234b79ea.js"><link rel="prefetch" href="/assets/js/41.fcee3e0f.js"><link rel="prefetch" href="/assets/js/42.b34f1599.js"><link rel="prefetch" href="/assets/js/43.5a509601.js"><link rel="prefetch" href="/assets/js/44.64fd3383.js"><link rel="prefetch" href="/assets/js/45.685623ac.js"><link rel="prefetch" href="/assets/js/46.0dc12666.js"><link rel="prefetch" href="/assets/js/47.9bed4c1b.js"><link rel="prefetch" href="/assets/js/48.ba7dfd47.js"><link rel="prefetch" href="/assets/js/49.ee9681bc.js"><link rel="prefetch" href="/assets/js/5.94727770.js"><link rel="prefetch" href="/assets/js/50.488122e5.js"><link rel="prefetch" href="/assets/js/51.ad7a3e32.js"><link rel="prefetch" href="/assets/js/52.2bb763f1.js"><link rel="prefetch" href="/assets/js/53.f76e624c.js"><link rel="prefetch" href="/assets/js/54.6140535b.js"><link rel="prefetch" href="/assets/js/55.653b34bd.js"><link rel="prefetch" href="/assets/js/56.67ae905d.js"><link rel="prefetch" href="/assets/js/57.be37bfce.js"><link rel="prefetch" href="/assets/js/58.ba27feb2.js"><link rel="prefetch" href="/assets/js/59.7b7e3faf.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/60.96815912.js"><link rel="prefetch" href="/assets/js/61.08b4acf0.js"><link rel="prefetch" href="/assets/js/62.cc8fdced.js"><link rel="prefetch" href="/assets/js/63.41ff19e4.js"><link rel="prefetch" href="/assets/js/64.9b3def35.js"><link rel="prefetch" href="/assets/js/65.0b2ab47d.js"><link rel="prefetch" href="/assets/js/66.2ae7a107.js"><link rel="prefetch" href="/assets/js/67.79dd6daf.js"><link rel="prefetch" href="/assets/js/68.1b76c178.js"><link rel="prefetch" href="/assets/js/69.7ac52a2f.js"><link rel="prefetch" href="/assets/js/70.7279b1df.js"><link rel="prefetch" href="/assets/js/71.4f744076.js"><link rel="prefetch" href="/assets/js/72.44c999da.js"><link rel="prefetch" href="/assets/js/73.526febf1.js"><link rel="prefetch" href="/assets/js/74.26f8d9a5.js"><link rel="prefetch" href="/assets/js/75.dc7fdd0f.js"><link rel="prefetch" href="/assets/js/76.32858593.js"><link rel="prefetch" href="/assets/js/77.7b3f6980.js"><link rel="prefetch" href="/assets/js/78.31a353ef.js"><link rel="prefetch" href="/assets/js/79.173bbc8c.js"><link rel="prefetch" href="/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/assets/js/81.711911b1.js"><link rel="prefetch" href="/assets/js/82.3b90a7cc.js"><link rel="prefetch" href="/assets/js/83.f3a9ee0c.js"><link rel="prefetch" href="/assets/js/84.eeb423e8.js"><link rel="prefetch" href="/assets/js/85.4cd3a775.js"><link rel="prefetch" href="/assets/js/86.931cbb70.js"><link rel="prefetch" href="/assets/js/87.78b2eebd.js"><link rel="prefetch" href="/assets/js/88.03774161.js"><link rel="prefetch" href="/assets/js/89.e6cb2516.js"><link rel="prefetch" href="/assets/js/9.6e274fca.js"><link rel="prefetch" href="/assets/js/90.cdc8eb8f.js"><link rel="prefetch" href="/assets/js/91.56e567ac.js"><link rel="prefetch" href="/assets/js/92.6b777d4b.js"><link rel="prefetch" href="/assets/js/93.fb2397b7.js"><link rel="prefetch" href="/assets/js/94.1eade7f0.js"><link rel="prefetch" href="/assets/js/95.96f5db04.js"><link rel="prefetch" href="/assets/js/96.fc68b295.js"><link rel="prefetch" href="/assets/js/97.0154143f.js"><link rel="prefetch" href="/assets/js/98.77b1da6d.js"><link rel="prefetch" href="/assets/js/99.0677ca0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c76c3453.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕АуАБхЙНшиА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║МуАБхЯ║чбАчЯешпЖ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>хЫЫуАБцФпч║┐ф╗╗хКб</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ф║ФуАБщЫЖч╛д</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ebc8dc/" class="sidebar-link">ф╕╗ф╗ОхдНхИ╢</a></li><li><a href="/pages/af8752/" class="sidebar-link">хУихЕ╡</a></li><li><a href="/pages/040403/" aria-current="page" class="active sidebar-link">cluster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/040403/#хЙНшиА" class="sidebar-link">хЙНшиА</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#шКВчВ╣" class="sidebar-link">шКВчВ╣</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#цз╜цМЗц┤╛" class="sidebar-link">цз╜цМЗц┤╛</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#хЬищЫЖч╛дф╕нцЙзшбМхС╜ф╗д" class="sidebar-link">хЬищЫЖч╛дф╕нцЙзшбМхС╜ф╗д</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#щЗНцЦ░хИЖчЙЗ" class="sidebar-link">щЗНцЦ░хИЖчЙЗ</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#ask-щФЩшпп" class="sidebar-link">ASK щФЩшпп</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#хдНхИ╢ф╕ОцХЕщЪЬш╜мчз╗" class="sidebar-link">хдНхИ╢ф╕ОцХЕщЪЬш╜мчз╗</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#ц╢ИцБп" class="sidebar-link">ц╢ИцБп</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#щЗНчВ╣хЫЮщб╛" class="sidebar-link">щЗНчВ╣хЫЮщб╛</a></li><li class="sidebar-sub-header level2"><a href="/pages/040403/#хПВшАГцЦЗчМо" class="sidebar-link">хПВшАГцЦЗчМо</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Redis ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>ф║ФуАБщЫЖч╛д</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">cluster<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="хЙНшиА"><a href="#хЙНшиА" class="header-anchor">#</a> хЙНшиА</h2> <p>Redis щЫЖч╛дцШп Redis цПРф╛ЫчЪДхИЖх╕Гх╝ПцХ░цНох║УцЦ╣цбИя╝МщЫЖч╛дщАЪш┐ЗхИЖчЙЗя╝Иshardingя╝ЙцЭеш┐ЫшбМцХ░цНохЕ▒ф║ля╝Мх╣╢цПРф╛ЫхдНхИ╢хТМцХЕщЪЬш╜мчз╗хКЯшГ╜уАВ</p> <p>цЬмшКВх░Жхп╣щЫЖч╛дчЪДшКВчВ╣уАБцз╜цМЗц┤╛уАБхС╜ф╗дцЙзшбМуАБщЗНцЦ░хИЖчЙЗуАБш╜мхРСуАБцХЕщЪЬш╜мчз╗уАБц╢ИцБпчнЙхРДф╕кцЦ╣щЭвш┐ЫшбМф╗Лч╗Н</p> <h2 id="шКВчВ╣"><a href="#шКВчВ╣" class="header-anchor">#</a> шКВчВ╣</h2> <p>ф╕Аф╕к Redis щЫЖч╛дщАЪх╕╕чФ▒хдЪф╕кшКВчВ╣я╝Иnodeя╝Йч╗ДцИРя╝М хЬихИЪх╝АхзЛчЪДцЧ╢хАЩя╝М цпПф╕кшКВчВ╣щГ╜цШпчЫ╕ф║ТчЛмчлЛчЪДя╝М хоГф╗мщГ╜хдДф║Оф╕Аф╕кхПкхМЕхРлшЗкх╖▒чЪДщЫЖч╛дх╜Уф╕ня╝М шжБч╗Дх╗║ф╕Аф╕кчЬЯцнгхПпх╖еф╜ЬчЪДщЫЖч╛дя╝М цИСф╗мх┐Ещб╗х░ЖхРДф╕кчЛмчлЛчЪДшКВчВ╣ш┐ЮцОеш╡╖цЭея╝М цЮДцИРф╕Аф╕кхМЕхРлхдЪф╕кшКВчВ╣чЪДщЫЖч╛дуАВ</p> <p>ш┐ЮцОехРДф╕кшКВчВ╣чЪДх╖еф╜ЬхПпф╗еф╜┐чФи CLUSTER MEET хС╜ф╗дцЭехоМцИРя╝М шпехС╜ф╗дчЪДца╝х╝ПхжВф╕Ля╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>CLUSTER MEET <span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre></div><p>хРСф╕Аф╕кшКВчВ╣ <code>node</code> хПСщАБ CLUSTER MEET хС╜ф╗дя╝М хПпф╗ешой <code>node</code> шКВчВ╣ф╕О <code>ip</code> хТМ <code>port</code> цЙАцМЗхоЪчЪДшКВчВ╣ш┐ЫшбМцПбцЙЛя╝Иhandshakeя╝Йя╝М х╜УцПбцЙЛцИРхКЯцЧ╢я╝М <code>node</code> шКВчВ╣х░▒ф╝Ъх░Ж <code>ip</code> хТМ <code>port</code> цЙАцМЗхоЪчЪДшКВчВ╣ц╖╗хКахИ░ <code>node</code> шКВчВ╣х╜УхЙНцЙАхЬичЪДщЫЖч╛дф╕нуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝М хБЗшо╛чО░хЬицЬЙф╕Йф╕кчЛмчлЛчЪДшКВчВ╣ <code>127.0.0.1:7000</code> уАБ <code>127.0.0.1:7001</code> уАБ <code>127.0.0.1:7002</code> я╝Иф╕ЛцЦЗчЬБчХе IP хЬ░хЭАя╝МчЫ┤цОеф╜┐чФичлпхПгхП╖цЭехМ║хИЖхРДф╕кшКВчВ╣я╝Йя╝М цИСф╗мщжЦхЕИф╜┐чФиховцИ╖члпш┐Юф╕КшКВчВ╣ 7000 я╝М щАЪш┐ЗхПСщАБ CLUSTER NODE хС╜ф╗дхПпф╗ечЬЛхИ░я╝М щЫЖч╛дчЫохЙНхПкхМЕхРл 7000 шЗкх╖▒ф╕Аф╕кшКВчВ╣я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>$ redis-cli -c -p 7000
127.0.0.1:7000&gt; CLUSTER NODES
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master - 0 0 0 connected
</code></pre></div><p>щАЪш┐ЗхРСшКВчВ╣ 7000 хПСщАБф╗еф╕ЛхС╜ф╗дя╝М цИСф╗мхПпф╗ех░ЖшКВчВ╣ 7001 ц╖╗хКахИ░шКВчВ╣ 7000 цЙАхЬичЪДщЫЖч╛дщЗМщЭвя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; CLUSTER MEET 127.0.0.1 7001
OK

127.0.0.1:7000&gt; CLUSTER NODES
68eef66df23420a5862208ef5b1a7005b806f2ff 127.0.0.1:7001 master - 0 1388204746210 0 connected
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master - 0 0 0 connected
</code></pre></div><p>ч╗зч╗нхРСшКВчВ╣ 7000 хПСщАБф╗еф╕ЛхС╜ф╗дя╝М цИСф╗мхПпф╗ех░ЖшКВчВ╣ 7002 ф╣Яц╖╗хКахИ░шКВчВ╣ 7000 хТМшКВчВ╣ 7001 цЙАхЬичЪДщЫЖч╛дщЗМщЭвя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; CLUSTER MEET 127.0.0.1 7002
OK

127.0.0.1:7000&gt; CLUSTER NODES
68eef66df23420a5862208ef5b1a7005b806f2ff 127.0.0.1:7001 master - 0 1388204848376 0 connected
9dfb4c4e016e627d9769e4c9bb0d4fa208e65c26 127.0.0.1:7002 master - 0 1388204847977 0 connected
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master - 0 0 0 connected
</code></pre></div><p>чО░хЬия╝М ш┐Щф╕кщЫЖч╛дщЗМщЭвхМЕхРлф║Ж 7000 уАБ 7001 хТМ 7002 ф╕Йф╕кшКВчВ╣я╝М хЫ╛ IMAGE_CONNECT_NODES_1 шЗ│ IMAGE_CONNECT_NODES_5 х▒Хчд║ф║Жш┐Щф╕Йф╕кшКВчВ╣ш┐ЫшбМцПбцЙЛчЪДцХ┤ф╕кш┐ЗчиЛуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409172354043.png" alt=""></p> <p><img src="https://book-redis-design.netlify.app/images/graphviz-0dd5d540b9b878363345957a4d670ec68b8f6d2e.png" alt=""></p> <p><img src="https://book-redis-design.netlify.app/images/graphviz-ba1a1fe21698beb1c8f1e2b8a7d4b8613f3d6762.png" alt=""></p> <p><img src="https://book-redis-design.netlify.app/images/graphviz-82978b9d481d760ccbb0be601b833b971e03f712.png" alt=""></p> <p><img src="https://book-redis-design.netlify.app/images/graphviz-ec041e1da87d6bfcc318c57b4af697fc6db4d500.png" alt=""></p> <p>цЬмшКВцОеф╕ЛцЭечЪДхЖЕхо╣х░Жф╗Лч╗НхРпхКишКВчВ╣чЪДцЦ╣ц│Хя╝М хТМщЫЖч╛дцЬЙхЕ│чЪДцХ░цНоч╗УцЮДя╝М ф╗ехПК CLUSTER MEET хС╜ф╗дчЪДхоЮчО░хОЯчРЖуАВ</p> <h3 id="хРпхКишКВчВ╣"><a href="#хРпхКишКВчВ╣" class="header-anchor">#</a> хРпхКишКВчВ╣</h3> <p>ф╕Аф╕кшКВчВ╣х░▒цШпф╕Аф╕кш┐РшбМхЬищЫЖч╛дцибх╝Пф╕ЛчЪД Redis цЬНхКбхЩия╝М Redis цЬНхКбхЩихЬихРпхКицЧ╢ф╝Ъца╣цНо <code>cluster-enabled</code> щЕНч╜ощАЙщб╣чЪДцШпхРжф╕║ <code>yes</code> цЭехЖ│хоЪцШпхРжх╝АхРпцЬНхКбхЩичЪДщЫЖч╛дцибх╝Пя╝М хжВхЫ╛ IMAGE_NODE_OR_SERVER цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/graphviz-c2f64cc37f45e64ee79ac42a4f33e5ec23ad6bff.png" alt=""></p> <p>шКВчВ╣я╝Иш┐РшбМхЬищЫЖч╛дцибх╝Пф╕ЛчЪД Redis цЬНхКбхЩия╝Йф╝Ъч╗зч╗нф╜┐чФицЙАцЬЙхЬихНХцЬ║цибх╝Пф╕нф╜┐чФичЪДцЬНхКбхЩич╗Дф╗╢я╝М цпФхжВшп┤я╝Ъ</p> <ul><li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФицЦЗф╗╢ф║Лф╗╢хдДчРЖхЩицЭехдДчРЖхС╜ф╗дшп╖ц▒ВхТМш┐ФхЫЮхС╜ф╗дхЫЮхдНуАВ</li> <li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФицЧ╢щЧ┤ф║Лф╗╢хдДчРЖхЩицЭецЙзшбМ <code>serverCron</code> хЗ╜цХ░я╝М шАМ <code>serverCron</code> хЗ╜цХ░хПИф╝Ъш░ГчФищЫЖч╛дцибх╝ПчЙ╣цЬЙчЪД <code>clusterCron</code> хЗ╜цХ░я╝Ъ <code>clusterCron</code> хЗ╜цХ░ш┤Яш┤гцЙзшбМхЬищЫЖч╛дцибх╝Пф╕ЛщЬАшжБцЙзшбМчЪДх╕╕шзДцУНф╜Ья╝М цпФхжВхРСщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣хПСщАБ Gossip ц╢ИцБпя╝М цгАцЯешКВчВ╣цШпхРжцЦнч║┐я╝Ы хПИцИЦшАЕцгАцЯецШпхРжщЬАшжБхп╣ф╕Лч║┐шКВчВ╣ш┐ЫшбМшЗкхКицХЕщЪЬш╜мчз╗я╝М чнЙчнЙуАВ</li> <li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФицХ░цНох║УцЭеф┐ЭхнШщФохА╝хп╣цХ░цНоя╝МщФохА╝хп╣ф╛ЭчД╢ф╝ЪцШпхРДчзНф╕НхРМч▒╗хЮЛчЪДхп╣ш▒буАВ</li> <li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФи RDB цМБф╣ЕхМЦцибхЭЧхТМ AOF цМБф╣ЕхМЦцибхЭЧцЭецЙзшбМцМБф╣ЕхМЦх╖еф╜ЬуАВ</li> <li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФихПСх╕Гф╕ОшовщШЕцибхЭЧцЭецЙзшбМ PUBLISH уАБ SUBSCRIBE чнЙхС╜ф╗дуАВ</li> <li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФихдНхИ╢цибхЭЧцЭеш┐ЫшбМшКВчВ╣чЪДхдНхИ╢х╖еф╜ЬуАВ</li> <li>шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФи Lua шДЪцЬмчОпхвГцЭецЙзшбМховцИ╖члпш╛УхЕечЪД Lua шДЪцЬмуАВ</li></ul> <p>шп╕хжВцндч▒╗уАВ</p> <p><strong>щЩдцндф╣ЛхдЦ</strong>я╝М шКВчВ╣ф╝Ъч╗зч╗нф╜┐чФи <code>redisServer</code> ч╗УцЮДцЭеф┐ЭхнШцЬНхКбхЩичЪДчК╢цАБя╝М ф╜┐чФи <code>redisClient</code> ч╗УцЮДцЭеф┐ЭхнШховцИ╖члпчЪДчК╢цАБя╝М шЗ│ф║ОщВгф║ЫхПкцЬЙхЬищЫЖч╛дцибх╝Пф╕ЛцЙНф╝ЪчФихИ░чЪДцХ░цНоя╝М шКВчВ╣х░ЖхоГф╗мф┐ЭхнШхИ░ф║Ж <code>cluster.h/clusterNode</code> ч╗УцЮДя╝М <code>cluster.h/clusterLink</code> ч╗УцЮДя╝М ф╗ехПК <code>cluster.h/clusterState</code> ч╗УцЮДщЗМщЭвя╝М цОеф╕ЛцЭечЪДф╕АшКВх░Жхп╣ш┐Щф╕ЙчзНцХ░цНоч╗УцЮДш┐ЫшбМф╗Лч╗Н</p> <h3 id="щЫЖч╛дцХ░цНоч╗УцЮД"><a href="#щЫЖч╛дцХ░цНоч╗УцЮД" class="header-anchor">#</a> щЫЖч╛дцХ░цНоч╗УцЮД</h3> <p><code>clusterNode</code> ч╗УцЮДф┐ЭхнШф║Жф╕Аф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБя╝М цпФхжВшКВчВ╣чЪДхИЫх╗║цЧ╢щЧ┤я╝М шКВчВ╣чЪДхРНхнЧя╝М шКВчВ╣х╜УхЙНчЪДщЕНч╜оч║кхЕГя╝М шКВчВ╣чЪД IP хТМхЬ░хЭАя╝М чнЙчнЙуАВ</p> <p>цпПф╕кшКВчВ╣щГ╜ф╝Ъф╜┐чФиф╕Аф╕к <code>clusterNode</code> ч╗УцЮДцЭешо░х╜ХшЗкх╖▒чЪДчК╢цАБя╝М х╣╢ф╕║щЫЖч╛дф╕нчЪДцЙАцЬЙхЕ╢ф╗ЦшКВчВ╣я╝ИхМЕцЛмф╕╗шКВчВ╣хТМф╗ОшКВчВ╣я╝ЙщГ╜хИЫх╗║ф╕Аф╕кчЫ╕х║ФчЪД <code>clusterNode</code> ч╗УцЮДя╝М ф╗ецндцЭешо░х╜ХхЕ╢ф╗ЦшКВчВ╣чЪДчК╢цАБя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">clusterNode</span> <span class="token punctuation">{</span>

    <span class="token comment">// хИЫх╗║шКВчВ╣чЪДцЧ╢щЧ┤</span>
    <span class="token class-name">mstime_t</span> ctime<span class="token punctuation">;</span>

    <span class="token comment">// шКВчВ╣чЪДхРНхнЧя╝МчФ▒ 40 ф╕кхНБхЕнш┐ЫхИ╢хнЧчмжч╗ДцИР</span>
    <span class="token comment">// ф╛ЛхжВ 68eef66df23420a5862208ef5b1a7005b806f2ff</span>
    <span class="token keyword">char</span> name<span class="token punctuation">[</span>REDIS_CLUSTER_NAMELEN<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// шКВчВ╣цаЗшпЖ</span>
    <span class="token comment">// ф╜┐чФихРДчзНф╕НхРМчЪДцаЗшпЖхА╝шо░х╜ХшКВчВ╣чЪДшзТшЙ▓я╝ИцпФхжВф╕╗шКВчВ╣цИЦшАЕф╗ОшКВчВ╣я╝Йя╝М</span>
    <span class="token comment">// ф╗ехПКшКВчВ╣чЫохЙНцЙАхдДчЪДчК╢цАБя╝ИцпФхжВхЬич║┐цИЦшАЕф╕Лч║┐я╝ЙуАВ</span>
    <span class="token keyword">int</span> flags<span class="token punctuation">;</span>

    <span class="token comment">// шКВчВ╣х╜УхЙНчЪДщЕНч╜оч║кхЕГя╝МчФиф║ОхоЮчО░цХЕщЪЬш╜мчз╗</span>
    <span class="token class-name">uint64_t</span> configEpoch<span class="token punctuation">;</span>

    <span class="token comment">// шКВчВ╣чЪД IP хЬ░хЭА</span>
    <span class="token keyword">char</span> ip<span class="token punctuation">[</span>REDIS_IP_STR_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// шКВчВ╣чЪДчлпхПгхП╖</span>
    <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token comment">// ф┐ЭхнШш┐ЮцОешКВчВ╣цЙАщЬАчЪДцЬЙхЕ│ф┐бцБп</span>
    clusterLink <span class="token operator">*</span>link<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>clusterNode</code> ч╗УцЮДчЪД <code>link</code> х▒ЮцАзцШпф╕Аф╕к <code>clusterLink</code> ч╗УцЮДя╝М шпеч╗УцЮДф┐ЭхнШф║Жш┐ЮцОешКВчВ╣цЙАщЬАчЪДцЬЙхЕ│ф┐бцБпя╝М цпФхжВхеЧцОехнЧцППш┐░чмжя╝М ш╛УхЕеч╝УхЖ▓хМ║хТМш╛УхЗ║ч╝УхЖ▓хМ║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">clusterLink</span> <span class="token punctuation">{</span>

    <span class="token comment">// ш┐ЮцОечЪДхИЫх╗║цЧ╢щЧ┤</span>
    <span class="token class-name">mstime_t</span> ctime<span class="token punctuation">;</span>

    <span class="token comment">// TCP хеЧцОехнЧцППш┐░чмж</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>

    <span class="token comment">// ш╛УхЗ║ч╝УхЖ▓хМ║я╝Мф┐ЭхнШчЭАчнЙх╛ЕхПСщАБч╗ЩхЕ╢ф╗ЦшКВчВ╣чЪДц╢ИцБпя╝Иmessageя╝ЙуАВ</span>
    sds sndbuf<span class="token punctuation">;</span>

    <span class="token comment">// ш╛УхЕеч╝УхЖ▓хМ║я╝Мф┐ЭхнШчЭАф╗ОхЕ╢ф╗ЦшКВчВ╣цОецФ╢хИ░чЪДц╢ИцБпуАВ</span>
    sds rcvbuf<span class="token punctuation">;</span>

    <span class="token comment">// ф╕Ош┐Щф╕кш┐ЮцОечЫ╕хЕ│шБФчЪДшКВчВ╣я╝МхжВцЮЬц▓бцЬЙчЪДшпЭх░▒ф╕║ NULL</span>
    <span class="token keyword">struct</span> <span class="token class-name">clusterNode</span> <span class="token operator">*</span>node<span class="token punctuation">;</span>

<span class="token punctuation">}</span> clusterLink<span class="token punctuation">;</span>
</code></pre></div><p><code>redisClient</code> ч╗УцЮДхТМ <code>clusterLink</code> ч╗УцЮДчЪДчЫ╕хРМхТМф╕НхРМф╣ЛхдД</p> <p><code>redisClient</code> ч╗УцЮДхТМ <code>clusterLink</code> ч╗УцЮДщГ╜цЬЙшЗкх╖▒чЪДхеЧцОехнЧцППш┐░чмжхТМш╛УхЕеуАБш╛УхЗ║ч╝УхЖ▓хМ║я╝М ш┐Щф╕дф╕кч╗УцЮДчЪДхМ║хИлхЬиф║Оя╝М <code>redisClient</code> ч╗УцЮДф╕нчЪДхеЧцОехнЧхТМч╝УхЖ▓хМ║цШпчФиф║Ош┐ЮцОеховцИ╖члпчЪДя╝М шАМ <code>clusterLink</code> ч╗УцЮДф╕нчЪДхеЧцОехнЧхТМч╝УхЖ▓хМ║хИЩцШпчФиф║Ош┐ЮцОешКВчВ╣чЪДуАВ</p> <p>цЬАхРОя╝М цпПф╕кшКВчВ╣щГ╜ф┐ЭхнШчЭАф╕Аф╕к <code>clusterState</code> ч╗УцЮДя╝М ш┐Щф╕кч╗УцЮДшо░х╜Хф║ЖхЬих╜УхЙНшКВчВ╣чЪДшзЖшзТф╕Ля╝М щЫЖч╛дчЫохЙНцЙАхдДчЪДчК╢цАБ тАФтАФ цпФхжВщЫЖч╛дцШпхЬич║┐ш┐ШцШпф╕Лч║┐я╝М щЫЖч╛дхМЕхРлхдЪх░Сф╕кшКВчВ╣я╝М щЫЖч╛дх╜УхЙНчЪДщЕНч╜оч║кхЕГя╝М шп╕хжВцндч▒╗я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">clusterState</span> <span class="token punctuation">{</span>

    <span class="token comment">// цМЗхРСх╜УхЙНшКВчВ╣чЪДцМЗщТИ</span>
    clusterNode <span class="token operator">*</span>myself<span class="token punctuation">;</span>

    <span class="token comment">// щЫЖч╛дх╜УхЙНчЪДщЕНч╜оч║кхЕГя╝МчФиф║ОхоЮчО░цХЕщЪЬш╜мчз╗</span>
    <span class="token class-name">uint64_t</span> currentEpoch<span class="token punctuation">;</span>

    <span class="token comment">// щЫЖч╛дх╜УхЙНчЪДчК╢цАБя╝ЪцШпхЬич║┐ш┐ШцШпф╕Лч║┐</span>
    <span class="token keyword">int</span> state<span class="token punctuation">;</span>

    <span class="token comment">// щЫЖч╛дф╕ншЗ│х░СхдДчРЖчЭАф╕Аф╕кцз╜чЪДшКВчВ╣чЪДцХ░щЗП</span>
    <span class="token keyword">int</span> size<span class="token punctuation">;</span>

    <span class="token comment">// щЫЖч╛дшКВчВ╣хРНхНХя╝ИхМЕцЛм myself шКВчВ╣я╝Й</span>
    <span class="token comment">// хнЧхЕ╕чЪДщФоф╕║шКВчВ╣чЪДхРНхнЧя╝МхнЧхЕ╕чЪДхА╝ф╕║шКВчВ╣хп╣х║ФчЪД clusterNode ч╗УцЮД</span>
    dict <span class="token operator">*</span>nodes<span class="token punctuation">;</span>

<span class="token punctuation">}</span> clusterState<span class="token punctuation">;</span>
</code></pre></div><p>ф╗ехЙНщЭвф╗Лч╗НчЪД 7000 уАБ 7001 уАБ 7002 ф╕Йф╕кшКВчВ╣ф╕║ф╛Ля╝М хЫ╛ IMAGE_CLUSTER_STATE_OF_7000 х▒Хчд║ф║ЖшКВчВ╣ 7000 хИЫх╗║чЪД <code>clusterState</code> ч╗УцЮДя╝М ш┐Щф╕кч╗УцЮДф╗ОшКВчВ╣ 7000 чЪДшзТх║жшо░х╜Хф║ЖщЫЖч╛дуАБф╗ехПКщЫЖч╛дхМЕхРлчЪДф╕Йф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБ я╝Иф╕║ф║Жчй║щЧ┤шАГшЩСя╝МхЫ╛ф╕нчЬБчХеф║Ж <code>clusterNode</code> ч╗УцЮДчЪДф╕АщГихИЖх▒ЮцАзя╝Йя╝Ъ</p> <ul><li>ч╗УцЮДчЪД <code>currentEpoch</code> х▒ЮцАзчЪДхА╝ф╕║ <code>0</code> я╝М шбичд║щЫЖч╛дх╜УхЙНчЪДщЕНч╜оч║кхЕГф╕║ <code>0</code> уАВ</li> <li>ч╗УцЮДчЪД <code>size</code> х▒ЮцАзчЪДхА╝ф╕║ <code>0</code> я╝М шбичд║щЫЖч╛дчЫохЙНц▓бцЬЙф╗╗ф╜ХшКВчВ╣хЬихдДчРЖцз╜я╝Ъ хЫацндч╗УцЮДчЪД <code>state</code> х▒ЮцАзчЪДхА╝ф╕║ <code>REDIS_CLUSTER_FAIL</code> тАФтАФ ш┐Щшбичд║щЫЖч╛дчЫохЙНхдДф║Оф╕Лч║┐чК╢цАБуАВ</li> <li>ч╗УцЮДчЪД <code>nodes</code> хнЧхЕ╕шо░х╜Хф║ЖщЫЖч╛дчЫохЙНхМЕхРлчЪДф╕Йф╕кшКВчВ╣я╝М ш┐Щф╕Йф╕кшКВчВ╣хИЖхИлчФ▒ф╕Йф╕к <code>clusterNode</code> ч╗УцЮДшбичд║я╝Ъ хЕ╢ф╕н <code>myself</code> цМЗщТИцМЗхРСф╗гшбишКВчВ╣ 7000 чЪД <code>clusterNode</code> ч╗УцЮДя╝М шАМхнЧхЕ╕ф╕нчЪДхПжхдЦф╕дф╕кцМЗщТИхИЩхИЖхИлцМЗхРСф╗гшбишКВчВ╣ 7001 хТМф╗гшбишКВчВ╣ 7002 чЪД <code>clusterNode</code> ч╗УцЮДя╝М ш┐Щф╕дф╕кшКВчВ╣цШпшКВчВ╣ 7000 х╖▓чЯечЪДхЬищЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣уАВ</li> <li>ф╕Йф╕кшКВчВ╣чЪД <code>clusterNode</code> ч╗УцЮДчЪД <code>flags</code> х▒ЮцАзщГ╜цШп <code>REDIS_NODE_MASTER</code> я╝Мшп┤цШОф╕Йф╕кшКВчВ╣щГ╜цШпф╕╗шКВчВ╣уАВ</li></ul> <p>шКВчВ╣ 7001 хТМшКВчВ╣ 7002 ф╣Яф╝ЪхИЫх╗║ч▒╗ф╝╝чЪД <code>clusterState</code> ч╗УцЮДя╝Ъ</p> <ul><li>ф╕Нш┐ЗхЬишКВчВ╣ 7001 хИЫх╗║чЪД <code>clusterState</code> ч╗УцЮДф╕ня╝М <code>myself</code> цМЗщТИх░ЖцМЗхРСф╗гшбишКВчВ╣ 7001 чЪД <code>clusterNode</code> ч╗УцЮДя╝М шАМшКВчВ╣ 7000 хТМшКВчВ╣ 7002 хИЩцШпщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣уАВ</li> <li>шАМхЬишКВчВ╣ 7002 хИЫх╗║чЪД <code>clusterState</code> ч╗УцЮДф╕ня╝М <code>myself</code> цМЗщТИх░ЖцМЗхРСф╗гшбишКВчВ╣ 7002 чЪД <code>clusterNode</code> ч╗УцЮДя╝М шАМшКВчВ╣ 7000 хТМшКВчВ╣ 7001 хИЩцШпщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣уАВ</li></ul> <p><img src="https://book-redis-design.netlify.app/images/graphviz-18b061357fdce60bd7df193ff4a95265bbda38b4.png" alt=""></p> <h3 id="cluster-meet-хС╜ф╗дчЪДхоЮчО░"><a href="#cluster-meet-хС╜ф╗дчЪДхоЮчО░" class="header-anchor">#</a> CLUSTER MEET хС╜ф╗дчЪДхоЮчО░</h3> <p>щАЪш┐ЗхРСшКВчВ╣ A хПСщАБ CLUSTER MEET хС╜ф╗дя╝М ховцИ╖члпхПпф╗ешойцОецФ╢хС╜ф╗дчЪДшКВчВ╣ A х░ЖхПжф╕Аф╕кшКВчВ╣ B ц╖╗хКахИ░шКВчВ╣ A х╜УхЙНцЙАхЬичЪДщЫЖч╛дщЗМщЭвя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>CLUSTER MEET <span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre></div><p>цФ╢хИ░хС╜ф╗дчЪДшКВчВ╣ A х░Жф╕ОшКВчВ╣ B ш┐ЫшбМцПбцЙЛя╝Иhandshakeя╝Йя╝М ф╗ецндцЭечбошодх╜╝цндчЪДхнШхЬия╝М х╣╢ф╕║х░ЖцЭечЪДш┐Ыф╕АцнещАЪф┐бцЙУхе╜хЯ║чбАя╝Ъ</p> <ol><li>шКВчВ╣ A ф╝Ъф╕║шКВчВ╣ B хИЫх╗║ф╕Аф╕к <code>clusterNode</code> ч╗УцЮДя╝М х╣╢х░Жшпеч╗УцЮДц╖╗хКахИ░шЗкх╖▒чЪД <code>clusterState.nodes</code> хнЧхЕ╕щЗМщЭвуАВ</li> <li>ф╣ЛхРОя╝М шКВчВ╣ A х░Жца╣цНо CLUSTER MEET хС╜ф╗дч╗ЩхоЪчЪД IP хЬ░хЭАхТМчлпхПгхП╖я╝М хРСшКВчВ╣ B хПСщАБф╕АцЭб <code>MEET</code> ц╢ИцБпя╝Иmessageя╝ЙуАВ</li> <li>хжВцЮЬф╕АхИЗщб║хИйя╝М шКВчВ╣ B х░ЖцОецФ╢хИ░шКВчВ╣ A хПСщАБчЪД <code>MEET</code> ц╢ИцБпя╝М шКВчВ╣ B ф╝Ъф╕║шКВчВ╣ A хИЫх╗║ф╕Аф╕к <code>clusterNode</code> ч╗УцЮДя╝М х╣╢х░Жшпеч╗УцЮДц╖╗хКахИ░шЗкх╖▒чЪД <code>clusterState.nodes</code> хнЧхЕ╕щЗМщЭвуАВ</li> <li>ф╣ЛхРОя╝М шКВчВ╣ B х░ЖхРСшКВчВ╣ A ш┐ФхЫЮф╕АцЭб <code>PONG</code> ц╢ИцБпуАВ</li> <li>хжВцЮЬф╕АхИЗщб║хИйя╝М шКВчВ╣ A х░ЖцОецФ╢хИ░шКВчВ╣ B ш┐ФхЫЮчЪД <code>PONG</code> ц╢ИцБпя╝М щАЪш┐Зш┐ЩцЭб <code>PONG</code> ц╢ИцБпшКВчВ╣ A хПпф╗ечЯещБУшКВчВ╣ B х╖▓ч╗ПцИРхКЯхЬ░цОецФ╢хИ░ф║ЖшЗкх╖▒хПСщАБчЪД <code>MEET</code> ц╢ИцБпуАВ</li> <li>ф╣ЛхРОя╝М шКВчВ╣ A х░ЖхРСшКВчВ╣ B ш┐ФхЫЮф╕АцЭб <code>PING</code> ц╢ИцБпуАВ</li> <li>хжВцЮЬф╕АхИЗщб║хИйя╝М шКВчВ╣ B х░ЖцОецФ╢хИ░шКВчВ╣ A ш┐ФхЫЮчЪД <code>PING</code> ц╢ИцБпя╝М щАЪш┐Зш┐ЩцЭб <code>PING</code> ц╢ИцБпшКВчВ╣ B хПпф╗ечЯещБУшКВчВ╣ A х╖▓ч╗ПцИРхКЯхЬ░цОецФ╢хИ░ф║ЖшЗкх╖▒ш┐ФхЫЮчЪД <code>PONG</code> ц╢ИцБпя╝М цПбцЙЛхоМцИРуАВ</li></ol> <p>хЫ╛ IMAGE_HANDSHAKE х▒Хчд║ф║Жф╗еф╕КцнещкдцППш┐░чЪДцПбцЙЛш┐ЗчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/graphviz-76550f578052d5f52e35414facb5ac680d38c7f5.png" alt=""></p> <p>ф╣ЛхРОя╝М шКВчВ╣ A ф╝Ъх░ЖшКВчВ╣ B чЪДф┐бцБпщАЪш┐З Gossip хНПшооф╝ацТнч╗ЩщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣я╝М шойхЕ╢ф╗ЦшКВчВ╣ф╣Яф╕ОшКВчВ╣ B ш┐ЫшбМцПбцЙЛя╝М цЬАч╗Ия╝М ч╗Пш┐Зф╕Ацо╡цЧ╢щЧ┤ф╣ЛхРОя╝М шКВчВ╣ B ф╝ЪшвлщЫЖч╛дф╕нчЪДцЙАцЬЙшКВчВ╣шодшпЖ</p> <h2 id="цз╜цМЗц┤╛"><a href="#цз╜цМЗц┤╛" class="header-anchor">#</a> цз╜цМЗц┤╛</h2> <p>Redis щЫЖч╛дщАЪш┐ЗхИЖчЙЗчЪДцЦ╣х╝ПцЭеф┐ЭхнШцХ░цНох║Уф╕нчЪДщФохА╝хп╣я╝ЪщЫЖч╛дчЪДцХ┤ф╕кцХ░цНох║УшвлхИЖф╕║ 16384 ф╕кцз╜я╝Иslotя╝Йя╝МцХ░цНох║Уф╕нчЪДцпПф╕кщФощГ╜х▒Юф║Ош┐Щ 16384ф╕кцз╜чЪДхЕ╢ф╕нф╕Аф╕кя╝МщЫЖч╛дф╕нчЪДцпПф╕кшКВчВ╣хПпф╗ехдДчРЖ 0 ф╕кцИЦцЬАхдЪ 16384 ф╕кцз╜уАВ</p> <ul><li>х╜УцХ░цНох║Уф╕нчЪД 16384 ф╕кцз╜щГ╜цЬЙшКВчВ╣хЬихдДчРЖцЧ╢я╝МщЫЖч╛дхдДф║Оф╕Кч║┐чК╢цАБя╝Иokя╝Й</li> <li>хжВцЮЬцХ░цНох║Уф╕нцЬЙф╗╗ф╜Хф╕Аф╕кцз╜ц▓бцЬЙх╛ЧхИ░хдДчРЖя╝МщВгф╣ИщЫЖч╛дхдДф║Оф╕Лч║┐чК╢цАБя╝Иfailя╝Й</li></ul> <p>хЬиф╕Кф╕АшКВя╝МцИСф╗мф╜┐чФи CLUSTER MEET хС╜ф╗дх░Ж 7000уАБ7001уАБ7002 ф╕Йф╕кшКВчВ╣ш┐ЮцОехИ░ф║ЖхРМф╕Аф╕кщЫЖч╛дщЗМщЭвя╝Мф╕Нш┐Зш┐Щф╕кщЫЖч╛дчЫохЙНф╗НчД╢хдДф║Оф╕Лч║┐чК╢цАБя╝МхЫаф╕║щЫЖч╛дф╕нчЪДф╕Йф╕кшКВчВ╣щГ╜ц▓бцЬЙхЬихдДчРЖф╗╗ф╜Хцз╜я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; CLUSTER INFO
cluster_state:fail
cluster_slots_assigned:0
cluster_slots_ok:0
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:3
cluster_size:0
cluster_current_epoch:0
cluster_stats_messages_sent:110
cluster_stats_messages_received:28
</code></pre></div><p>щАЪш┐ЗхРСшКВчВ╣хПСщАБ CLUSTER ADDSLOTS хС╜ф╗дя╝МцИСф╗мхПпф╗ех░Жф╕Аф╕кцИЦхдЪф╕кцз╜цМЗц┤╛я╝Иassignя╝Йч╗ЩшКВчВ╣ш┤Яш┤гя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>CLUSTER ADDSLOTS &lt;slot&gt; [slot]
</code></pre></div><p>ф╕╛ф╕кф╛ЛхнРя╝МцЙзшбМф╗еф╕ЛхС╜ф╗дхПпф╗ех░Жцз╜0шЗ│цз╜5000цМЗц┤╛ч╗ЩшКВчВ╣7000ш┤Яш┤гя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; CLUSTER ADDSLOTS 0 1 2 3 4  5000
OK
127.0.0.1:7000&gt; CLUSTER NODES
9dfb4c4e016e627d9769e4c9bb0d4fa208e65c26 127.0.0.1:7002 master - 0 1388316664849 0 connected
68eef66df23420a5862208ef5b1a7005b806f2ff 127.0.0.1:7001 master - 0 1388316665850 0 connected
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master - 0 0 0 connected 0-5000
</code></pre></div><p>ф╕║ф║Жшой 7000уАБ7001уАБ7002 ф╕Йф╕кшКВчВ╣цЙАхЬичЪДщЫЖч╛дш┐ЫхЕеф╕Кч║┐чК╢цАБя╝МцИСф╗мч╗зч╗нцЙзшбМф╗еф╕ЛхС╜ф╗дя╝Мх░Жцз╜ 5001 шЗ│цз╜ 10000 цМЗц┤╛ч╗ЩшКВчВ╣ 7001 ш┤Яш┤гя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7001&gt; CLUSTER ADDSLOTS 5001 5002 5003 5004 10000
OK
</code></pre></div><p>чД╢хРОх░Жцз╜ 10001 шЗ│цз╜ 16383 цМЗц┤╛ч╗Щ7002ш┤Яш┤гя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7002&gt; CLUSTER ADDSLOTS 10001 10002 10003 10004 16383
OK
</code></pre></div><p>х╜Уф╗еф╕Кф╕Йф╕кCLUSTER ADDSLOTSхС╜ф╗дщГ╜цЙзшбМхоМцпХф╣ЛхРОя╝МцХ░цНох║Уф╕нчЪД16384ф╕кцз╜щГ╜х╖▓ч╗ПшвлцМЗц┤╛ч╗Щф║ЖчЫ╕х║ФчЪДшКВчВ╣я╝МщЫЖч╛дш┐ЫхЕеф╕Кч║┐чК╢цАБя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; CLUSTER INFO
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:3
cluster_size:3
cluster_current_epoch:0
cluster_stats_messages_sent:2699
cluster_stats_messages_received:2617
127.0.0.1:7000&gt; CLUSTER NODES
9dfb4c4e016e627d9769e4c9bb0d4fa208e65c26 127.0.0.1:7002 master - 0 1388317426165 0 connected 10001-16383
68eef66df23420a5862208ef5b1a7005b806f2ff 127.0.0.1:7001 master - 0 1388317427167 0 connected 5001-10000
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master - 0 0 0 connected 0-5000
</code></pre></div><p>цЬмшКВцОеф╕ЛцЭечЪДхЖЕхо╣х░ЖщжЦхЕИф╗Лч╗НшКВчВ╣ф┐ЭхнШцз╜цМЗц┤╛ф┐бцБпчЪДцЦ╣ц│Хя╝Мф╗ехПКшКВчВ╣ф╣ЛщЧ┤ф╝ацТнцз╜цМЗц┤╛ф┐бцБпчЪДцЦ╣ц│Хя╝Мф╣ЛхРОхЖНф╗Лч╗НCLUSTER ADDSLOTSхС╜ф╗дчЪДхоЮчО░уАВ</p> <h3 id="шо░х╜ХшКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБп"><a href="#шо░х╜ХшКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБп" class="header-anchor">#</a> шо░х╜ХшКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБп</h3> <p>clusterNodeч╗УцЮДчЪДslotsх▒ЮцАзхТМnumslotх▒ЮцАзшо░х╜Хф║ЖшКВчВ╣ш┤Яш┤гхдДчРЖхУкф║Ыцз╜я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">clusterNode</span> <span class="token punctuation">{</span>

  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> slots<span class="token punctuation">[</span><span class="token number">16384</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> numslots<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>slotsх▒ЮцАзцШпф╕Аф╕кф║Мш┐ЫхИ╢ф╜НцХ░ч╗Дя╝Иbit arrayя╝Йя╝Мш┐Щф╕кцХ░ч╗ДчЪДщХ┐х║жф╕║16384/8=2048ф╕кхнЧшКВя╝МхЕ▒хМЕхРл16384ф╕кф║Мш┐ЫхИ╢ф╜НуАВ</p> <p>Redisф╗е0ф╕║ш╡╖хзЛч┤вх╝Хя╝М16383ф╕║ч╗Ицнвч┤вх╝Хя╝Мхп╣slotsцХ░ч╗Дф╕нчЪД16384ф╕кф║Мш┐ЫхИ╢ф╜Нш┐ЫшбМч╝ЦхП╖я╝Мх╣╢ца╣цНоч┤вх╝Хiф╕КчЪДф║Мш┐ЫхИ╢ф╜НчЪДхА╝цЭехИдцЦншКВчВ╣цШпхРжш┤Яш┤гхдДчРЖцз╜iя╝Ъ</p> <ul><li><p>хжВцЮЬslotsцХ░ч╗ДхЬич┤вх╝Хiф╕КчЪДф║Мш┐ЫхИ╢ф╜НчЪДхА╝ф╕║1я╝МщВгф╣Ишбичд║шКВчВ╣ш┤Яш┤гхдДчРЖцз╜iуАВ</p></li> <li><p>хжВцЮЬslotsцХ░ч╗ДхЬич┤вх╝Хiф╕КчЪДф║Мш┐ЫхИ╢ф╜НчЪДхА╝ф╕║0я╝МщВгф╣Ишбичд║шКВчВ╣ф╕Нш┤Яш┤гхдДчРЖцз╜iуАВ</p></li></ul> <p>хЫ╛17-9х▒Хчд║ф║Жф╕Аф╕кslotsцХ░ч╗Дчд║ф╛Ля╝Ъш┐Щф╕кцХ░ч╗Дч┤вх╝Х0шЗ│ч┤вх╝Х7ф╕КчЪДф║Мш┐ЫхИ╢ф╜НчЪДхА╝щГ╜ф╕║1я╝МхЕ╢ф╜ЩцЙАцЬЙф║Мш┐ЫхИ╢ф╜НчЪДхА╝щГ╜ф╕║0я╝Мш┐Щшбичд║шКВчВ╣ш┤Яш┤гхдДчРЖцз╜0шЗ│цз╜7уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000159.jpg" alt="img"></p> <p>хЫ╛17-9уААф╕Аф╕кslotsцХ░ч╗Дчд║ф╛Л</p> <p>хЫ╛17-10 х▒Хчд║ф║ЖхПжф╕Аф╕кslotsцХ░ч╗Дчд║ф╛Ля╝Ъш┐Щф╕кцХ░ч╗Дч┤вх╝Х1уАБ3уАБ5уАБ8уАБ9уАБ10ф╕КчЪДф║Мш┐ЫхИ╢ф╜НчЪДхА╝щГ╜ф╕║1я╝МшАМхЕ╢ф╜ЩцЙАцЬЙф║Мш┐ЫхИ╢ф╜НчЪДхА╝щГ╜ф╕║0я╝Мш┐Щшбичд║шКВчВ╣ш┤Яш┤гхдДчРЖцз╜1уАБ3уАБ5уАБ8уАБ9уАБ10уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000302.jpg" alt="img"></p> <p>хЫ╛17-10уААхПжф╕Аф╕кslotsцХ░ч╗Дчд║ф╛Л</p> <p>хЫаф╕║хПЦхЗ║хТМшо╛ч╜оslotsцХ░ч╗Дф╕нчЪДф╗╗цДПф╕Аф╕кф║Мш┐ЫхИ╢ф╜НчЪДхА╝чЪДхдНцЭВх║жф╗Еф╕║Oя╝И1я╝Йя╝МцЙАф╗ехп╣ф║Оф╕Аф╕кч╗ЩхоЪшКВчВ╣чЪДslotsцХ░ч╗ДцЭешп┤я╝МчиЛх║ПцгАцЯешКВчВ╣цШпхРжш┤Яш┤гхдДчРЖцЯРф╕кцз╜я╝МхПИцИЦшАЕх░ЖцЯРф╕кцз╜цМЗц┤╛ч╗ЩшКВчВ╣ш┤Яш┤гя╝Мш┐Щф╕дф╕кхКиф╜ЬчЪДхдНцЭВх║жщГ╜цШпOя╝И1я╝ЙуАВ</p> <p>шЗ│ф║Оnumslotsх▒ЮцАзхИЩшо░х╜ХшКВчВ╣ш┤Яш┤гхдДчРЖчЪДцз╜чЪДцХ░щЗПя╝Мф╣ЯхН│цШпslotsцХ░ч╗Дф╕нхА╝ф╕║1чЪДф║Мш┐ЫхИ╢ф╜НчЪДцХ░щЗПуАВ</p> <p>цпФхжВшп┤я╝Мхп╣ф║ОхЫ╛17-9цЙАчд║чЪДslotsцХ░ч╗ДцЭешп┤я╝МшКВчВ╣хдДчРЖчЪДцз╜цХ░щЗПф╕║8я╝МшАМхп╣ф║ОхЫ╛17-10цЙАчд║чЪДslotsцХ░ч╗ДцЭешп┤я╝МшКВчВ╣хдДчРЖчЪДцз╜цХ░щЗПф╕║6уАВ</p> <h3 id="ф╝ацТншКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБп"><a href="#ф╝ацТншКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБп" class="header-anchor">#</a> ф╝ацТншКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБп</h3> <p>ф╕Аф╕кшКВчВ╣щЩдф║Жф╝Ъх░ЖшЗкх╖▒ш┤Яш┤гхдДчРЖчЪДцз╜шо░х╜ХхЬи clusterNode ч╗УцЮДчЪД slots х▒ЮцАзхТМ numslots х▒ЮцАзф╣ЛхдЦя╝МхоГш┐Шф╝Ъх░ЖшЗкх╖▒чЪД slots цХ░ч╗ДщАЪш┐Зц╢ИцБпхПСщАБч╗ЩщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣я╝Мф╗ецндцЭехСКчЯехЕ╢ф╗ЦшКВчВ╣шЗкх╖▒чЫохЙНш┤Яш┤гхдДчРЖхУкф║Ыцз╜уАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхЙНщЭвх▒Хчд║чЪДхМЕхРл7000уАБ7001уАБ7002ф╕Йф╕кшКВчВ╣чЪДщЫЖч╛дцЭешп┤я╝Ъ</p> <ul><li><p>шКВчВ╣7000ф╝ЪщАЪш┐Зц╢ИцБпхРСшКВчВ╣7001хТМшКВчВ╣7002хПСщАБшЗкх╖▒чЪДslotsцХ░ч╗Дя╝Мф╗ецндцЭехСКчЯеш┐Щф╕дф╕кшКВчВ╣я╝МшЗкх╖▒ш┤Яш┤гхдДчРЖцз╜0шЗ│цз╜5000я╝МхжВхЫ╛17-11цЙАчд║уАВ</p></li> <li><p>шКВчВ╣7001ф╝ЪщАЪш┐Зц╢ИцБпхРСшКВчВ╣7000хТМшКВчВ╣7002хПСщАБшЗкх╖▒чЪДslotsцХ░ч╗Дя╝Мф╗ецндцЭехСКчЯеш┐Щф╕дф╕кшКВчВ╣я╝МшЗкх╖▒ш┤Яш┤гхдДчРЖцз╜5001шЗ│цз╜10000я╝МхжВхЫ╛17-12цЙАчд║уАВ</p></li> <li><p>шКВчВ╣7002ф╝ЪщАЪш┐Зц╢ИцБпхРСшКВчВ╣7000хТМшКВчВ╣7001хПСщАБшЗкх╖▒чЪДslotsцХ░ч╗Дя╝Мф╗ецндцЭехСКчЯеш┐Щф╕дф╕кшКВчВ╣я╝МшЗкх╖▒ш┤Яш┤гхдДчРЖцз╜10001шЗ│цз╜16383я╝МхжВхЫ╛17-13цЙАчд║уАВ</p></li></ul> <p><img src="https://book-redis-design.netlify.app/images/000273.jpg" alt="img"></p> <p>хЫ╛17-11уАА7000хСКчЯе7001хТМ7002шЗкх╖▒ш┤Яш┤гхдДчРЖчЪДцз╜</p> <p><img src="https://book-redis-design.netlify.app/images/000058.jpg" alt="img"></p> <p><img src="https://book-redis-design.netlify.app/images/000146.jpg" alt="img"></p> <p>хЫ╛17-13уАА7002хСКчЯе7000хТМ7001шЗкх╖▒ш┤Яш┤гхдДчРЖчЪДцз╜</p> <p>х╜УшКВчВ╣AщАЪш┐Зц╢ИцБпф╗ОшКВчВ╣BщВгщЗМцОецФ╢хИ░шКВчВ╣BчЪДslotsцХ░ч╗ДцЧ╢я╝МшКВчВ╣Aф╝ЪхЬишЗкх╖▒чЪД clusterState.nodes хнЧхЕ╕ф╕нцЯецЙ╛шКВчВ╣Bхп╣х║ФчЪД clusterNode ч╗УцЮДя╝Мх╣╢хп╣ч╗УцЮДф╕нчЪД slots цХ░ч╗Дш┐ЫшбМф┐ЭхнШцИЦшАЕцЫ┤цЦ░уАВ</p> <p>хЫаф╕║щЫЖч╛дф╕нчЪДцпПф╕кшКВчВ╣щГ╜ф╝Ъх░ЖшЗкх╖▒чЪД slots цХ░ч╗ДщАЪш┐Зц╢ИцБпхПСщАБч╗ЩщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣я╝Мх╣╢ф╕ФцпПф╕кцОецФ╢хИ░ slots цХ░ч╗ДчЪДшКВчВ╣щГ╜ф╝Ъх░ЖцХ░ч╗Дф┐ЭхнШхИ░чЫ╕х║ФшКВчВ╣чЪД clusterNode ч╗УцЮДщЗМщЭвя╝МхЫацндя╝МщЫЖч╛дф╕нчЪДцпПф╕кшКВчВ╣щГ╜ф╝ЪчЯещБУцХ░цНох║Уф╕нчЪД 16384 ф╕кцз╜хИЖхИлшвлцМЗц┤╛ч╗Щф║ЖщЫЖч╛дф╕нчЪДхУкф║ЫшКВчВ╣уАВ</p> <h3 id="шо░х╜ХщЫЖч╛дцЙАцЬЙцз╜чЪДцМЗц┤╛ф┐бцБп"><a href="#шо░х╜ХщЫЖч╛дцЙАцЬЙцз╜чЪДцМЗц┤╛ф┐бцБп" class="header-anchor">#</a> шо░х╜ХщЫЖч╛дцЙАцЬЙцз╜чЪДцМЗц┤╛ф┐бцБп</h3> <p>clusterState ч╗УцЮДф╕нчЪД slots цХ░ч╗Дшо░х╜Хф║ЖщЫЖч╛дф╕нцЙАцЬЙ 16384 ф╕кцз╜чЪДцМЗц┤╛ф┐бцБпя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">clusterState</span> <span class="token punctuation">{</span>
 
  clusterNode <span class="token operator">*</span>slots<span class="token punctuation">[</span><span class="token number">16384</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
<span class="token punctuation">}</span> clusterState<span class="token punctuation">;</span>
</code></pre></div><p>slotsцХ░ч╗ДхМЕхРл16384ф╕кщб╣я╝МцпПф╕кцХ░ч╗Дщб╣щГ╜цШпф╕Аф╕кцМЗхРСclusterNodeч╗УцЮДчЪДцМЗщТИя╝Ъ</p> <ul><li><p>хжВцЮЬslots[i]цМЗщТИцМЗхРСNULLя╝МщВгф╣Ишбичд║цз╜iх░ЪцЬкцМЗц┤╛ч╗Щф╗╗ф╜ХшКВчВ╣уАВ</p></li> <li><p>хжВцЮЬslots[i]цМЗщТИцМЗхРСф╕Аф╕кclusterNodeч╗УцЮДя╝МщВгф╣Ишбичд║цз╜iх╖▓ч╗ПцМЗц┤╛ч╗Щф║ЖclusterNodeч╗УцЮДцЙАф╗гшбичЪДшКВчВ╣уАВ</p></li></ul> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║О7000уАБ7001уАБ7002ф╕Йф╕кшКВчВ╣цЭешп┤я╝МхоГф╗мчЪДclusterStateч╗УцЮДчЪДslotsцХ░ч╗Дх░Жф╝ЪцШпхЫ╛17-14цЙАчд║чЪДца╖хнРя╝Ъ</p> <ul><li><p>цХ░ч╗Дщб╣slots[0]шЗ│slots[5000]чЪДцМЗщТИщГ╜цМЗхРСф╗гшбишКВчВ╣7000чЪДclusterNodeч╗УцЮДя╝Мшбичд║цз╜0шЗ│5000щГ╜цМЗц┤╛ч╗Щф║ЖшКВчВ╣7000уАВ</p></li> <li><p>цХ░ч╗Дщб╣slots[5001]шЗ│slots[10000]чЪДцМЗщТИщГ╜цМЗхРСф╗гшбишКВчВ╣7001чЪДclusterNodeч╗УцЮДя╝Мшбичд║цз╜5001шЗ│10000щГ╜цМЗц┤╛ч╗Щф║ЖшКВчВ╣7001уАВ</p></li> <li><p>цХ░ч╗Дщб╣slots[10001]шЗ│slots[16383]чЪДцМЗщТИщГ╜цМЗхРСф╗гшбишКВчВ╣7002чЪДclusterNodeч╗УцЮДя╝Мшбичд║цз╜10001шЗ│16383щГ╜цМЗц┤╛ч╗Щф║ЖшКВчВ╣7002уАВ</p></li></ul> <p>хжВцЮЬхПкх░Жцз╜цМЗц┤╛ф┐бцБпф┐ЭхнШхЬихРДф╕кшКВчВ╣чЪДclusterNode.slotsцХ░ч╗ДщЗМя╝Мф╝ЪхЗ║чО░ф╕Аф║ЫцЧац│ХщлШцХИхЬ░шзгхЖ│чЪДщЧощвШя╝МшАМclusterState.slotsцХ░ч╗ДчЪДхнШхЬишзгхЖ│ф║Жш┐Щф║ЫщЧощвШя╝Ъ</p> <ul><li><p>хжВцЮЬшКВчВ╣хПкф╜┐чФиclusterNode.slotsцХ░ч╗ДцЭешо░х╜Хцз╜чЪДцМЗц┤╛ф┐бцБпя╝МщВгф╣Иф╕║ф║ЖчЯещБУцз╜iцШпхРжх╖▓ч╗ПшвлцМЗц┤╛я╝МцИЦшАЕцз╜iшвлцМЗц┤╛ч╗Щф║ЖхУкф╕кшКВчВ╣я╝МчиЛх║ПщЬАшжБщБНхОЖclusterState.nodesхнЧхЕ╕ф╕нчЪДцЙАцЬЙclusterNodeч╗УцЮДя╝МцгАцЯеш┐Щф║Ыч╗УцЮДчЪДslotsцХ░ч╗Дя╝МчЫ┤хИ░цЙ╛хИ░ш┤Яш┤гхдДчРЖцз╜iчЪДшКВчВ╣ф╕║цнвя╝Мш┐Щф╕кш┐ЗчиЛчЪДхдНцЭВх║жф╕║Oя╝ИNя╝Йя╝МхЕ╢ф╕нNф╕║clusterState.nodesхнЧхЕ╕ф┐ЭхнШчЪДclusterNodeч╗УцЮДчЪДцХ░щЗПуАВ</p></li> <li><p>шАМщАЪш┐Зх░ЖцЙАцЬЙцз╜чЪДцМЗц┤╛ф┐бцБпф┐ЭхнШхЬиclusterState.slotsцХ░ч╗ДщЗМщЭвя╝МчиЛх║ПшжБцгАцЯецз╜iцШпхРжх╖▓ч╗ПшвлцМЗц┤╛я╝МхПИцИЦшАЕхПЦх╛Чш┤Яш┤гхдДчРЖцз╜iчЪДшКВчВ╣я╝МхПкщЬАшжБшо┐щЧоclusterState.slots[i]чЪДхА╝хН│хПпя╝Мш┐Щф╕кцУНф╜ЬчЪДхдНцЭВх║жф╗Еф╕║<code>O(1)</code>уАВ</p></li></ul> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхЫ╛17-14цЙАчд║чЪДslotsцХ░ч╗ДцЭешп┤я╝МхжВцЮЬчиЛх║ПщЬАшжБчЯещБУцз╜10002швлцМЗц┤╛ч╗Щф║ЖхУкф╕кшКВчВ╣я╝МщВгф╣ИхПкшжБшо┐щЧоцХ░ч╗Дщб╣slots[10002]я╝Мх░▒хПпф╗ещймф╕КчЯещБУцз╜10002швлцМЗц┤╛ч╗Щф║ЖшКВчВ╣7002я╝МхжВхЫ╛17-15цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000070.jpg" alt="img"></p> <p>хЫ╛17-15уААшо┐щЧоslots[10002]чЪДхА╝</p> <p>шжБшп┤цШОчЪДф╕АчВ╣цШпя╝МшЩ╜чД╢clusterState.slotsцХ░ч╗Дшо░х╜Хф║ЖщЫЖч╛дф╕нцЙАцЬЙцз╜чЪДцМЗц┤╛ф┐бцБпя╝М<strong>ф╜Жф╜┐чФиclusterNodeч╗УцЮДчЪДslotsцХ░ч╗ДцЭешо░х╜ХхНХф╕кшКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБпф╗НчД╢цШпцЬЙх┐ЕшжБчЪД</strong>я╝Ъ</p> <ul><li><p>хЫаф╕║х╜УчиЛх║ПщЬАшжБх░ЖцЯРф╕кшКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБпщАЪш┐Зц╢ИцБпхПСщАБч╗ЩхЕ╢ф╗ЦшКВчВ╣цЧ╢я╝МчиЛх║ПхПкщЬАшжБх░ЖчЫ╕х║ФшКВчВ╣чЪДclusterNode.slotsцХ░ч╗ДцХ┤ф╕кхПСщАБхЗ║хО╗х░▒хПпф╗еф║ЖуАВ</p></li> <li><p>хПжф╕АцЦ╣щЭвя╝МхжВцЮЬRedisф╕Нф╜┐чФиclusterNode.slotsцХ░ч╗Дя╝МшАМхНХчЛмф╜┐чФиclusterState.slotsцХ░ч╗ДчЪДшпЭя╝МщВгф╣ИцпПцмбшжБх░ЖшКВчВ╣AчЪДцз╜цМЗц┤╛ф┐бцБпф╝ацТнч╗ЩхЕ╢ф╗ЦшКВчВ╣цЧ╢я╝МчиЛх║Пх┐Ещб╗хЕИщБНхОЖцХ┤ф╕кclusterState.slotsцХ░ч╗Дя╝Мшо░х╜ХшКВчВ╣Aш┤Яш┤гхдДчРЖхУкф║Ыцз╜я╝МчД╢хРОцЙНшГ╜хПСщАБшКВчВ╣AчЪДцз╜цМЗц┤╛ф┐бцБпя╝Мш┐ЩцпФчЫ┤цОехПСщАБclusterNode.slotsцХ░ч╗ДшжБщ║╗чГжхТМф╜ОцХИх╛ЧхдЪуАВ</p></li></ul> <p>clusterState.slotsцХ░ч╗Дшо░х╜Хф║ЖщЫЖч╛дф╕нцЙАцЬЙцз╜чЪДцМЗц┤╛ф┐бцБпя╝МшАМclusterNode.slotsцХ░ч╗ДхПкшо░х╜Хф║ЖclusterNodeч╗УцЮДцЙАф╗гшбичЪДшКВчВ╣чЪДцз╜цМЗц┤╛ф┐бцБпя╝Мш┐ЩцШпф╕дф╕кslotsцХ░ч╗ДчЪДхЕ│щФохМ║хИлцЙАхЬиуАВ</p> <h3 id="cluster-addslots-хС╜ф╗дчЪДхоЮчО░"><a href="#cluster-addslots-хС╜ф╗дчЪДхоЮчО░" class="header-anchor">#</a> CLUSTER ADDSLOTS хС╜ф╗дчЪДхоЮчО░</h3> <p>CLUSTER ADDSLOTS хС╜ф╗дцОехПЧф╕Аф╕кцИЦхдЪф╕кцз╜ф╜Ьф╕║хПВцХ░я╝Мх╣╢х░ЖцЙАцЬЙш╛УхЕечЪДцз╜цМЗц┤╛ч╗ЩцОецФ╢шпехС╜ф╗дчЪДшКВчВ╣ш┤Яш┤гя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>CLUSTER ADDSLOTS <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token punctuation">[</span>slot<span class="token punctuation">]</span>
</code></pre></div><p>CLUSTER ADDSLOTS хС╜ф╗дчЪДхоЮчО░хПпф╗ечФиф╗еф╕Лф╝кф╗гчаБцЭешбичд║я╝Ъ</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">CLUSTER_ADDSLOTS</span><span class="token punctuation">(</span><span class="token operator">*</span>all_input_slots<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># щБНхОЖцЙАцЬЙш╛УхЕецз╜я╝МцгАцЯехоГф╗мцШпхРжщГ╜цШпцЬкцМЗц┤╛цз╜</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> all_input_slots<span class="token punctuation">:</span>
        <span class="token comment"># хжВцЮЬцЬЙхУкцАХф╕Аф╕кцз╜х╖▓ч╗ПшвлцМЗц┤╛ч╗Щф║ЖцЯРф╕кшКВчВ╣</span>
        <span class="token comment"># щВгф╣ИхРСховцИ╖члпш┐ФхЫЮщФЩшппя╝Мх╣╢ч╗ИцнвхС╜ф╗дцЙзшбМ</span>
        <span class="token keyword">if</span> clusterState<span class="token punctuation">.</span>slots<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> NULL<span class="token punctuation">:</span>
            reply_error<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
    <span class="token comment"># хжВцЮЬцЙАцЬЙш╛УхЕецз╜щГ╜цШпцЬкцМЗц┤╛цз╜</span>
    <span class="token comment"># щВгф╣ИхЖНцмбщБНхОЖцЙАцЬЙш╛УхЕецз╜я╝Мх░Жш┐Щф║Ыцз╜цМЗц┤╛ч╗Щх╜УхЙНшКВчВ╣</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> all_input_slots<span class="token punctuation">:</span>
        <span class="token comment"># шо╛ч╜оclusterStateч╗УцЮДчЪДslotsцХ░ч╗Д</span>
        <span class="token comment"># х░Жslots[i]чЪДцМЗщТИцМЗхРСф╗гшбих╜УхЙНшКВчВ╣чЪДclusterNodeч╗УцЮД</span>
        clusterState<span class="token punctuation">.</span>slots<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> clusterState<span class="token punctuation">.</span>myself
        <span class="token comment"># шо┐щЧоф╗гшбих╜УхЙНшКВчВ╣чЪДclusterNodeч╗УцЮДчЪДslotsцХ░ч╗Д</span>
        <span class="token comment"># х░ЖцХ░ч╗ДхЬич┤вх╝Хiф╕КчЪДф║Мш┐ЫхИ╢ф╜Ншо╛ч╜оф╕║1</span>
        setSlotBit<span class="token punctuation">(</span>clusterState<span class="token punctuation">.</span>myself<span class="token punctuation">.</span>slots<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
</code></pre></div><p>ф╕╛ф╕кф╛ЛхнРя╝МхЫ╛17-16х▒Хчд║ф║Жф╕Аф╕кшКВчВ╣чЪДclusterStateч╗УцЮДя╝МclusterState.slotsцХ░ч╗Дф╕нчЪДцЙАцЬЙцМЗщТИщГ╜цМЗхРСNULLя╝Мх╣╢ф╕ФclusterNode.slotsцХ░ч╗Дф╕нчЪДцЙАцЬЙф║Мш┐ЫхИ╢ф╜НчЪДхА╝щГ╜цШп0я╝Мш┐Щшп┤цШОх╜УхЙНшКВчВ╣ц▓бцЬЙшвлцМЗц┤╛ф╗╗ф╜Хцз╜я╝Мх╣╢ф╕ФщЫЖч╛дф╕нчЪДцЙАцЬЙцз╜щГ╜цШпцЬкцМЗц┤╛чЪДуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000258.jpg" alt="img"></p> <p>хЫ╛17-16уААшКВчВ╣чЪДclusterStateч╗УцЮД</p> <p>х╜УховцИ╖члпхп╣17-16цЙАчд║чЪДшКВчВ╣цЙзшбМхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>CLUSTER ADDSLOTS 1 2
</code></pre></div><p>х░Жцз╜1хТМцз╜2цМЗц┤╛ч╗ЩшКВчВ╣ф╣ЛхРОя╝МшКВчВ╣чЪДclusterStateч╗УцЮДх░ЖшвлцЫ┤цЦ░цИРхЫ╛17-17цЙАчд║чЪДца╖хнРя╝Ъ</p> <ul><li><p>clusterState.slotsцХ░ч╗ДхЬич┤вх╝Х1хТМч┤вх╝Х2ф╕КчЪДцМЗщТИцМЗхРСф║Жф╗гшбих╜УхЙНшКВчВ╣чЪДclusterNodeч╗УцЮДуАВ</p></li> <li><p>х╣╢ф╕ФclusterNode.slotsцХ░ч╗ДхЬич┤вх╝Х1хТМч┤вх╝Х2ф╕КчЪДф╜Ншвлшо╛ч╜оцИРф║Ж1уАВ</p></li></ul> <p><img src="https://book-redis-design.netlify.app/images/000322.jpg" alt="img"></p> <p>хЫ╛17-17уААцЙзшбМ CLUSTER ADDSLOTS хС╜ф╗дф╣ЛхРОчЪД clusterState ч╗УцЮД</p> <p>цЬАхРОя╝МхЬи CLUSTER ADDSLOTS хС╜ф╗дцЙзшбМхоМцпХф╣ЛхРОя╝МшКВчВ╣ф╝ЪщАЪш┐ЗхПСщАБц╢ИцБпхСКчЯещЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣я╝МшЗкх╖▒чЫохЙНцнгхЬиш┤Яш┤гхдДчРЖхУкф║Ыцз╜уАВ</p> <h2 id="хЬищЫЖч╛дф╕нцЙзшбМхС╜ф╗д"><a href="#хЬищЫЖч╛дф╕нцЙзшбМхС╜ф╗д" class="header-anchor">#</a> хЬищЫЖч╛дф╕нцЙзшбМхС╜ф╗д</h2> <p>хЬихп╣цХ░цНох║Уф╕нчЪД16384ф╕кцз╜щГ╜ш┐ЫшбМф║ЖцМЗц┤╛ф╣ЛхРОя╝МщЫЖч╛дх░▒ф╝Ъш┐ЫхЕеф╕Кч║┐чК╢цАБя╝Мш┐ЩцЧ╢ховцИ╖члпх░▒хПпф╗ехРСщЫЖч╛дф╕нчЪДшКВчВ╣хПСщАБцХ░цНохС╜ф╗дф║ЖуАВ</p> <p>х╜УховцИ╖члпхРСшКВчВ╣хПСщАБф╕ОцХ░цНох║УщФоцЬЙхЕ│чЪДхС╜ф╗дцЧ╢я╝МцОецФ╢хС╜ф╗дчЪДшКВчВ╣ф╝ЪшобчоЧхЗ║хС╜ф╗дшжБхдДчРЖчЪДцХ░цНох║УщФох▒Юф║ОхУкф╕кцз╜я╝Мх╣╢цгАцЯеш┐Щф╕кцз╜цШпхРжцМЗц┤╛ч╗Щф║ЖшЗкх╖▒я╝Ъ</p> <ul><li><p>хжВцЮЬщФоцЙАхЬичЪДцз╜цнгхе╜х░▒цМЗц┤╛ч╗Щф║Жх╜УхЙНшКВчВ╣я╝МщВгф╣ИшКВчВ╣чЫ┤цОецЙзшбМш┐Щф╕кхС╜ф╗дуАВ</p></li> <li><p>хжВцЮЬщФоцЙАхЬичЪДцз╜х╣╢ц▓бцЬЙцМЗц┤╛ч╗Щх╜УхЙНшКВчВ╣я╝МщВгф╣ИшКВчВ╣ф╝ЪхРСховцИ╖члпш┐ФхЫЮф╕Аф╕кMOVEDщФЩшппя╝МцМЗх╝ХховцИ╖члпш╜мхРСя╝Иredirectя╝ЙшЗ│цнгчбочЪДшКВчВ╣я╝Мх╣╢хЖНцмбхПСщАБф╣ЛхЙНцГ│шжБцЙзшбМчЪДхС╜ф╗дуАВ</p></li></ul> <p>хЫ╛17-18х▒Хчд║ф║Жш┐Щф╕дчзНцГЕхЖ╡чЪДхИдцЦнц╡БчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000362.jpg" alt="img"></p> <p>хЫ╛17-18уААхИдцЦнховцИ╖члпцШпхРжщЬАшжБш╜мхРСчЪДц╡БчиЛ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬцИСф╗мхЬиф╣ЛхЙНцПРхИ░чЪДя╝МчФ▒7000уАБ7001уАБ7002ф╕Йф╕кшКВчВ╣ч╗ДцИРчЪДщЫЖч╛дф╕ня╝МчФиховцИ╖члпш┐Юф╕КшКВчВ╣7000я╝Мх╣╢хПСщАБф╗еф╕ЛхС╜ф╗дя╝МщВгф╣ИхС╜ф╗дф╝ЪчЫ┤цОешвлшКВчВ╣7000цЙзшбМя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; SET date &quot;2013-12-31&quot;
OK
</code></pre></div><p>хЫаф╕║щФоdateцЙАхЬичЪДцз╜2022цнгцШпчФ▒шКВчВ╣7000ш┤Яш┤гхдДчРЖчЪДуАВ</p> <p>ф╜ЖцШпя╝МхжВцЮЬцИСф╗мцЙзшбМф╗еф╕ЛхС╜ф╗дя╝МщВгф╣ИховцИ╖члпф╝ЪхЕИшвлш╜мхРСшЗ│шКВчВ╣7001я╝МчД╢хРОхЖНцЙзшбМхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; SET msg &quot;happy new year!&quot;
-&gt; Redirected to slot [6257] located at 127.0.0.1:7001
OK
127.0.0.1:7001&gt; GET msg
&quot;happy new year!&quot;
</code></pre></div><p>ш┐ЩцШпхЫаф╕║щФоmsgцЙАхЬичЪДцз╜6257цШпчФ▒шКВчВ╣7001ш┤Яш┤гхдДчРЖчЪДя╝МшАМф╕НцШпчФ▒цЬАхИЭцОецФ╢хС╜ф╗дчЪДшКВчВ╣7000ш┤Яш┤гхдДчРЖя╝Ъ</p> <ul><li><p>х╜УховцИ╖члпчммф╕АцмбхРСшКВчВ╣7000хПСщАБSETхС╜ф╗дчЪДцЧ╢хАЩя╝МшКВчВ╣7000ф╝ЪхРСховцИ╖члпш┐ФхЫЮMOVEDщФЩшппя╝МцМЗх╝ХховцИ╖члпш╜мхРСшЗ│шКВчВ╣7001уАВ</p></li> <li><p>х╜УховцИ╖члпш╜мхРСхИ░шКВчВ╣7001ф╣ЛхРОя╝МховцИ╖члпщЗНцЦ░хРСшКВчВ╣7001хПСщАБSETхС╜ф╗дя╝Мш┐Щф╕кхС╜ф╗дф╝ЪшвлшКВчВ╣7001цИРхКЯцЙзшбМуАВ</p></li></ul> <p>цЬмшКВцОеф╕ЛцЭечЪДхЖЕхо╣х░Жф╗Лч╗НшобчоЧщФоцЙАх▒Юцз╜чЪДцЦ╣ц│Хя╝МшКВчВ╣хИдцЦнцЯРф╕кцз╜цШпхРжчФ▒шЗкх╖▒ш┤Яш┤гчЪДцЦ╣ц│Хя╝Мф╗ехПКMOVEDщФЩшппчЪДхоЮчО░цЦ╣ц│Хя╝МцЬАхРОя╝МцЬмшКВш┐Шф╝Ъф╗Лч╗НшКВчВ╣хТМхНХцЬ║RedisцЬНхКбхЩиф┐ЭхнШщФохА╝хп╣цХ░цНочЪДчЫ╕хРМхТМф╕НхРМф╣ЛхдДуАВ</p> <h3 id="шобчоЧщФох▒Юф║ОхУкф╕кцз╜"><a href="#шобчоЧщФох▒Юф║ОхУкф╕кцз╜" class="header-anchor">#</a> шобчоЧщФох▒Юф║ОхУкф╕кцз╜</h3> <p>шКВчВ╣ф╜┐чФиф╗еф╕ЛчоЧц│ХцЭешобчоЧч╗ЩхоЪщФоkeyх▒Юф║ОхУкф╕кцз╜я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>def <span class="token function">slot_number</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token function">CRC16</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">16383</span>
</code></pre></div><p>хЕ╢ф╕нCRC16я╝Иkeyя╝ЙшпнхПечФиф║ОшобчоЧщФоkeyчЪДCRC-16цабщкМхТМя╝МшАМ&amp;16383шпнхПехИЩчФиф║ОшобчоЧхЗ║ф╕Аф╕кф╗Лф║О0шЗ│16383ф╣ЛщЧ┤чЪДцХ┤цХ░ф╜Ьф╕║щФоkeyчЪДцз╜хП╖уАВ</p> <p>ф╜┐чФиCLUSTER KEYSLOT<key>хС╜ф╗дхПпф╗ецЯечЬЛф╕Аф╕кч╗ЩхоЪщФох▒Юф║ОхУкф╕кцз╜я╝Ъ</key></p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; CLUSTER KEYSLOT &quot;date&quot;
(integer) 2022
127.0.0.1:7000&gt; CLUSTER KEYSLOT &quot;msg&quot;
(integer) 6257
127.0.0.1:7000&gt; CLUSTER KEYSLOT &quot;name&quot;
(integer) 5798
127.0.0.1:7000&gt; CLUSTER KEYSLOT &quot;fruits&quot;
(integer) 14943
</code></pre></div><p>CLUSTER KEYSLOTхС╜ф╗дх░▒цШпщАЪш┐Зш░ГчФиф╕КщЭвч╗ЩхЗ║чЪДцз╜хИЖщЕНчоЧц│ХцЭехоЮчО░чЪДя╝Мф╗еф╕ЛцШпшпехС╜ф╗дчЪДф╝кф╗гчаБхоЮчО░я╝Ъ</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">CLUSTER_KEYSLOT</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># шобчоЧцз╜хП╖</span>
    slot <span class="token operator">=</span> slot_number<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token comment"># х░Жцз╜хП╖ш┐ФхЫЮч╗ЩховцИ╖члп</span>
    reply_client<span class="token punctuation">(</span>slot<span class="token punctuation">)</span>
</code></pre></div><h3 id="хИдцЦнцз╜цШпхРжчФ▒х╜УхЙНшКВчВ╣ш┤Яш┤гхдДчРЖ"><a href="#хИдцЦнцз╜цШпхРжчФ▒х╜УхЙНшКВчВ╣ш┤Яш┤гхдДчРЖ" class="header-anchor">#</a> хИдцЦнцз╜цШпхРжчФ▒х╜УхЙНшКВчВ╣ш┤Яш┤гхдДчРЖ</h3> <p>х╜УшКВчВ╣шобчоЧхЗ║щФоцЙАх▒ЮчЪДцз╜iф╣ЛхРОя╝МшКВчВ╣х░▒ф╝ЪцгАцЯешЗкх╖▒хЬиclusterState.slotsцХ░ч╗Дф╕нчЪДщб╣iя╝МхИдцЦнщФоцЙАхЬичЪДцз╜цШпхРжчФ▒шЗкх╖▒ш┤Яш┤гя╝Ъ</p> <p>1я╝ЙхжВцЮЬclusterState.slots[i]чнЙф║ОclusterState.myselfя╝МщВгф╣Ишп┤цШОцз╜iчФ▒х╜УхЙНшКВчВ╣ш┤Яш┤гя╝МшКВчВ╣хПпф╗ецЙзшбМховцИ╖члпхПСщАБчЪДхС╜ф╗дуАВ</p> <p>2я╝ЙхжВцЮЬclusterState.slots[i]ф╕НчнЙф║ОclusterState.myselfя╝МщВгф╣Ишп┤цШОцз╜iх╣╢щЭЮчФ▒х╜УхЙНшКВчВ╣ш┤Яш┤гя╝МшКВчВ╣ф╝Ъца╣цНоclusterState.slots[i]цМЗхРСчЪДclusterNodeч╗УцЮДцЙАшо░х╜ХчЪДшКВчВ╣IPхТМчлпхПгхП╖я╝МхРСховцИ╖члпш┐ФхЫЮMOVEDщФЩшппя╝МцМЗх╝ХховцИ╖члпш╜мхРСшЗ│цнгхЬихдДчРЖцз╜iчЪДшКВчВ╣уАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхБЗшо╛хЫ╛17-19ф╕║шКВчВ╣7000чЪДclusterStateч╗УцЮДя╝Ъ</p> <ul><li><p>х╜УховцИ╖члпхРСшКВчВ╣7000хПСщАБхС╜ф╗дSET date&quot;2013-12-31&quot;чЪДцЧ╢хАЩя╝МшКВчВ╣щжЦхЕИшобчоЧхЗ║щФоdateх▒Юф║Оцз╜2022я╝МчД╢хРОцгАцЯех╛ЧхЗ║clusterState.slots[2022]чнЙф║ОclusterState.myselfя╝Мш┐Щшп┤цШОцз╜2022цнгцШпчФ▒шКВчВ╣7000ш┤Яш┤гя╝Мф║ОцШпшКВчВ╣7000чЫ┤цОецЙзшбМш┐Щф╕кSETхС╜ф╗дя╝Мх╣╢х░Жч╗УцЮЬш┐ФхЫЮч╗ЩхПСщАБхС╜ф╗дчЪДховцИ╖члпуАВ</p></li> <li><p>х╜УховцИ╖члпхРСшКВчВ╣7000хПСщАБхС╜ф╗дSET msg&quot;happy new yearя╝Б&quot;чЪДцЧ╢хАЩя╝МшКВчВ╣щжЦхЕИшобчоЧхЗ║щФоmsgх▒Юф║Оцз╜6257я╝МчД╢хРОцгАцЯеclusterState.slots[6257]цШпхРжчнЙф║ОclusterState.myselfя╝Мч╗УцЮЬхПСчО░ф╕дшАЕх╣╢ф╕НчЫ╕чнЙя╝Ъш┐Щшп┤цШОцз╜6257х╣╢щЭЮчФ▒шКВчВ╣7000ш┤Яш┤гхдДчРЖя╝Мф║ОцШпшКВчВ╣7000шо┐щЧоclusterState.slots[6257]цЙАцМЗхРСчЪДclusterNodeч╗УцЮДя╝Мх╣╢ца╣цНоч╗УцЮДф╕ншо░х╜ХчЪДIPхЬ░хЭА127.0.0.1хТМчлпхПгхП╖7001я╝МхРСховцИ╖члпш┐ФхЫЮщФЩшппMOVED 6257 127.0.0.1:7001я╝МцМЗх╝ХшКВчВ╣ш╜мхРСшЗ│цнгхЬиш┤Яш┤гхдДчРЖцз╜6257чЪДшКВчВ╣7001уАВ</p></li></ul> <p><img src="https://book-redis-design.netlify.app/images/000357.jpg" alt="img"></p> <p>хЫ╛17-19уААшКВчВ╣7000чЪДclusterStateч╗УцЮД</p> <h3 id="moved-щФЩшпп"><a href="#moved-щФЩшпп" class="header-anchor">#</a> MOVED щФЩшпп</h3> <p>х╜УшКВчВ╣хПСчО░щФоцЙАхЬичЪДцз╜х╣╢щЭЮчФ▒шЗкх╖▒ш┤Яш┤гхдДчРЖчЪДцЧ╢хАЩя╝МшКВчВ╣х░▒ф╝ЪхРСховцИ╖члпш┐ФхЫЮф╕Аф╕к MOVED щФЩшппя╝МцМЗх╝ХховцИ╖члпш╜мхРСшЗ│цнгхЬиш┤Яш┤гцз╜чЪДшКВчВ╣уАВ</p> <p>MOVEDщФЩшппчЪДца╝х╝Пф╕║я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>MOVED &lt;slot&gt; &lt;ip&gt;:&lt;port&gt;
</code></pre></div><p>хЕ╢ф╕нslotф╕║щФоцЙАхЬичЪДцз╜я╝МшАМipхТМportхИЩцШпш┤Яш┤гхдДчРЖцз╜slotчЪДшКВчВ╣чЪДIPхЬ░хЭАхТМчлпхПгхП╖уАВф╛ЛхжВщФЩшппя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>OVED 10086 127.0.0.1:7002
</code></pre></div><p>шбичд║цз╜10086цнгчФ▒IPхЬ░хЭАф╕║127.0.0.1я╝МчлпхПгхП╖ф╕║7002чЪДшКВчВ╣ш┤Яш┤гуАВ</p> <p>хПИф╛ЛхжВщФЩшппя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>MOVED 789 127.0.0.1:7000
</code></pre></div><p>шбичд║цз╜789цнгчФ▒IPхЬ░хЭАф╕║127.0.0.1я╝МчлпхПгхП╖ф╕║7000чЪДшКВчВ╣ш┤Яш┤гуАВ</p> <p>х╜УховцИ╖члпцОецФ╢хИ░шКВчВ╣ш┐ФхЫЮчЪДMOVEDщФЩшппцЧ╢я╝МховцИ╖члпф╝Ъца╣цНоMOVEDщФЩшппф╕нцПРф╛ЫчЪДIPхЬ░хЭАхТМчлпхПгхП╖я╝Мш╜мхРСшЗ│ш┤Яш┤гхдДчРЖцз╜slotчЪДшКВчВ╣я╝Мх╣╢хРСшпешКВчВ╣щЗНцЦ░хПСщАБф╣ЛхЙНцГ│шжБцЙзшбМчЪДхС╜ф╗дуАВф╗ехЙНщЭвчЪДховцИ╖члпф╗ОшКВчВ╣7000ш╜мхРСшЗ│7001чЪДцГЕхЖ╡ф╜Ьф╕║ф╛ЛхнРя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; SET msg &quot;happy new year!&quot;
-&gt; Redirected to slot [6257] located at 127.0.0.1:7001
OK
127.0.0.1:7001&gt;
</code></pre></div><p>хЫ╛17-20х▒Хчд║ф║ЖховцИ╖члпхРСшКВчВ╣7000хПСщАБSETхС╜ф╗дя╝Мх╣╢шО╖х╛ЧMOVEDщФЩшппчЪДш┐ЗчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000245.jpg" alt="img"></p> <p>хЫ╛17-20уААшКВчВ╣7000хРСховцИ╖члпш┐ФхЫЮMOVEDщФЩшпп</p> <p>шАМхЫ╛17-21хИЩх▒Хчд║ф║ЖховцИ╖члпца╣цНоMOVEDщФЩшппя╝Мш╜мхРСшЗ│шКВчВ╣7001я╝Мх╣╢щЗНцЦ░хПСщАБSETхС╜ф╗дчЪДш┐ЗчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000234.jpg" alt="img"></p> <p>хЫ╛17-21уААховцИ╖члпца╣цНоMOVEDщФЩшппчЪДцМЗчд║ш╜мхРСшЗ│шКВчВ╣7001</p> <p>ф╕Аф╕кщЫЖч╛дховцИ╖члпщАЪх╕╕ф╝Ъф╕ОщЫЖч╛дф╕нчЪДхдЪф╕кшКВчВ╣хИЫх╗║хеЧцОехнЧш┐ЮцОея╝МшАМцЙАш░УчЪДшКВчВ╣ш╜мхРСхоЮщЩЕф╕Кх░▒цШпцНвф╕Аф╕кхеЧцОехнЧцЭехПСщАБхС╜ф╗дуАВ</p> <p>хжВцЮЬховцИ╖члпх░ЪцЬкф╕ОцГ│шжБш╜мхРСчЪДшКВчВ╣хИЫх╗║хеЧцОехнЧш┐ЮцОея╝МщВгф╣ИховцИ╖члпф╝ЪхЕИца╣цНоMOVEDщФЩшппцПРф╛ЫчЪДIPхЬ░хЭАхТМчлпхПгхП╖цЭеш┐ЮцОешКВчВ╣я╝МчД╢хРОхЖНш┐ЫшбМш╜мхРСуАВ</p> <blockquote><p>швлщЪРшЧПчЪДMOVEDщФЩшпп</p> <p>щЫЖч╛дцибх╝ПчЪДredis-cliховцИ╖члпхЬицОецФ╢хИ░MOVEDщФЩшппцЧ╢я╝Мх╣╢ф╕Нф╝ЪцЙУхН░хЗ║MOVEDщФЩшппя╝МшАМцШпца╣цНоMOVEDщФЩшппшЗкхКиш┐ЫшбМшКВчВ╣ш╜мхРСя╝Мх╣╢цЙУхН░хЗ║ш╜мхРСф┐бцБпя╝МцЙАф╗ецИСф╗мцШпчЬЛф╕НшзБшКВчВ╣ш┐ФхЫЮчЪДMOVEDщФЩшппчЪДя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>$ redis<span class="token operator">-</span>cli <span class="token operator">-</span>c <span class="token operator">-</span>p <span class="token number">7000</span> # 
щЫЖч╛дцибх╝П
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7000</span><span class="token operator">&gt;</span> SET msg <span class="token string">&quot;happy new year!&quot;</span>
<span class="token operator">-&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">6257</span><span class="token punctuation">]</span> located at <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7001</span>
OK
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7001</span><span class="token operator">&gt;</span>
</code></pre></div><p>ф╜ЖцШпя╝МхжВцЮЬцИСф╗мф╜┐чФихНХцЬ║я╝Иstand aloneя╝Йцибх╝ПчЪДredis-cliховцИ╖члпя╝МхЖНцмбхРСшКВчВ╣7000хПСщАБчЫ╕хРМчЪДхС╜ф╗дя╝МщВгф╣ИMOVEDщФЩшппх░▒ф╝ЪшвлховцИ╖члпцЙУхН░хЗ║цЭея╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>$ redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">7000</span> # 
хНХцЬ║цибх╝П
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7000</span><span class="token operator">&gt;</span> SET msg <span class="token string">&quot;happy new year!&quot;</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> MOVED <span class="token number">6257</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7001</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">7000</span><span class="token operator">&gt;</span>
</code></pre></div><p>ш┐ЩцШпхЫаф╕║хНХцЬ║цибх╝ПчЪДredis-cliховцИ╖члпф╕Нц╕ЕцеЪMOVEDщФЩшппчЪДф╜ЬчФия╝МцЙАф╗ехоГхПкф╝ЪчЫ┤цОех░ЖMOVEDщФЩшппчЫ┤цОецЙУхН░хЗ║цЭея╝МшАМф╕Нф╝Ъш┐ЫшбМшЗкхКиш╜мхРСуАВ</p></blockquote> <h3 id="шКВчВ╣цХ░цНох║УчЪДхоЮчО░"><a href="#шКВчВ╣цХ░цНох║УчЪДхоЮчО░" class="header-anchor">#</a> шКВчВ╣цХ░цНох║УчЪДхоЮчО░</h3> <p>щЫЖч╛дшКВчВ╣ф┐ЭхнШщФохА╝хп╣ф╗ехПКщФохА╝хп╣ш┐ЗцЬЯцЧ╢щЧ┤чЪДцЦ╣х╝Пя╝Мф╕Очмм9члащЗМщЭвф╗Лч╗НчЪДхНХцЬ║RedisцЬНхКбхЩиф┐ЭхнШщФохА╝хп╣ф╗ехПКщФохА╝хп╣ш┐ЗцЬЯцЧ╢щЧ┤чЪДцЦ╣х╝ПхоМхЕичЫ╕хРМуАВ</p> <p>шКВчВ╣хТМхНХцЬ║цЬНхКбхЩихЬицХ░цНох║УцЦ╣щЭвчЪДф╕Аф╕кхМ║хИлцШпя╝МшКВчВ╣хПкшГ╜ф╜┐чФи0хП╖цХ░цНох║Уя╝МшАМхНХцЬ║RedisцЬНхКбхЩихИЩц▓бцЬЙш┐Щф╕АщЩРхИ╢уАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхЫ╛17-22х▒Хчд║ф║ЖшКВчВ╣7000чЪДцХ░цНох║УчК╢цАБя╝МцХ░цНох║Уф╕нхМЕхРлхИЧшбищФо&quot;lst&quot;я╝МхУИх╕МщФо&quot;book&quot;я╝Мф╗ехПКхнЧчмжф╕▓щФо&quot;date&quot;я╝МхЕ╢ф╕нщФо&quot;lst&quot;хТМщФо&quot;book&quot;х╕жцЬЙш┐ЗцЬЯцЧ╢щЧ┤уАВ</p> <p>хПжхдЦя╝МщЩдф║Жх░ЖщФохА╝хп╣ф┐ЭхнШхЬицХ░цНох║УщЗМщЭвф╣ЛхдЦя╝МшКВчВ╣ш┐Шф╝ЪчФиclusterStateч╗УцЮДф╕нчЪДslots_to_keysш╖│ш╖ГшбицЭеф┐ЭхнШцз╜хТМщФоф╣ЛщЧ┤чЪДхЕ│ч│╗я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">clusterState</span> <span class="token punctuation">{</span>

  zskiplist <span class="token operator">*</span>slots_to_keys<span class="token punctuation">;</span>
 
<span class="token punctuation">}</span> clusterState<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://book-redis-design.netlify.app/images/000257.jpg" alt="img"></p> <p>хЫ╛17-22уААшКВчВ╣7000чЪДцХ░цНох║У</p> <p>slots_to_keysш╖│ш╖ГшбицпПф╕кшКВчВ╣чЪДхИЖхА╝я╝Иscoreя╝ЙщГ╜цШпф╕Аф╕кцз╜хП╖я╝МшАМцпПф╕кшКВчВ╣чЪДцИРхСШя╝Иmemberя╝ЙщГ╜цШпф╕Аф╕кцХ░цНох║УщФоя╝Ъ</p> <ul><li><p>цпПх╜УшКВчВ╣х╛АцХ░цНох║Уф╕нц╖╗хКаф╕Аф╕кцЦ░чЪДщФохА╝хп╣цЧ╢я╝МшКВчВ╣х░▒ф╝Ъх░Жш┐Щф╕кщФоф╗ехПКщФочЪДцз╜хП╖хЕ│шБФхИ░slots_to_keysш╖│ш╖ГшбиуАВ</p></li> <li><p>х╜УшКВчВ╣хИащЩдцХ░цНох║Уф╕нчЪДцЯРф╕кщФохА╝хп╣цЧ╢я╝МшКВчВ╣х░▒ф╝ЪхЬиslots_to_keysш╖│ш╖ГшбишзгщЩдшвлхИащЩдщФоф╕Оцз╜хП╖чЪДхЕ│шБФуАВ</p></li></ul> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхЫ╛17-22цЙАчд║чЪДцХ░цНох║Уя╝МшКВчВ╣7000х░ЖхИЫх╗║ч▒╗ф╝╝хЫ╛17-23цЙАчд║чЪДslots_to_keysш╖│ш╖Гшбия╝Ъ</p> <ul><li><p>щФо&quot;book&quot;цЙАхЬиш╖│ш╖ГшбишКВчВ╣чЪДхИЖхА╝ф╕║1337.0я╝Мш┐Щшбичд║щФо&quot;book&quot;цЙАхЬичЪДцз╜ф╕║1337уАВ</p></li> <li><p>щФо&quot;date&quot;цЙАхЬиш╖│ш╖ГшбишКВчВ╣чЪДхИЖхА╝ф╕║2022.0я╝Мш┐Щшбичд║щФо&quot;date&quot;цЙАхЬичЪДцз╜ф╕║2022уАВ</p></li> <li><p>щФо&quot;lst&quot;цЙАхЬиш╖│ш╖ГшбишКВчВ╣чЪДхИЖхА╝ф╕║3347.0я╝Мш┐Щшбичд║щФо&quot;lst&quot;цЙАхЬичЪДцз╜ф╕║3347уАВ</p></li></ul> <p>щАЪш┐ЗхЬиslots_to_keysш╖│ш╖Гшбиф╕ншо░х╜ХхРДф╕кцХ░цНох║УщФоцЙАх▒ЮчЪДцз╜я╝МшКВчВ╣хПпф╗ех╛ИцЦ╣ф╛┐хЬ░хп╣х▒Юф║ОцЯРф╕кцИЦцЯРф║Ыцз╜чЪДцЙАцЬЙцХ░цНох║УщФош┐ЫшбМцЙ╣щЗПцУНф╜Ья╝Мф╛ЛхжВхС╜ф╗дCLUSTER GETKEYSINSLOT<count>хС╜ф╗дхПпф╗еш┐ФхЫЮцЬАхдЪcountф╕кх▒Юф║Оцз╜slotчЪДцХ░цНох║УщФоя╝МшАМш┐Щф╕кхС╜ф╗дх░▒цШпщАЪш┐ЗщБНхОЖslots_to_keysш╖│ш╖ГшбицЭехоЮчО░чЪДуАВ</count></p> <p><img src="https://book-redis-design.netlify.app/images/000083.jpg" alt="img"></p> <p>хЫ╛17-23уААшКВчВ╣7000чЪДslots_to_keysш╖│ш╖Гшби</p> <h2 id="щЗНцЦ░хИЖчЙЗ"><a href="#щЗНцЦ░хИЖчЙЗ" class="header-anchor">#</a> щЗНцЦ░хИЖчЙЗ</h2> <p>RedisщЫЖч╛дчЪДщЗНцЦ░хИЖчЙЗцУНф╜ЬхПпф╗ех░Жф╗╗цДПцХ░щЗПх╖▓ч╗ПцМЗц┤╛ч╗ЩцЯРф╕кшКВчВ╣я╝Иц║РшКВчВ╣я╝ЙчЪДцз╜цФ╣ф╕║цМЗц┤╛ч╗ЩхПжф╕Аф╕кшКВчВ╣я╝ИчЫоцаЗшКВчВ╣я╝Йя╝Мх╣╢ф╕ФчЫ╕хЕ│цз╜цЙАх▒ЮчЪДщФохА╝хп╣ф╣Яф╝Ъф╗Оц║РшКВчВ╣швлчз╗хКихИ░чЫоцаЗшКВчВ╣уАВ</p> <p>щЗНцЦ░хИЖчЙЗцУНф╜ЬхПпф╗ехЬич║┐я╝Иonlineя╝Йш┐ЫшбМя╝МхЬищЗНцЦ░хИЖчЙЗчЪДш┐ЗчиЛф╕ня╝МщЫЖч╛дф╕НщЬАшжБф╕Лч║┐я╝Мх╣╢ф╕Фц║РшКВчВ╣хТМчЫоцаЗшКВчВ╣щГ╜хПпф╗еч╗зч╗нхдДчРЖхС╜ф╗дшп╖ц▒ВуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║Оф╣ЛхЙНцПРхИ░чЪДя╝МхМЕхРл7000уАБ7001уАБ7002ф╕Йф╕кшКВчВ╣чЪДщЫЖч╛дцЭешп┤я╝МцИСф╗мхПпф╗ехРСш┐Щф╕кщЫЖч╛дц╖╗хКаф╕Аф╕кIPф╕║127.0.0.1я╝МчлпхПгхП╖ф╕║7003чЪДшКВчВ╣я╝ИхРОщЭвчоАчз░шКВчВ╣7003я╝Йя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>$ redis-cli -c -p 7000
127.0.0.1:7000&gt; CLUSTER MEET 127.0.0.1 7003
OK
127.0.0.1:7000&gt; cluster nodes
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master - 0 0 0 connected 0-5000
68eef66df23420a5862208ef5b1a7005b806f2ff 127.0.0.1:7001 master - 0 1388635782831 0 connected 5001-10000
9dfb4c4e016e627d9769e4c9bb0d4fa208e65c26 127.0.0.1:7002 master - 0 1388635782831 0 connected 10001-16383
04579925484ce537d3410d7ce97bd2e260c459a2 127.0.0.1:7003 master - 0 1388635782330 0 connected
</code></pre></div><p>чД╢хРОщАЪш┐ЗщЗНцЦ░хИЖчЙЗцУНф╜Ья╝Мх░ЖхОЯцЬмцМЗц┤╛ч╗ЩшКВчВ╣7002чЪДцз╜15001шЗ│16383цФ╣ф╕║цМЗц┤╛ч╗ЩшКВчВ╣7003уАВ</p> <p>ф╗еф╕ЛцШпщЗНцЦ░хИЖчЙЗцУНф╜ЬцЙзшбМф╣ЛхРОя╝МшКВчВ╣чЪДцз╜хИЖщЕНчК╢цАБя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7000&gt; cluster nodes
51549e625cfda318ad27423a31e7476fe3cd2939 :0 myself,master -0 0 0 connected 0-5000
68eef66df23420a5862208ef5b1a7005b806f2ff 127.0.0.1:7001 master -0 1388635782831 0 connected 5001-10000
9dfb4c4e016e627d9769e4c9bb0d4fa208e65c26 127.0.0.1:7002 master -0 1388635782831 0 connected 10001-15000
04579925484ce537d3410d7ce97bd2e260c459a2 127.0.0.1:7003 master -0 1388635782330 0 connected 15001-16383
</code></pre></div><p><strong>щЗНцЦ░хИЖчЙЗчЪДхоЮчО░хОЯчРЖ</strong></p> <p>RedisщЫЖч╛дчЪДщЗНцЦ░хИЖчЙЗцУНф╜ЬцШпчФ▒RedisчЪДщЫЖч╛дчобчРЖш╜пф╗╢redis-tribш┤Яш┤гцЙзшбМчЪДя╝МRedisцПРф╛Ыф║Жш┐ЫшбМщЗНцЦ░хИЖчЙЗцЙАщЬАчЪДцЙАцЬЙхС╜ф╗дя╝МшАМredis-tribхИЩщАЪш┐ЗхРСц║РшКВчВ╣хТМчЫоцаЗшКВчВ╣хПСщАБхС╜ф╗дцЭеш┐ЫшбМщЗНцЦ░хИЖчЙЗцУНф╜ЬуАВ</p> <p>redis-tribхп╣щЫЖч╛дчЪДхНХф╕кцз╜slotш┐ЫшбМщЗНцЦ░хИЖчЙЗчЪДцнещкдхжВф╕Ля╝Ъ</p> <p>1я╝Йredis-tribхп╣чЫоцаЗшКВчВ╣хПСщАБ<code>CLUSTER SETSLOT &lt;slot&gt; IMPORTING &lt;source_id&gt;</code> хС╜ф╗дя╝МшойчЫоцаЗшКВчВ╣хЗЖхдЗхе╜ф╗Оц║РшКВчВ╣хп╝хЕея╝Иimportя╝Йх▒Юф║Оцз╜slotчЪДщФохА╝хп╣уАВ</p> <p>2я╝Йredis-tribхп╣ц║РшКВчВ╣хПСщАБ<code>CLUSTER SETSLOT &lt;slot&gt; MIGRATING &lt;target_id&gt;</code>хС╜ф╗дя╝Мшойц║РшКВчВ╣хЗЖхдЗхе╜х░Жх▒Юф║Оцз╜slotчЪДщФохА╝хп╣ш┐Бчз╗я╝Иmigrateя╝ЙшЗ│чЫоцаЗшКВчВ╣уАВ</p> <p>3я╝Йredis-tribхРСц║РшКВчВ╣хПСщАБ<code>CLUSTER GETKEYSINSLOT &lt;slot&gt; &lt;count&gt;</code> хС╜ф╗дя╝МшО╖х╛ЧцЬАхдЪcountф╕кх▒Юф║Оцз╜slotчЪДщФохА╝хп╣чЪДщФохРНя╝Иkey nameя╝ЙуАВ</p> <p>4я╝Йхп╣ф║Оцнещкд3шО╖х╛ЧчЪДцпПф╕кщФохРНя╝Мredis-tribщГ╜хРСц║РшКВчВ╣хПСщАБф╕Аф╕к<code>MIGRATE &lt;target_ip &gt;&lt;target_port&gt; &lt;key_name&gt; 0 &lt;timeout&gt;</code>хС╜ф╗дя╝Мх░ЖшвлщАЙф╕нчЪДщФохОЯхнРхЬ░ф╗Оц║РшКВчВ╣ш┐Бчз╗шЗ│чЫоцаЗшКВчВ╣уАВ</p> <p>5я╝ЙщЗНхдНцЙзшбМцнещкд3хТМцнещкд4я╝МчЫ┤хИ░ц║РшКВчВ╣ф┐ЭхнШчЪДцЙАцЬЙх▒Юф║Оцз╜slotчЪДщФохА╝хп╣щГ╜швлш┐Бчз╗шЗ│чЫоцаЗшКВчВ╣ф╕║цнвуАВцпПцмбш┐Бчз╗щФочЪДш┐ЗчиЛхжВхЫ╛17-24цЙАчд║уАВ</p> <p>6я╝Йredis-tribхРСщЫЖч╛дф╕нчЪДф╗╗цДПф╕Аф╕кшКВчВ╣хПСщАБ<code>CLUSTER SETSLOT &lt;slot&gt; NODE &lt;target_id&gt;</code>хС╜ф╗дя╝Мх░Жцз╜slotцМЗц┤╛ч╗ЩчЫоцаЗшКВчВ╣я╝Мш┐Щф╕АцМЗц┤╛ф┐бцБпф╝ЪщАЪш┐Зц╢ИцБпхПСщАБшЗ│цХ┤ф╕кщЫЖч╛дя╝МцЬАч╗ИщЫЖч╛дф╕нчЪДцЙАцЬЙшКВчВ╣щГ╜ф╝ЪчЯещБУцз╜slotх╖▓ч╗ПцМЗц┤╛ч╗Щф║ЖчЫоцаЗшКВчВ╣уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000287.jpg" alt="img"></p> <p>хЫ╛17-24уААш┐Бчз╗щФочЪДш┐ЗчиЛ</p> <p>хЫ╛17-25 х▒Хчд║ф║Жхп╣цз╜slotш┐ЫшбМщЗНцЦ░хИЖчЙЗчЪДцХ┤ф╕кш┐ЗчиЛуАВ</p> <p>хжВцЮЬщЗНцЦ░хИЖчЙЗц╢ЙхПКхдЪф╕кцз╜я╝МщВгф╣Иredis-tribх░Жхп╣цпПф╕кч╗ЩхоЪчЪДцз╜хИЖхИлцЙзшбМф╕КщЭвч╗ЩхЗ║чЪДцнещкдуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000283.jpg" alt="img"></p> <p>хЫ╛17-25уААхп╣цз╜slotш┐ЫшбМщЗНцЦ░хИЖчЙЗчЪДш┐ЗчиЛ</p> <h2 id="ask-щФЩшпп"><a href="#ask-щФЩшпп" class="header-anchor">#</a> ASK щФЩшпп</h2> <p>хЬиш┐ЫшбМщЗНцЦ░хИЖчЙЗцЬЯщЧ┤я╝Мц║РшКВчВ╣хРСчЫоцаЗшКВчВ╣ш┐Бчз╗ф╕Аф╕кцз╜чЪДш┐ЗчиЛф╕ня╝МхПпшГ╜ф╝ЪхЗ║чО░ш┐Щца╖ф╕АчзНцГЕхЖ╡я╝Ъх▒Юф║Ошвлш┐Бчз╗цз╜чЪДф╕АщГихИЖщФохА╝хп╣ф┐ЭхнШхЬиц║РшКВчВ╣щЗМщЭвя╝МшАМхПжф╕АщГихИЖщФохА╝хп╣хИЩф┐ЭхнШхЬичЫоцаЗшКВчВ╣щЗМщЭвуАВ</p> <p>х╜УховцИ╖члпхРСц║РшКВчВ╣хПСщАБф╕Аф╕кф╕ОцХ░цНох║УщФоцЬЙхЕ│чЪДхС╜ф╗дя╝Мх╣╢ф╕ФхС╜ф╗дшжБхдДчРЖчЪДцХ░цНох║УщФоцБ░хе╜х░▒х▒Юф║ОцнгхЬишвлш┐Бчз╗чЪДцз╜цЧ╢я╝Ъ</p> <ul><li>ц║РшКВчВ╣ф╝ЪхЕИхЬишЗкх╖▒чЪДцХ░цНох║УщЗМщЭвцЯецЙ╛цМЗхоЪчЪДщФоя╝МхжВцЮЬцЙ╛хИ░чЪДшпЭя╝Мх░▒чЫ┤цОецЙзшбМховцИ╖члпхПСщАБчЪДхС╜ф╗дуАВ</li> <li>чЫ╕хПНхЬ░я╝МхжВцЮЬц║РшКВчВ╣ц▓бшГ╜хЬишЗкх╖▒чЪДцХ░цНох║УщЗМщЭвцЙ╛хИ░цМЗхоЪчЪДщФоя╝МщВгф╣Иш┐Щф╕кщФоцЬЙхПпшГ╜х╖▓ч╗Пшвлш┐Бчз╗хИ░ф║ЖчЫоцаЗшКВчВ╣я╝Мц║РшКВчВ╣х░ЖхРСховцИ╖члпш┐ФхЫЮф╕Аф╕кASKщФЩшппя╝МцМЗх╝ХховцИ╖члпш╜мхРСцнгхЬихп╝хЕецз╜чЪДчЫоцаЗшКВчВ╣я╝Мх╣╢хЖНцмбхПСщАБф╣ЛхЙНцГ│шжБцЙзшбМчЪДхС╜ф╗дуАВ</li></ul> <p>хЫ╛17-26х▒Хчд║ф║Жц║РшКВчВ╣хИдцЦнцШпхРжщЬАшжБхРСховцИ╖члпхПСщАБASKщФЩшппчЪДцХ┤ф╕кш┐ЗчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000210.jpg" alt="img"></p> <p>хЫ╛17-26уААхИдцЦнцШпхРжхПСщАБASKщФЩшппчЪДш┐ЗчиЛ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхБЗшо╛шКВчВ╣7002цнгхЬихРСшКВчВ╣7003ш┐Бчз╗цз╜16198я╝Мш┐Щф╕кцз╜хМЕхРл&quot;is&quot;хТМ&quot;love&quot;ф╕дф╕кщФоя╝МхЕ╢ф╕нщФо&quot;is&quot;ш┐ШчХЩхЬишКВчВ╣7002я╝МшАМщФо&quot;love&quot;х╖▓ч╗Пшвлш┐Бчз╗хИ░ф║ЖшКВчВ╣7003уАВ</p> <p>хжВцЮЬцИСф╗мхРСшКВчВ╣7002хПСщАБхЕ│ф║ОщФо&quot;is&quot;чЪДхС╜ф╗дя╝МщВгф╣Иш┐Щф╕кхС╜ф╗дф╝ЪчЫ┤цОешвлшКВчВ╣7002цЙзшбМя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7002&gt; GET &quot;is&quot;
&quot;you get the key 'is'&quot;
</code></pre></div><p>шАМхжВцЮЬцИСф╗мхРСшКВчВ╣7002хПСщАБхЕ│ф║ОщФо&quot;love&quot;чЪДхС╜ф╗дя╝МщВгф╣ИховцИ╖члпф╝ЪхЕИшвлш╜мхРСшЗ│шКВчВ╣7003я╝МчД╢хРОхЖНцмбцЙзшбМхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7002&gt; GET &quot;love&quot;
-&gt; Redirected to slot [16198] located at 127.0.0.1:7003
&quot;you get the key 'love'&quot;
127.0.0.1:7003&gt;
</code></pre></div><blockquote><p>швлщЪРшЧПчЪДASKщФЩшпп</p> <p>хТМцОехИ░MOVEDщФЩшппцЧ╢чЪДцГЕхЖ╡ч▒╗ф╝╝я╝МщЫЖч╛дцибх╝ПчЪДredis-cliхЬицОехИ░ASKщФЩшппцЧ╢ф╣Яф╕Нф╝ЪцЙУхН░щФЩшппя╝МшАМцШпшЗкхКица╣цНощФЩшппцПРф╛ЫчЪДIPхЬ░хЭАхТМчлпхПгш┐ЫшбМш╜мхРСхКиф╜ЬуАВхжВцЮЬцГ│чЬЛхИ░шКВчВ╣хПСщАБчЪДASKщФЩшппчЪДшпЭя╝МхПпф╗еф╜┐чФихНХцЬ║цибх╝ПчЪДredis-cliховцИ╖члпя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>$ redis-cli -p 7002
127.0.0.1:7002&gt; GET &quot;love&quot;
(error) ASK 16198 127.0.0.1:7003
</code></pre></div></blockquote> <p><strong>ц│ицДП</strong></p> <p>хЬихЖЩш┐ЩчпЗцЦЗчлачЪДцЧ╢хАЩя╝МщЫЖч╛дцибх╝ПчЪДredis-cliх╣╢цЬкцФпцМБASKшЗкхКиш╜мхРСя╝Мф╕КщЭвх▒Хчд║чЪДASKшЗкхКиш╜мхРСшбМф╕║хоЮщЩЕф╕КцШпца╣цНоMOVEDшЗкхКиш╜мхРСшбМф╕║шЩЪцЮДхЗ║цЭечЪДуАВхЫацндя╝Мх╜УщЫЖч╛дцибх╝ПчЪДredis-cliчЬЯцнгцФпцМБASKшЗкхКиш╜мхРСцЧ╢я╝МхоГчЪДшбМф╕║хТМф╕КщЭвх▒Хчд║чЪДшбМф╕║хПпшГ╜ф╝ЪцЬЙцЙАф╕НхРМуАВ</p> <p>цЬмшКВх░Жхп╣ASKщФЩшппчЪДхоЮчО░хОЯчРЖш┐ЫшбМшп┤цШОя╝Мх╣╢хп╣цпФASKщФЩшппхТМMOVEDщФЩшппчЪДхМ║хИлуАВ</p> <h3 id="cluster-setslot-importingхС╜ф╗дчЪДхоЮчО░"><a href="#cluster-setslot-importingхС╜ф╗дчЪДхоЮчО░" class="header-anchor">#</a> CLUSTER SETSLOT IMPORTINGхС╜ф╗дчЪДхоЮчО░</h3> <p>clusterStateч╗УцЮДчЪДimporting_slots_fromцХ░ч╗Дшо░х╜Хф║Жх╜УхЙНшКВчВ╣цнгхЬиф╗ОхЕ╢ф╗ЦшКВчВ╣хп╝хЕечЪДцз╜я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">clusterState</span> <span class="token punctuation">{</span>

  clusterNode <span class="token operator">*</span>importing_slots_from<span class="token punctuation">[</span><span class="token number">16384</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span> clusterState<span class="token punctuation">;</span>
</code></pre></div><p>хжВцЮЬimporting_slots_from[i]чЪДхА╝ф╕Нф╕║NULLя╝МшАМцШпцМЗхРСф╕Аф╕кclusterNodeч╗УцЮДя╝МщВгф╣Ишбичд║х╜УхЙНшКВчВ╣цнгхЬиф╗ОclusterNodeцЙАф╗гшбичЪДшКВчВ╣хп╝хЕецз╜iуАВ</p> <p>хЬихп╣щЫЖч╛дш┐ЫшбМщЗНцЦ░хИЖчЙЗчЪДцЧ╢хАЩя╝МхРСчЫоцаЗшКВчВ╣хПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>CLUSTER SETSLOT &lt;i&gt; IMPORTING &lt;source_id&gt;
</code></pre></div><p>хПпф╗ех░ЖчЫоцаЗшКВчВ╣clusterState.importing_slots_from[i]чЪДхА╝шо╛ч╜оф╕║source_idцЙАф╗гшбишКВчВ╣чЪДclusterNodeч╗УцЮДуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬховцИ╖члпхРСшКВчВ╣7003хПСщАБф╗еф╕ЛхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code># 9dfb цШпшКВчВ╣7002 чЪДID 
127.0.0.1:7003&gt; CLUSTER SETSLOT 16198 IMPORTING 9dfb4c4e016e627d9769e4c9bb0d4fa208e65c26
OK
</code></pre></div><p>щВгф╣ИшКВчВ╣7003чЪДclusterState.importing_slots_fromцХ░ч╗Дх░ЖхПШцИРхЫ╛17-27цЙАчд║чЪДца╖хнРуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000300.jpg" alt="img"></p> <p>хЫ╛17-27уААшКВчВ╣7003чЪДimporting_slots_fromцХ░ч╗Д</p> <h3 id="cluster-setslot-migrating-хС╜ф╗дчЪДхоЮчО░"><a href="#cluster-setslot-migrating-хС╜ф╗дчЪДхоЮчО░" class="header-anchor">#</a> CLUSTER SETSLOT MIGRATING хС╜ф╗дчЪДхоЮчО░</h3> <p>clusterStateч╗УцЮДчЪДmigrating_slots_toцХ░ч╗Дшо░х╜Хф║Жх╜УхЙНшКВчВ╣цнгхЬиш┐Бчз╗шЗ│хЕ╢ф╗ЦшКВчВ╣чЪДцз╜я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">clusterState</span> <span class="token punctuation">{</span>
   
   clusterNode <span class="token operator">*</span>migrating_slots_to<span class="token punctuation">[</span><span class="token number">16384</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   
<span class="token punctuation">}</span> clusterState<span class="token punctuation">;</span>
</code></pre></div><p>хжВцЮЬmigrating_slots_to[i]чЪДхА╝ф╕Нф╕║NULLя╝МшАМцШпцМЗхРСф╕Аф╕к clusterNode ч╗УцЮДя╝МщВгф╣Ишбичд║х╜УхЙНшКВчВ╣цнгхЬих░Жцз╜iш┐Бчз╗шЗ│clusterNodeцЙАф╗гшбичЪДшКВчВ╣уАВ</p> <p>хЬихп╣щЫЖч╛дш┐ЫшбМщЗНцЦ░хИЖчЙЗчЪДцЧ╢хАЩя╝МхРСц║РшКВчВ╣хПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>CLUSTER SETSLOT &lt;i&gt; MIGRATING &lt;target_id&gt;
</code></pre></div><p>хПпф╗ех░Жц║РшКВчВ╣clusterState.migrating_slots_to[i]чЪДхА╝шо╛ч╜оф╕║target_idцЙАф╗гшбишКВчВ╣чЪДclusterNodeч╗УцЮДуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬховцИ╖члпхРСшКВчВ╣7002хПСщАБф╗еф╕ЛхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code># 0457
цШпшКВчВ╣7003 
чЪДID 
127.0.0.1:7002&gt; CLUSTER SETSLOT 16198 MIGRATING 04579925484ce537d3410d7ce97bd2e260c459a2
OK
</code></pre></div><p>щВгф╣ИшКВчВ╣7002чЪДclusterState.migrating_slots_toцХ░ч╗Дх░ЖхПШцИРхЫ╛17-28цЙАчд║чЪДца╖хнРуАВ</p> <p>хЫ╛17-28уААшКВчВ╣7002чЪДmigrating_slots_toцХ░ч╗Д</p> <h3 id="ask-щФЩшпп-2"><a href="#ask-щФЩшпп-2" class="header-anchor">#</a> ASK щФЩшпп</h3> <p>хжВцЮЬшКВчВ╣цФ╢хИ░ф╕Аф╕кхЕ│ф║ОщФоkeyчЪДхС╜ф╗дшп╖ц▒Вя╝Мх╣╢ф╕ФщФоkeyцЙАх▒ЮчЪДцз╜iцнгхе╜х░▒цМЗц┤╛ч╗Щф║Жш┐Щф╕кшКВчВ╣я╝МщВгф╣ИшКВчВ╣ф╝Ъх░ЭшпХхЬишЗкх╖▒чЪДцХ░цНох║УщЗМцЯецЙ╛щФоkeyя╝МхжВцЮЬцЙ╛хИ░ф║ЖчЪДшпЭя╝МшКВчВ╣х░▒чЫ┤цОецЙзшбМховцИ╖члпхПСщАБчЪДхС╜ф╗дуАВ</p> <p>ф╕ОцндчЫ╕хПНя╝МхжВцЮЬшКВчВ╣ц▓бцЬЙхЬишЗкх╖▒чЪДцХ░цНох║УщЗМцЙ╛хИ░щФоkeyя╝МщВгф╣ИшКВчВ╣ф╝ЪцгАцЯешЗкх╖▒чЪДclusterState.migrating_slots_to[i]я╝МчЬЛщФоkeyцЙАх▒ЮчЪДцз╜iцШпхРжцнгхЬиш┐ЫшбМш┐Бчз╗я╝МхжВцЮЬцз╜iчЪДчбохЬиш┐ЫшбМш┐Бчз╗чЪДшпЭя╝МщВгф╣ИшКВчВ╣ф╝ЪхРСховцИ╖члпхПСщАБф╕Аф╕кASKщФЩшппя╝Мх╝Ххп╝ховцИ╖члпхИ░цнгхЬихп╝хЕецз╜iчЪДшКВчВ╣хО╗цЯецЙ╛щФоkeyуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхБЗшо╛хЬишКВчВ╣7002хРСшКВчВ╣7003ш┐Бчз╗цз╜16198цЬЯщЧ┤я╝МцЬЙф╕Аф╕кховцИ╖члпхРСшКВчВ╣7002хПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>GET 
тАЬloveтАЭ
</code></pre></div><p>хЫаф╕║щФо&quot;love&quot;цнгхе╜х▒Юф║Оцз╜16198я╝МцЙАф╗ешКВчВ╣7002ф╝ЪщжЦхЕИхЬишЗкх╖▒чЪДцХ░цНох║Уф╕нцЯецЙ╛щФо&quot;love&quot;я╝Мф╜Жх╣╢ц▓бцЬЙцЙ╛хИ░я╝МщАЪш┐ЗцгАцЯешЗкх╖▒чЪДclusterState.migrating_slots_to[16198]я╝МшКВчВ╣7002хПСчО░шЗкх╖▒цнгхЬих░Жцз╜16198ш┐Бчз╗шЗ│шКВчВ╣7003я╝Мф║ОцШпхоГхРСховцИ╖члпш┐ФхЫЮщФЩшппя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>ASK 16198 127.0.0.1:7003
</code></pre></div><p>ш┐Щф╕кщФЩшппшбичд║ховцИ╖члпхПпф╗ех░ЭшпХхИ░IPф╕║127.0.0.1я╝МчлпхПгхП╖ф╕║7003чЪДшКВчВ╣хО╗цЙзшбМхТМцз╜16198цЬЙхЕ│чЪДцУНф╜Ья╝МхжВхЫ╛17-29цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000224.jpg" alt="img"></p> <p>хЫ╛17-29уААховцИ╖члпцОецФ╢хИ░шКВчВ╣7002ш┐ФхЫЮчЪДASKщФЩшпп</p> <p>цОехИ░ASKщФЩшппчЪДховцИ╖члпф╝Ъца╣цНощФЩшппцПРф╛ЫчЪДIPхЬ░хЭАхТМчлпхПгхП╖я╝Мш╜мхРСшЗ│цнгхЬихп╝хЕецз╜чЪДчЫоцаЗшКВчВ╣я╝МчД╢хРОщжЦхЕИхРСчЫоцаЗшКВчВ╣хПСщАБф╕Аф╕кASKINGхС╜ф╗дя╝Мф╣ЛхРОхЖНщЗНцЦ░хПСщАБхОЯцЬмцГ│шжБцЙзшбМчЪДхС╜ф╗дуАВ</p> <p>ф╗ехЙНщЭвчЪДф╛ЛхнРцЭешп┤я╝Мх╜УховцИ╖члпцОецФ╢хИ░шКВчВ╣7002ш┐ФхЫЮчЪДф╗еф╕ЛщФЩшппцЧ╢я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>ASK 16198 127.0.0.1:7003
</code></pre></div><p>ховцИ╖члпф╝Ъш╜мхРСшЗ│шКВчВ╣7003я╝МщжЦхЕИхПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>ASKING
</code></pre></div><p>чД╢хРОхЖНцмбхПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>GET &quot;love&quot;
</code></pre></div><p>х╣╢шО╖х╛ЧхЫЮхдНя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;you get the key 'love'&quot;
</code></pre></div><p>цХ┤ф╕кш┐ЗчиЛхжВхЫ╛17-30цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000005.jpeg" alt="img"></p> <p>хЫ╛17-30уААховцИ╖члпш╜мхРСшЗ│шКВчВ╣7003</p> <h3 id="askingхС╜ф╗д"><a href="#askingхС╜ф╗д" class="header-anchor">#</a> ASKINGхС╜ф╗д</h3> <p>ASKINGхС╜ф╗дхФпф╕АшжБхБЪчЪДх░▒цШпцЙУх╝АхПСщАБшпехС╜ф╗дчЪДховцИ╖члпчЪДREDIS_ASKINGцаЗшпЖя╝Мф╗еф╕ЛцШпшпехС╜ф╗дчЪДф╝кф╗гчаБхоЮчО░я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>def ASKING():
    # 
цЙУх╝АцаЗшпЖ
    client.flags |= REDIS_ASKING
    # 
хРСховцИ╖члпш┐ФхЫЮOK 
хЫЮхдН
    reply(&quot;OK&quot;)
</code></pre></div><p>хЬиф╕АшИмцГЕхЖ╡ф╕Ля╝МхжВцЮЬховцИ╖члпхРСшКВчВ╣хПСщАБф╕Аф╕кхЕ│ф║Оцз╜iчЪДхС╜ф╗дя╝МшАМцз╜iхПИц▓бцЬЙцМЗц┤╛ч╗Щш┐Щф╕кшКВчВ╣чЪДшпЭя╝МщВгф╣ИшКВчВ╣х░ЖхРСховцИ╖члпш┐ФхЫЮф╕Аф╕кMOVEDщФЩшппя╝Ыф╜ЖцШпя╝МхжВцЮЬшКВчВ╣чЪДclusterState.importing_slots_from[i]цШ╛чд║шКВчВ╣цнгхЬихп╝хЕецз╜iя╝Мх╣╢ф╕ФхПСщАБхС╜ф╗дчЪДховцИ╖члпх╕жцЬЙREDIS_ASKINGцаЗшпЖя╝МщВгф╣ИшКВчВ╣х░Жча┤ф╛ЛцЙзшбМш┐Щф╕кхЕ│ф║Оцз╜iчЪДхС╜ф╗дф╕Ацмбя╝МхЫ╛17-31х▒Хчд║ф║Жш┐Щф╕кхИдцЦнш┐ЗчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000190.jpg" alt="img"></p> <p>хЫ╛17-31уААшКВчВ╣хИдцЦнцШпхРжцЙзшбМховцИ╖члпхС╜ф╗дчЪДш┐ЗчиЛ</p> <p>х╜УховцИ╖члпцОецФ╢хИ░ASKщФЩшппх╣╢ш╜мхРСшЗ│цнгхЬихп╝хЕецз╜чЪДшКВчВ╣цЧ╢я╝МховцИ╖члпф╝ЪхЕИхРСшКВчВ╣хПСщАБф╕Аф╕кASKINGхС╜ф╗дя╝МчД╢хРОцЙНщЗНцЦ░хПСщАБцГ│шжБцЙзшбМчЪДхС╜ф╗дя╝Мш┐ЩцШпхЫаф╕║хжВцЮЬховцИ╖члпф╕НхПСщАБASKINGхС╜ф╗дя╝МшАМчЫ┤цОехПСщАБцГ│шжБцЙзшбМчЪДхС╜ф╗дчЪДшпЭя╝МщВгф╣ИховцИ╖члпхПСщАБчЪДхС╜ф╗дх░ЖшвлшКВчВ╣цЛТч╗ЭцЙзшбМя╝Мх╣╢ш┐ФхЫЮMOVEDщФЩшппуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МцИСф╗мхПпф╗еф╜┐чФицЩощАЪцибх╝ПчЪДredis-cliховцИ╖члпя╝МхРСцнгхЬихп╝хЕецз╜16198чЪДшКВчВ╣7003хПСщАБф╗еф╕ЛхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>$ ./redis-cli -p 7003
127.0.0.1:7003&gt; GET &quot;love&quot;
(error) MOVED 16198 127.0.0.1:7002
</code></pre></div><p>шЩ╜чД╢шКВчВ╣7003цнгхЬихп╝хЕецз╜16198я╝Мф╜Жцз╜16198чЫохЙНф╗НчД╢цШпцМЗц┤╛ч╗Щф║ЖшКВчВ╣7002я╝МцЙАф╗ешКВчВ╣7003ф╝ЪхРСховцИ╖члпш┐ФхЫЮMOVEDщФЩшппя╝МцМЗх╝ХховцИ╖члпш╜мхРСшЗ│шКВчВ╣7002уАВ</p> <p>ф╜ЖцШпя╝МхжВцЮЬцИСф╗мхЬихПСщАБGETхС╜ф╗дф╣ЛхЙНя╝МхЕИхРСшКВчВ╣хПСщАБф╕Аф╕кASKINGхС╜ф╗дя╝МщВгф╣Иш┐Щф╕кGETхС╜ф╗дх░▒ф╝ЪшвлшКВчВ╣7003цЙзшбМя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7003&gt; ASKING
OK
127.0.0.1:7003&gt; GET &quot;love&quot;
&quot;you get the key 'love'&quot;
</code></pre></div><p>хПжхдЦшжБц│ицДПчЪДцШпя╝МховцИ╖члпчЪДREDIS_ASKINGцаЗшпЖцШпф╕Аф╕кф╕АцмбцАзцаЗшпЖя╝Мх╜УшКВчВ╣цЙзшбМф║Жф╕Аф╕кх╕жцЬЙREDIS_ASKINGцаЗшпЖчЪДховцИ╖члпхПСщАБчЪДхС╜ф╗дф╣ЛхРОя╝МховцИ╖члпчЪДREDIS_ASKINGцаЗшпЖх░▒ф╝Ъшвлчз╗щЩдуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬцИСф╗мхЬицИРхКЯцЙзшбМGETхС╜ф╗дф╣ЛхРОя╝МхЖНцмбхРСшКВчВ╣7003хПСщАБGETхС╜ф╗дя╝МщВгф╣Ичммф║МцмбхПСщАБчЪДGETхС╜ф╗дх░ЖцЙзшбМхд▒ш┤ея╝МхЫаф╕║ш┐ЩцЧ╢ховцИ╖члпчЪДREDIS_ASKINGцаЗшпЖх╖▓ч╗Пшвлчз╗щЩдя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7003&gt; ASKING                 #
цЙУх╝АREDIS_ASKING
цаЗшпЖ
OK
127.0.0.1:7003&gt; GET &quot;love&quot;   #
чз╗щЩдREDIS_ASKING
цаЗшпЖ
&quot;you get the key 'love'&quot;
127.0.0.1:7003&gt; GET &quot;love&quot;   # REDIS_ASKING
цаЗшпЖцЬкцЙУх╝Ая╝МцЙзшбМхд▒ш┤е
(error) MOVED 16198 127.0.0.1:7002
</code></pre></div><h3 id="askщФЩшппхТМmovedщФЩшппчЪДхМ║хИл"><a href="#askщФЩшппхТМmovedщФЩшппчЪДхМ║хИл" class="header-anchor">#</a> ASKщФЩшппхТМMOVEDщФЩшппчЪДхМ║хИл</h3> <p>ASKщФЩшппхТМMOVEDщФЩшппщГ╜ф╝Ъхп╝шЗ┤ховцИ╖члпш╜мхРСя╝МхоГф╗мчЪДхМ║хИлхЬиф║Оя╝Ъ</p> <ul><li><p>MOVEDщФЩшппф╗гшбицз╜чЪДш┤Яш┤гцЭГх╖▓ч╗Пф╗Оф╕Аф╕кшКВчВ╣ш╜мчз╗хИ░ф║ЖхПжф╕Аф╕кшКВчВ╣я╝ЪхЬиховцИ╖члпцФ╢хИ░хЕ│ф║Оцз╜iчЪДMOVEDщФЩшппф╣ЛхРОя╝МховцИ╖члпцпПцмбщБЗхИ░хЕ│ф║Оцз╜iчЪДхС╜ф╗дшп╖ц▒ВцЧ╢я╝МщГ╜хПпф╗ечЫ┤цОех░ЖхС╜ф╗дшп╖ц▒ВхПСщАБшЗ│MOVEDщФЩшппцЙАцМЗхРСчЪДшКВчВ╣я╝МхЫаф╕║шпешКВчВ╣х░▒цШпчЫохЙНш┤Яш┤гцз╜iчЪДшКВчВ╣уАВ</p></li> <li><p>ф╕ОцндчЫ╕хПНя╝МASKщФЩшппхПкцШпф╕дф╕кшКВчВ╣хЬиш┐Бчз╗цз╜чЪДш┐ЗчиЛф╕нф╜┐чФичЪДф╕АчзНф╕┤цЧ╢цОкцЦ╜я╝ЪхЬиховцИ╖члпцФ╢хИ░хЕ│ф║Оцз╜iчЪДASKщФЩшппф╣ЛхРОя╝МховцИ╖члпхПкф╝ЪхЬицОеф╕ЛцЭечЪДф╕АцмбхС╜ф╗дшп╖ц▒Вф╕нх░ЖхЕ│ф║Оцз╜iчЪДхС╜ф╗дшп╖ц▒ВхПСщАБшЗ│ASKщФЩшппцЙАцМЗчд║чЪДшКВчВ╣я╝Мф╜Жш┐ЩчзНш╜мхРСф╕Нф╝Ъхп╣ховцИ╖члпф╗КхРОхПСщАБхЕ│ф║Оцз╜iчЪДхС╜ф╗дшп╖ц▒Вф║зчФЯф╗╗ф╜Хх╜▒хУНя╝МховцИ╖члпф╗НчД╢ф╝Ъх░ЖхЕ│ф║Оцз╜iчЪДхС╜ф╗дшп╖ц▒ВхПСщАБшЗ│чЫохЙНш┤Яш┤гхдДчРЖцз╜iчЪДшКВчВ╣я╝МщЩдщЭЮASKщФЩшппхЖНцмбхЗ║чО░уАВ</p></li></ul> <h2 id="хдНхИ╢ф╕ОцХЕщЪЬш╜мчз╗"><a href="#хдНхИ╢ф╕ОцХЕщЪЬш╜мчз╗" class="header-anchor">#</a> хдНхИ╢ф╕ОцХЕщЪЬш╜мчз╗</h2> <p>RedisщЫЖч╛дф╕нчЪДшКВчВ╣хИЖф╕║ф╕╗шКВчВ╣я╝Иmasterя╝ЙхТМф╗ОшКВчВ╣я╝Иslaveя╝Йя╝МхЕ╢ф╕нф╕╗шКВчВ╣чФиф║ОхдДчРЖцз╜я╝МшАМф╗ОшКВчВ╣хИЩчФиф║ОхдНхИ╢цЯРф╕кф╕╗шКВчВ╣я╝Мх╣╢хЬишвлхдНхИ╢чЪДф╕╗шКВчВ╣ф╕Лч║┐цЧ╢я╝Мф╗гцЫ┐ф╕Лч║┐ф╕╗шКВчВ╣ч╗зч╗нхдДчРЖхС╜ф╗дшп╖ц▒ВуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхМЕхРл7000уАБ7001уАБ7002уАБ7003хЫЫф╕кф╕╗шКВчВ╣чЪДщЫЖч╛дцЭешп┤я╝МцИСф╗мхПпф╗ех░Ж7004уАБ7005ф╕дф╕кшКВчВ╣ц╖╗хКахИ░щЫЖч╛дщЗМщЭвя╝Мх╣╢х░Жш┐Щф╕дф╕кшКВчВ╣шо╛хоЪф╕║шКВчВ╣7000чЪДф╗ОшКВчВ╣я╝МхжВхЫ╛17-32цЙАчд║я╝ИхЫ╛ф╕нф╗ехПМхЬЖх╜вшбичд║ф╕╗шКВчВ╣я╝МхНХхЬЖх╜вшбичд║ф╗ОшКВчВ╣я╝ЙуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000010.jpg" alt="img"></p> <p>хЫ╛17-32уААшо╛ч╜ошКВчВ╣7004хТМшКВчВ╣7005цИРф╕║шКВчВ╣7000чЪДф╗ОшКВчВ╣</p> <p>шби17-1шо░х╜Хф║ЖщЫЖч╛дхРДф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБя╝Мф╗ехПКхоГф╗мцнгхЬихБЪчЪДх╖еф╜ЬуАВ</p> <p>шби17-1уААщЫЖч╛дхРДф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБ</p> <p><img src="https://book-redis-design.netlify.app/images/000032.jpg" alt="img"></p> <p>хжВцЮЬш┐ЩцЧ╢я╝МшКВчВ╣7000ш┐ЫхЕеф╕Лч║┐чК╢цАБя╝МщВгф╣ИщЫЖч╛дф╕нф╗НхЬицнгх╕╕ш┐Рф╜ЬчЪДхЗаф╕кф╕╗шКВчВ╣х░ЖхЬишКВчВ╣7000чЪДф╕дф╕кф╗ОшКВчВ╣тАФтАФшКВчВ╣7004хТМшКВчВ╣7005ф╕нщАЙхЗ║ф╕Аф╕кшКВчВ╣ф╜Ьф╕║цЦ░чЪДф╕╗шКВчВ╣я╝Мш┐Щф╕кцЦ░чЪДф╕╗шКВчВ╣х░ЖцОечобхОЯцЭешКВчВ╣7000ш┤Яш┤гхдДчРЖчЪДцз╜я╝Мх╣╢ч╗зч╗нхдДчРЖховцИ╖члпхПСщАБчЪДхС╜ф╗дшп╖ц▒ВуАВ</p> <p>ф╛ЛхжВя╝МхжВцЮЬшКВчВ╣7004швлщАЙф╕нф╕║цЦ░чЪДф╕╗шКВчВ╣я╝МщВгф╣ИшКВчВ╣7004х░ЖцОечобхОЯцЭечФ▒шКВчВ╣7000ш┤Яш┤гхдДчРЖчЪДцз╜0шЗ│цз╜5000я╝МшКВчВ╣7005ф╣Яф╝Ъф╗ОхОЯцЭечЪДхдНхИ╢шКВчВ╣7000я╝МцФ╣ф╕║хдНхИ╢шКВчВ╣7004я╝МхжВхЫ╛17-33цЙАчд║я╝ИхЫ╛ф╕нчФишЩЪч║┐хМЕхЫ┤чЪДшКВчВ╣ф╕║х╖▓ф╕Лч║┐шКВчВ╣я╝ЙуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000048.jpg" alt="img"></p> <p>хЫ╛17-33уААшКВчВ╣7004цИРф╕║цЦ░чЪДф╕╗шКВчВ╣</p> <p>шби17-2шо░х╜Хф║ЖхЬихп╣шКВчВ╣7000ш┐ЫшбМцХЕщЪЬш╜мчз╗ф╣ЛхРОя╝МщЫЖч╛дхРДф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБя╝Мф╗ехПКхоГф╗мцнгхЬихБЪчЪДх╖еф╜ЬуАВ</p> <p>шби17-2уААщЫЖч╛дхРДф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБ</p> <p><img src="https://book-redis-design.netlify.app/images/000062.jpg" alt="img"></p> <p>хжВцЮЬхЬицХЕщЪЬш╜мчз╗хоМцИРф╣ЛхРОя╝Мф╕Лч║┐чЪДшКВчВ╣7000щЗНцЦ░ф╕Кч║┐я╝МщВгф╣ИхоГх░ЖцИРф╕║шКВчВ╣7004чЪДф╗ОшКВчВ╣я╝МхжВхЫ╛17-34цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000076.jpg" alt="img"></p> <p>хЫ╛17-34уААщЗНцЦ░ф╕Кч║┐чЪДшКВчВ╣7000цИРф╕║шКВчВ╣7004чЪДф╗ОшКВчВ╣</p> <p>шби17-3х▒Хчд║ф║ЖшКВчВ╣7000хдНхИ╢шКВчВ╣7004ф╣ЛхРОя╝МщЫЖч╛дф╕нхРДф╕кшКВчВ╣чЪДчК╢цАБуАВ</p> <p>шби17-3уААщЫЖч╛дхРДф╕кшКВчВ╣чЪДх╜УхЙНчК╢цАБ</p> <p><img src="https://book-redis-design.netlify.app/images/000155.jpg" alt="img"></p> <p>цЬмшКВцОеф╕ЛцЭечЪДхЖЕхо╣х░Жф╗Лч╗НшКВчВ╣чЪДхдНхИ╢цЦ╣ц│Хя╝МцгАц╡ЛшКВчВ╣цШпхРжф╕Лч║┐чЪДцЦ╣ц│Хя╝Мф╗ехПКхп╣ф╕Лч║┐ф╕╗шКВчВ╣ш┐ЫшбМцХЕщЪЬш╜мчз╗чЪДцЦ╣ц│ХуАВ</p> <h3 id="шо╛ч╜оф╗ОшКВчВ╣"><a href="#шо╛ч╜оф╗ОшКВчВ╣" class="header-anchor">#</a> шо╛ч╜оф╗ОшКВчВ╣</h3> <p>хРСф╕Аф╕кшКВчВ╣хПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>CLUSTER REPLICATE &lt;node_id&gt;
</code></pre></div><p>хПпф╗ешойцОецФ╢хС╜ф╗дчЪДшКВчВ╣цИРф╕║node_idцЙАцМЗхоЪшКВчВ╣чЪДф╗ОшКВчВ╣я╝Мх╣╢х╝АхзЛхп╣ф╕╗шКВчВ╣ш┐ЫшбМхдНхИ╢я╝Ъ</p> <ul><li><p>цОецФ╢хИ░шпехС╜ф╗дчЪДшКВчВ╣щжЦхЕИф╝ЪхЬишЗкх╖▒чЪДclusterState.nodesхнЧхЕ╕ф╕нцЙ╛хИ░node_idцЙАхп╣х║ФшКВчВ╣чЪДclusterNodeч╗УцЮДя╝Мх╣╢х░ЖшЗкх╖▒чЪДclusterState.myself.slaveofцМЗщТИцМЗхРСш┐Щф╕кч╗УцЮДя╝Мф╗ецндцЭешо░х╜Хш┐Щф╕кшКВчВ╣цнгхЬихдНхИ╢чЪДф╕╗шКВчВ╣я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">clusterNode</span> <span class="token punctuation">{</span>

     <span class="token comment">//хжВцЮЬш┐ЩцШпф╕Аф╕кф╗ОшКВчВ╣я╝МщВгф╣ИцМЗхРСф╕╗шКВчВ╣</span>
     <span class="token keyword">struct</span> <span class="token class-name">clusterNode</span> <span class="token operator">*</span>slaveof<span class="token punctuation">;</span>
    
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>чД╢хРОшКВчВ╣ф╝Ъф┐оцФ╣шЗкх╖▒хЬиclusterState.myself.flagsф╕нчЪДх▒ЮцАзя╝МхЕ│щЧнхОЯцЬмчЪДREDIS_NODE_MASTERцаЗшпЖя╝МцЙУх╝АREDIS_NODE_SLAVEцаЗшпЖя╝Мшбичд║ш┐Щф╕кшКВчВ╣х╖▓ч╗ПчФ▒хОЯцЭечЪДф╕╗шКВчВ╣хПШцИРф║Жф╗ОшКВчВ╣уАВ</p></li> <li><p>цЬАхРОя╝МшКВчВ╣ф╝Ъш░ГчФихдНхИ╢ф╗гчаБя╝Мх╣╢ца╣цНоclusterState.myself.slaveofцМЗхРСчЪДclusterNodeч╗УцЮДцЙАф┐ЭхнШчЪДIPхЬ░хЭАхТМчлпхПгхП╖я╝Мхп╣ф╕╗шКВчВ╣ш┐ЫшбМхдНхИ╢уАВхЫаф╕║шКВчВ╣чЪДхдНхИ╢хКЯшГ╜хТМхНХцЬ║RedisцЬНхКбхЩичЪДхдНхИ╢хКЯшГ╜ф╜┐чФиф║ЖчЫ╕хРМчЪДф╗гчаБя╝МцЙАф╗ешойф╗ОшКВчВ╣хдНхИ╢ф╕╗шКВчВ╣чЫ╕х╜Уф║ОхРСф╗ОшКВчВ╣хПСщАБхС╜ф╗дSLAVEOFуАВ</p></li></ul> <p>хЫ╛17-35х▒Хчд║ф║ЖшКВчВ╣7004хЬихдНхИ╢шКВчВ╣7000цЧ╢чЪДclusterStateч╗УцЮДя╝Ъ</p> <ul><li><p>clusterState.myself.flagsх▒ЮцАзчЪДхА╝ф╕║REDIS_NODE_SLAVEя╝Мшбичд║шКВчВ╣7004цШпф╕Аф╕кф╗ОшКВчВ╣уАВ</p></li> <li><p>clusterState.myself.slaveofцМЗщТИцМЗхРСф╗гшбишКВчВ╣7000чЪДч╗УцЮДя╝Мшбичд║шКВчВ╣7004цнгхЬихдНхИ╢чЪДф╕╗шКВчВ╣ф╕║шКВчВ╣7000уАВ</p></li></ul> <p><img src="https://book-redis-design.netlify.app/images/000174.jpg" alt="img"></p> <p>хЫ╛17-35уААшКВчВ╣7004чЪДclusterStateч╗УцЮД</p> <p>ф╕Аф╕кшКВчВ╣цИРф╕║ф╗ОшКВчВ╣я╝Мх╣╢х╝АхзЛхдНхИ╢цЯРф╕кф╕╗шКВчВ╣ш┐Щф╕Аф┐бцБпф╝ЪщАЪш┐Зц╢ИцБпхПСщАБч╗ЩщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣я╝МцЬАч╗ИщЫЖч╛дф╕нчЪДцЙАцЬЙшКВчВ╣щГ╜ф╝ЪчЯещБУцЯРф╕кф╗ОшКВчВ╣цнгхЬихдНхИ╢цЯРф╕кф╕╗шКВчВ╣уАВ</p> <p>щЫЖч╛дф╕нчЪДцЙАцЬЙшКВчВ╣щГ╜ф╝ЪхЬиф╗гшбиф╕╗шКВчВ╣чЪДclusterNodeч╗УцЮДчЪДslavesх▒ЮцАзхТМnumslavesх▒ЮцАзф╕ншо░х╜ХцнгхЬихдНхИ╢ш┐Щф╕кф╕╗шКВчВ╣чЪДф╗ОшКВчВ╣хРНхНХя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>struct clusterNode {
    // 
    // 
цнгхЬихдНхИ╢ш┐Щф╕кф╕╗шКВчВ╣чЪДф╗ОшКВчВ╣цХ░щЗП
    int numslaves;
    // 
ф╕Аф╕кцХ░ч╗Д
    // 
цпПф╕кцХ░ч╗Дщб╣цМЗхРСф╕Аф╕кцнгхЬихдНхИ╢ш┐Щф╕кф╕╗шКВчВ╣чЪДф╗ОшКВчВ╣чЪДclusterNode
ч╗УцЮД
    struct clusterNode **slaves;
    // 
};
</code></pre></div><p>ф╕╛ф╕кф╛ЛхнРя╝МхЫ╛17-36шо░х╜Хф║ЖшКВчВ╣7004хТМшКВчВ╣7005цИРф╕║шКВчВ╣7000чЪДф╗ОшКВчВ╣ф╣ЛхРОя╝МщЫЖч╛дф╕нчЪДхРДф╕кшКВчВ╣ф╕║шКВчВ╣7000хИЫх╗║чЪДclusterNodeч╗УцЮДчЪДца╖хнРя╝Ъ</p> <ul><li><p>ф╗гшбишКВчВ╣7000чЪДclusterNodeч╗УцЮДчЪДnumslavesх▒ЮцАзчЪДхА╝ф╕║2я╝Мш┐Щшп┤цШОцЬЙф╕дф╕кф╗ОшКВчВ╣цнгхЬихдНхИ╢шКВчВ╣7000уАВ</p></li> <li><p>ф╗гшбишКВчВ╣7000чЪДclusterNodeч╗УцЮДчЪДslavesцХ░ч╗ДчЪДф╕дф╕кщб╣хИЖхИлцМЗхРСф╗гшбишКВчВ╣7004хТМф╗гшбишКВчВ╣7005чЪДclusterNodeч╗УцЮДя╝Мш┐Щшп┤цШОшКВчВ╣7000чЪДф╕дф╕кф╗ОшКВчВ╣хИЖхИлцШпшКВчВ╣7004хТМшКВчВ╣7005уАВ</p></li></ul> <p><img src="https://book-redis-design.netlify.app/images/000403.jpg" alt="img"></p> <p>хЫ╛17-36уААщЫЖч╛дф╕нчЪДхРДф╕кшКВчВ╣ф╕║шКВчВ╣7000хИЫх╗║чЪДclusterNodeч╗УцЮД</p> <h3 id="цХЕщЪЬцгАц╡Л"><a href="#цХЕщЪЬцгАц╡Л" class="header-anchor">#</a> цХЕщЪЬцгАц╡Л</h3> <p>щЫЖч╛дф╕нчЪДцпПф╕кшКВчВ╣щГ╜ф╝ЪхоЪцЬЯхЬ░хРСщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣хПСщАБPINGц╢ИцБпя╝Мф╗ецндцЭецгАц╡Лхп╣цЦ╣цШпхРжхЬич║┐я╝МхжВцЮЬцОецФ╢PINGц╢ИцБпчЪДшКВчВ╣ц▓бцЬЙхЬишзДхоЪчЪДцЧ╢щЧ┤хЖЕя╝МхРСхПСщАБPINGц╢ИцБпчЪДшКВчВ╣ш┐ФхЫЮPONGц╢ИцБпя╝МщВгф╣ИхПСщАБPINGц╢ИцБпчЪДшКВчВ╣х░▒ф╝Ъх░ЖцОецФ╢PINGц╢ИцБпчЪДшКВчВ╣цаЗшо░ф╕║чЦСф╝╝ф╕Лч║┐я╝Иprobable failя╝МPFAILя╝ЙуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬшКВчВ╣7001хРСшКВчВ╣7000хПСщАБф║Жф╕АцЭбPINGц╢ИцБпя╝Мф╜ЖцШпшКВчВ╣7000ц▓бцЬЙхЬишзДхоЪчЪДцЧ╢щЧ┤хЖЕя╝МхРСшКВчВ╣7001ш┐ФхЫЮф╕АцЭбPONGц╢ИцБпя╝МщВгф╣ИшКВчВ╣7001х░▒ф╝ЪхЬишЗкх╖▒чЪДclusterState.nodesхнЧхЕ╕ф╕нцЙ╛хИ░шКВчВ╣7000цЙАхп╣х║ФчЪДclusterNodeч╗УцЮДя╝Мх╣╢хЬич╗УцЮДчЪДflagsх▒ЮцАзф╕нцЙУх╝АREDIS_NODE_PFAILцаЗшпЖя╝Мф╗ецндшбичд║шКВчВ╣7000ш┐ЫхЕеф║ЖчЦСф╝╝ф╕Лч║┐чК╢цАБя╝МхжВхЫ╛17-37цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000209.jpg" alt="img"></p> <p>хЫ╛17-37уААф╗гшбишКВчВ╣7000чЪДclusterNodeч╗УцЮД</p> <p>щЫЖч╛дф╕нчЪДхРДф╕кшКВчВ╣ф╝ЪщАЪш┐Зф║ТчЫ╕хПСщАБц╢ИцБпчЪДцЦ╣х╝ПцЭеф║дцНвщЫЖч╛дф╕нхРДф╕кшКВчВ╣чЪДчК╢цАБф┐бцБпя╝Мф╛ЛхжВцЯРф╕кшКВчВ╣цШпхдДф║ОхЬич║┐чК╢цАБуАБчЦСф╝╝ф╕Лч║┐чК╢цАБя╝ИPFAILя╝Йя╝Мш┐ШцШпх╖▓ф╕Лч║┐чК╢цАБя╝ИFAILя╝ЙуАВ</p> <p>х╜Уф╕Аф╕кф╕╗шКВчВ╣AщАЪш┐Зц╢ИцБпх╛ЧчЯеф╕╗шКВчВ╣Bшодф╕║ф╕╗шКВчВ╣Cш┐ЫхЕеф║ЖчЦСф╝╝ф╕Лч║┐чК╢цАБцЧ╢я╝Мф╕╗шКВчВ╣Aф╝ЪхЬишЗкх╖▒чЪДclusterState.nodesхнЧхЕ╕ф╕нцЙ╛хИ░ф╕╗шКВчВ╣CцЙАхп╣х║ФчЪДclusterNodeч╗УцЮДя╝Мх╣╢х░Жф╕╗шКВчВ╣BчЪДф╕Лч║┐цКехСКя╝Иfailure reportя╝Йц╖╗хКахИ░clusterNodeч╗УцЮДчЪДfail_reportsщУ╛шбищЗМщЭвя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>struct clusterNode {
  // 
  // 
ф╕Аф╕кщУ╛шбия╝Мшо░х╜Хф║ЖцЙАцЬЙхЕ╢ф╗ЦшКВчВ╣хп╣шпешКВчВ╣чЪДф╕Лч║┐цКехСК
  list *fail_reports;
  // 
};
</code></pre></div><p>цпПф╕кф╕Лч║┐цКехСКчФ▒ф╕Аф╕кclusterNodeFailReportч╗УцЮДшбичд║я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>struct clusterNodeFailReport {
  // 
цКехСКчЫоцаЗшКВчВ╣х╖▓ч╗Пф╕Лч║┐чЪДшКВчВ╣
  struct clusterNode *node;
  // 
цЬАхРОф╕Ацмбф╗Оnode
шКВчВ╣цФ╢хИ░ф╕Лч║┐цКехСКчЪДцЧ╢щЧ┤
  // 
чиЛх║Пф╜┐чФиш┐Щф╕кцЧ╢щЧ┤цИ│цЭецгАцЯеф╕Лч║┐цКехСКцШпхРжш┐ЗцЬЯ
  // 
я╝Иф╕Ох╜УхЙНцЧ╢щЧ┤чЫ╕х╖охдкф╣ЕчЪДф╕Лч║┐цКехСКф╝ЪшвлхИащЩдя╝Й
  mstime_t time;
} typedef clusterNodeFailReport;
</code></pre></div><p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬф╕╗шКВчВ╣7001хЬицФ╢хИ░ф╕╗шКВчВ╣7002уАБф╕╗шКВчВ╣7003хПСщАБчЪДц╢ИцБпхРОх╛ЧчЯея╝Мф╕╗шКВчВ╣7002хТМф╕╗шКВчВ╣7003щГ╜шодф╕║ф╕╗шКВчВ╣7000ш┐ЫхЕеф║ЖчЦСф╝╝ф╕Лч║┐чК╢цАБя╝МщВгф╣Иф╕╗шКВчВ╣7001х░Жф╕║ф╕╗шКВчВ╣7000хИЫх╗║хЫ╛17-38цЙАчд║чЪДф╕Лч║┐цКехСКуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000348.jpg" alt="img"></p> <p>хЫ╛17-38уААшКВчВ╣7000чЪДф╕Лч║┐цКехСК</p> <p>хжВцЮЬхЬиф╕Аф╕кщЫЖч╛дщЗМщЭвя╝МхНКцХ░ф╗еф╕Кш┤Яш┤гхдДчРЖцз╜чЪДф╕╗шКВчВ╣щГ╜х░ЖцЯРф╕кф╕╗шКВчВ╣xцКехСКф╕║чЦСф╝╝ф╕Лч║┐я╝МщВгф╣Иш┐Щф╕кф╕╗шКВчВ╣xх░ЖшвлцаЗшо░ф╕║х╖▓ф╕Лч║┐я╝ИFAILя╝Йя╝Мх░Жф╕╗шКВчВ╣xцаЗшо░ф╕║х╖▓ф╕Лч║┐чЪДшКВчВ╣ф╝ЪхРСщЫЖч╛дх╣┐цТнф╕АцЭбхЕ│ф║Оф╕╗шКВчВ╣xчЪДFAILц╢ИцБпя╝МцЙАцЬЙцФ╢хИ░ш┐ЩцЭбFAILц╢ИцБпчЪДшКВчВ╣щГ╜ф╝ЪчлЛхН│х░Жф╕╗шКВчВ╣xцаЗшо░ф╕║х╖▓ф╕Лч║┐уАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхЫ╛17-38цЙАчд║чЪДф╕Лч║┐цКехСКцЭешп┤я╝Мф╕╗шКВчВ╣7002хТМф╕╗шКВчВ╣7003щГ╜шодф╕║ф╕╗шКВчВ╣7000ш┐ЫхЕеф║Жф╕Лч║┐чК╢цАБя╝Мх╣╢ф╕Фф╕╗шКВчВ╣7001ф╣Яшодф╕║ф╕╗шКВчВ╣7000ш┐ЫхЕеф║ЖчЦСф╝╝ф╕Лч║┐чК╢цАБя╝Иф╗гшбиф╕╗шКВчВ╣7000чЪДч╗УцЮДцЙУх╝Аф║ЖREDIS_NODE_PFAILцаЗшпЖя╝Йя╝Мч╗╝хРИш╡╖цЭея╝МхЬищЫЖч╛дхЫЫф╕кш┤Яш┤гхдДчРЖцз╜чЪДф╕╗шКВчВ╣щЗМщЭвя╝МцЬЙф╕Йф╕кщГ╜х░Жф╕╗шКВчВ╣7000цаЗшо░ф╕║ф╕Лч║┐я╝МцХ░щЗПх╖▓ч╗Пш╢Еш┐Зф║ЖхНКцХ░я╝МцЙАф╗еф╕╗шКВчВ╣7001ф╝Ъх░Жф╕╗шКВчВ╣7000цаЗшо░ф╕║х╖▓ф╕Лч║┐я╝Мх╣╢хРСщЫЖч╛дх╣┐цТнф╕АцЭбхЕ│ф║Оф╕╗шКВчВ╣7000чЪДFAILц╢ИцБпя╝МхжВхЫ╛17-39цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000284.jpg" alt="img"></p> <p>хЫ╛17-39уААшКВчВ╣7001хРСщЫЖч╛дх╣┐цТнFAILц╢ИцБп</p> <h3 id="цХЕщЪЬш╜мчз╗"><a href="#цХЕщЪЬш╜мчз╗" class="header-anchor">#</a> цХЕщЪЬш╜мчз╗</h3> <p>х╜Уф╕Аф╕кф╗ОшКВчВ╣хПСчО░шЗкх╖▒цнгхЬихдНхИ╢чЪДф╕╗шКВчВ╣ш┐ЫхЕеф║Жх╖▓ф╕Лч║┐чК╢цАБцЧ╢я╝Мф╗ОшКВчВ╣х░Жх╝АхзЛхп╣ф╕Лч║┐ф╕╗шКВчВ╣ш┐ЫшбМцХЕщЪЬш╜мчз╗я╝Мф╗еф╕ЛцШпцХЕщЪЬш╜мчз╗чЪДцЙзшбМцнещкдя╝Ъ</p> <p>1я╝ЙхдНхИ╢ф╕Лч║┐ф╕╗шКВчВ╣чЪДцЙАцЬЙф╗ОшКВчВ╣щЗМщЭвя╝Мф╝ЪцЬЙф╕Аф╕кф╗ОшКВчВ╣швлщАЙф╕нуАВ</p> <p>2я╝ЙшвлщАЙф╕нчЪДф╗ОшКВчВ╣ф╝ЪцЙзшбМSLAVEOF no oneхС╜ф╗дя╝МцИРф╕║цЦ░чЪДф╕╗шКВчВ╣уАВ</p> <p>3я╝ЙцЦ░чЪДф╕╗шКВчВ╣ф╝ЪцТдщФАцЙАцЬЙхп╣х╖▓ф╕Лч║┐ф╕╗шКВчВ╣чЪДцз╜цМЗц┤╛я╝Мх╣╢х░Жш┐Щф║Ыцз╜хЕищГицМЗц┤╛ч╗ЩшЗкх╖▒уАВ</p> <p>4я╝ЙцЦ░чЪДф╕╗шКВчВ╣хРСщЫЖч╛дх╣┐цТнф╕АцЭбPONGц╢ИцБпя╝Мш┐ЩцЭбPONGц╢ИцБпхПпф╗ешойщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣члЛхН│чЯещБУш┐Щф╕кшКВчВ╣х╖▓ч╗ПчФ▒ф╗ОшКВчВ╣хПШцИРф║Жф╕╗шКВчВ╣я╝Мх╣╢ф╕Фш┐Щф╕кф╕╗шКВчВ╣х╖▓ч╗ПцОечобф║ЖхОЯцЬмчФ▒х╖▓ф╕Лч║┐шКВчВ╣ш┤Яш┤гхдДчРЖчЪДцз╜уАВ</p> <p>5я╝ЙцЦ░чЪДф╕╗шКВчВ╣х╝АхзЛцОецФ╢хТМшЗкх╖▒ш┤Яш┤гхдДчРЖчЪДцз╜цЬЙхЕ│чЪДхС╜ф╗дшп╖ц▒Вя╝МцХЕщЪЬш╜мчз╗хоМцИРуАВ</p> <h3 id="щАЙф╕╛цЦ░чЪДф╕╗шКВчВ╣"><a href="#щАЙф╕╛цЦ░чЪДф╕╗шКВчВ╣" class="header-anchor">#</a> щАЙф╕╛цЦ░чЪДф╕╗шКВчВ╣</h3> <p>цЦ░чЪДф╕╗шКВчВ╣цШпщАЪш┐ЗщАЙф╕╛ф║зчФЯчЪДуАВ</p> <p>ф╗еф╕ЛцШпщЫЖч╛дщАЙф╕╛цЦ░чЪДф╕╗шКВчВ╣чЪДцЦ╣ц│Хя╝Ъ</p> <p>1я╝ЙщЫЖч╛дчЪДщЕНч╜оч║кхЕГцШпф╕Аф╕кшЗкхвЮшобцХ░хЩия╝МхоГчЪДхИЭхзЛхА╝ф╕║0уАВ</p> <p>2я╝Йх╜УщЫЖч╛дщЗМчЪДцЯРф╕кшКВчВ╣х╝АхзЛф╕АцмбцХЕщЪЬш╜мчз╗цУНф╜ЬцЧ╢я╝МщЫЖч╛дщЕНч╜оч║кхЕГчЪДхА╝ф╝ЪшвлхвЮф╕АуАВ</p> <p>3я╝Йхп╣ф║ОцпПф╕кщЕНч╜оч║кхЕГя╝МщЫЖч╛дщЗМцпПф╕кш┤Яш┤гхдДчРЖцз╜чЪДф╕╗шКВчВ╣щГ╜цЬЙф╕АцмбцКХчеичЪДцЬ║ф╝Ъя╝МшАМчммф╕Аф╕кхРСф╕╗шКВчВ╣шжБц▒ВцКХчеичЪДф╗ОшКВчВ╣х░ЖшО╖х╛Чф╕╗шКВчВ╣чЪДцКХчеиуАВ</p> <p>4я╝Йх╜Уф╗ОшКВчВ╣хПСчО░шЗкх╖▒цнгхЬихдНхИ╢чЪДф╕╗шКВчВ╣ш┐ЫхЕех╖▓ф╕Лч║┐чК╢цАБцЧ╢я╝Мф╗ОшКВчВ╣ф╝ЪхРСщЫЖч╛дх╣┐цТнф╕АцЭбCLUSTERMSG_TYPE_FAILOVER_AUTH_REQUESTц╢ИцБпя╝МшжБц▒ВцЙАцЬЙцФ╢хИ░ш┐ЩцЭбц╢ИцБпуАБх╣╢ф╕ФхЕ╖цЬЙцКХчеицЭГчЪДф╕╗шКВчВ╣хРСш┐Щф╕кф╗ОшКВчВ╣цКХчеиуАВ</p> <p>5я╝ЙхжВцЮЬф╕Аф╕кф╕╗шКВчВ╣хЕ╖цЬЙцКХчеицЭГя╝ИхоГцнгхЬиш┤Яш┤гхдДчРЖцз╜я╝Йя╝Мх╣╢ф╕Фш┐Щф╕кф╕╗шКВчВ╣х░ЪцЬкцКХчеич╗ЩхЕ╢ф╗Цф╗ОшКВчВ╣я╝МщВгф╣Иф╕╗шКВчВ╣х░ЖхРСшжБц▒ВцКХчеичЪДф╗ОшКВчВ╣ш┐ФхЫЮф╕АцЭбCLUSTERMSG_TYPE_FAILOVER_AUTH_ACKц╢ИцБпя╝Мшбичд║ш┐Щф╕кф╕╗шКВчВ╣цФпцМБф╗ОшКВчВ╣цИРф╕║цЦ░чЪДф╕╗шКВчВ╣уАВ</p> <p>6я╝ЙцпПф╕кхПВф╕ОщАЙф╕╛чЪДф╗ОшКВчВ╣щГ╜ф╝ЪцОецФ╢CLUSTERMSG_TYPE_FAILOVER_AUTH_ACKц╢ИцБпя╝Мх╣╢ца╣цНошЗкх╖▒цФ╢хИ░ф║ЖхдЪх░СцЭбш┐ЩчзНц╢ИцБпцЭеч╗ЯшобшЗкх╖▒шО╖х╛Чф║ЖхдЪх░Сф╕╗шКВчВ╣чЪДцФпцМБуАВ</p> <p>7я╝ЙхжВцЮЬщЫЖч╛дщЗМцЬЙNф╕кхЕ╖цЬЙцКХчеицЭГчЪДф╕╗шКВчВ╣я╝МщВгф╣Их╜Уф╕Аф╕кф╗ОшКВчВ╣цФ╢щЫЖхИ░хдзф║ОчнЙф║ОN/2+1х╝ацФпцМБчеицЧ╢я╝Мш┐Щф╕кф╗ОшКВчВ╣х░▒ф╝Ъх╜УщАЙф╕║цЦ░чЪДф╕╗шКВчВ╣уАВ</p> <p>8я╝ЙхЫаф╕║хЬицпПф╕Аф╕кщЕНч╜оч║кхЕГщЗМщЭвя╝МцпПф╕кхЕ╖цЬЙцКХчеицЭГчЪДф╕╗шКВчВ╣хПкшГ╜цКХф╕Ацмбчеия╝МцЙАф╗ехжВцЮЬцЬЙNф╕кф╕╗шКВчВ╣ш┐ЫшбМцКХчеия╝МщВгф╣ИхЕ╖цЬЙхдзф║ОчнЙф║ОN/2+1х╝ацФпцМБчеичЪДф╗ОшКВчВ╣хПкф╝ЪцЬЙф╕Аф╕кя╝Мш┐Щчбоф┐Эф║ЖцЦ░чЪДф╕╗шКВчВ╣хПкф╝ЪцЬЙф╕Аф╕куАВ</p> <p>9я╝ЙхжВцЮЬхЬиф╕Аф╕кщЕНч╜оч║кхЕГщЗМщЭвц▓бцЬЙф╗ОшКВчВ╣шГ╜цФ╢щЫЖхИ░ш╢│хдЯхдЪчЪДцФпцМБчеия╝МщВгф╣ИщЫЖч╛дш┐ЫхЕеф╕Аф╕кцЦ░чЪДщЕНч╜оч║кхЕГя╝Мх╣╢хЖНцмбш┐ЫшбМщАЙф╕╛я╝МчЫ┤хИ░щАЙхЗ║цЦ░чЪДф╕╗шКВчВ╣ф╕║цнвуАВ</p> <p>ш┐Щф╕кщАЙф╕╛цЦ░ф╕╗шКВчВ╣чЪДцЦ╣ц│ХхТМчмм16члаф╗Лч╗НчЪДщАЙф╕╛щвЖхд┤SentinelчЪДцЦ╣ц│ХщЭЮх╕╕чЫ╕ф╝╝я╝МхЫаф╕║ф╕дшАЕщГ╜цШпхЯ║ф║ОRaftчоЧц│ХчЪДщвЖхд┤щАЙф╕╛я╝Иleader electionя╝ЙцЦ╣ц│ХцЭехоЮчО░чЪДуАВ</p> <h2 id="ц╢ИцБп"><a href="#ц╢ИцБп" class="header-anchor">#</a> ц╢ИцБп</h2> <p>щЫЖч╛дф╕нчЪДхРДф╕кшКВчВ╣щАЪш┐ЗхПСщАБхТМцОецФ╢ц╢ИцБпя╝Иmessageя╝ЙцЭеш┐ЫшбМщАЪф┐бя╝МцИСф╗мчз░хПСщАБц╢ИцБпчЪДшКВчВ╣ф╕║хПСщАБшАЕя╝Иsenderя╝Йя╝МцОецФ╢ц╢ИцБпчЪДшКВчВ╣ф╕║цОецФ╢шАЕя╝Иreceiverя╝Йя╝МхжВхЫ╛17-40цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000262.jpg" alt="img"></p> <p>хЫ╛17-40уААхПСщАБшАЕхТМцОецФ╢шАЕ</p> <p>шКВчВ╣хПСщАБчЪДц╢ИцБпф╕╗шжБцЬЙф╗еф╕Лф║ФчзНя╝Ъ</p> <ul><li><p>MEETц╢ИцБпя╝Ъх╜УхПСщАБшАЕцОехИ░ховцИ╖члпхПСщАБчЪДCLUSTER MEETхС╜ф╗дцЧ╢я╝МхПСщАБшАЕф╝ЪхРСцОецФ╢шАЕхПСщАБMEETц╢ИцБпя╝Мшп╖ц▒ВцОецФ╢шАЕхКахЕехИ░хПСщАБшАЕх╜УхЙНцЙАхдДчЪДщЫЖч╛дщЗМщЭвуАВ</p></li> <li><p>PINGц╢ИцБпя╝ЪщЫЖч╛дщЗМчЪДцпПф╕кшКВчВ╣щ╗ШшодцпПщЪФф╕АчзТщТЯх░▒ф╝Ъф╗Ох╖▓чЯешКВчВ╣хИЧшбиф╕нщЪПцЬ║щАЙхЗ║ф║Фф╕кшКВчВ╣я╝МчД╢хРОхп╣ш┐Щф║Фф╕кшКВчВ╣ф╕нцЬАщХ┐цЧ╢щЧ┤ц▓бцЬЙхПСщАБш┐ЗPINGц╢ИцБпчЪДшКВчВ╣хПСщАБPINGц╢ИцБпя╝Мф╗ецндцЭецгАц╡ЛшвлщАЙф╕нчЪДшКВчВ╣цШпхРжхЬич║┐уАВщЩдцндф╣ЛхдЦя╝МхжВцЮЬшКВчВ╣AцЬАхРОф╕АцмбцФ╢хИ░шКВчВ╣BхПСщАБчЪДPONGц╢ИцБпчЪДцЧ╢щЧ┤я╝Мш╖Эчж╗х╜УхЙНцЧ╢щЧ┤х╖▓ч╗Пш╢Еш┐Зф║ЖшКВчВ╣AчЪДcluster-node-timeoutщАЙщб╣шо╛ч╜оцЧ╢щХ┐чЪДф╕АхНКя╝МщВгф╣ИшКВчВ╣Aф╣Яф╝ЪхРСшКВчВ╣BхПСщАБPINGц╢ИцБпя╝Мш┐ЩхПпф╗ещШ▓цнвшКВчВ╣AхЫаф╕║щХ┐цЧ╢щЧ┤ц▓бцЬЙщЪПцЬ║щАЙф╕ншКВчВ╣Bф╜Ьф╕║PINGц╢ИцБпчЪДхПСщАБхп╣ш▒бшАМхп╝шЗ┤хп╣шКВчВ╣BчЪДф┐бцБпцЫ┤цЦ░ц╗ЮхРОуАВ</p></li> <li><p>PONGц╢ИцБпя╝Ъх╜УцОецФ╢шАЕцФ╢хИ░хПСщАБшАЕхПСцЭечЪДMEETц╢ИцБпцИЦшАЕPINGц╢ИцБпцЧ╢я╝Мф╕║ф║ЖхРСхПСщАБшАЕчбошодш┐ЩцЭбMEETц╢ИцБпцИЦшАЕPINGц╢ИцБпх╖▓хИ░ш╛╛я╝МцОецФ╢шАЕф╝ЪхРСхПСщАБшАЕш┐ФхЫЮф╕АцЭбPONGц╢ИцБпуАВхПжхдЦя╝Мф╕Аф╕кшКВчВ╣ф╣ЯхПпф╗ещАЪш┐ЗхРСщЫЖч╛дх╣┐цТншЗкх╖▒чЪДPONGц╢ИцБпцЭешойщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣члЛхН│хИ╖цЦ░хЕ│ф║Ош┐Щф╕кшКВчВ╣чЪДшодшпЖя╝Мф╛ЛхжВх╜Уф╕АцмбцХЕщЪЬш╜мчз╗цУНф╜ЬцИРхКЯцЙзшбМф╣ЛхРОя╝МцЦ░чЪДф╕╗шКВчВ╣ф╝ЪхРСщЫЖч╛дх╣┐цТнф╕АцЭбPONGц╢ИцБпя╝Мф╗ецндцЭешойщЫЖч╛дф╕нчЪДхЕ╢ф╗ЦшКВчВ╣члЛхН│чЯещБУш┐Щф╕кшКВчВ╣х╖▓ч╗ПхПШцИРф║Жф╕╗шКВчВ╣я╝Мх╣╢ф╕ФцОечобф║Жх╖▓ф╕Лч║┐шКВчВ╣ш┤Яш┤гчЪДцз╜уАВ</p></li> <li><p>FAILц╢ИцБпя╝Ъх╜Уф╕Аф╕кф╕╗шКВчВ╣AхИдцЦнхПжф╕Аф╕кф╕╗шКВчВ╣Bх╖▓ч╗Пш┐ЫхЕеFAILчК╢цАБцЧ╢я╝МшКВчВ╣Aф╝ЪхРСщЫЖч╛дх╣┐цТнф╕АцЭбхЕ│ф║ОшКВчВ╣BчЪДFAILц╢ИцБпя╝МцЙАцЬЙцФ╢хИ░ш┐ЩцЭбц╢ИцБпчЪДшКВчВ╣щГ╜ф╝ЪчлЛхН│х░ЖшКВчВ╣BцаЗшо░ф╕║х╖▓ф╕Лч║┐уАВ</p></li> <li><p>PUBLISHц╢ИцБпя╝Ъх╜УшКВчВ╣цОецФ╢хИ░ф╕Аф╕кPUBLISHхС╜ф╗дцЧ╢я╝МшКВчВ╣ф╝ЪцЙзшбМш┐Щф╕кхС╜ф╗дя╝Мх╣╢хРСщЫЖч╛дх╣┐цТнф╕АцЭбPUBLISHц╢ИцБпя╝МцЙАцЬЙцОецФ╢хИ░ш┐ЩцЭбPUBLISHц╢ИцБпчЪДшКВчВ╣щГ╜ф╝ЪцЙзшбМчЫ╕хРМчЪДPUBLISHхС╜ф╗дуАВ</p></li></ul> <p>ф╕АцЭбц╢ИцБпчФ▒ц╢ИцБпхд┤я╝Иheaderя╝ЙхТМц╢ИцБпцнгцЦЗя╝Иdataя╝Йч╗ДцИРя╝МцОеф╕ЛцЭечЪДхЖЕхо╣х░ЖщжЦхЕИф╗Лч╗Нц╢ИцБпхд┤я╝МчД╢хРОхЖНхИЖхИлф╗Лч╗Нф╕КщЭвцПРхИ░чЪДф║ФчзНф╕НхРМч▒╗хЮЛчЪДц╢ИцБпцнгцЦЗуАВ</p> <h3 id="ц╢ИцБпхд┤"><a href="#ц╢ИцБпхд┤" class="header-anchor">#</a> ц╢ИцБпхд┤</h3> <p>шКВчВ╣хПСщАБчЪДцЙАцЬЙц╢ИцБпщГ╜чФ▒ф╕Аф╕кц╢ИцБпхд┤хМЕшг╣я╝Мц╢ИцБпхд┤щЩдф║ЖхМЕхРлц╢ИцБпцнгцЦЗф╣ЛхдЦя╝Мш┐Шшо░х╜Хф║Жц╢ИцБпхПСщАБшАЕшЗкш║лчЪДф╕Аф║Ыф┐бцБпя╝МхЫаф╕║ш┐Щф║Ыф┐бцБпф╣Яф╝Ъшвлц╢ИцБпцОецФ╢шАЕчФихИ░я╝МцЙАф╗еф╕еца╝цЭешо▓я╝МцИСф╗мхПпф╗ешодф╕║ц╢ИцБпхд┤цЬмш║лф╣ЯцШпц╢ИцБпчЪДф╕АщГихИЖуАВ</p> <p>цпПф╕кц╢ИцБпхд┤щГ╜чФ▒ф╕Аф╕кcluster.h/clusterMsgч╗УцЮДшбичд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  <span class="token comment">// ц╢ИцБпчЪДщХ┐х║жя╝ИхМЕцЛмш┐Щф╕кц╢ИцБпхд┤чЪДщХ┐х║жхТМц╢ИцБпцнгцЦЗчЪДщХ┐х║жя╝Й</span>
  <span class="token class-name">uint32_t</span> totlen<span class="token punctuation">;</span>
  <span class="token comment">// ц╢ИцБпчЪДч▒╗хЮЛ</span>
  <span class="token class-name">uint16_t</span> type<span class="token punctuation">;</span>
  <span class="token comment">// ц╢ИцБпцнгцЦЗхМЕхРлчЪДшКВчВ╣ф┐бцБпцХ░щЗП</span>
  <span class="token comment">// хПкхЬихПСщАБMEETуАБPINGуАБPONGш┐Щф╕ЙчзНGossipхНПшооц╢ИцБпцЧ╢ф╜┐чФи</span>
  <span class="token class-name">uint16_t</span> count<span class="token punctuation">;</span>
  <span class="token comment">// хПСщАБшАЕцЙАхдДчЪДщЕНч╜оч║кхЕГ</span>
  <span class="token class-name">uint64_t</span> currentEpoch<span class="token punctuation">;</span>
 <span class="token comment">// хжВцЮЬхПСщАБшАЕцШпф╕Аф╕кф╕╗шКВчВ╣я╝МщВгф╣Иш┐ЩщЗМшо░х╜ХчЪДцШпхПСщАБшАЕчЪДщЕНч╜оч║кхЕГ</span>
  <span class="token comment">// хжВцЮЬхПСщАБшАЕцШпф╕Аф╕кф╗ОшКВчВ╣я╝МщВгф╣Иш┐ЩщЗМшо░х╜ХчЪДцШпхПСщАБшАЕцнгхЬихдНхИ╢чЪДф╕╗шКВчВ╣чЪДщЕНч╜оч║кхЕГ</span>
  <span class="token class-name">uint64_t</span> configEpoch<span class="token punctuation">;</span>
  <span class="token comment">// хПСщАБшАЕчЪДхРНхнЧя╝ИID</span>
я╝Й 
  <span class="token keyword">char</span> sender<span class="token punctuation">[</span>REDIS_CLUSTER_NAMELEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// хПСщАБшАЕчЫохЙНчЪДцз╜цМЗц┤╛ф┐бцБп</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> myslots<span class="token punctuation">[</span>REDIS_CLUSTER_SLOTS<span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// хжВцЮЬхПСщАБшАЕцШпф╕Аф╕кф╗ОшКВчВ╣я╝МщВгф╣Иш┐ЩщЗМшо░х╜ХчЪДцШпхПСщАБшАЕцнгхЬихдНхИ╢чЪДф╕╗шКВчВ╣чЪДхРНхнЧ</span>
  <span class="token comment">// хжВцЮЬхПСщАБшАЕцШпф╕Аф╕кф╕╗шКВчВ╣я╝МщВгф╣Иш┐ЩщЗМшо░х╜ХчЪДцШпREDIS_NODE_NULL_NAME</span>
  <span class="token comment">// я╝Иф╕Аф╕к40хнЧшКВщХ┐я╝МхА╝хЕиф╕║0чЪДхнЧшКВцХ░ч╗Дя╝Й</span>
  <span class="token keyword">char</span> slaveof<span class="token punctuation">[</span>REDIS_CLUSTER_NAMELEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// хПСщАБшАЕчЪДчлпхПгхП╖</span>
  <span class="token class-name">uint16_t</span> port<span class="token punctuation">;</span>
  <span class="token comment">// хПСщАБшАЕчЪДцаЗшпЖхА╝</span>
  <span class="token class-name">uint16_t</span> flags<span class="token punctuation">;</span>
  <span class="token comment">// хПСщАБшАЕцЙАхдДщЫЖч╛дчЪДчК╢цАБ</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> state<span class="token punctuation">;</span>
  <span class="token comment">// ц╢ИцБпчЪДцнгцЦЗя╝ИцИЦшАЕшп┤я╝МхЖЕхо╣я╝Й</span>
  <span class="token keyword">union</span> clusterMsgData data<span class="token punctuation">;</span>
<span class="token punctuation">}</span> clusterMsg<span class="token punctuation">;</span>
</code></pre></div><p>clusterMsg.dataх▒ЮцАзцМЗхРСшБФхРИcluster.h/clusterMsgDataя╝Мш┐Щф╕кшБФхРИх░▒цШпц╢ИцБпчЪДцнгцЦЗя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">union</span> clusterMsgData <span class="token punctuation">{</span>
  <span class="token comment">// MEETуАБPINGуАБPONGц╢ИцБпчЪДцнгцЦЗ</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// цпПцЭбMEETуАБPINGуАБPONGц╢ИцБпщГ╜хМЕхРлф╕дф╕к</span>
    <span class="token comment">// clusterMsgDataGossipч╗УцЮД</span>
    clusterMsgDataGossip gossip<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> ping<span class="token punctuation">;</span>
  <span class="token comment">// FAILц╢ИцБпчЪДцнгцЦЗ</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    clusterMsgDataFail about<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> fail<span class="token punctuation">;</span>
  <span class="token comment">// PUBLISHц╢ИцБпчЪДцнгцЦЗ</span>
  <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    clusterMsgDataPublish msg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> publish<span class="token punctuation">;</span>
  <span class="token comment">// хЕ╢ф╗Цц╢ИцБпчЪДцнгцЦЗ</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>clusterMsgч╗УцЮДчЪДcurrentEpochуАБsenderуАБmyslotsчнЙх▒ЮцАзшо░х╜Хф║ЖхПСщАБшАЕшЗкш║лчЪДшКВчВ╣ф┐бцБпя╝МцОецФ╢шАЕф╝Ъца╣цНош┐Щф║Ыф┐бцБпя╝МхЬишЗкх╖▒чЪДclusterState.nodesхнЧхЕ╕щЗМцЙ╛хИ░хПСщАБшАЕхп╣х║ФчЪДclusterNodeч╗УцЮДя╝Мх╣╢хп╣ч╗УцЮДш┐ЫшбМцЫ┤цЦ░уАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝МщАЪш┐Зхп╣цпФцОецФ╢шАЕф╕║хПСщАБшАЕшо░х╜ХчЪДцз╜цМЗц┤╛ф┐бцБпя╝Мф╗ехПКхПСщАБшАЕхЬиц╢ИцБпхд┤чЪДmyslotsх▒ЮцАзшо░х╜ХчЪДцз╜цМЗц┤╛ф┐бцБпя╝МцОецФ╢шАЕхПпф╗ечЯещБУхПСщАБшАЕчЪДцз╜цМЗц┤╛ф┐бцБпцШпхРжхПСчФЯф║ЖхПШхМЦуАВ</p> <p>хПИцИЦшАЕшп┤я╝МщАЪш┐Зхп╣цпФцОецФ╢шАЕф╕║хПСщАБшАЕшо░х╜ХчЪДцаЗшпЖхА╝я╝Мф╗ехПКхПСщАБшАЕхЬиц╢ИцБпхд┤чЪДflagsх▒ЮцАзшо░х╜ХчЪДцаЗшпЖхА╝я╝МцОецФ╢шАЕхПпф╗ечЯещБУхПСщАБшАЕчЪДчК╢цАБхТМшзТшЙ▓цШпхРжхПСчФЯф║ЖхПШхМЦя╝Мф╛ЛхжВшКВчВ╣чК╢цАБчФ▒хОЯцЭечЪДхЬич║┐хПШцИРф║Жф╕Лч║┐я╝МцИЦшАЕчФ▒ф╕╗шКВчВ╣хПШцИРф║Жф╗ОшКВчВ╣чнЙчнЙуАВ</p> <h3 id="meetуАБpingуАБpongц╢ИцБпчЪДхоЮчО░"><a href="#meetуАБpingуАБpongц╢ИцБпчЪДхоЮчО░" class="header-anchor">#</a> MEETуАБPINGуАБPONGц╢ИцБпчЪДхоЮчО░</h3> <p>RedisщЫЖч╛дф╕нчЪДхРДф╕кшКВчВ╣щАЪш┐З<code>Gossip</code>хНПшооцЭеф║дцНвхРДшЗкхЕ│ф║Оф╕НхРМшКВчВ╣чЪДчК╢цАБф┐бцБпя╝МхЕ╢ф╕нGossipхНПшоочФ▒<code>MEET</code>уАБ<code>PING</code>уАБ<code>PONG</code>ф╕ЙчзНц╢ИцБпхоЮчО░я╝Мш┐Щф╕ЙчзНц╢ИцБпчЪДцнгцЦЗщГ╜чФ▒ф╕дф╕кcluster.h/clusterMsgDataGossipч╗УцЮДч╗ДцИРя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>union clusterMsgData {
  // 
  // MEETуАБPINGхТМPONGц╢ИцБпчЪДцнгцЦЗ
  struct {
    // цпПцЭбMEETуАБPINGуАБPONGц╢ИцБпщГ╜хМЕхРлф╕дф╕к
    // clusterMsgDataGossipч╗УцЮД
    clusterMsgDataGossip gossip[1];
  } ping;
  // хЕ╢ф╗Цц╢ИцБпчЪДцнгцЦЗ 
};

</code></pre></div><p>хЫаф╕║MEETуАБPINGуАБPONGф╕ЙчзНц╢ИцБпщГ╜ф╜┐чФичЫ╕хРМчЪДц╢ИцБпцнгцЦЗя╝МцЙАф╗ешКВчВ╣щАЪш┐Зц╢ИцБпхд┤чЪДtypeх▒ЮцАзцЭехИдцЦнф╕АцЭбц╢ИцБпцШпMEETц╢ИцБпуАБPINGц╢ИцБпш┐ШцШпPONGц╢ИцБпуАВ</p> <p>цпПцмбхПСщАБMEETуАБPINGуАБPONGц╢ИцБпцЧ╢я╝МхПСщАБшАЕщГ╜ф╗ОшЗкх╖▒чЪДх╖▓чЯешКВчВ╣хИЧшбиф╕нщЪПцЬ║щАЙхЗ║ф╕дф╕кшКВчВ╣я╝ИхПпф╗ецШпф╕╗шКВчВ╣цИЦшАЕф╗ОшКВчВ╣я╝Йя╝Мх╣╢х░Жш┐Щф╕дф╕кшвлщАЙф╕ншКВчВ╣чЪДф┐бцБпхИЖхИлф┐ЭхнШхИ░ф╕дф╕кclusterMsgDataGossipч╗УцЮДщЗМщЭвуАВ</p> <p>clusterMsgDataGossipч╗УцЮДшо░х╜Хф║ЖшвлщАЙф╕ншКВчВ╣чЪДхРНхнЧя╝МхПСщАБшАЕф╕ОшвлщАЙф╕ншКВчВ╣цЬАхРОф╕АцмбхПСщАБхТМцОецФ╢PINGц╢ИцБпхТМPONGц╢ИцБпчЪДцЧ╢щЧ┤цИ│я╝МшвлщАЙф╕ншКВчВ╣чЪДIPхЬ░хЭАхТМчлпхПгхП╖я╝Мф╗ехПКшвлщАЙф╕ншКВчВ╣чЪДцаЗшпЖхА╝я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>typedef struct {
  // шКВчВ╣чЪДхРНхнЧ
  char nodename[REDIS_CLUSTER_NAMELEN];
  // цЬАхРОф╕АцмбхРСшпешКВчВ╣хПСщАБPINGц╢ИцБпчЪДцЧ╢щЧ┤цИ│
  uint32_t ping_sent;
  // цЬАхРОф╕Ацмбф╗ОшпешКВчВ╣цОецФ╢хИ░PONGц╢ИцБпчЪДцЧ╢щЧ┤цИ│
  uint32_t pong_received;
  // шКВчВ╣чЪДIPхЬ░хЭА
  char ip[16];
  // шКВчВ╣чЪДчлпхПгхП╖
  uint16_t port;
  // шКВчВ╣чЪДцаЗшпЖхА╝
  uint16_t flags;
} clusterMsgDataGossip;
</code></pre></div><p>х╜УцОецФ╢шАЕцФ╢хИ░MEETуАБPINGуАБPONGц╢ИцБпцЧ╢я╝МцОецФ╢шАЕф╝Ъшо┐щЧоц╢ИцБпцнгцЦЗф╕нчЪДф╕дф╕кclusterMsgDataGossipч╗УцЮДя╝Мх╣╢ца╣цНошЗкх╖▒цШпхРжшодшпЖclusterMsgDataGossipч╗УцЮДф╕ншо░х╜ХчЪДшвлщАЙф╕ншКВчВ╣цЭещАЙцЛйш┐ЫшбМхУкчзНцУНф╜Ья╝Ъ</p> <ul><li><p>хжВцЮЬшвлщАЙф╕ншКВчВ╣ф╕НхнШхЬиф║ОцОецФ╢шАЕчЪДх╖▓чЯешКВчВ╣хИЧшбия╝МщВгф╣Ишп┤цШОцОецФ╢шАЕцШпчммф╕АцмбцОешзжхИ░швлщАЙф╕ншКВчВ╣я╝МцОецФ╢шАЕх░Жца╣цНоч╗УцЮДф╕ншо░х╜ХчЪДIPхЬ░хЭАхТМчлпхПгхП╖чнЙф┐бцБпя╝Мф╕ОшвлщАЙф╕ншКВчВ╣ш┐ЫшбМцПбцЙЛуАВ</p></li> <li><p>хжВцЮЬшвлщАЙф╕ншКВчВ╣х╖▓ч╗ПхнШхЬиф║ОцОецФ╢шАЕчЪДх╖▓чЯешКВчВ╣хИЧшбия╝МщВгф╣Ишп┤цШОцОецФ╢шАЕф╣ЛхЙНх╖▓ч╗Пф╕ОшвлщАЙф╕ншКВчВ╣ш┐ЫшбМш┐ЗцОешзжя╝МцОецФ╢шАЕх░Жца╣цНоclusterMsgDataGossipч╗УцЮДшо░х╜ХчЪДф┐бцБпя╝Мхп╣швлщАЙф╕ншКВчВ╣цЙАхп╣х║ФчЪДclusterNodeч╗УцЮДш┐ЫшбМцЫ┤цЦ░уАВ</p></li></ul> <p>ф╕╛ф╕кхПСщАБPINGц╢ИцБпхТМш┐ФхЫЮPONGц╢ИцБпчЪДф╛ЛхнРя╝МхБЗшо╛хЬиф╕Аф╕кхМЕхРлAуАБBуАБCуАБDуАБEуАБFхЕнф╕кшКВчВ╣чЪДщЫЖч╛дщЗМя╝Ъ</p> <ul><li><p>шКВчВ╣AхРСшКВчВ╣DхПСщАБPINGц╢ИцБпя╝Мх╣╢ф╕Фц╢ИцБпщЗМщЭвхМЕхРлф║ЖшКВчВ╣BхТМшКВчВ╣CчЪДф┐бцБпя╝Мх╜УшКВчВ╣DцФ╢хИ░ш┐ЩцЭбPINGц╢ИцБпцЧ╢я╝МхоГх░ЖцЫ┤цЦ░шЗкх╖▒хп╣шКВчВ╣BхТМшКВчВ╣CчЪДшодшпЖуАВ</p></li> <li><p>ф╣ЛхРОя╝МшКВчВ╣Dх░ЖхРСшКВчВ╣Aш┐ФхЫЮф╕АцЭбPONGц╢ИцБпя╝Мх╣╢ф╕Фц╢ИцБпщЗМщЭвхМЕхРлф║ЖшКВчВ╣EхТМшКВчВ╣FчЪДц╢ИцБпя╝Мх╜УшКВчВ╣AцФ╢хИ░ш┐ЩцЭбPONGц╢ИцБпцЧ╢я╝МхоГх░ЖцЫ┤цЦ░шЗкх╖▒хп╣шКВчВ╣EхТМшКВчВ╣FчЪДшодшпЖуАВ</p></li></ul> <p>цХ┤ф╕кщАЪф┐бш┐ЗчиЛхжВхЫ╛17-41цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000268.jpg" alt="img"></p> <p>хЫ╛17-41уААф╕Аф╕кPING-PONGц╢ИцБпщАЪф┐бчд║ф╛Л</p> <h3 id="failц╢ИцБпчЪДхоЮчО░"><a href="#failц╢ИцБпчЪДхоЮчО░" class="header-anchor">#</a> FAILц╢ИцБпчЪДхоЮчО░</h3> <p>х╜УщЫЖч╛дщЗМчЪДф╕╗шКВчВ╣Aх░Жф╕╗шКВчВ╣BцаЗшо░ф╕║х╖▓ф╕Лч║┐я╝ИFAILя╝ЙцЧ╢я╝Мф╕╗шКВчВ╣Aх░ЖхРСщЫЖч╛дх╣┐цТнф╕АцЭбхЕ│ф║Оф╕╗шКВчВ╣BчЪДFAILц╢ИцБпя╝МцЙАцЬЙцОецФ╢хИ░ш┐ЩцЭбFAILц╢ИцБпчЪДшКВчВ╣щГ╜ф╝Ъх░Жф╕╗шКВчВ╣BцаЗшо░ф╕║х╖▓ф╕Лч║┐уАВ</p> <p>хЬищЫЖч╛дчЪДшКВчВ╣цХ░щЗПцпФш╛ГхдзчЪДцГЕхЖ╡ф╕Ля╝МхНХч║пф╜┐чФиGossipхНПшооцЭеф╝ацТншКВчВ╣чЪДх╖▓ф╕Лч║┐ф┐бцБпф╝Ъч╗ЩшКВчВ╣чЪДф┐бцБпцЫ┤цЦ░х╕жцЭеф╕АхоЪх╗╢ш┐Яя╝МхЫаф╕║GossipхНПшооц╢ИцБпщАЪх╕╕щЬАшжБф╕Ацо╡цЧ╢щЧ┤цЙНшГ╜ф╝ацТншЗ│цХ┤ф╕кщЫЖч╛дя╝МшАМхПСщАБFAILц╢ИцБпхПпф╗ешойщЫЖч╛дщЗМчЪДцЙАцЬЙшКВчВ╣члЛхН│чЯещБУцЯРф╕кф╕╗шКВчВ╣х╖▓ф╕Лч║┐я╝Мф╗ОшАМх░╜х┐лхИдцЦнцШпхРжщЬАшжБх░ЖщЫЖч╛дцаЗшо░ф╕║ф╕Лч║┐я╝МхПИцИЦшАЕхп╣ф╕Лч║┐ф╕╗шКВчВ╣ш┐ЫшбМцХЕщЪЬш╜мчз╗уАВ</p> <p>FAILц╢ИцБпчЪДцнгцЦЗчФ▒cluster.h/clusterMsgDataFailч╗УцЮДшбичд║я╝Мш┐Щф╕кч╗УцЮДхПкхМЕхРлф╕Аф╕кnodenameх▒ЮцАзя╝Мшпех▒ЮцАзшо░х╜Хф║Жх╖▓ф╕Лч║┐шКВчВ╣чЪДхРНхнЧя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>typedef struct {
    char nodename[REDIS_CLUSTER_NAMELEN];
} clusterMsgDataFail;
</code></pre></div><p>хЫаф╕║щЫЖч╛дщЗМчЪДцЙАцЬЙшКВчВ╣щГ╜цЬЙф╕Аф╕кчЛмф╕АцЧаф║МчЪДхРНхнЧя╝МцЙАф╗еFAILц╢ИцБпщЗМщЭвхПкщЬАшжБф┐ЭхнШф╕Лч║┐шКВчВ╣чЪДхРНхнЧя╝МцОецФ╢хИ░ц╢ИцБпчЪДшКВчВ╣х░▒хПпф╗еца╣цНош┐Щф╕кхРНхнЧцЭехИдцЦнцШпхУкф╕кшКВчВ╣ф╕Лч║┐ф║ЖуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхМЕхРл7000уАБ7001уАБ7002уАБ7003хЫЫф╕кф╕╗шКВчВ╣чЪДщЫЖч╛дцЭешп┤я╝Ъ</p> <ul><li><p>хжВцЮЬф╕╗шКВчВ╣7001хПСчО░ф╕╗шКВчВ╣7000х╖▓ф╕Лч║┐я╝МщВгф╣Иф╕╗шКВчВ╣7001х░ЖхРСф╕╗шКВчВ╣7002хТМф╕╗шКВчВ╣7003хПСщАБFAILц╢ИцБпя╝МхЕ╢ф╕нFAILц╢ИцБпф╕нхМЕхРлчЪДшКВчВ╣хРНхнЧф╕║ф╕╗шКВчВ╣7000чЪДхРНхнЧя╝Мф╗ецндцЭешбичд║ф╕╗шКВчВ╣7000х╖▓ф╕Лч║┐уАВ</p></li> <li><p>х╜Уф╕╗шКВчВ╣7002хТМф╕╗шКВчВ╣7003щГ╜цОецФ╢хИ░ф╕╗шКВчВ╣7001хПСщАБчЪДFAILц╢ИцБпцЧ╢я╝МхоГф╗мф╣Яф╝Ъх░Жф╕╗шКВчВ╣7000цаЗшо░ф╕║х╖▓ф╕Лч║┐уАВ</p></li> <li><p>хЫаф╕║ш┐ЩцЧ╢щЫЖч╛дх╖▓ч╗ПцЬЙш╢Еш┐Зф╕АхНКчЪДф╕╗шКВчВ╣шодф╕║ф╕╗шКВчВ╣7000х╖▓ф╕Лч║┐я╝МцЙАф╗ещЫЖч╛дхЙйф╕ЛчЪДхЗаф╕кф╕╗шКВчВ╣хПпф╗ехИдцЦнцШпхРжщЬАшжБх░ЖщЫЖч╛дцаЗшо░ф╕║ф╕Лч║┐я╝МхПИцИЦшАЕх╝АхзЛхп╣ф╕╗шКВчВ╣7000ш┐ЫшбМцХЕщЪЬш╜мчз╗уАВ</p></li></ul> <p>хЫ╛17-42шЗ│хЫ╛17-44х▒Хчд║ф║ЖшКВчВ╣хПСщАБхТМцОецФ╢FAILц╢ИцБпчЪДцХ┤ф╕кш┐ЗчиЛуАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000272.jpg" alt="img"></p> <p>хЫ╛17-42уААшКВчВ╣7001х░ЖшКВчВ╣7000цаЗшо░ф╕║х╖▓ф╕Лч║┐</p> <p><img src="https://book-redis-design.netlify.app/images/000358.jpg" alt="img"></p> <p>хЫ╛17-43уААшКВчВ╣7001хРСщЫЖч╛дх╣┐цТнFAILц╢ИцБп</p> <p><img src="https://book-redis-design.netlify.app/images/000019.jpg" alt="img"></p> <p>хЫ╛17-44уААшКВчВ╣7002хТМшКВчВ╣7003ф╣Ях░ЖшКВчВ╣7000цаЗшо░ф╕║х╖▓ф╕Лч║┐</p> <h3 id="publishц╢ИцБпчЪДхоЮчО░"><a href="#publishц╢ИцБпчЪДхоЮчО░" class="header-anchor">#</a> PUBLISHц╢ИцБпчЪДхоЮчО░</h3> <p>х╜УховцИ╖члпхРСщЫЖч╛дф╕нчЪДцЯРф╕кшКВчВ╣хПСщАБхС╜ф╗д</p> <div class="language- extra-class"><pre class="language-text"><code>PUBLISH &lt;channel&gt; &lt;message&gt;
</code></pre></div><p>чЪДцЧ╢хАЩя╝МцОецФ╢хИ░PUBLISHхС╜ф╗дчЪДшКВчВ╣ф╕Нф╗Еф╝ЪхРСchannelщвСщБУхПСщАБц╢ИцБпmessageя╝МхоГш┐Шф╝ЪхРСщЫЖч╛дх╣┐цТнф╕АцЭбPUBLISHц╢ИцБпя╝МцЙАцЬЙцОецФ╢хИ░ш┐ЩцЭбPUBLISHц╢ИцБпчЪДшКВчВ╣щГ╜ф╝ЪхРСchannelщвСщБУхПСщАБmessageц╢ИцБпуАВ</p> <p>цНвхПешпЭшп┤я╝МхРСщЫЖч╛дф╕нчЪДцЯРф╕кшКВчВ╣хПСщАБхС╜ф╗дя╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>PUBLISH &lt;channel&gt; &lt;message&gt;
</code></pre></div><p>х░Жхп╝шЗ┤щЫЖч╛дф╕нчЪДцЙАцЬЙшКВчВ╣щГ╜хРСchannelщвСщБУхПСщАБmessageц╢ИцБпуАВ</p> <p>ф╕╛ф╕кф╛ЛхнРя╝Мхп╣ф║ОхМЕхРл7000уАБ7001уАБ7002уАБ7003хЫЫф╕кшКВчВ╣чЪДщЫЖч╛дцЭешп┤я╝МхжВцЮЬшКВчВ╣7000цФ╢хИ░ф║ЖховцИ╖члпхПСщАБчЪДPUBLISHхС╜ф╗дя╝МщВгф╣ИшКВчВ╣7000х░ЖхРС7001уАБ7002уАБ7003ф╕Йф╕кшКВчВ╣хПСщАБPUBLISHц╢ИцБпя╝МхжВхЫ╛17-45цЙАчд║уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000177.jpg" alt="img"></p> <p>хЫ╛17-45уААцОецФ╢хИ░PUBLISHхС╜ф╗дчЪДшКВчВ╣7000хРСщЫЖч╛дх╣┐цТнPUBLISHц╢ИцБп</p> <p>PUBLISHц╢ИцБпчЪДцнгцЦЗчФ▒cluster.h/clusterMsgDataPublishч╗УцЮДшбичд║я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>typedef struct {
  uint32_t channel_len;
  uint32_t message_len;
  // хоЪф╣Йф╕║8 хнЧшКВхПкцШпф╕║ф║Жхп╣щ╜РхЕ╢ф╗Цц╢ИцБпч╗УцЮД
  // хоЮщЩЕчЪДщХ┐х║жчФ▒ф┐ЭхнШчЪДхЖЕхо╣хЖ│хоЪ
  unsigned char bulk_data[8];
} clusterMsgDataPublish;
</code></pre></div><p>clusterMsgDataPublishч╗УцЮДчЪДbulk_dataх▒ЮцАзцШпф╕Аф╕кхнЧшКВцХ░ч╗Дя╝Мш┐Щф╕кхнЧшКВцХ░ч╗Дф┐ЭхнШф║ЖховцИ╖члпщАЪш┐ЗPUBLISHхС╜ф╗дхПСщАБч╗ЩшКВчВ╣чЪДchannelхПВцХ░хТМmessageхПВцХ░я╝МшАМч╗УцЮДчЪДchannel_lenхТМmessage_lenхИЩхИЖхИлф┐ЭхнШф║ЖchannelхПВцХ░чЪДщХ┐х║жхТМmessageхПВцХ░чЪДщХ┐х║жя╝Ъ</p> <ul><li><p>хЕ╢ф╕нbulk_dataчЪД0хнЧшКВшЗ│channel_len-1хнЧшКВф┐ЭхнШчЪДцШпchannelхПВцХ░уАВ</p></li> <li><p>шАМbulk_dataчЪДchannel_lenхнЧшКВшЗ│channel_len+message_len-1хнЧшКВф┐ЭхнШчЪДхИЩцШпmessageхПВцХ░уАВ</p></li></ul> <p>ф╕╛ф╕кф╛ЛхнРя╝МхжВцЮЬшКВчВ╣цФ╢хИ░чЪДPUBLISHхС╜ф╗дф╕║я╝Ъ</p> <div class="language- extra-class"><pre class="language-text"><code>PUBLISH &quot;news.it&quot; &quot;hello&quot;
</code></pre></div><p>щВгф╣ИшКВчВ╣хПСщАБчЪДPUBLISHц╢ИцБпчЪДclusterMsgDataPublishч╗УцЮДх░ЖхжВхЫ╛17-46цЙАчд║я╝ЪхЕ╢ф╕нbulk_dataцХ░ч╗ДчЪДхЙНф╕Гф╕кхнЧшКВф┐ЭхнШф║ЖchannelхПВцХ░чЪДхА╝&quot;news.it&quot;я╝МшАМbulk_dataцХ░ч╗ДчЪДхРОф║Фф╕кхнЧшКВхИЩф┐ЭхнШф║ЖmessageхПВцХ░чЪДхА╝&quot;hello&quot;уАВ</p> <p><img src="https://book-redis-design.netlify.app/images/000055.jpg" alt="img"></p> <p>хЫ╛17-46уААclusterMsgDataPublishч╗УцЮДчд║ф╛Л</p> <blockquote><p><strong>ф╕║ф╗Аф╣Иф╕НчЫ┤цОехРСшКВчВ╣х╣┐цТнPUBLISHхС╜ф╗д</strong></p> <p>хоЮщЩЕф╕Кя╝МшжБшойщЫЖч╛дчЪДцЙАцЬЙшКВчВ╣щГ╜цЙзшбМчЫ╕хРМчЪДPUBLISHхС╜ф╗дя╝МцЬАчоАхНХчЪДцЦ╣ц│Хх░▒цШпхРСцЙАцЬЙшКВчВ╣х╣┐цТнчЫ╕хРМчЪДPUBLISHхС╜ф╗дя╝Мш┐Щф╣ЯцШпRedisхЬихдНхИ╢PUBLISHхС╜ф╗дцЧ╢цЙАф╜┐чФичЪДцЦ╣ц│Хя╝Мф╕Нш┐ЗхЫаф╕║ш┐ЩчзНхБЪц│Хх╣╢ф╕НчмжхРИRedisщЫЖч╛дчЪДтАЬхРДф╕кшКВчВ╣щАЪш┐ЗхПСщАБхТМцОецФ╢ц╢ИцБпцЭеш┐ЫшбМщАЪф┐бтАЭш┐Щф╕АшзДхИЩя╝МцЙАф╗ешКВчВ╣ц▓бцЬЙщЗЗхПЦх╣┐цТнPUBLISHхС╜ф╗дчЪДхБЪц│ХуАВ</p></blockquote> <h2 id="щЗНчВ╣хЫЮщб╛"><a href="#щЗНчВ╣хЫЮщб╛" class="header-anchor">#</a> щЗНчВ╣хЫЮщб╛</h2> <ul><li>шКВчВ╣щАЪш┐ЗцПбцЙЛцЭех░ЖхЕ╢ф╗ЦшКВчВ╣ц╖╗хКахИ░шЗкх╖▒цЙАхдДчЪДщЫЖч╛дх╜Уф╕нуАВ</li> <li>щЫЖч╛дф╕нчЪД <code>16384</code> ф╕кцз╜хПпф╗ехИЖхИлцМЗц┤╛ч╗ЩщЫЖч╛дф╕нчЪДхРДф╕кшКВчВ╣я╝М цпПф╕кшКВчВ╣щГ╜ф╝Ъшо░х╜ХхУкф║Ыцз╜цМЗц┤╛ч╗Щф║ЖшЗкх╖▒я╝М шАМхУкф║Ыцз╜хПИшвлцМЗц┤╛ч╗Щф║ЖхЕ╢ф╗ЦшКВчВ╣уАВ</li> <li>шКВчВ╣хЬицОехИ░ф╕Аф╕кхС╜ф╗дшп╖ц▒ВцЧ╢я╝М ф╝ЪхЕИцгАцЯеш┐Щф╕кхС╜ф╗дшп╖ц▒ВшжБхдДчРЖчЪДщФоцЙАхЬичЪДцз╜цШпхРжчФ▒шЗкх╖▒ш┤Яш┤гя╝М хжВцЮЬф╕НцШпчЪДшпЭя╝М шКВчВ╣х░ЖхРСховцИ╖члпш┐ФхЫЮф╕Аф╕к <code>MOVED</code> щФЩшппя╝М <code>MOVED</code> щФЩшппцР║х╕жчЪДф┐бцБпхПпф╗ецМЗх╝ХховцИ╖члпш╜мхРСшЗ│цнгхЬиш┤Яш┤гчЫ╕хЕ│цз╜чЪДшКВчВ╣уАВ</li> <li>хп╣ Redis щЫЖч╛дчЪДщЗНцЦ░хИЖчЙЗх╖еф╜ЬцШпчФ▒ховцИ╖члпцЙзшбМчЪДя╝М щЗНцЦ░хИЖчЙЗчЪДхЕ│щФоцШпх░Жх▒Юф║ОцЯРф╕кцз╜чЪДцЙАцЬЙщФохА╝хп╣ф╗Оф╕Аф╕кшКВчВ╣ш╜мчз╗шЗ│хПжф╕Аф╕кшКВчВ╣уАВ</li> <li>хжВцЮЬшКВчВ╣ A цнгхЬиш┐Бчз╗цз╜ <code>i</code> шЗ│шКВчВ╣ B я╝М щВгф╣Их╜УшКВчВ╣ A ц▓бшГ╜хЬишЗкх╖▒чЪДцХ░цНох║Уф╕нцЙ╛хИ░хС╜ф╗дцМЗхоЪчЪДцХ░цНох║УщФоцЧ╢я╝М шКВчВ╣ A ф╝ЪхРСховцИ╖члпш┐ФхЫЮф╕Аф╕к <code>ASK</code> щФЩшппя╝М цМЗх╝ХховцИ╖члпхИ░шКВчВ╣ B ч╗зч╗нцЯецЙ╛цМЗхоЪчЪДцХ░цНох║УщФоуАВ</li> <li><code>MOVED</code> щФЩшппшбичд║цз╜чЪДш┤Яш┤гцЭГх╖▓ч╗Пф╗Оф╕Аф╕кшКВчВ╣ш╜мчз╗хИ░ф║ЖхПжф╕Аф╕кшКВчВ╣я╝М шАМ <code>ASK</code> щФЩшппхПкцШпф╕дф╕кшКВчВ╣хЬиш┐Бчз╗цз╜чЪДш┐ЗчиЛф╕нф╜┐чФичЪДф╕АчзНф╕┤цЧ╢цОкцЦ╜уАВ</li> <li>щЫЖч╛дщЗМчЪДф╗ОшКВчВ╣чФиф║ОхдНхИ╢ф╕╗шКВчВ╣я╝М х╣╢хЬиф╕╗шКВчВ╣ф╕Лч║┐цЧ╢я╝М ф╗гцЫ┐ф╕╗шКВчВ╣ч╗зч╗нхдДчРЖхС╜ф╗дшп╖ц▒ВуАВ</li> <li>щЫЖч╛дф╕нчЪДшКВчВ╣щАЪш┐ЗхПСщАБхТМцОецФ╢ц╢ИцБпцЭеш┐ЫшбМщАЪшопя╝М х╕╕шзБчЪДц╢ИцБпхМЕцЛм <code>MEET</code> уАБ <code>PING</code> уАБ <code>PONG</code> уАБ <code>PUBLISH</code> уАБ <code>FAIL</code> ф║ФчзНуАВ</li></ul> <h2 id="хПВшАГцЦЗчМо"><a href="#хПВшАГцЦЗчМо" class="header-anchor">#</a> хПВшАГцЦЗчМо</h2> <ul><li><p><a href="https://time.geekbang.org/column/intro/100084301?utm_campaign=geektime_search&amp;utm_content=geektime_search&amp;utm_medium=geektime_search&amp;utm_source=geektime_search&amp;utm_term=geektime_search" target="_blank" rel="noopener noreferrer">цЮБховцЧ╢щЧ┤я╝ЪRedisц║РчаБхЙЦцЮРф╕ОхоЮцИШ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://book.douban.com/subject/25900156/" target="_blank" rel="noopener noreferrer">Redisшо╛шобф╕ОхоЮчО░ <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://github.com/redis/redis/blob/5.0/src/ae.c" target="_blank" rel="noopener noreferrer">Githubя╝Ъredis ц║РчаБ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Redis ч│╗ч╗Яшо╛шоб/05.ф║ФуАБщЫЖч╛д/35.cluster.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/18, 11:29:27</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/af8752/" class="prev">хУихЕ╡</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.ed657d66.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/80.d8713e74.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
