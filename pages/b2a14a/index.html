<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bootstrapя╝Иserverя╝Йц║РчаБшзгцЮР | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ч│╗ч╗Яшо╛шобф╣ЛуАМшо▓шзг + щЭвшпХцМЗхНЧуАНя╝Мц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣я╝Б">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.c76c3453.css" as="style"><link rel="preload" href="/assets/js/app.6c7acbd0.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/45.685623ac.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.2cc95be8.js"><link rel="prefetch" href="/assets/js/100.2b21dce5.js"><link rel="prefetch" href="/assets/js/101.09d5e594.js"><link rel="prefetch" href="/assets/js/11.c7521a10.js"><link rel="prefetch" href="/assets/js/12.38d1989d.js"><link rel="prefetch" href="/assets/js/13.8ddd597e.js"><link rel="prefetch" href="/assets/js/14.397b7600.js"><link rel="prefetch" href="/assets/js/15.b3c76984.js"><link rel="prefetch" href="/assets/js/16.831e5a24.js"><link rel="prefetch" href="/assets/js/17.acb3bf3d.js"><link rel="prefetch" href="/assets/js/18.e491edb6.js"><link rel="prefetch" href="/assets/js/19.daf31819.js"><link rel="prefetch" href="/assets/js/20.cb4a5c13.js"><link rel="prefetch" href="/assets/js/21.24c0f101.js"><link rel="prefetch" href="/assets/js/22.7d106f59.js"><link rel="prefetch" href="/assets/js/23.623f0b5d.js"><link rel="prefetch" href="/assets/js/24.6ba53300.js"><link rel="prefetch" href="/assets/js/25.1fb855d9.js"><link rel="prefetch" href="/assets/js/26.0146252c.js"><link rel="prefetch" href="/assets/js/27.de80589e.js"><link rel="prefetch" href="/assets/js/28.d4ca2c30.js"><link rel="prefetch" href="/assets/js/29.7325b5ce.js"><link rel="prefetch" href="/assets/js/3.5c09ac9d.js"><link rel="prefetch" href="/assets/js/30.892b2994.js"><link rel="prefetch" href="/assets/js/31.a532917f.js"><link rel="prefetch" href="/assets/js/32.13b70e91.js"><link rel="prefetch" href="/assets/js/33.64ab8d0c.js"><link rel="prefetch" href="/assets/js/34.6d3cc288.js"><link rel="prefetch" href="/assets/js/35.5b49d706.js"><link rel="prefetch" href="/assets/js/36.be98cc35.js"><link rel="prefetch" href="/assets/js/37.ead210df.js"><link rel="prefetch" href="/assets/js/38.9f396b5a.js"><link rel="prefetch" href="/assets/js/39.8409097b.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.0ada49bd.js"><link rel="prefetch" href="/assets/js/41.fcee3e0f.js"><link rel="prefetch" href="/assets/js/42.b34f1599.js"><link rel="prefetch" href="/assets/js/43.5a509601.js"><link rel="prefetch" href="/assets/js/44.64fd3383.js"><link rel="prefetch" href="/assets/js/46.7624d38c.js"><link rel="prefetch" href="/assets/js/47.86be3d8d.js"><link rel="prefetch" href="/assets/js/48.ba7dfd47.js"><link rel="prefetch" href="/assets/js/49.ee9681bc.js"><link rel="prefetch" href="/assets/js/5.94727770.js"><link rel="prefetch" href="/assets/js/50.3e91aa07.js"><link rel="prefetch" href="/assets/js/51.ad7a3e32.js"><link rel="prefetch" href="/assets/js/52.08ad747c.js"><link rel="prefetch" href="/assets/js/53.5ee4652a.js"><link rel="prefetch" href="/assets/js/54.0bbf2ba5.js"><link rel="prefetch" href="/assets/js/55.0edcba5d.js"><link rel="prefetch" href="/assets/js/56.5ecf867d.js"><link rel="prefetch" href="/assets/js/57.72ba41a6.js"><link rel="prefetch" href="/assets/js/58.7144aef6.js"><link rel="prefetch" href="/assets/js/59.f96f0065.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/60.66a7f41d.js"><link rel="prefetch" href="/assets/js/61.08b4acf0.js"><link rel="prefetch" href="/assets/js/62.cc8fdced.js"><link rel="prefetch" href="/assets/js/63.41ff19e4.js"><link rel="prefetch" href="/assets/js/64.9b3def35.js"><link rel="prefetch" href="/assets/js/65.0b2ab47d.js"><link rel="prefetch" href="/assets/js/66.2ae7a107.js"><link rel="prefetch" href="/assets/js/67.79dd6daf.js"><link rel="prefetch" href="/assets/js/68.1b76c178.js"><link rel="prefetch" href="/assets/js/69.7ac52a2f.js"><link rel="prefetch" href="/assets/js/70.7279b1df.js"><link rel="prefetch" href="/assets/js/71.f44644ed.js"><link rel="prefetch" href="/assets/js/72.c8cf2fab.js"><link rel="prefetch" href="/assets/js/73.526febf1.js"><link rel="prefetch" href="/assets/js/74.d9ad1a67.js"><link rel="prefetch" href="/assets/js/75.90fd56c9.js"><link rel="prefetch" href="/assets/js/76.32858593.js"><link rel="prefetch" href="/assets/js/77.7b3f6980.js"><link rel="prefetch" href="/assets/js/78.31a353ef.js"><link rel="prefetch" href="/assets/js/79.173bbc8c.js"><link rel="prefetch" href="/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/assets/js/80.d8713e74.js"><link rel="prefetch" href="/assets/js/81.d124398a.js"><link rel="prefetch" href="/assets/js/82.3b90a7cc.js"><link rel="prefetch" href="/assets/js/83.f3a9ee0c.js"><link rel="prefetch" href="/assets/js/84.1fd412a9.js"><link rel="prefetch" href="/assets/js/85.f69467b2.js"><link rel="prefetch" href="/assets/js/86.931cbb70.js"><link rel="prefetch" href="/assets/js/87.78b2eebd.js"><link rel="prefetch" href="/assets/js/88.605444aa.js"><link rel="prefetch" href="/assets/js/89.e05e3a70.js"><link rel="prefetch" href="/assets/js/9.6e274fca.js"><link rel="prefetch" href="/assets/js/90.ca1ff100.js"><link rel="prefetch" href="/assets/js/91.8ad18b18.js"><link rel="prefetch" href="/assets/js/92.b554f1c7.js"><link rel="prefetch" href="/assets/js/93.fb2397b7.js"><link rel="prefetch" href="/assets/js/94.1eade7f0.js"><link rel="prefetch" href="/assets/js/95.96f5db04.js"><link rel="prefetch" href="/assets/js/96.5ed2d348.js"><link rel="prefetch" href="/assets/js/97.0154143f.js"><link rel="prefetch" href="/assets/js/98.8d8d41db.js"><link rel="prefetch" href="/assets/js/99.690e4395.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c76c3453.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕АуАБхЙНшиА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║МуАБхЯ║чбАчЯешпЖ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b0bc66/" class="sidebar-link">Netty цбЖцЮ╢цжВш┐░</a></li><li><a href="/pages/9582d0/" class="sidebar-link">Bootstrapя╝Иclientя╝Йц║РчаБшзгцЮР</a></li><li><a href="/pages/b2a14a/" aria-current="page" class="active sidebar-link">Bootstrapя╝Иserverя╝Йц║РчаБшзгцЮР</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/b2a14a/#цЬНхКбхЩичлп" class="sidebar-link">цЬНхКбхЩичлп</a></li><li class="sidebar-sub-header level2"><a href="/pages/b2a14a/#хРОшо░" class="sidebar-link">хРОшо░</a></li></ul></li><li><a href="/pages/8d1ba9/Channel/" class="sidebar-link">Channel ц║РчаБшзгцЮР</a></li><li><a href="/pages/397456/" class="sidebar-link">EventLoop ц║РчаБшзгцЮР</a></li><li><a href="/pages/ce1f78/" class="sidebar-link">ChannelHandler ц║РчаБшзгцЮР</a></li><li><a href="/pages/4234c0/" class="sidebar-link">ChannelPipeline ц║РчаБшзгцЮР</a></li><li><a href="/pages/43eb30/" class="sidebar-link">ByteBuf ц║РчаБшзгцЮР</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>хЫЫуАБц╖▒хЕе Netty ца╕х┐Г</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║ФуАБц╖▒хЕе Netty хЖЕхнШчобчРЖ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Netty ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Bootstrapя╝Иserverя╝Йц║РчаБшзгцЮР<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="цЬНхКбхЩичлп"><a href="#цЬНхКбхЩичлп" class="header-anchor">#</a> цЬНхКбхЩичлп</h2> <p>хЬихИЖцЮРховцИ╖члпчЪДф╗гчаБцЧ╢, цИСф╗мх╖▓ч╗Пхп╣ Bootstrap хРпхКи Netty цЬЙф║Жф╕Аф╕кхдзшЗ┤чЪДшодшпЖ, щВгф╣ИцОеф╕ЛцЭехИЖцЮРцЬНхКбхЩичлпцЧ╢, х░▒ф╝ЪчЫ╕хп╣чоАхНХф╕Аф║Ыф║Ж. щжЦхЕИш┐ШцШпцЭечЬЛф╕Аф╕ЛцЬНхКбхЩичлпчЪДхРпхКиф╗гчаБ:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">EchoServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token constant">SSL</span> <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;ssl&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;8007&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// Configure SSL.</span>
        <span class="token keyword">final</span> <span class="token class-name">SslContext</span> sslCtx<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SSL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SelfSignedCertificate</span> ssc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SelfSignedCertificate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sslCtx <span class="token operator">=</span> <span class="token class-name">SslContextBuilder</span><span class="token punctuation">.</span><span class="token function">forServer</span><span class="token punctuation">(</span>ssc<span class="token punctuation">.</span><span class="token function">certificate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ssc<span class="token punctuation">.</span><span class="token function">privateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            sslCtx <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Configure the server.</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_BACKLOG</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                 <span class="token annotation punctuation">@Override</span>
                 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                     <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token keyword">if</span> <span class="token punctuation">(</span>sslCtx <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                         p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>sslCtx<span class="token punctuation">.</span><span class="token function">newHandler</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>
                     <span class="token comment">//p.addLast(new LoggingHandler(LogLevel.INFO));</span>
                     p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EchoServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Start the server.</span>
            <span class="token class-name">ChannelFuture</span> f <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Wait until the server socket is closed.</span>
            f<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// Shut down all event loops to terminate all threads.</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>хТМховцИ╖члпчЪДф╗гчаБчЫ╕цпФ, ц▓бцЬЙх╛ИхдзчЪДх╖охИл, хЯ║цЬмф╕Кф╣ЯцШпш┐ЫшбМф║ЖхжВф╕ЛхЗаф╕кщГихИЖчЪДхИЭхзЛхМЦ:</p> <ol><li>EventLoopGroup: ф╕Ншо║цШпцЬНхКбхЩичлпш┐ШцШпховцИ╖члп, щГ╜х┐Ещб╗цМЗхоЪ EventLoopGroup. хЬиш┐Щф╕кф╛ЛхнРф╕н, цМЗхоЪф║Ж NioEventLoopGroup, шбичд║ф╕Аф╕к NIO чЪД EventLoopGroup, ф╕Нш┐ЗцЬНхКбхЩичлпщЬАшжБцМЗхоЪф╕дф╕к EventLoopGroup, ф╕Аф╕кцШп bossGroup, чФиф║ОхдДчРЖховцИ╖члпчЪДш┐ЮцОешп╖ц▒В; хПжф╕Аф╕кцШп workerGroup, чФиф║ОхдДчРЖф╕ОхРДф╕кховцИ╖члпш┐ЮцОечЪД IO цУНф╜Ь</li> <li>ChannelType: цМЗхоЪ Channel чЪДч▒╗хЮЛ. хЫаф╕║цШпцЬНхКбхЩичлп, хЫацндф╜┐чФиф║Ж NioServerSocketChannel</li> <li>Handler: шо╛ч╜оцХ░цНочЪДхдДчРЖхЩи</li></ol> <h3 id="channel-чЪДхИЭхзЛхМЦш┐ЗчиЛ"><a href="#channel-чЪДхИЭхзЛхМЦш┐ЗчиЛ" class="header-anchor">#</a> Channel чЪДхИЭхзЛхМЦш┐ЗчиЛ</h3> <p>цИСф╗мхЬихИЖцЮРховцИ╖члпчЪД Channel хИЭхзЛхМЦш┐ЗчиЛцЧ╢, х╖▓ч╗ПцПРхИ░, Channel цШпхп╣ Java х║Хх▒В Socket ш┐ЮцОечЪДцК╜ш▒б, х╣╢ф╕ФчЯещБУф║ЖховцИ╖члпчЪД Channel чЪДхЕ╖ф╜Уч▒╗хЮЛцШп NioSocketChannel, щВгф╣ИшЗкчД╢чЪД, цЬНхКбхЩичлпчЪД Channel ч▒╗хЮЛх░▒цШп NioServerSocketChannel ф║Ж. щВгф╣ИцОеф╕ЛцЭецИСф╗мцМЙчЕзхИЖцЮРховцИ╖члпчЪДц╡БчиЛхп╣цЬНхКбхЩичлпчЪДф╗гчаБф╣ЯхРМца╖хЬ░хИЖцЮРф╕АщБН, ш┐Щца╖ф╣ЯцЦ╣ф╛┐цИСф╗мхп╣цпФф╕Аф╕ЛцЬНхКбхЩичлпхТМховцИ╖члпцЬЙхУкф║Ыф╕Нф╕Аца╖чЪДхЬ░цЦ╣.</p> <h4 id="channel-ч▒╗хЮЛчЪДчбохоЪ"><a href="#channel-ч▒╗хЮЛчЪДчбохоЪ" class="header-anchor">#</a> Channel ч▒╗хЮЛчЪДчбохоЪ</h4> <p>хРМца╖чЪДхИЖцЮРхеЧш╖п, цИСф╗мх╖▓ч╗ПчЯещБУф║Ж, хЬиховцИ╖члпф╕н, Channel чЪДч▒╗хЮЛхЕ╢хоЮцШпхЬихИЭхзЛхМЦцЧ╢, щАЪш┐З Bootstrap.channel() цЦ╣ц│Хшо╛ч╜очЪД, цЬНхКбхЩичлпшЗкчД╢ф╣Яф╕Нф╛ЛхдЦ</p> <p>хЬицЬНхКбхЩичлп, цИСф╗мш░ГчФиф║Ж ServerBootstarap.channel(NioServerSocketChannel.class), ф╝ащАТф║Жф╕Аф╕к NioServerSocketChannel Class хп╣ш▒б. ш┐Щца╖чЪДшпЭ, цМЙчЕзхТМхИЖцЮРховцИ╖члпф╗гчаБф╕Аца╖чЪДц╡БчиЛ, цИСф╗мх░▒хПпф╗ечбохоЪ, NioServerSocketChannel чЪДхоЮф╛ЛхМЦцШпщАЪш┐З BootstrapChannelFactory х╖ехОВч▒╗цЭехоМцИРчЪД, шАМ BootstrapChannelFactory ф╕нчЪД clazz хнЧцо╡швлшо╛ч╜оф╕║ф║Ж NioServerSocketChannel.class, хЫацндх╜Уш░ГчФи BootstrapChannelFactory.newChannel() цЧ╢:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">newChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// хИащЩд try хЭЧ</span>
    <span class="token keyword">return</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>х░▒шО╖хПЦхИ░ф║Жф╕Аф╕к NioServerSocketChannel чЪДхоЮф╛Л.</p> <p>цЬАхРОцИСф╗мф╣ЯцЭецА╗ч╗Уф╕Аф╕Л:</p> <ul><li>ServerBootstrap ф╕нчЪД ChannelFactory чЪДхоЮчО░цШп BootstrapChannelFactory</li> <li>чФЯцИРчЪД Channel чЪДхЕ╖ф╜Уч▒╗хЮЛцШп NioServerSocketChannel. Channel чЪДхоЮф╛ЛхМЦш┐ЗчиЛ, хЕ╢хоЮх░▒цШпш░ГчФичЪД ChannelFactory.newChannel цЦ╣ц│Х, шАМхоЮф╛ЛхМЦчЪД Channel чЪДхЕ╖ф╜УчЪДч▒╗хЮЛхПИцШпхТМхЬихИЭхзЛхМЦ ServerBootstrap цЧ╢ф╝ахЕечЪД channel() цЦ╣ц│ХчЪДхПВцХ░чЫ╕хЕ│. хЫацндхп╣ф║ОцИСф╗мш┐Щф╕кф╛ЛхнРф╕нчЪДцЬНхКбхЩичлпчЪД ServerBootstrap шАМшиА, чФЯцИРчЪДчЪД Channel хоЮф╛Лх░▒цШп NioServerSocketChannel</li></ul> <h4 id="nioserversocketchannel-чЪДхоЮф╛ЛхМЦш┐ЗчиЛ"><a href="#nioserversocketchannel-чЪДхоЮф╛ЛхМЦш┐ЗчиЛ" class="header-anchor">#</a> NioServerSocketChannel чЪДхоЮф╛ЛхМЦш┐ЗчиЛ</h4> <p>щжЦхЕИш┐ШцШпцЭечЬЛф╕Аф╕Л NioServerSocketChannel чЪДхоЮф╛ЛхМЦш┐ЗчиЛ. ф╕ЛщЭвцШп NioServerSocketChannel чЪДч▒╗х▒Вцмбч╗УцЮДхЫ╛:</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182203035.png" alt="NioServerSocketChannel ч▒╗х▒Вцмбч╗УцЮД.png"></p> <p>щжЦхЕИ, цИСф╗мцЭечЬЛф╕Аф╕ЛхоГчЪДщ╗ШшодчЪДцЮДщАахЩи. хТМ NioSocketChannel ч▒╗ф╝╝, цЮДщАахЩищГ╜цШпш░ГчФиф║Ж newSocket цЭецЙУх╝Аф╕Аф╕к Java чЪД NIO Socket, ф╕Нш┐ЗщЬАшжБц│ицДПчЪДцШп, ховцИ╖члпчЪД newSocket ш░ГчФичЪДцШп openSocketChannel, шАМцЬНхКбхЩичлпчЪД newSocket ш░ГчФичЪДцШп openServerSocketChannel. щб╛хРНцАЭф╣Й, ф╕Аф╕кцШпховцИ╖члпчЪД Java SocketChannel, ф╕Аф╕кцШпцЬНхКбхЩичлпчЪД Java ServerSocketChannel.</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token function">newSocket</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_SELECTOR_PROVIDER</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ServerSocketChannel</span> <span class="token function">newSocket</span><span class="token punctuation">(</span><span class="token class-name">SelectorProvider</span> provider<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> provider<span class="token punctuation">.</span><span class="token function">openServerSocketChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>цОеф╕ЛцЭеф╝Ъш░ГчФищЗНш╜╜чЪДцЮДщАахЩи:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> channel<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioServerSocketChannelConfig</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">javaChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐Щф╕кцЮДщАахЕ╢ф╕н, ш░ГчФичИ╢ч▒╗цЮДщАахЩицЧ╢, ф╝ахЕечЪДхПВцХ░цШп <strong>SelectionKey.OP_ACCEPT</strong>. ф╜Ьф╕║хп╣цпФ, цИСф╗мхЫЮцГ│ф╕Аф╕Л, хЬиховцИ╖члпчЪД Channel хИЭхзЛхМЦцЧ╢, ф╝ахЕечЪДхПВцХ░цШп <strong>SelectionKey.OP_READ</strong></p> <p>цЬЙ Java NIO Socket х╝АхПСч╗ПщкМчЪДцЬЛхПЛх░▒чЯещБУф║Ж, Java NIO цШпф╕АчзН Reactor цибх╝П, цИСф╗мщАЪш┐З selector цЭехоЮчО░ I/O чЪДхдЪш╖пхдНчФихдНчФи. хЬиф╕Ах╝АхзЛцЧ╢, цЬНхКбхЩичлпщЬАшжБчЫСхРмховцИ╖члпчЪДш┐ЮцОешп╖ц▒В, хЫацндхЬиш┐ЩщЗМцИСф╗мшо╛ч╜оф║Ж <strong>SelectionKey.OP_ACCEPT</strong>, хН│щАЪчЯе selector цИСф╗мхп╣ховцИ╖члпчЪДш┐ЮцОешп╖ц▒ВцДЯхЕ┤ш╢г.</p> <p>цОечЭАхТМховцИ╖члпчЪДхИЖцЮРф╕Аф╕Л, ф╝ЪщАРч║зхЬ░ш░ГчФичИ╢ч▒╗чЪДцЮДщАахЩи NioServerSocketChannel &lt;- AbstractNioMessageChannel &lt;- AbstractNioChannel &lt;- AbstractChannel.</p> <p>хРМца╖чЪД, хЬи AbstractChannel ф╕нф╝ЪхоЮф╛ЛхМЦф╕Аф╕к unsafe хТМ pipeline:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">AbstractChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
    unsafe <span class="token operator">=</span> <span class="token function">newUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pipeline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultChannelPipeline</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕Нш┐З, ш┐ЩщЗМцЬЙф╕АчВ╣щЬАшжБц│ицДПчЪДцШп, ховцИ╖члпчЪД unsafe цШпф╕Аф╕к AbstractNioByteChannel#NioByteUnsafe чЪДхоЮф╛Л, шАМхЬицЬНхКбхЩичлпцЧ╢, хЫаф╕║ AbstractNioMessageChannel щЗНхЖЩф║Ж newUnsafe цЦ╣ц│Х:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token class-name">AbstractNioUnsafe</span> <span class="token function">newUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NioMessageUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>хЫацндхЬицЬНхКбхЩичлп, unsafe хнЧцо╡хЕ╢хоЮцШпф╕Аф╕к AbstractNioMessageChannel#AbstractNioUnsafe чЪДхоЮф╛Л. цИСф╗мцЭецА╗ч╗Уф╕Аф╕Л, хЬи NioServerSocketChannsl хоЮф╛ЛхМЦш┐ЗчиЛф╕н, цЙАщЬАшжБхБЪчЪДх╖еф╜Ь:</p> <ul><li>ш░ГчФи NioServerSocketChannel.newSocket(DEFAULT_SELECTOR_PROVIDER) цЙУх╝Аф╕Аф╕кцЦ░чЪД Java NIO ServerSocketChannel</li> <li>AbstractChannel(Channel parent) ф╕нхИЭхзЛхМЦ AbstractChannel чЪДх▒ЮцАз:</li> <li>parent х▒ЮцАзч╜оф╕║ null</li> <li>unsafe щАЪш┐З newUnsafe() хоЮф╛ЛхМЦф╕Аф╕к unsafe хп╣ш▒б, хоГчЪДч▒╗хЮЛцШп AbstractNioMessageChannel#AbstractNioUnsafe хЖЕщГич▒╗</li> <li>pipeline цШп new DefaultChannelPipeline(this) цЦ░хИЫх╗║чЪДхоЮф╛Л.</li> <li>AbstractNioChannel ф╕нчЪДх▒ЮцАз:</li> <li>SelectableChannel ch швлшо╛ч╜оф╕║ Java ServerSocketChannel, хН│ NioServerSocketChannel#newSocket ш┐ФхЫЮчЪД Java NIO ServerSocketChannel.</li> <li>readInterestOp швлшо╛ч╜оф╕║ SelectionKey.OP_ACCEPT</li> <li>SelectableChannel ch швлщЕНч╜оф╕║щЭЮщШ╗хбЮчЪД <strong>ch.configureBlocking(false)</strong></li> <li>NioServerSocketChannel ф╕нчЪДх▒ЮцАз:</li> <li>ServerSocketChannelConfig config = new NioServerSocketChannelConfig(this, javaChannel().socket())</li></ul> <h3 id="channelpipeline-хИЭхзЛхМЦ"><a href="#channelpipeline-хИЭхзЛхМЦ" class="header-anchor">#</a> ChannelPipeline хИЭхзЛхМЦ</h3> <p>цЬНхКбхЩичлпхТМховцИ╖члпчЪД ChannelPipeline чЪДхИЭхзЛхМЦф╕АшЗ┤, хЫацндх░▒ф╕НхЖНхНХчЛмхИЖцЮРф║Ж.</p> <h3 id="channel-чЪДц│ихЖМ"><a href="#channel-чЪДц│ихЖМ" class="header-anchor">#</a> Channel чЪДц│ихЖМ</h3> <p>цЬНхКбхЩичлпхТМховцИ╖члпчЪД Channel чЪДц│ихЖМш┐ЗчиЛф╕АшЗ┤, хЫацндх░▒ф╕НхЖНхНХчЛмхИЖцЮРф║Ж.</p> <h3 id="хЕ│ф║О-bossgroup-ф╕О-workergroup"><a href="#хЕ│ф║О-bossgroup-ф╕О-workergroup" class="header-anchor">#</a> хЕ│ф║О bossGroup ф╕О workerGroup</h3> <p>хЬиховцИ╖члпчЪДцЧ╢хАЩ, цИСф╗мхПкцПРф╛Ыф║Жф╕Аф╕к EventLoopGroup хп╣ш▒б, шАМхЬицЬНхКбхЩичлпчЪДхИЭхзЛхМЦцЧ╢, цИСф╗мшо╛ч╜оф║Жф╕дф╕к EventLoopGroup, ф╕Аф╕кцШп bossGroup, хПжф╕Аф╕кцШп workerGroup. щВгф╣Иш┐Щф╕дф╕к EventLoopGroup щГ╜цШпх╣▓ф╗Аф╣ИчФичЪДхСв? хЕ╢хоЮхСв, bossGroup цШпчФиф║ОцЬНхКбчлп чЪД accept чЪД, хН│чФиф║ОхдДчРЖховцИ╖члпчЪДш┐ЮцОешп╖ц▒В. цИСф╗мхПпф╗ецКК Netty цпФф╜Ьф╕Аф╕кщенх║Ч, bossGroup х░▒хГПф╕Аф╕кхГПф╕Аф╕кхЙНхП░цОех╛Е, х╜УховцИ╖цЭехИ░щенх║ЧхРГцЧ╢, цОех╛ЕхСШх░▒ф╝Ъх╝Ххп╝щб╛ховх░▒хЭР, ф╕║щб╛ховчлпшМ╢щАБц░┤чнЙ. шАМ workerGroup, хЕ╢хоЮх░▒цШпхоЮщЩЕф╕Кх╣▓ц┤╗чЪДхХж, хоГф╗мш┤Яш┤гховцИ╖члпш┐ЮцОещАЪщБУчЪД IO цУНф╜Ь: х╜УцОех╛ЕхСШ цЛЫх╛Ехе╜щб╛ховхРО, х░▒хПпф╗ечиНхБЪф╝СцБп, шАМцндцЧ╢хРОхОищЗМчЪДхОих╕Иф╗м(workerGroup)х░▒х╝АхзЛх┐ЩчвМхЬ░хЗЖхдЗщеншПЬф║Ж. хЕ│ф║О bossGroup ф╕О workerGroup чЪДхЕ│ч│╗, цИСф╗мхПпф╗ечФихжВф╕ЛхЫ╛цЭех▒Хчд║:</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182205250.png" alt="image-20240918220553207"></p> <p>щжЦхЕИ, цЬНхКбхЩичлп bossGroup ф╕НцЦнхЬ░чЫСхРмцШпхРжцЬЙховцИ╖члпчЪДш┐ЮцОе, х╜УхПСчО░цЬЙф╕Аф╕кцЦ░чЪДховцИ╖члпш┐ЮцОехИ░цЭецЧ╢, bossGroup х░▒ф╝Ъф╕║цндш┐ЮцОехИЭхзЛхМЦхРДщб╣ш╡Дц║Р, чД╢хРОф╗О workerGroup ф╕нщАЙхЗ║ф╕Аф╕к EventLoop ч╗СхоЪхИ░цндховцИ╖члпш┐ЮцОеф╕н. щВгф╣ИцОеф╕ЛцЭечЪДцЬНхКбхЩиф╕ОховцИ╖члпчЪДф║дф║Тш┐ЗчиЛх░▒хЕищГихЬицндхИЖщЕНчЪД EventLoop ф╕нф║Ж.</p> <p>хПгшп┤цЧахЗн, цИСф╗мш┐ШцШпф╗ец║РчаБшп┤шпЭхРз. щжЦхЕИхЬи ServerBootstrap хИЭхзЛхМЦцЧ╢, ш░ГчФиф║Ж <strong>b.group(bossGroup, workerGroup)</strong> шо╛ч╜оф║Жф╕дф╕к EventLoopGroup, цИСф╗мш╖Яш╕кш┐ЫхО╗чЬЛф╕Аф╕Л:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ServerBootstrap</span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token class-name">EventLoopGroup</span> parentGroup<span class="token punctuation">,</span> <span class="token class-name">EventLoopGroup</span> childGroup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>parentGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>childGroup <span class="token operator">=</span> childGroup<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>цШ╛чД╢, ш┐Щф╕кцЦ╣ц│ХхИЭхзЛхМЦф║Жф╕дф╕кхнЧцо╡, ф╕Аф╕кцШп <strong>group = parentGroup</strong>, хоГцШпхЬи super.group(parentGroup) ф╕нхИЭхзЛхМЦчЪД, хПжф╕Аф╕кцШп <strong>childGroup = childGroup</strong>. цОечЭАцИСф╗мхРпхКичиЛх║Пш░ГчФиф║Ж b.bind цЦ╣ц│ХцЭечЫСхРмф╕Аф╕кцЬмхЬ░члпхПг. bind цЦ╣ц│Хф╝ЪшзжхПСхжВф╕ЛчЪДш░ГчФищУ╛:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">AbstractBootstrap</span><span class="token punctuation">.</span>bind <span class="token operator">-&gt;</span> <span class="token class-name">AbstractBootstrap</span><span class="token punctuation">.</span>doBind <span class="token operator">-&gt;</span> <span class="token class-name">AbstractBootstrap</span><span class="token punctuation">.</span>initAndRegister
</code></pre></div><p>AbstractBootstrap.initAndRegister цШпцИСф╗мчЪДшАБцЬЛхПЛф║Ж, цИСф╗мхЬихИЖцЮРховцИ╖члпчиЛх║ПцЧ╢, хТМхоГцЙУш┐Зх╛ИхдЪф║дхИ░ф║Ж, цИСф╗мхЖНцЭехЫЮщб╛ф╕Аф╕Лш┐Щф╕кцЦ╣ц│ХхРз:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">ChannelFuture</span> <span class="token function">initAndRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token function">channelFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> чЬБчХех╝Вх╕╕хИдцЦн
    <span class="token function">init</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ChannelFuture</span> regFuture <span class="token operator">=</span> <span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> regFuture<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐ЩщЗМ group() цЦ╣ц│Хш┐ФхЫЮчЪДцШпф╕КщЭвцИСф╗мцПРхИ░чЪД bossGroup, шАМш┐ЩщЗМчЪД channel цИСф╗мф╣Ях╖▓ч╗ПхИЖцЮРш┐Зф║Ж, хоГцШпф╕Аф╕кцШпф╕Аф╕к NioServerSocketChannel хоЮф╛Л, хЫацндцИСф╗мхПпф╗ечЯещБУ, group().register(channel) х░Ж bossGroup хТМ NioServerSocketChannel хЕ│шБФш╡╖цЭеф║Ж. щВгф╣И workerGroup цШпхЬихУкщЗМф╕О NioSocketChannel хЕ│шБФчЪДхСв? цИСф╗мч╗зч╗нчЬЛ <strong>init(channel)</strong> цЦ╣ц│Х:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">EventLoopGroup</span> currentChildGroup <span class="token operator">=</span> childGroup<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">ChannelHandler</span> currentChildHandler <span class="token operator">=</span> childHandler<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelOption</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildOptions<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttributeKey</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildAttrs<span class="token punctuation">;</span>

    p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChannelHandler</span> handler <span class="token operator">=</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerBootstrapAcceptor</span><span class="token punctuation">(</span>
                    currentChildGroup<span class="token punctuation">,</span> currentChildHandler<span class="token punctuation">,</span> currentChildOptions<span class="token punctuation">,</span> currentChildAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>init цЦ╣ц│ХхЬи ServerBootstrap ф╕нщЗНхЖЩф║Ж, ф╗Оф╕КщЭвчЪДф╗гчаБчЙЗцо╡ф╕нцИСф╗мчЬЛхИ░, хоГф╕║ pipeline ф╕нц╖╗хКаф║Жф╕Аф╕к ChannelInitializer, шАМш┐Щф╕к ChannelInitializer ф╕нц╖╗хКаф║Жф╕Аф╕кхЕ│щФочЪД <strong>ServerBootstrapAcceptor</strong> handler. хЕ│ф║О handler чЪДц╖╗хКаф╕ОхИЭхзЛхМЦчЪДш┐ЗчиЛ, цИСф╗мчХЩх╛Еф╕Лф╕Ах░ПшКВф╕нхИЖцЮР, цИСф╗мчО░хЬихЕ│ц│иф╕Аф╕Л ServerBootstrapAcceptor ч▒╗. ServerBootstrapAcceptor ф╕нщЗНхЖЩф║Ж channelRead цЦ╣ц│Х, хЕ╢ф╕╗шжБф╗гчаБхжВф╕Л:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Channel</span> child <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
    child<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>childHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    childGroup<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ServerBootstrapAcceptor ф╕нчЪД childGroup цШпцЮДщАацндхп╣ш▒бцШпф╝ахЕечЪД currentChildGroup, хН│цИСф╗мчЪД workerGroup, шАМ Channel цШпф╕Аф╕к NioSocketChannel чЪДхоЮф╛Л, хЫацндш┐ЩщЗМчЪД childGroup.register х░▒цШпх░Ж workerGroup ф╕нчЪДцС╕ф╕к EventLoop хТМ NioSocketChannel хЕ│шБФф║Ж. цЧвчД╢ш┐Щца╖, щВгф╣ИчО░хЬичЪДщЧощвШцШп, ServerBootstrapAcceptor.channelRead цЦ╣ц│ХцШпцАОф╣Ишвлш░ГчФичЪДхСв? хЕ╢хоЮх╜Уф╕Аф╕к client ш┐ЮцОехИ░ server цЧ╢, Java х║Хх▒ВчЪД NIO ServerSocketChannel ф╝ЪцЬЙф╕Аф╕к <strong>SelectionKey.OP_ACCEPT</strong> х░▒ч╗кф║Лф╗╢, цОечЭАх░▒ф╝Ъш░ГчФихИ░ NioServerSocketChannel.doReadMessages:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doReadMessages</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> buf<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> ch <span class="token operator">=</span> <span class="token function">javaChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> чЬБчХех╝Вх╕╕хдДчРЖ
    buf<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NioSocketChannel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>хЬи doReadMessages ф╕н, щАЪш┐З javaChannel().accept() шО╖хПЦхИ░ховцИ╖члпцЦ░ш┐ЮцОечЪД SocketChannel, цОечЭАх░▒хоЮф╛ЛхМЦф╕Аф╕к <strong>NioSocketChannel</strong>, х╣╢ф╕Фф╝ахЕе NioServerSocketChannel хп╣ш▒б(хН│ this), чФ▒цндхПпчЯе, цИСф╗мхИЫх╗║чЪДш┐Щф╕к NioSocketChannel чЪДчИ╢ Channel х░▒цШп NioServerSocketChannel хоЮф╛Л . цОеф╕ЛцЭех░▒ч╗ПчФ▒ Netty чЪД ChannelPipeline цЬ║хИ╢, х░Жшп╗хПЦф║Лф╗╢щАРч║зхПСщАБхИ░хРДф╕к handler ф╕н, ф║ОцШпх░▒ф╝ЪшзжхПСхЙНщЭвцИСф╗мцПРхИ░чЪД ServerBootstrapAcceptor.channelRead цЦ╣ц│ХхХж.</p> <h3 id="handler-чЪДц╖╗хКаш┐ЗчиЛ"><a href="#handler-чЪДц╖╗хКаш┐ЗчиЛ" class="header-anchor">#</a> handler чЪДц╖╗хКаш┐ЗчиЛ</h3> <p>цЬНхКбхЩичлпчЪД handler чЪДц╖╗хКаш┐ЗчиЛхТМховцИ╖члпчЪДцЬЙчВ╣хМ║хИл, хТМ EventLoopGroup ф╕Аца╖, цЬНхКбхЩичлпчЪД handler ф╣ЯцЬЙф╕дф╕к, ф╕Аф╕кцШпщАЪш┐З handler() цЦ╣ц│Хшо╛ч╜о handler хнЧцо╡, хПжф╕Аф╕кцШпщАЪш┐З childHandler() шо╛ч╜о childHandler хнЧцо╡. щАЪш┐ЗхЙНщЭвчЪД bossGroup хТМ workerGroup чЪДхИЖцЮР, хЕ╢хоЮцИСф╗мхЬиш┐ЩщЗМхПпф╗ехдзшГЖхЬ░чМЬц╡Л: handler хнЧцо╡ф╕О accept ш┐ЗчиЛцЬЙхЕ│, хН│ш┐Щф╕к handler ш┤Яш┤гхдДчРЖховцИ╖члпчЪДш┐ЮцОешп╖ц▒В; шАМ childHandler х░▒цШпш┤Яш┤гхТМховцИ╖члпчЪДш┐ЮцОечЪД IO ф║дф║Т. щВгф╣ИхоЮщЩЕф╕КцШпф╕НцШпш┐Щца╖чЪДхСв? цЭе, цИСф╗мч╗зч╗нщАЪш┐Зф╗гчаБшпБцШО.</p> <p>хЬи <strong>хЕ│ф║О bossGroup ф╕О workerGroup</strong> х░ПшКВф╕н, цИСф╗мцПРхИ░, ServerBootstrap щЗНхЖЩф║Ж init цЦ╣ц│Х, хЬиш┐Щф╕кцЦ╣ц│Хф╕нц╖╗хКаф║Ж handler:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">EventLoopGroup</span> currentChildGroup <span class="token operator">=</span> childGroup<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">ChannelHandler</span> currentChildHandler <span class="token operator">=</span> childHandler<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelOption</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildOptions<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AttributeKey</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> currentChildAttrs<span class="token punctuation">;</span>

    p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Channel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
            <span class="token class-name">ChannelPipeline</span> pipeline <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ChannelHandler</span> handler <span class="token operator">=</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            pipeline<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServerBootstrapAcceptor</span><span class="token punctuation">(</span>
                    currentChildGroup<span class="token punctuation">,</span> currentChildHandler<span class="token punctuation">,</span> currentChildOptions<span class="token punctuation">,</span> currentChildAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕КщЭвф╗гчаБчЪД <strong>initChannel</strong> цЦ╣ц│Хф╕н, щжЦхЕИщАЪш┐З handler() цЦ╣ц│ХшО╖хПЦф╕Аф╕к handler, хжВцЮЬшО╖хПЦчЪД handler ф╕Нф╕║чй║,хИЩц╖╗хКахИ░ pipeline ф╕н. чД╢хРОцОечЭА, ц╖╗хКаф║Жф╕Аф╕к ServerBootstrapAcceptor хоЮф╛Л. щВгф╣Иш┐ЩщЗМ handler() цЦ╣ц│Хш┐ФхЫЮчЪДцШпхУкф╕кхп╣ш▒бхСв? хЕ╢хоЮхоГш┐ФхЫЮчЪДцШп handler хнЧцо╡, шАМш┐Щф╕кхнЧцо╡х░▒цШпцИСф╗мхЬицЬНхКбхЩичлпчЪДхРпхКиф╗гчаБф╕ншо╛ч╜очЪД:</p> <div class="language-Java extra-class"><pre class="language-java"><code>b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>щВгф╣Иш┐Щф╕кцЧ╢хАЩ, pipeline ф╕нчЪД handler цГЕхЖ╡хжВф╕Л: [<img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182200616.png" alt="Alt text">](https://github.com/yongshun/learn_netty_source_code/blob/master/Netty ц║РчаБхИЖцЮРф╣Л ф╕А цПнх╝А Bootstrap чеЮчзШчЪДч║вчЫЦхд┤ (цЬНхКбхЩичлп)/1477377831087.png)</p> <p>ца╣цНоцИСф╗мхОЯцЭехИЖцЮРховцИ╖члпчЪДч╗ПщкМ, цИСф╗мцМЗхоЪ, х╜У channel ч╗СхоЪхИ░ eventLoop хРО(хЬиш┐ЩщЗМцШп NioServerSocketChannel ч╗СхоЪхИ░ bossGroup)ф╕нцЧ╢, ф╝ЪхЬи pipeline ф╕нхПСхЗ║ <strong>fireChannelRegistered</strong> ф║Лф╗╢, цОечЭАх░▒ф╝ЪшзжхПС ChannelInitializer.initChannel цЦ╣ц│ХчЪДш░ГчФи. хЫацндхЬич╗СхоЪхоМцИРхРО, цндцЧ╢чЪД pipeline чЪДхЖЕхжВхжВф╕Л: [<img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182200531.png" alt="Alt text">](https://github.com/yongshun/learn_netty_source_code/blob/master/Netty ц║РчаБхИЖцЮРф╣Л ф╕А цПнх╝А Bootstrap чеЮчзШчЪДч║вчЫЦхд┤ (цЬНхКбхЩичлп)/1477378182291.png)</p> <p>хЙНщЭвцИСф╗мхЬихИЖцЮР bossGroup хТМ workerGroup цЧ╢, х╖▓ч╗ПчЯещБУф║ЖхЬи ServerBootstrapAcceptor.channelRead ф╕нф╝Ъф╕║цЦ░х╗║чЪД Channel шо╛ч╜о handler х╣╢ц│ихЖМхИ░ф╕Аф╕к eventLoop ф╕н, хН│:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Channel</span> child <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span><span class="token punctuation">)</span> msg<span class="token punctuation">;</span>
    child<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>childHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    childGroup<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>шАМш┐ЩщЗМчЪД childHandler х░▒цШпцИСф╗мхЬицЬНхКбхЩичлпхРпхКиф╗гчаБф╕ншо╛ч╜очЪД handler:</p> <div class="language-Java extra-class"><pre class="language-java"><code>b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Override</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
         <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>sslCtx <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>sslCtx<span class="token punctuation">.</span><span class="token function">newHandler</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token comment">//p.addLast(new LoggingHandler(LogLevel.INFO));</span>
         p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EchoServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>хРОч╗нчЪДцнещкдх░▒ц▓бцЬЙф╗Аф╣Ихе╜шп┤чЪДф║Ж, х╜Уш┐Щф╕кховцИ╖члпш┐ЮцОе Channel ц│ихЖМхРО, х░▒ф╝ЪшзжхПС ChannelInitializer.initChannel цЦ╣ц│ХчЪДш░ГчФи, цндхРОчЪДховцИ╖члпчЪД ChannelPipeline чК╢цАБхжВф╕Л:</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182209246.png" alt="цЦ░ховцИ╖члпш┐ЮцОеф╣ЛхРО, NioSocketChannel хп╣х║ФчЪД pipeline.png"></p> <p>цЬАхРОцИСф╗мцЭецА╗ч╗Уф╕Аф╕ЛцЬНхКбхЩичлпчЪД handler ф╕О childHandler чЪДхМ║хИлф╕ОшБФч│╗:</p> <ul><li>хЬицЬНхКбхЩи NioServerSocketChannel чЪД pipeline ф╕нц╖╗хКачЪДцШп handler ф╕О ServerBootstrapAcceptor.</li> <li>х╜УцЬЙцЦ░чЪДховцИ╖члпш┐ЮцОешп╖ц▒ВцЧ╢, ServerBootstrapAcceptor.channelRead ф╕нш┤Яш┤гцЦ░х╗║цндш┐ЮцОечЪД NioSocketChannel х╣╢ц╖╗хКа childHandler хИ░ NioSocketChannel хп╣х║ФчЪД pipeline ф╕н, х╣╢х░Жцнд channel ч╗СхоЪхИ░ workerGroup ф╕нчЪДцЯРф╕к eventLoop ф╕н.</li> <li>handler цШпхЬи accept щШ╢цо╡ш╡╖ф╜ЬчФи, хоГхдДчРЖховцИ╖члпчЪДш┐ЮцОешп╖ц▒В.</li> <li>childHandler цШпхЬиховцИ╖члпш┐ЮцОех╗║члЛф╗ехРОш╡╖ф╜ЬчФи, хоГш┤Яш┤гховцИ╖члпш┐ЮцОечЪД IO ф║дф║Т.</li></ul> <p>ф╕ЛщЭвцИСф╗мчФиф╕Ах╣ЕхЫ╛цЭецА╗ч╗Уф╕Аф╕ЛцЬНхКбхЩичлпчЪД handler ц╖╗хКац╡БчиЛ:</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182210529.png" alt="image-20240918221010465"></p> <h2 id="хРОшо░"><a href="#хРОшо░" class="header-anchor">#</a> хРОшо░</h2> <p>ш┐ЩцШп <strong>Netty ц║РчаБхИЖцЮР</strong> ч│╗хИЧцХЩчиЛчЪДчммф╕АчпЗ, цМЙцИСчЪДшобхИТ, ш┐Щф╕АчпЗцЦЗчлацШпф╕Аф╕кчоАш┐░цАзш┤ичЪД, хН│ш┐ЩщЗМф╝Ъц╢ЙхПКхИ░ Netty хРДф╕кхКЯшГ╜цибхЭЧ, ф╜ЖцШпцИСхПкцШпчоАхНХхЬ░цПРф║Жф╕Аф╕Л, шАМц▓бцЬЙц╖▒хЕехЬ░цОвч┤вхоГф╗мхЖЕщГичЪДхоЮчО░цЬ║чРЖ. ф╣ЛцЙАф╗еш┐Щца╖хБЪ, чммф╕А, цШпхЫаф╕║хжВцЮЬф╕Аф╕КцЭех░▒ф╗Оч╗ЖшКВхИЖцЮР, щВгф╣ИцЬкхЕНф╝ЪщЩ╖хЕехРДчзНчРРчвОчЪДч╗ЖшКВф╕нщЪ╛ф╗ешЗкцЛФ; чммф║М, цИСцГ│ч╗Щшп╗шАЕх▒Хчд║ф╕Аф╕кф╕Аф╕кхоМцХ┤чЪД Netty чЪДш┐РшбМц╡БчиЛ, шойшп╗шАЕф╗Оф╕Аф╕кцХ┤ф╜Уф╕Кхп╣ Netty цЬЙф╕Аф╕кцДЯцАзчЪДшодшпЖ. цндчпЗцЦЗчлац╢ЙхПКчЪДцибхЭЧцпФш╛ГхдЪ, щЭвцпФш╛Гх╣┐, хЫацндхЖЩш╡╖цЭещЪ╛хЕНцЬЙф╕АчВ╣ш╖│ш╖Г, х╣╢ф╕ФцИСцДЯшзЙхЖЩчЭАхЖЩчЭАшзБшзБцЬЙчВ╣ф╕НчЯецЙАф║С, щА╗ш╛Сц╖╖ф╣▒ф║Ж, ц▒Ч. хФЙ, ш┐ШцШпцДЯшзЙшЗкх╖▒хКЯхКЫф╕НхдЯ, hold ф╕Нф╜П. цОеф╕ЛцЭечЪДхЗачпЗцЦЗчла, цИСф╝Ъца╣цНо Netty чЪДхРДф╕кцибхЭЧц╖▒хЕехИЖцЮРф╕Аф╕Л, х╕МцЬЫф╗ехРОчЪДцЦЗчлашГ╜хдЯч╗Дч╗ЗчЪДш░ГчРЖцЫ┤хКац╕ЕцЩ░ф╕Аф║Ы.</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Netty ч│╗ч╗Яшо╛шоб/20.ф╕ЙуАБф╕╗ч║┐ф╗╗хКб/03.Bootstrapя╝Иserverя╝Йц║РчаБшзгцЮР.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/18, 16:19:18</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/9582d0/" class="prev">Bootstrapя╝Иclientя╝Йц║РчаБшзгцЮР</a></span> <span class="next"><a href="/pages/8d1ba9/Channel/">Channel ц║РчаБшзгцЮР</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.6c7acbd0.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/45.685623ac.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
