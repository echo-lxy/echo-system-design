<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sender ç±»ä»£ç åˆ†æ | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ç³»ç»Ÿè®¾è®¡ä¹‹ã€Œè®²è§£ + é¢è¯•æŒ‡å—ã€ï¼Œæ°´æ»´çŸ³ç©¿ï¼Œè®¾è®¡æ— é“¶å¼¹ï¼">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.f82a82e9.css" as="style"><link rel="preload" href="/assets/js/app.78f2b9cc.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/24.891fe6fb.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.b313d17c.js"><link rel="prefetch" href="/assets/js/100.a9558091.js"><link rel="prefetch" href="/assets/js/101.007aa479.js"><link rel="prefetch" href="/assets/js/102.57bca734.js"><link rel="prefetch" href="/assets/js/11.c7521a10.js"><link rel="prefetch" href="/assets/js/12.f57a12da.js"><link rel="prefetch" href="/assets/js/13.d9d26d25.js"><link rel="prefetch" href="/assets/js/14.09cf8a64.js"><link rel="prefetch" href="/assets/js/15.d5a34c66.js"><link rel="prefetch" href="/assets/js/16.8cea924c.js"><link rel="prefetch" href="/assets/js/17.8d94c5e8.js"><link rel="prefetch" href="/assets/js/18.baad837c.js"><link rel="prefetch" href="/assets/js/19.571eaed1.js"><link rel="prefetch" href="/assets/js/20.d70e5281.js"><link rel="prefetch" href="/assets/js/21.0e0ed140.js"><link rel="prefetch" href="/assets/js/22.1ccaa6f3.js"><link rel="prefetch" href="/assets/js/23.623f0b5d.js"><link rel="prefetch" href="/assets/js/25.41dca26b.js"><link rel="prefetch" href="/assets/js/26.6337eac0.js"><link rel="prefetch" href="/assets/js/27.de80589e.js"><link rel="prefetch" href="/assets/js/28.95a1fb6b.js"><link rel="prefetch" href="/assets/js/29.371a40e1.js"><link rel="prefetch" href="/assets/js/3.e62a71e4.js"><link rel="prefetch" href="/assets/js/30.e32f6b31.js"><link rel="prefetch" href="/assets/js/31.21bd2de1.js"><link rel="prefetch" href="/assets/js/32.f1174703.js"><link rel="prefetch" href="/assets/js/33.eab858f3.js"><link rel="prefetch" href="/assets/js/34.4ba0e53e.js"><link rel="prefetch" href="/assets/js/35.8287c9dc.js"><link rel="prefetch" href="/assets/js/36.b5f133ca.js"><link rel="prefetch" href="/assets/js/37.82be3556.js"><link rel="prefetch" href="/assets/js/38.40fe2658.js"><link rel="prefetch" href="/assets/js/39.6450065f.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.591baf2a.js"><link rel="prefetch" href="/assets/js/41.f961e422.js"><link rel="prefetch" href="/assets/js/42.b34f1599.js"><link rel="prefetch" href="/assets/js/43.5a509601.js"><link rel="prefetch" href="/assets/js/44.64fd3383.js"><link rel="prefetch" href="/assets/js/45.685623ac.js"><link rel="prefetch" href="/assets/js/46.b7523f9c.js"><link rel="prefetch" href="/assets/js/47.9bed4c1b.js"><link rel="prefetch" href="/assets/js/48.a1b270df.js"><link rel="prefetch" href="/assets/js/49.ee9681bc.js"><link rel="prefetch" href="/assets/js/5.b472a9bb.js"><link rel="prefetch" href="/assets/js/50.b424b2c0.js"><link rel="prefetch" href="/assets/js/51.53684c6e.js"><link rel="prefetch" href="/assets/js/52.a45a9bb1.js"><link rel="prefetch" href="/assets/js/53.6f165300.js"><link rel="prefetch" href="/assets/js/54.61a6a81b.js"><link rel="prefetch" href="/assets/js/55.5391018d.js"><link rel="prefetch" href="/assets/js/56.e0b862ae.js"><link rel="prefetch" href="/assets/js/57.374534af.js"><link rel="prefetch" href="/assets/js/58.bb9706ba.js"><link rel="prefetch" href="/assets/js/59.6d5a538f.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/60.99b51260.js"><link rel="prefetch" href="/assets/js/61.33893dab.js"><link rel="prefetch" href="/assets/js/62.e6604fa3.js"><link rel="prefetch" href="/assets/js/63.e753bb13.js"><link rel="prefetch" href="/assets/js/64.59e76eda.js"><link rel="prefetch" href="/assets/js/65.66728f4b.js"><link rel="prefetch" href="/assets/js/66.30cbe3ea.js"><link rel="prefetch" href="/assets/js/67.9aea7c9b.js"><link rel="prefetch" href="/assets/js/68.79ee7ba7.js"><link rel="prefetch" href="/assets/js/69.a776cc2e.js"><link rel="prefetch" href="/assets/js/70.13d90b76.js"><link rel="prefetch" href="/assets/js/71.4f4c7733.js"><link rel="prefetch" href="/assets/js/72.b0948cb0.js"><link rel="prefetch" href="/assets/js/73.d7ed15dc.js"><link rel="prefetch" href="/assets/js/74.6884119c.js"><link rel="prefetch" href="/assets/js/75.b70b8a0c.js"><link rel="prefetch" href="/assets/js/76.2766fd7c.js"><link rel="prefetch" href="/assets/js/77.c9b76e03.js"><link rel="prefetch" href="/assets/js/78.9aa9da2e.js"><link rel="prefetch" href="/assets/js/79.ea5b4888.js"><link rel="prefetch" href="/assets/js/8.77b795dd.js"><link rel="prefetch" href="/assets/js/80.3c3f7534.js"><link rel="prefetch" href="/assets/js/81.76b7b1ed.js"><link rel="prefetch" href="/assets/js/82.7b7a2f1c.js"><link rel="prefetch" href="/assets/js/83.44c820ac.js"><link rel="prefetch" href="/assets/js/84.f53c8839.js"><link rel="prefetch" href="/assets/js/85.8c526118.js"><link rel="prefetch" href="/assets/js/86.e17eab25.js"><link rel="prefetch" href="/assets/js/87.a09f72d3.js"><link rel="prefetch" href="/assets/js/88.0f27b036.js"><link rel="prefetch" href="/assets/js/89.2fd11d59.js"><link rel="prefetch" href="/assets/js/9.36f81190.js"><link rel="prefetch" href="/assets/js/90.e60814ad.js"><link rel="prefetch" href="/assets/js/91.08cfa575.js"><link rel="prefetch" href="/assets/js/92.81c822a0.js"><link rel="prefetch" href="/assets/js/93.5f199263.js"><link rel="prefetch" href="/assets/js/94.266b7d71.js"><link rel="prefetch" href="/assets/js/95.0899dfb4.js"><link rel="prefetch" href="/assets/js/96.c1156914.js"><link rel="prefetch" href="/assets/js/97.18525931.js"><link rel="prefetch" href="/assets/js/98.ee554b1a.js"><link rel="prefetch" href="/assets/js/99.f0fb67c2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f82a82e9.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ğŸ é¦–é¡µ</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">âœ’ï¸çƒ­é—¨ç®—æ³•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ–ï¸èµæç»å…¸è®¾è®¡" class="dropdown-title"><!----> <span class="title" style="display:;">ğŸ–ï¸èµæç»å…¸è®¾è®¡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">JUC ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ç³»ç»Ÿè®¾è®¡</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ğŸ§‘â€ğŸ’»å®æˆ˜ç³»ç»Ÿè®¾è®¡</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">â“é—®ç­”</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ğŸ‘€åŠ¨æ€</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ğŸ é¦–é¡µ</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">âœ’ï¸çƒ­é—¨ç®—æ³•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ–ï¸èµæç»å…¸è®¾è®¡" class="dropdown-title"><!----> <span class="title" style="display:;">ğŸ–ï¸èµæç»å…¸è®¾è®¡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">JUC ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ç³»ç»Ÿè®¾è®¡</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ğŸ§‘â€ğŸ’»å®æˆ˜ç³»ç»Ÿè®¾è®¡</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">â“é—®ç­”</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ğŸ‘€åŠ¨æ€</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä¸€ã€å‰è¨€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ä¸‰ã€ä¸»çº¿ä»»åŠ¡</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/46a58a/" class="sidebar-link">Kafka æ•´ä½“æ¶æ„</a></li><li><a href="/pages/bb1005/" class="sidebar-link">ç”Ÿäº§è€…</a></li><li><a href="/pages/aa0392/" class="sidebar-link">Broker</a></li><li><a href="/pages/ca141b/" class="sidebar-link">æ¶ˆè´¹è€…</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>ã€Œç”Ÿäº§è€…ã€æºç åˆ†æ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/19bf78/" class="sidebar-link">Kafka Producer è®¾è®¡åˆ†æ</a></li><li><a href="/pages/32a8ff/" class="sidebar-link">Kafka Producer æºç åˆ†æ</a></li><li><a href="/pages/b77953/" class="sidebar-link">RecordAccumulator æºç åˆ†æ</a></li><li><a href="/pages/bf1d55/" aria-current="page" class="active sidebar-link">Sender ç±»ä»£ç åˆ†æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/bf1d55/#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header level2"><a href="/pages/bf1d55/#sender-ç±»æ ¸å¿ƒä»£ç " class="sidebar-link">Sender ç±»æ ¸å¿ƒä»£ç </a></li><li class="sidebar-sub-header level2"><a href="/pages/bf1d55/#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li><li class="sidebar-sub-header level2"><a href="/pages/bf1d55/#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a></li></ul></li><li><a href="/pages/b2caf1/" class="sidebar-link">NetworkClient ç±»ä»£ç åˆ†æ</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Œæ¶ˆè´¹è€…ã€æºç åˆ†æ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€ŒBrokerã€åŸç†åˆ†æ</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å››ã€è®¾è®¡ç›®æ ‡</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Kafka  ç³»ç»Ÿè®¾è®¡</span></li><li data-v-06225672><span data-v-06225672>ä¸‰ã€ä¸»çº¿ä»»åŠ¡</span></li><li data-v-06225672><span data-v-06225672>ã€Œç”Ÿäº§è€…ã€æºç åˆ†æ</span></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>echo</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><!---->Sender ç±»ä»£ç åˆ†æ<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>ä¸Šæ–‡æˆ‘ä»¬è®²åˆ°å¾…å‘é€çš„æ¶ˆæ¯å·²ç»ç¼“å­˜åœ¨RecordAccumulatorä¸­ã€‚KafkaProducerå¾—çŸ¥æœ‰Batchå·²ç»æ»¡äº†ï¼Œå°±ä¼š<strong>é€šçŸ¥</strong>Senderå¼€å§‹å¹²æ´»ã€‚æœ¬ç¯‡æˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹Senderçš„è®¾è®¡å’Œå®ç°ã€‚</p> <p>Senderåœ¨KafkaProducerä¸­ä»¥<strong>ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹</strong>è¿è¡Œï¼ŒæŠŠRecordAccumulatorä¸­å°ç®±åçš„ProducerBatchå‘é€å‡ºå»ã€‚ç½‘ç»œIOæ˜¯ç”±Senderè§¦å‘çš„ã€‚</p> <p>SenderæŠŠProducerBatchæŒ‰ç…§è¦å‘å¾€çš„broker nodeè¿›è¡Œåˆ†ç±»ï¼Œå‘å¾€åŒä¸€ä¸ªnodeçš„ProducerBatchä¼šè¢«æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œåªè§¦å‘ä¸€æ¬¡ç½‘ç»œIOã€‚ä¾‹å¦‚ä¸»é¢˜Aåˆ†åŒº1å’Œä¸»é¢˜Båˆ†åŒº2å­˜æ”¾åœ¨åŒä¸€ä¸ªnodeä¸Šï¼Œé‚£ä¹ˆSendåœ¨IOå‰ä¼šæŠŠè¿™ä¸¤ä¸ªä¸»é¢˜åˆ†åŒºçš„æ¶ˆæ¯æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç”Ÿæˆä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œä¸€å¹¶å‘è¿‡å»ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†ç½‘ç»œIOçš„å¼€é”€ã€‚</p> <p>æˆ‘è¿˜æ˜¯ä»¥å‘é€å¿«é€’ä¸¾ä¾‹ç±»æ¯”ï¼Œè¿™æ¬¡æ˜¯æŠŠè´§ç®±è£…è½¦çš„åœºæ™¯ï¼š</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409181627060.png" alt="image-20240918162740988"></p> <p>ç»¿è‰²è¡£æœçš„å°äººæ˜¯è£…ç®±å·¥ä½œäººå‘˜ï¼Œè´Ÿè´£æŠŠè´§ç®±è£…åˆ°å¯¹åº”çš„è½¦ä¸Šã€‚å¯ä»¥çœ‹åˆ°è½¦æ˜¯æŒ‰ç…§å¿«é€’ç«™ç‚¹åŒºåˆ†çš„ï¼Œé‚£ä¹ˆæœé˜³åŒ—äº¬å’Œæ²³åŒ—å”å±±çš„è´§ç®±éƒ½è¦è£…åˆ°ååŒ—ä¸€åŒºçš„è½¦ä¸Šã€‚è¿™æ ·ä¸€è¶Ÿè½¦å°±å¯ä»¥æŠŠåŒ—äº¬å’Œå”å±±çš„åŒ…è£¹ä¸€èµ·å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ä¸¤è¾†è½¦åˆ†åˆ«å‘é€ã€‚</p> <p>å…¶å®è¿™ä¸ªç»¿è‰²å°äººå°±æ˜¯senderï¼Œå®ƒè´Ÿè´£æŠŠä¸åŒä¸»é¢˜åˆ†åŒºçš„ProducerBatchï¼ˆè´§ç®±ï¼‰å°è£…è¿›åŒä¸€ä¸ªClientRequestï¼ˆè´§è½¦é›†è£…ç®±ï¼‰ï¼Œå‰ææ˜¯è¿™äº›ä¸»é¢˜åˆ†åŒºå­˜å‚¨åœ¨åŒä¸€ä¸ªbrokerä¸Šï¼ˆéƒ½å±ååŒ—ä¸€åŒºï¼‰ï¼Œç„¶åé€šè¿‡NetWorkClientï¼ˆè´§è½¦ï¼‰çœŸæ­£ç½‘ç»œIOå‘å¾€Brokerï¼ˆååŒ—ä¸€åŒºç«™ç‚¹ï¼‰ã€‚</p> <p>ä¸‹é¢è¿›å…¥Senderçš„ä»£ç è®²è§£ã€‚</p> <h2 id="sender-ç±»æ ¸å¿ƒä»£ç "><a href="#sender-ç±»æ ¸å¿ƒä»£ç " class="header-anchor">#</a> Sender ç±»æ ¸å¿ƒä»£ç </h2> <p>ä»Senderè®¾è®¡å¯ä»¥çœ‹åˆ°ï¼ŒSenderå†…éƒ¨æœ‰ä¸¤ä¸ªé‡è¦çš„å®ä¾‹å¼•ç”¨ï¼Œä¸€ä¸ªå°±æ˜¯ä»“åº“ï¼šRecordAccumulatorï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯é‚£ä¸€è¾†è¾†è½¦ï¼šè´Ÿè´£ç½‘ç»œIOçš„KafkaClientå¯¹è±¡ã€‚KafkaClientè´Ÿè´£è®©ä¸åŒçš„è½¦æ‰¾åˆ°é€šå¾€å„è‡ªç›®çš„åœ°çš„è·¯ï¼ŒæŠŠè´§ç‰©è¿é€è¿‡å»ã€‚KafkaClientåé¢ä¼šå•ç‹¬è®²è§£ï¼Œæœ¬ç¯‡æˆ‘ä»¬ä¸“æ³¨äºåˆ†æsender<strong>æ€ä¹ˆæŠŠæ¶ˆæ¯é‡æ–°åˆ†ç»„è£…è½¦</strong>ã€‚</p> <h3 id="run-æ–¹æ³•"><a href="#run-æ–¹æ³•" class="header-anchor">#</a> run()æ–¹æ³•</h3> <p>Senderå®ç°Runnableæ¥å£ï¼Œé‡å†™runæ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯çº¿ç¨‹çš„å¯åŠ¨å…¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Starting Kafka producer I/O thread.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// main loop, runs until close is called</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">run</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Uncaught error in kafka producer I/O thread: &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Beginning shutdown of Kafka producer I/O thread, sending remaining records.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// okay we stopped accepting requests but there may still be</span>
    <span class="token comment">// requests in the accumulator or waiting for acknowledgment,</span>
    <span class="token comment">// wait until these are completed.</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>forceClose <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">hasUndrained</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">inFlightRequestCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">run</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Uncaught error in kafka producer I/O thread: &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>forceClose<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We need to fail all the incomplete batches and wake up the threads waiting on</span>
        <span class="token comment">// the futures.</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Aborting incomplete batches due to forced shutdown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">abortIncompleteBatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to close network client&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Shutdown of Kafka producer I/O thread has completed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>run æ–¹æ³•ä¸»å¾ªç¯ä¸­è°ƒç”¨ run(time.milliseconds()) æ–¹æ³•ï¼Œsender çš„ä¸»è¦é€»è¾‘å®é™…åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼šä¸€æ—¦runningä¸ºfalseè·³å‡ºä¸»å¾ªç¯ï¼Œæ ¹æ®çŠ¶æ€åˆ¤æ–­æ˜¯ç»§ç»­å‘é€å®Œæˆï¼Œè¿˜æ˜¯å¼ºåˆ¶å…³é—­ã€‚å¼ºåˆ¶å…³é—­çš„è¯ï¼Œé€šè¿‡ accumulator.abortIncompleteBatches() æŠŠRecourdAccumulatorä¸­incompleteé›†åˆä¸­ä¿å­˜çš„æœªå®ŒæˆProducerBatchåšç›¸åº”çš„å¤„ç†ï¼Œå¯¹ä»–ä»¬è¿›è¡Œå°ç®±ï¼Œé˜²æ­¢ç»§ç»­æœ‰æ–°çš„æ¶ˆæ¯è¢«è¿½åŠ è¿›æ¥ï¼Œç„¶åä»æ‰€å±Dequeä¸­åˆ é™¤æ‰ï¼Œé‡Šæ”¾æ‰BufferPoolä¸­çš„ç©ºé—´ã€‚è¿™éƒ¨åˆ†æ ¸å¿ƒçš„ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">abortBatches</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RuntimeException</span> reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProducerBatch</span> batch <span class="token operator">:</span> incomplete<span class="token punctuation">.</span><span class="token function">copyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span></span> dq <span class="token operator">=</span> <span class="token function">getDeque</span><span class="token punctuation">(</span>batch<span class="token punctuation">.</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>dq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            batch<span class="token punctuation">.</span><span class="token function">abortRecordAppends</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dq<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        batch<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">deallocate</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>run æ–¹æ³•æœ€åå…³é—­è´Ÿè´£ç½‘ç»œ IO çš„NetworkClient</p> <h3 id="run-long-now-æ–¹æ³•"><a href="#run-long-now-æ–¹æ³•" class="header-anchor">#</a> run(long now) æ–¹æ³•</h3> <p>senderçš„ä¸»è¦é€»è¾‘å®é™…åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ã€‚è¿™ä¸ªæ–¹æ³•å‰é¢ä¸€å¤§æ®µé€»è¾‘éƒ½æ˜¯å¤„ç†å¼€å¯äº‹ç‰©çš„æ¶ˆæ¯å‘é€ï¼Œæˆ‘ä»¬ä¸ºäº†ç®€åŒ–ä»£ç ç†è§£ï¼Œä¸åšè¿™éƒ¨åˆ†åˆ†æï¼Œç›´æ¥è¿›å…¥éäº‹åŠ¡çš„æ¶ˆæ¯å‘é€é€»è¾‘ä¸­</p> <p>éäº‹åŠ¡çš„æ¶ˆæ¯å‘é€åªæœ‰ä¸¤è¡Œå…³é”®ä»£ç ï¼š</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">long</span> pollTimeout <span class="token operator">=</span> <span class="token function">sendProducerData</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>pollTimeout<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><p>å‡†å¤‡å‘é€çš„æ•°æ®è¯·æ±‚</p></li> <li><p>æŠŠå‡†å¤‡å¥½çš„æ¶ˆæ¯è¯·æ±‚çœŸæ­£å‘é€å‡ºå»</p></li></ol> <p>ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹å‡†å¤‡æ•°æ®è¯·æ±‚çš„æ–¹æ³•sendProducerData()ã€‚</p> <h3 id="sendproducerdata-æ–¹æ³•"><a href="#sendproducerdata-æ–¹æ³•" class="header-anchor">#</a> sendProducerData()æ–¹æ³•</h3> <p>è¿™ä¸ªæ–¹æ³•æ˜¯senderçš„ä¸»æµç¨‹ï¼Œéœ€è¦è®¤çœŸç†è§£ã€‚æˆ‘å…ˆè´´ä»£ç ï¼Œä»£ç ä¸‹ç´§è·Ÿé€»è¾‘è®²è§£</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">long</span> <span class="token function">sendProducerData</span><span class="token punctuation">(</span><span class="token keyword">long</span> now<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
    <span class="token class-name">Cluster</span> cluster <span class="token operator">=</span> metadata<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// get the list of partitions with data ready to send</span>
    <span class="token class-name">RecordAccumulator<span class="token punctuation">.</span>ReadyCheckResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span>cluster<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// if there are any partitions whose leaders are not known yet, force metadata update</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>unknownLeaderTopics<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// The set of topics with unknown leader contains topics with leader election pending as well as</span>
        <span class="token comment">// topics which may have expired. Add the topic again to metadata to ensure it is included</span>
        <span class="token comment">// and request metadata update, since there are messages to send to the topic.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> topic <span class="token operator">:</span> result<span class="token punctuation">.</span>unknownLeaderTopics<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Requesting metadata update due to unknown leader topics from the batched records: {}&quot;</span><span class="token punctuation">,</span>
            result<span class="token punctuation">.</span>unknownLeaderTopics<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>metadata<span class="token punctuation">.</span><span class="token function">requestUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// remove any nodes we aren't ready to send to</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> result<span class="token punctuation">.</span>readyNodes<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> notReadyTimeout <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span> node <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            iter<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            notReadyTimeout <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>notReadyTimeout<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">pollDelayMs</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// create produce requests</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> batches <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">drain</span><span class="token punctuation">(</span>cluster<span class="token punctuation">,</span> result<span class="token punctuation">.</span>readyNodes<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxRequestSize<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addToInflightBatches</span><span class="token punctuation">(</span>batches<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>guaranteeMessageOrder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Mute all the partitions drained</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span></span> batchList <span class="token operator">:</span> batches<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProducerBatch</span> batch <span class="token operator">:</span> batchList<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">mutePartition</span><span class="token punctuation">(</span>batch<span class="token punctuation">.</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 
    accumulator<span class="token punctuation">.</span><span class="token function">resetNextBatchExpiryTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span></span> expiredInflightBatches <span class="token operator">=</span> <span class="token function">getExpiredInflightBatches</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span></span> expiredBatches <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">expiredBatches</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    expiredBatches<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>expiredInflightBatches<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Reset the producer id if an expired batch has previously been sent to the broker. Also update the metrics</span>
    <span class="token comment">// for expired batches. see the documentation of @TransactionState.resetProducerId to understand why</span>
    <span class="token comment">// we need to reset the producer id here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>expiredBatches<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Expired {} batches in accumulator&quot;</span><span class="token punctuation">,</span> expiredBatches<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProducerBatch</span> expiredBatch <span class="token operator">:</span> expiredBatches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> errorMessage <span class="token operator">=</span> <span class="token string">&quot;Expiring &quot;</span> <span class="token operator">+</span> expiredBatch<span class="token punctuation">.</span>recordCount <span class="token operator">+</span> <span class="token string">&quot; record(s) for &quot;</span> <span class="token operator">+</span> expiredBatch<span class="token punctuation">.</span>topicPartition
            <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> expiredBatch<span class="token punctuation">.</span>createdMs<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ms has passed since batch creation&quot;</span><span class="token punctuation">;</span>
        <span class="token function">failBatch</span><span class="token punctuation">(</span>expiredBatch<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NO_TIMESTAMP</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>transactionManager <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> expiredBatch<span class="token punctuation">.</span><span class="token function">inRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// This ensures that no new batches are drained until the current in flight batches are fully resolved.</span>
            transactionManager<span class="token punctuation">.</span><span class="token function">markSequenceUnresolved</span><span class="token punctuation">(</span>expiredBatch<span class="token punctuation">.</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    sensors<span class="token punctuation">.</span><span class="token function">updateProduceRequestMetrics</span><span class="token punctuation">(</span>batches<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// If we have any nodes that are ready to send + have sendable data, poll with 0 timeout so this can immediately</span>
    <span class="token comment">// loop and try sending more data. Otherwise, the timeout will be the smaller value between next batch expiry</span>
    <span class="token comment">// time, and the delay time for checking data availability. Note that the nodes may have data that isn't yet</span>
    <span class="token comment">// sendable due to lingering, backing off, etc. This specifically does not include nodes with sendable data</span>
    <span class="token comment">// that aren't ready to send since they would cause busy looping.</span>
    <span class="token keyword">long</span> pollTimeout <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>nextReadyCheckDelayMs<span class="token punctuation">,</span> notReadyTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pollTimeout <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>pollTimeout<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accumulator<span class="token punctuation">.</span><span class="token function">nextExpiryTimeMs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pollTimeout <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>pollTimeout<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span>readyNodes<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Nodes with data ready to send: {}&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>readyNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// if some partitions are already ready to be sent, the select time would be 0;</span>
        <span class="token comment">// otherwise if some partition already has some data accumulated but not ready yet,</span>
        <span class="token comment">// the select time will be the time difference between now and its linger expiry time;</span>
        <span class="token comment">// otherwise the select time will be the time difference between now and the metadata expiry time;</span>
        pollTimeout <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">sendProduceRequests</span><span class="token punctuation">(</span>batches<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pollTimeout<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š</p> <ol><li>æ ¹æ®accumulatorä¸­å¾…å‘é€æ¶ˆæ¯å¯¹åº”çš„ä¸»é¢˜åˆ†åŒºï¼Œæ£€æŸ¥kafkaé›†ç¾¤å¯¹åº”çš„nodeå“ªäº›å¯ç”¨ï¼Œå“ªäº›ä¸å¯ç”¨ã€‚å¾—åˆ°ReadyCheckResult ç»“æœ</li> <li>å¦‚æœReadyCheckResult ä¸­çš„unknownLeaderTopicsæœ‰å€¼ï¼Œé‚£ä¹ˆåˆ™éœ€è¦æ›´æ–°Kafkaé›†ç¾¤å…ƒæ•°æ®</li> <li>å¾ªç¯readyNodesï¼Œæ£€æŸ¥KafkaClientå¯¹è¯¥nodeæ˜¯å¦ç¬¦åˆç½‘ç»œIOçš„æ¡ä»¶ï¼Œä¸ç¬¦åˆçš„ä»é›†åˆä¸­åˆ é™¤ã€‚</li> <li>é€šè¿‡accumulator.drain()æ–¹æ³•æŠŠå¾…å‘é€çš„æ¶ˆæ¯æŒ‰nodeå·è¿›è¡Œåˆ†ç»„ï¼Œè¿”å›Map&lt;Integer, List<ProducerBatch>&gt;</ProducerBatch></li> <li>æŠŠå¾…å‘é€çš„batchæ·»åŠ åˆ°Senderçš„inFlightBatchesä¸­ã€‚inFlightBatchesæ˜¯Map&lt;TopicPartition,List<ProducerBatch>&gt;ï¼Œå¯è§æ˜¯ç…§ä¸»é¢˜åˆ†åŒºæ¥å­˜å‚¨çš„ã€‚</ProducerBatch></li> <li>è·å–æ‰€æœ‰è¿‡æœŸçš„batchï¼Œå¾ªç¯åšè¿‡æœŸå¤„ç†</li> <li>è®¡ç®—æ¥ä¸‹æ¥å¤–å±‚ç¨‹åºé€»è¾‘ä¸­è°ƒç”¨NetWorkClientçš„pollæ“ä½œæ—¶çš„timeoutæ—¶é—´</li> <li>è°ƒç”¨sendProduceRequests()æ–¹æ³•ï¼Œå°†å¾…å‘é€çš„ProducerBatchå°è£…æˆä¸ºClientRequestï¼Œç„¶åâ€œå‘é€â€å‡ºå»ã€‚æ³¨æ„è¿™é‡Œçš„å‘é€ï¼Œå…¶å®æ˜¯åŠ å…¥å‘é€çš„é˜Ÿåˆ—ã€‚ç­‰åˆ°NetWorkClientè¿›è¡Œpollæ“ä½œæ—¶ï¼Œæ‰å‘ç”Ÿç½‘ç»œIO</li> <li>è¿”å›ç¬¬7æ­¥ä¸­è®¡ç®—çš„pollæ“ä½œtimeoutæ—¶é—´</li></ol> <p>ä¸‹é¢æˆ‘ä»¬é‡ç‚¹æ¥æ¥ç¬¬8æ­¥çš„<code>sendProduceRequests()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­å®é™…æ˜¯æŒ‰ç…§nodeç¼–å·å¾ªç¯ç¬¬4æ­¥å¾—åˆ°çš„<code>Map&lt;Integer, List&lt;ProducerBatch&gt;&gt; batches</code>ï¼Œå–å¾—nodeå¯¹åº”çš„<code>List&lt;ProducerBatch&gt;</code>,ç„¶åè°ƒç”¨<code>sendProduceRequest()</code>ã€‚å°è£… ClientRequestæ˜¯åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œçš„ã€‚</p> <h3 id="sendproducerequest-æ–¹æ³•"><a href="#sendproducerequest-æ–¹æ³•" class="header-anchor">#</a> sendProduceRequest() æ–¹æ³•</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendProduceRequest</span><span class="token punctuation">(</span><span class="token keyword">long</span> now<span class="token punctuation">,</span> <span class="token keyword">int</span> destination<span class="token punctuation">,</span> <span class="token keyword">short</span> acks<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span></span> batches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>batches<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
 
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">,</span> <span class="token class-name">MemoryRecords</span><span class="token punctuation">&gt;</span></span> produceRecordsByPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>batches<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TopicPartition</span><span class="token punctuation">,</span> <span class="token class-name">ProducerBatch</span><span class="token punctuation">&gt;</span></span> recordsByPartition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>batches<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">// find the minimum magic version used when creating the record sets</span>
        <span class="token keyword">byte</span> minUsedMagic <span class="token operator">=</span> apiVersions<span class="token punctuation">.</span><span class="token function">maxUsableProduceMagic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProducerBatch</span> batch <span class="token operator">:</span> batches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>batch<span class="token punctuation">.</span><span class="token function">magic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> minUsedMagic<span class="token punctuation">)</span>
                minUsedMagic <span class="token operator">=</span> batch<span class="token punctuation">.</span><span class="token function">magic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProducerBatch</span> batch <span class="token operator">:</span> batches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TopicPartition</span> tp <span class="token operator">=</span> batch<span class="token punctuation">.</span>topicPartition<span class="token punctuation">;</span>
            <span class="token class-name">MemoryRecords</span> records <span class="token operator">=</span> batch<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token comment">// down convert if necessary to the minimum magic used. In general, there can be a delay between the time</span>
            <span class="token comment">// that the producer starts building the batch and the time that we send the request, and we may have</span>
            <span class="token comment">// chosen the message format based on out-dated metadata. In the worst case, we optimistically chose to use</span>
            <span class="token comment">// the new message format, but found that the broker didn't support it, so we need to down-convert on the</span>
            <span class="token comment">// client before sending. This is intended to handle edge cases around cluster upgrades where brokers may</span>
            <span class="token comment">// not all support the same message format version. For example, if a partition migrates from a broker</span>
            <span class="token comment">// which is supporting the new magic version to one which doesn't, then we will need to convert.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>records<span class="token punctuation">.</span><span class="token function">hasMatchingMagic</span><span class="token punctuation">(</span>minUsedMagic<span class="token punctuation">)</span><span class="token punctuation">)</span>
                records <span class="token operator">=</span> batch<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downConvert</span><span class="token punctuation">(</span>minUsedMagic<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            produceRecordsByPartition<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>tp<span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span>
            recordsByPartition<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>tp<span class="token punctuation">,</span> batch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token class-name">String</span> transactionalId <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>transactionManager <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> transactionManager<span class="token punctuation">.</span><span class="token function">isTransactional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            transactionalId <span class="token operator">=</span> transactionManager<span class="token punctuation">.</span><span class="token function">transactionalId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">ProduceRequest<span class="token punctuation">.</span>Builder</span> requestBuilder <span class="token operator">=</span> <span class="token class-name">ProduceRequest<span class="token punctuation">.</span>Builder</span><span class="token punctuation">.</span><span class="token function">forMagic</span><span class="token punctuation">(</span>minUsedMagic<span class="token punctuation">,</span> acks<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span>
                produceRecordsByPartition<span class="token punctuation">,</span> transactionalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RequestCompletionHandler</span> callback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestCompletionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token class-name">ClientResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">handleProduceResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> recordsByPartition<span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
        <span class="token class-name">String</span> nodeId <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ClientRequest</span> clientRequest <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newClientRequest</span><span class="token punctuation">(</span>nodeId<span class="token punctuation">,</span> requestBuilder<span class="token punctuation">,</span> now<span class="token punctuation">,</span> acks <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                requestTimeoutMs<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>clientRequest<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Sent produce request to {}: {}&quot;</span><span class="token punctuation">,</span> nodeId<span class="token punctuation">,</span> requestBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸ªæ–¹æ³•çš„è¾“å…¥çš„<code>List&lt;ProducerBatch&gt; batches</code>å·²ç»æ˜¯æŒ‰ç…§nodeåˆ†å¥½ç»„çš„ï¼Œåˆ—è¡¨ä¸­çš„ProducerBatchä¸ä¸€å®šåœ¨åŒä¸€ä¸ªä¸»é¢˜åˆ†åŒºï¼Œä½†æ‰€å±ä¸»é¢˜åˆ†åŒºè‚¯å®šåœ¨åŒä¸€ä¸ªnodeä¸Šã€‚</p> <ol><li><p>å¾ªç¯batchesï¼ŒMemoryRecords records = batch.records(); è·å–ProducerBatchä¸­ç»„ç»‡å¥½çš„æ¶ˆæ¯å†…å®¹ä¹Ÿã€‚æŒ‰ç…§ä¸»é¢˜åˆ†åŒºåˆ†å †ProducerBatchå’ŒMemoryRecordså¾—åˆ°ä¸¤ä¸ªä»¥TopicPartitionä¸ºKeyçš„Mapï¼ŒproduceRecordsByPartitionå’ŒrecordsByPartition</p></li> <li><p>å£°æ˜ProduceRequest.Builderå¯¹è±¡ï¼Œä»–å†…éƒ¨æœ‰å¼•ç”¨æŒ‡å‘produceRecordsByPartition</p></li> <li><p>ç”ŸæˆClientRequestå¯¹è±¡</p></li> <li><p>è°ƒç”¨NetWorkClientçš„sendæ–¹æ³•ã€‚</p></li></ol> <p>åœ¨NetWorkClientçš„sendæ–¹æ³•ä¸­ï¼Œé€šè¿‡Builderå¯¹è±¡çš„buildæ–¹æ³•ç”ŸæˆProduceRequestå¯¹è±¡ã€‚å†é€šè¿‡request.toSend(destination, header)ï¼Œå¾—åˆ°NetworkSendå¯¹è±¡sendã€‚ç”ŸæˆInFlightRequestå¯¹è±¡ï¼Œä¿å­˜èµ·æ¥ã€‚æœ€åè°ƒç”¨selector.send(send)ï¼›è¿™ä¸ªæ–¹æ³•ä¼šæŠŠsendè¯·æ±‚åŠ å…¥é˜Ÿåˆ—ç­‰å¾…éšåçš„pollæ–¹æ³•æŠŠå®ƒå‘é€å‡ºå»ã€‚</p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>è®²è§£åˆ°è¿™é‡Œï¼Œå› ä¸ºæ¶‰åŠåˆ°NIOçš„æ¦‚å¿µï¼Œè€ŒKafkaåˆå¯¹NIOåšäº†å°è£…ï¼Œæ‰€ä»¥ä¼šéš¾ä»¥ç†è§£ã€‚æœ¬ç¯‡å¤§å®¶åªè¦èƒ½æ˜ç™½æˆ‘ä»¬åœ¨sendProduceRequest()æ–¹æ³•ä¸­ï¼Œç”ŸæˆæŒ‰kafka nodeåˆ’åˆ†çš„è¯·æ±‚å¯¹è±¡ClientRequestï¼Œç„¶åäº¤ç»™NetWorkClientå¤„ç†ã€‚å…³äºNetWorkClientå¦‚ä½•é€šè¿‡NIOæ–¹å¼æŠŠClientRequestå‘é€å‡ºå»ï¼Œæˆ‘ä»¬ä»¥åçš„ç« èŠ‚å†è®²ã€‚</p> <h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <p><a href="https://blog.csdn.net/liyiming2017/article/details/89011519" target="_blank" rel="noopener noreferrer">ä½ ç»å¯¹èƒ½çœ‹æ‡‚çš„Kafkaæºä»£ç åˆ†æ-Senderç±»ä»£ç åˆ†æ_kafka produceræºç senderçº¿ç¨‹-CSDNåšå®¢<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/02.Kafka  ç³»ç»Ÿè®¾è®¡/06.ä¸‰ã€ä¸»çº¿ä»»åŠ¡/500.ã€Œç”Ÿäº§è€…ã€æºç åˆ†æ/40.Sender ç±»ä»£ç åˆ†æ.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°äº:</span> <span class="time">2024/09/18, 11:29:27</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/b77953/" class="prev">RecordAccumulator æºç åˆ†æ</a></span> <span class="next"><a href="/pages/b2caf1/">NetworkClient ç±»ä»£ç åˆ†æ</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.78f2b9cc.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/24.891fe6fb.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
