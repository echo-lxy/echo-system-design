<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>чммф║Мшп╛я╝ЪReactorхЬи Netty ф╕нчЪДхоЮчО░я╝ИхИЫх╗║чпЗя╝Й | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ч│╗ч╗Яшо╛шобф╣ЛуАМшо▓шзг + щЭвшпХцМЗхНЧуАНя╝Мц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣я╝Б">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.c76c3453.css" as="style"><link rel="preload" href="/assets/js/app.bdcc6820.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/52.24cc5c91.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.2cc95be8.js"><link rel="prefetch" href="/assets/js/100.152e23f6.js"><link rel="prefetch" href="/assets/js/101.99b73fec.js"><link rel="prefetch" href="/assets/js/11.c7521a10.js"><link rel="prefetch" href="/assets/js/12.38d1989d.js"><link rel="prefetch" href="/assets/js/13.850793b0.js"><link rel="prefetch" href="/assets/js/14.1141ec27.js"><link rel="prefetch" href="/assets/js/15.8f1b4081.js"><link rel="prefetch" href="/assets/js/16.e52ba8b4.js"><link rel="prefetch" href="/assets/js/17.acb3bf3d.js"><link rel="prefetch" href="/assets/js/18.5df2a013.js"><link rel="prefetch" href="/assets/js/19.571eaed1.js"><link rel="prefetch" href="/assets/js/20.fe7d08c7.js"><link rel="prefetch" href="/assets/js/21.0e0ed140.js"><link rel="prefetch" href="/assets/js/22.dd779f94.js"><link rel="prefetch" href="/assets/js/23.4d814163.js"><link rel="prefetch" href="/assets/js/24.e94253bb.js"><link rel="prefetch" href="/assets/js/25.1d172890.js"><link rel="prefetch" href="/assets/js/26.6337eac0.js"><link rel="prefetch" href="/assets/js/27.eeee1d20.js"><link rel="prefetch" href="/assets/js/28.6fa848cf.js"><link rel="prefetch" href="/assets/js/29.4ff6fa35.js"><link rel="prefetch" href="/assets/js/3.08ee786a.js"><link rel="prefetch" href="/assets/js/30.892b2994.js"><link rel="prefetch" href="/assets/js/31.df4cc39d.js"><link rel="prefetch" href="/assets/js/32.f1174703.js"><link rel="prefetch" href="/assets/js/33.64ab8d0c.js"><link rel="prefetch" href="/assets/js/34.405ab364.js"><link rel="prefetch" href="/assets/js/35.8287c9dc.js"><link rel="prefetch" href="/assets/js/36.be98cc35.js"><link rel="prefetch" href="/assets/js/37.82be3556.js"><link rel="prefetch" href="/assets/js/38.40fe2658.js"><link rel="prefetch" href="/assets/js/39.6e2f31a6.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.0ada49bd.js"><link rel="prefetch" href="/assets/js/41.fcee3e0f.js"><link rel="prefetch" href="/assets/js/42.f5fdb401.js"><link rel="prefetch" href="/assets/js/43.5a509601.js"><link rel="prefetch" href="/assets/js/44.64fd3383.js"><link rel="prefetch" href="/assets/js/45.685623ac.js"><link rel="prefetch" href="/assets/js/46.7624d38c.js"><link rel="prefetch" href="/assets/js/47.cc86aae6.js"><link rel="prefetch" href="/assets/js/48.ba7dfd47.js"><link rel="prefetch" href="/assets/js/49.15d8e916.js"><link rel="prefetch" href="/assets/js/5.94727770.js"><link rel="prefetch" href="/assets/js/50.b424b2c0.js"><link rel="prefetch" href="/assets/js/51.ef213b56.js"><link rel="prefetch" href="/assets/js/53.16def11d.js"><link rel="prefetch" href="/assets/js/54.8604fc24.js"><link rel="prefetch" href="/assets/js/55.78a9171b.js"><link rel="prefetch" href="/assets/js/56.94e28708.js"><link rel="prefetch" href="/assets/js/57.9f8a974b.js"><link rel="prefetch" href="/assets/js/58.24008d78.js"><link rel="prefetch" href="/assets/js/59.28ca51b4.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/60.1714dba8.js"><link rel="prefetch" href="/assets/js/61.08b4acf0.js"><link rel="prefetch" href="/assets/js/62.cc8fdced.js"><link rel="prefetch" href="/assets/js/63.41ff19e4.js"><link rel="prefetch" href="/assets/js/64.9b3def35.js"><link rel="prefetch" href="/assets/js/65.0b2ab47d.js"><link rel="prefetch" href="/assets/js/66.2ae7a107.js"><link rel="prefetch" href="/assets/js/67.79dd6daf.js"><link rel="prefetch" href="/assets/js/68.c27f5109.js"><link rel="prefetch" href="/assets/js/69.5f61d937.js"><link rel="prefetch" href="/assets/js/70.b920a5f7.js"><link rel="prefetch" href="/assets/js/71.f44644ed.js"><link rel="prefetch" href="/assets/js/72.9a370df8.js"><link rel="prefetch" href="/assets/js/73.bc16a468.js"><link rel="prefetch" href="/assets/js/74.d9ad1a67.js"><link rel="prefetch" href="/assets/js/75.7c86d41a.js"><link rel="prefetch" href="/assets/js/76.15a7bb60.js"><link rel="prefetch" href="/assets/js/77.c89b4964.js"><link rel="prefetch" href="/assets/js/78.c0a4ffae.js"><link rel="prefetch" href="/assets/js/79.0906d2fb.js"><link rel="prefetch" href="/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/assets/js/80.fdcb5fa1.js"><link rel="prefetch" href="/assets/js/81.711911b1.js"><link rel="prefetch" href="/assets/js/82.e54c087e.js"><link rel="prefetch" href="/assets/js/83.65db62ac.js"><link rel="prefetch" href="/assets/js/84.e5207e82.js"><link rel="prefetch" href="/assets/js/85.4cd3a775.js"><link rel="prefetch" href="/assets/js/86.931cbb70.js"><link rel="prefetch" href="/assets/js/87.47ba635a.js"><link rel="prefetch" href="/assets/js/88.93192130.js"><link rel="prefetch" href="/assets/js/89.e05e3a70.js"><link rel="prefetch" href="/assets/js/9.6e274fca.js"><link rel="prefetch" href="/assets/js/90.ca1ff100.js"><link rel="prefetch" href="/assets/js/91.8ad18b18.js"><link rel="prefetch" href="/assets/js/92.ec3a28ed.js"><link rel="prefetch" href="/assets/js/93.f8975bc4.js"><link rel="prefetch" href="/assets/js/94.1eade7f0.js"><link rel="prefetch" href="/assets/js/95.96f5db04.js"><link rel="prefetch" href="/assets/js/96.5ed2d348.js"><link rel="prefetch" href="/assets/js/97.4d4bfff5.js"><link rel="prefetch" href="/assets/js/98.18f62eb7.js"><link rel="prefetch" href="/assets/js/99.7d84cc97.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c76c3453.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕АуАБхЙНшиА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║МуАБхЯ║чбАчЯешпЖ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>хЫЫуАБц╖▒хЕе Netty ца╕х┐Г</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/65674f/" class="sidebar-link">чммф╕Ашп╛я╝ЪщАПш┐З Netty чЬЛ IO цибхЮЛ</a></li><li><a href="/pages/440035/" aria-current="page" class="active sidebar-link">чммф║Мшп╛я╝ЪReactorхЬи Netty ф╕нчЪДхоЮчО░я╝ИхИЫх╗║чпЗя╝Й</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/440035/#хЙНшиА" class="sidebar-link">хЙНшиА</a></li><li class="sidebar-sub-header level2"><a href="/pages/440035/#netty-хп╣-io-цибхЮЛчЪДцФпцМБ" class="sidebar-link">Netty хп╣ IO цибхЮЛчЪДцФпцМБ</a></li><li class="sidebar-sub-header level2"><a href="/pages/440035/#хИЫх╗║ф╕╗ф╗Оreactorч║┐чиЛч╗Д" class="sidebar-link">хИЫх╗║ф╕╗ф╗ОReactorч║┐чиЛч╗Д</a></li><li class="sidebar-sub-header level2"><a href="/pages/440035/#цА╗ч╗У" class="sidebar-link">цА╗ч╗У</a></li><li class="sidebar-sub-header level2"><a href="/pages/440035/#хПВшАГш╡ДцЦЩ" class="sidebar-link">хПВшАГш╡ДцЦЩ</a></li></ul></li><li><a href="/pages/bb668a/" class="sidebar-link">чммф╕Йшп╛я╝ЪNetty ца╕х┐Гх╝ХцУО Reactor чЪДш┐Рш╜мцЮ╢цЮД</a></li><li><a href="/pages/be98dc/" class="sidebar-link">чммхЫЫшп╛я╝ЪNetty хжВф╜ХщлШцХИцОецФ╢ч╜Сч╗Ьш┐ЮцОе</a></li><li><a href="/pages/0938c1/" class="sidebar-link">чммф║Фшп╛я╝ЪNetty хжВф╜ХщлШцХИцОецФ╢ч╜Сч╗ЬцХ░цНо</a></li><li><a href="/pages/8ed7b8/" class="sidebar-link">чммхЕншп╛я╝ЪNetty хжВф╜ХщлШцХИхПСщАБч╜Сч╗ЬцХ░цНо</a></li><li><a href="/pages/a1b0fe/" class="sidebar-link">чммф╕Гшп╛я╝ЪNetty ф╕нIOф║Лф╗╢чЪДшзжхПСцЧ╢цЬ║хТМф╝ацТнц╡БчиЛ</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║ФуАБц╖▒хЕе Netty хЖЕхнШчобчРЖ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Netty ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>хЫЫуАБц╖▒хЕе Netty ца╕х┐Г</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">чммф║Мшп╛я╝ЪReactorхЬи Netty ф╕нчЪДхоЮчО░я╝ИхИЫх╗║чпЗя╝Й<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="хЙНшиА"><a href="#хЙНшиА" class="header-anchor">#</a> хЙНшиА</h2> <p>хЬиф╕КчпЗцЦЗчла<a href="/pages/647c06/">уАКщАПш┐З Netty чЬЛ IO цибхЮЛуАЛ</a>ф╕нцИСф╗мшК▒ф║ЖхдзщЗПчЪДчпЗх╣ЕцЭеф╗ОхЖЕца╕шзТх║жшпжч╗Жшо▓ш┐░ф║Жф║ФчзН<code>IOцибхЮЛ</code>чЪДц╝Фш┐Ыш┐ЗчиЛф╗ехПК<code>ReactorIOч║┐чиЛцибхЮЛ</code>чЪДх║Хх▒ВхЯ║чЯ│IOхдЪш╖пхдНчФицКАцЬпхЬихЖЕца╕ф╕нчЪДхоЮчО░хОЯчРЖуАВ</p> <p>цЬАхРОцИСф╗мх╝ХхЗ║ф║Жnettyф╕нф╜┐чФичЪДф╕╗ф╗ОReactor IOч║┐чиЛцибхЮЛуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409190956559.png" alt="хЫ╛чЙЗ"></p> <p>щАЪш┐Зф╕КчпЗцЦЗчлачЪДф╗Лч╗Ня╝МцИСф╗мх╖▓ч╗Пц╕ЕцеЪф║ЖхЬиIOш░ГчФичЪДш┐ЗчиЛф╕нхЖЕца╕х╕оцИСф╗мцРЮф║ЖхУкф║Ыф║ЛцГЕя╝МщВгф╣Иф┐ЧшпЭшп┤чЪДхе╜<code>хЖЕца╕щвЖш┐ЫщЧия╝Мф┐ошбМхЬиnetty</code>я╝МnettyхЬичФицИ╖чй║щЧ┤хПИх╕оцИСф╗мцРЮф║ЖхУкф║Ыф║ЛцГЕ?</p> <p>щВгф╣Иф╗ОцЬмцЦЗх╝АхзЛя╝МчмФшАЕх░Жф╗Оц║РчаБшзТх║жцЭех╕жхдзхо╢чЬЛф╕Лф╕КхЫ╛ф╕нчЪД<code>Reactor IOч║┐чиЛцибхЮЛ</code>хЬиNettyф╕нцШпхжВф╜ХхоЮчО░чЪДуАВ</p> <p>цЬмцЦЗф╜Ьф╕║ReactorхЬиNettyф╕нхоЮчО░ч│╗хИЧцЦЗчлаф╕нчЪДх╝АчпЗцЦЗчлая╝МчмФшАЕхЕИцЭеф╕║хдзхо╢ф╗Лч╗НReactorчЪДщкицЮ╢цШпхжВф╜ХхИЫх╗║хЗ║цЭечЪДуАВ</p> <p>хЬиф╕КчпЗцЦЗчлаф╕нцИСф╗мцПРхИ░NettyщЗЗчФичЪДцШп<code>ф╕╗ф╗ОReactorхдЪч║┐чиЛ</code>чЪДцибхЮЛя╝Мф╜ЖцШпхоГхЬихоЮчО░ф╕КхПИф╕О<strong>Doug Lea</strong>хЬиScalable IO in Javaшо║цЦЗф╕нцПРхИ░чЪДч╗ПхЕ╕<code>ф╕╗ф╗ОReactorхдЪч║┐чиЛцибхЮЛ</code>цЬЙцЙАх╖ох╝ВуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409190958640.png" alt="хЫ╛чЙЗ"></p> <p>Nettyф╕нчЪД<code>Reactor</code>цШпф╗е<code>Group</code>чЪДх╜вх╝ПхЗ║чО░чЪДя╝М<code>ф╕╗ф╗ОReactor</code>хЬиNettyф╕нх░▒цШп<code>ф╕╗ф╗ОReactorч╗Д</code>я╝МцпПф╕к<code>Reactor Group</code>ф╕нф╝ЪцЬЙхдЪф╕к<code>Reactor</code>чФицЭецЙзшбМхЕ╖ф╜УчЪД<code>IOф╗╗хКб</code>уАВх╜УчД╢хЬиnettyф╕н<code>Reactor</code>ф╕НхПкчФицЭецЙзшбМ<code>IOф╗╗хКб</code>я╝Мш┐Щф╕кцИСф╗мхРОщЭвхЖНшп┤уАВ</p> <ul><li><code>Main Reactor Group</code>ф╕нчЪД<code>Reactor</code>цХ░щЗПхПЦхЖ│ф║ОцЬНхКбчлпшжБчЫСхРмчЪДчлпхПгф╕кцХ░я╝МщАЪх╕╕цИСф╗мчЪДцЬНхКбчлпчиЛх║ПхПкф╝ЪчЫСхРмф╕Аф╕кчлпхПгя╝МцЙАф╗е<code>Main Reactor Group</code>хПкф╝ЪцЬЙф╕Аф╕к<code>Main Reactor</code>ч║┐чиЛцЭехдДчРЖцЬАщЗНшжБчЪДф║ЛцГЕя╝Ъ<code>ч╗СхоЪчлпхПгхЬ░хЭА</code>я╝М<code>цОецФ╢ховцИ╖члпш┐ЮцОе</code>я╝М<code>ф╕║ховцИ╖члпхИЫх╗║хп╣х║ФчЪДSocketChannel</code>я╝М<code>х░ЖховцИ╖члпSocketChannelхИЖщЕНч╗Щф╕Аф╕кхЫ║хоЪчЪДSub Reactor</code>уАВф╣Ях░▒цШпф╕КчпЗцЦЗчлачмФшАЕф╕║хдзхо╢ф╕╛чЪДф╛ЛхнРя╝Мщенх║ЧцЬАщЗНшжБчЪДх╖еф╜Ьх░▒цШпхЕИцККховф║║ш┐ОцОеш┐ЫцЭеуАВ<strong>тАЬцИСхо╢хдзщЧих╕╕цЙУх╝Ая╝Мх╝АцФ╛цААцК▒чнЙф╜ая╝МцЛецК▒ш┐Зх░▒цЬЙф║Жщ╗ШхеСф╜аф╝ЪчИ▒ф╕Кш┐ЩщЗМ......тАЭ</strong></li> <li><code>Sub Reactor Group</code>щЗМцЬЙхдЪф╕к<code>Reactor</code>ч║┐чиЛя╝М<code>Reactor</code>ч║┐чиЛчЪДф╕кцХ░хПпф╗ещАЪш┐Зч│╗ч╗ЯхПВцХ░<code>-D io.netty.eventLoopThreads</code>цМЗхоЪуАВщ╗ШшодчЪД<code>Reactor</code>чЪДф╕кцХ░ф╕║<code>CPUца╕цХ░ * 2</code>уАВ<code>Sub Reactor</code>ч║┐чиЛф╕╗шжБчФицЭе<code>ш╜ошпвховцИ╖члпSocketChannelф╕КчЪДIOх░▒ч╗кф║Лф╗╢</code>я╝М<code>хдДчРЖIOх░▒ч╗кф║Лф╗╢</code>я╝М<code>цЙзшбМх╝Вцнеф╗╗хКб</code>уАВ<code>Sub Reactor Group</code>хБЪчЪДф║ЛцГЕх░▒цШпф╕КчпЗщенх║Чф╛ЛхнРф╕нцЬНхКбхСШчЪДх╖еф╜Ья╝Мховф║║ш┐ЫцЭеф║ЖшжБф╕║ховф║║хИЖщЕНх║зф╜Ня╝МчлпшМ╢щАБц░┤я╝МхБЪшПЬф╕КшПЬуАВ<strong>тАЬф╕Нчобш┐Ьш┐СщГ╜цШпховф║║я╝Мшп╖ф╕НчФиховц░Фя╝МчЫ╕ч║жхе╜ф║ЖхЬиф╕Аш╡╖я╝МцИСф╗мцмвш┐ОцВи......тАЭ</strong></li></ul> <blockquote><p>ф╕Аф╕к<code>ховцИ╖члпSocketChannel</code>хПкшГ╜хИЖщЕНч╗Щф╕Аф╕кхЫ║хоЪчЪД<code>Sub Reactor</code>уАВф╕Аф╕к<code>Sub Reactor</code>ш┤Яш┤гхдДчРЖхдЪф╕к<code>ховцИ╖члпSocketChannel</code>я╝Мш┐Щца╖хПпф╗ех░ЖцЬНхКбчлпцЙ┐ш╜╜чЪД<code>хЕищЗПховцИ╖члпш┐ЮцОе</code>хИЖцСКхИ░хдЪф╕к<code>Sub Reactor</code>ф╕нхдДчРЖя╝МхРМцЧ╢ф╣ЯшГ╜ф┐ЭшпБ<code>ховцИ╖члпSocketChannelф╕КчЪДIOхдДчРЖчЪДч║┐чиЛхоЙхЕицАз</code>уАВ</p></blockquote> <p>чФ▒ф║ОцЦЗчлачпЗх╣ЕчЪДхЕ│ч│╗я╝Мф╜Ьф╕║ReactorхЬиnettyф╕нхоЮчО░чЪДчммф╕АчпЗцИСф╗мф╕╗шжБцЭеф╗Лч╗Н<code>ф╕╗ф╗ОReactor Group</code>чЪДхИЫх╗║ц╡БчиЛя╝МщкицЮ╢шДЙч╗ЬхЕИцРнхе╜уАВ</p> <p>ф╕ЛщЭвцИСф╗мцЭечЬЛф╕Ацо╡NettyцЬНхКбчлпф╗гчаБчЪДч╝ЦхЖЩцибцЭ┐я╝Мф╗Оф╗гчаБцибцЭ┐чЪДц╡БчиЛф╕нцИСф╗мцЭешзгцЮРф╕Лф╕╗ф╗ОReactorчЪДхИЫх╗║ц╡БчиЛф╗ехПКхЬиш┐Щф╕кш┐ЗчиЛф╕нцЙАц╢ЙхПКхИ░чЪДNettyца╕х┐Гч▒╗уАВ</p> <h3 id="netty-цЬНхКбчлпф╗гчаБцибцЭ┐"><a href="#netty-цЬНхКбчлпф╗гчаБцибцЭ┐" class="header-anchor">#</a> Netty цЬНхКбчлпф╗гчаБцибцЭ┐</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Echoes back any received data from a client.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">EchoServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;8007&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// Configure the server.</span>
        <span class="token comment">//хИЫх╗║ф╕╗ф╗ОReactorч║┐чиЛч╗Д</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">EchoServerHandler</span> serverHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EchoServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServerBootstrap</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerBootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            b<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span>bossGroup<span class="token punctuation">,</span> workerGroup<span class="token punctuation">)</span><span class="token comment">//щЕНч╜оф╕╗ф╗ОReactor</span>
             <span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token class-name">NioServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">//щЕНч╜оф╕╗Reactorф╕нчЪДchannelч▒╗хЮЛ</span>
             <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_BACKLOG</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token comment">//шо╛ч╜оф╕╗Reactorф╕нchannelчЪДoptionщАЙщб╣</span>
             <span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingHandler</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span><span class="token punctuation">.</span><span class="token constant">INFO</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//шо╛ч╜оф╕╗Reactorф╕нChannel-&gt;pipline-&gt;handler</span>
             <span class="token punctuation">.</span><span class="token function">childHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChannelInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SocketChannel</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//шо╛ч╜оф╗ОReactorф╕нц│ихЖМchannelчЪДpipeline</span>
                 <span class="token annotation punctuation">@Override</span>
                 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> ch<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                     <span class="token class-name">ChannelPipeline</span> p <span class="token operator">=</span> ch<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment">//p.addLast(new LoggingHandler(LogLevel.INFO));</span>
                     p<span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>serverHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
                 <span class="token punctuation">}</span>
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Start the server. ч╗СхоЪчлпхПгхРпхКицЬНхКбя╝Мх╝АхзЛчЫСхРмacceptф║Лф╗╢</span>
            <span class="token class-name">ChannelFuture</span> f <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Wait until the server socket is closed.</span>
            f<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">closeFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// Shut down all event loops to terminate all threads.</span>
            bossGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerGroup<span class="token punctuation">.</span><span class="token function">shutdownGracefully</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li><p>щжЦхЕИцИСф╗мшжБхИЫх╗║NettyцЬАца╕х┐ГчЪДщГихИЖ -&gt; <code>хИЫх╗║ф╕╗ф╗ОReactor Group</code>я╝МхЬиNettyф╕н<code>EventLoopGroup</code>х░▒цШп<code>Reactor Group</code>чЪДхоЮчО░ч▒╗уАВхп╣х║ФчЪД<code>EventLoop</code>х░▒цШп<code>Reactor</code>чЪДхоЮчО░ч▒╗уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code>  <span class="token comment">//хИЫх╗║ф╕╗ф╗ОReactorч║┐чиЛч╗Д</span>
  <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>хИЫх╗║чФиф║О<code>IOхдДчРЖ</code>чЪД<code>ChannelHandler</code>я╝МхоЮчО░чЫ╕х║Ф<code>IOф║Лф╗╢</code>чЪДхЫЮш░ГхЗ╜цХ░я╝Мч╝ЦхЖЩхп╣х║ФчЪД<code>IOхдДчРЖ</code>щА╗ш╛СуАВц│ицДПш┐ЩщЗМхПкцШпчоАхНХчд║ф╛ЛхУИя╝Мшпжч╗ЖчЪДIOф║Лф╗╢хдДчРЖя╝МчмФшАЕф╝ЪхНХчЛмх╝Аф╕АчпЗцЦЗчлаф╕УщЧишо▓ш┐░уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">EchoServerHandler</span> serverHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EchoServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Handler implementation for the echo server.
 */</span>
<span class="token annotation punctuation">@Sharable</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoServerHandler</span> <span class="token keyword">extends</span> <span class="token class-name">ChannelInboundHandlerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelRead</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Object</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token constant">IO</span>хдДчРЖщА╗ш╛С<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        ctx<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">channelReadComplete</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        ctx<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exceptionCaught</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Close the connection when an exception is raised.</span>
        cause<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>хИЫх╗║<code>ServerBootstrap</code>NettyцЬНхКбчлпхРпхКич▒╗я╝Мх╣╢хЬихРпхКич▒╗ф╕нщЕНч╜охРпхКиNettyцЬНхКбчлпцЙАщЬАшжБчЪДф╕Аф║Ых┐ЕхдЗф┐бцБпуАВ</p> <blockquote><p>хЬиф╕КчпЗцЦЗчлаф╗Лч╗Н<code>SocketхЖЕца╕ч╗УцЮД</code>х░ПшКВф╕нцИСф╗мцПРхИ░я╝МхЬич╝ЦхЖЩцЬНхКбчлпч╜Сч╗ЬчиЛх║ПцЧ╢я╝МцИСф╗мщжЦхЕИшжБхИЫх╗║ф╕Аф╕к<code>Socket</code>чФиф║О<code>listenхТМbind</code>члпхПгхЬ░хЭАя╝МцИСф╗мцККш┐Щф╕кхПлхБЪ<code>чЫСхРмSocket</code>,ш┐ЩщЗМхп╣х║ФчЪДх░▒цШп<code>NioServerSocketChannel.class</code>уАВх╜УховцИ╖члпш┐ЮцОехоМцИРф╕ЙцмбцПбцЙЛя╝Мч│╗ч╗Яш░ГчФи<code>accept</code>хЗ╜цХ░ф╝ЪхЯ║ф║О<code>чЫСхРмSocket</code>хИЫх╗║хЗ║цЭеф╕Аф╕к<code>цЦ░чЪДSocket</code>ф╕УщЧичФиф║Оф╕ОховцИ╖члпф╣ЛщЧ┤чЪДч╜Сч╗ЬщАЪф┐бцИСф╗мчз░ф╕║<code>ховцИ╖члпш┐ЮцОеSocket</code>,ш┐ЩщЗМхп╣х║ФчЪДх░▒цШп<code>NioSocketChannel.class</code></p></blockquote> <blockquote><p>nettyцЬЙф╕дчзН<code>Channelч▒╗хЮЛ</code>я╝Ъф╕АчзНцШпцЬНхКбчлпчФиф║ОчЫСхРмч╗СхоЪчлпхПгхЬ░хЭАчЪД<code>NioServerSocketChannel</code>,ф╕АчзНцШпчФиф║ОховцИ╖члпщАЪф┐бчЪД<code>NioSocketChannel</code>уАВцпПчзН<code>Channelч▒╗хЮЛхоЮф╛Л</code>щГ╜ф╝Ъхп╣х║Фф╕Аф╕к<code>PipeLine</code>чФиф║Оч╝ЦцОТ<code>хп╣х║ФchannelхоЮф╛Л</code>ф╕КчЪДIOф║Лф╗╢хдДчРЖщА╗ш╛СуАВ<code>PipeLine</code>ф╕нч╗Дч╗ЗчЪДх░▒цШп<code>ChannelHandler</code>чФиф║Оч╝ЦхЖЩчЙ╣хоЪчЪДIOхдДчРЖщА╗ш╛СуАВ</p></blockquote> <blockquote><p><strong>ц│ицДП</strong><code>serverBootstrap.handler</code>шо╛ч╜очЪДцШпцЬНхКбчлп<code>NioServerSocketChannel PipeLine</code>ф╕нчЪД<code>ChannelHandler</code>уАВ</p></blockquote> <blockquote><p><code>ServerBootstrap</code>хРпхКич▒╗цЦ╣ц│Хх╕жцЬЙ<code>child</code>хЙНч╝АчЪДхЭЗцШпшо╛ч╜оховцИ╖члп<code>NioSocketChannel</code>х▒ЮцАзчЪДуАВ</p></blockquote> <blockquote><p><code>ChannelInitializer</code>цШпчФиф║Ох╜У<code>SocketChannel</code>цИРхКЯц│ихЖМхИ░ч╗СхоЪчЪД<code>Reactor</code>ф╕КхРОя╝МчФиф║ОхИЭхзЛхМЦшпе<code>SocketChannel</code>чЪД<code>Pipeline</code>уАВхоГчЪД<code>initChannel</code>цЦ╣ц│Хф╝ЪхЬиц│ихЖМцИРхКЯхРОцЙзшбМуАВш┐ЩщЗМхПкцШпцНОх╕жцПРф╕Аф╕Ля╝Мшойхдзхо╢цЬЙф╕кхИЭцнехН░ш▒бя╝МхРОщЭвцИСф╝Ъф╕УщЧиф╗Лч╗НуАВ</p></blockquote> <ul><li><code>serverBootstrap.childHandler(ChannelHandler childHandler)</code>чФиф║Ошо╛ч╜оховцИ╖члп<code>NioSocketChannel</code>ф╕нхп╣х║Ф<code>Pipieline</code>ф╕нчЪД<code>ChannelHandler</code>уАВцИСф╗мщАЪх╕╕щЕНч╜очЪДч╝ЦчаБшзгчаБхЩих░▒цШпхЬиш┐ЩщЗМуАВ</li> <li><code>serverBootstrap.option(ChannelOption.SO_BACKLOG, 100)</code>шо╛ч╜оцЬНхКбчлп<code>ServerSocketChannel</code>ф╕нчЪД<code>SocketOption</code>уАВхЕ│ф║О<code>SocketOption</code>чЪДщАЙщб╣цИСф╗мхРОш╛╣чЪДцЦЗчлахЖНшБКя╝МцЬмцЦЗф╕╗шжБшБЪчДжхЬиNetty <code>Main Reactor Group</code>чЪДхИЫх╗║хПКх╖еф╜Ьц╡БчиЛуАВ</li> <li><code>serverBootstrap.handler(....)</code>шо╛ч╜оцЬНхКбчлп<code>NioServerSocketChannel</code>ф╕нхп╣х║Ф<code>Pipieline</code>ф╕нчЪД<code>ChannelHandler</code>уАВ</li> <li>щАЪш┐З<code>serverBootstrap.group(bossGroup, workerGroup)</code>ф╕║NettyцЬНхКбчлпщЕНч╜о<code>ф╕╗ф╗ОReactor Group</code>хоЮф╛ЛуАВ</li> <li>щАЪш┐З<code>serverBootstrap.channel(NioServerSocketChannel.class)</code>щЕНч╜оNettyцЬНхКбчлпчЪД<code>ServerSocketChannel</code>чФиф║О<code>ч╗СхоЪчлпхПгхЬ░хЭА</code>ф╗ехПК<code>хИЫх╗║ховцИ╖члпSocketChannel</code>уАВNettyф╕нчЪД<code>NioServerSocketChannel.class</code>х░▒цШпхп╣JDK NIOф╕н<code>ServerSocketChannel</code>чЪДх░БшгЕуАВшАМчФиф║Ошбичд║<code>ховцИ╖члпш┐ЮцОе</code>чЪД<code>NioSocketChannel</code>цШпхп╣JDK NIO <code>SocketChannel</code>х░БшгЕуАВ</li></ul></li> <li><p><code>ChannelFuture f = serverBootstrap.bind(PORT).sync()</code>ш┐Щф╕Ацнеф╝ЪцШпф╕ЛчпЗцЦЗчлашжБщЗНчВ╣хИЖцЮРчЪДф╕╗щвШ<code>Main Reactor Group</code>чЪДхРпхКия╝Мч╗СхоЪчлпхПгхЬ░хЭАя╝Мх╝АхзЛчЫСхРмховцИ╖члпш┐ЮцОеф║Лф╗╢я╝И<code>OP_ACCEPT</code>я╝ЙуАВцЬмцЦЗцИСф╗мхПкхЕ│ц│ихИЫх╗║ц╡БчиЛ</p></li> <li><p><code>f.channel().closeFuture().sync()</code>чнЙх╛ЕцЬНхКбчлп<code>NioServerSocketChannel</code>хЕ│щЧнуАВNettyцЬНхКбчлпхИ░ш┐ЩщЗМцнгх╝ПхРпхКия╝Мх╣╢хЗЖхдЗхе╜цОехПЧховцИ╖члпш┐ЮцОечЪДхЗЖхдЗуАВ</p></li> <li><p><code>shutdownGracefully</code>ф╝ШщЫЕхЕ│щЧн<code>ф╕╗ф╗ОReactorч║┐чиЛч╗Д</code>щЗМчЪДцЙАцЬЙ<code>Reactorч║┐чиЛ</code>уАВ</p></li></ol> <h2 id="netty-хп╣-io-цибхЮЛчЪДцФпцМБ"><a href="#netty-хп╣-io-цибхЮЛчЪДцФпцМБ" class="header-anchor">#</a> Netty хп╣ IO цибхЮЛчЪДцФпцМБ</h2> <p>хЬиф╕КчпЗцЦЗчлаф╕нцИСф╗мф╗Лч╗Нф║Жф║ФчзН<code>IOцибхЮЛ</code>я╝МNettyф╕нцФпцМБ<code>BIO</code>,<code>NIO</code>,<code>AIO</code>ф╗ехПКхдЪчзНцУНф╜Ьч│╗ч╗Яф╕ЛчЪД<code>IOхдЪш╖пхдНчФицКАцЬп</code>хоЮчО░уАВ</p> <p>хЬиNettyф╕нхИЗцНвш┐ЩхЗачзН<code>IOцибхЮЛ</code>ф╣ЯцШпщЭЮх╕╕чЪДцЦ╣ф╛┐я╝Мф╕ЛщЭвцИСф╗мцЭечЬЛф╕ЛNettyхжВф╜Ххп╣ш┐ЩхЗачзНIOцибхЮЛш┐ЫшбМцФпцМБчЪДуАВ</p> <p>щжЦхЕИцИСф╗мф╗Лч╗Нф╕ЛхЗаф╕кф╕О<code>IOцибхЮЛ</code>чЫ╕хЕ│чЪДщЗНшжБцОехПгя╝Ъ</p> <h3 id="eventloop"><a href="#eventloop" class="header-anchor">#</a> EventLoop</h3> <p><code>EventLoop</code>х░▒цШпNettyф╕нчЪД<code>Reactor</code>я╝МхПпф╗ешп┤хоГх░▒цШпNettyчЪДх╝ХцУОя╝Мш┤Яш┤гChannelф╕К<code>IOх░▒ч╗кф║Лф╗╢чЪДчЫСхРм</code>я╝М<code>IOх░▒ч╗кф║Лф╗╢чЪДхдДчРЖ</code>я╝М<code>х╝Вцнеф╗╗хКбчЪДцЙзшбМ</code>щй▒хКичЭАцХ┤ф╕кNettyчЪДш┐Рш╜муАВ</p> <p>ф╕НхРМ<code>IOцибхЮЛ</code>ф╕Ля╝М<code>EventLoop</code>цЬЙчЭАф╕НхРМчЪДхоЮчО░я╝МцИСф╗мхПкщЬАшжБхИЗцНвф╕НхРМчЪДхоЮчО░ч▒╗х░▒хПпф╗ехоМцИРхп╣Netty<code>IOцибхЮЛ</code>чЪДхИЗцНвуАВ</p> <table><thead><tr><th style="text-align:center;">BIO</th> <th style="text-align:center;">NIO</th> <th style="text-align:center;">AIO</th></tr></thead> <tbody><tr><td style="text-align:center;">ThreadPerChannelEventLoop</td> <td style="text-align:center;">NioEventLoop</td> <td style="text-align:center;">AioEventLoop</td></tr></tbody></table> <p>хЬи<code>NIOцибхЮЛ</code>ф╕ЛNettyф╝Ъ<code>шЗкхКи</code>ца╣цНоцУНф╜Ьч│╗ч╗Яф╗ехПКчЙИцЬмчЪДф╕НхРМщАЙцЛйхп╣х║ФчЪД<code>IOхдЪш╖пхдНчФицКАцЬпхоЮчО░</code>уАВцпФхжВLinux 2.6чЙИцЬмф╗еф╕КчФичЪДцШп<code>Epoll</code>я╝М2.6чЙИцЬмф╗еф╕ЛчФичЪДцШп<code>Poll</code>я╝МMacф╕ЛщЗЗчФичЪДцШп<code>Kqueue</code>уАВ</p> <h3 id="eventloopgroup"><a href="#eventloopgroup" class="header-anchor">#</a> EventLoopGroup</h3> <p>Nettyф╕нчЪД<code>Reactor</code>цШпф╗е<code>Group</code>чЪДх╜вх╝ПхЗ║чО░чЪДя╝М<code>EventLoopGroup</code>цнгцШп<code>Reactorч╗Д</code>чЪДцОехПгхоЪф╣Йя╝Мш┤Яш┤гчобчРЖ<code>Reactor</code>я╝МNettyф╕нчЪД<code>Channel</code>х░▒цШпщАЪш┐З<code>EventLoopGroup</code>ц│ихЖМхИ░хЕ╖ф╜УчЪД<code>Reactor</code>ф╕КчЪДуАВ</p> <p>NettyчЪДIOч║┐чиЛцибхЮЛцШп<code>ф╕╗ф╗ОReactorхдЪч║┐чиЛцибхЮЛ</code>я╝М<code>ф╕╗ф╗ОReactorч║┐чиЛч╗Д</code>хЬиNettyц║РчаБф╕нхп╣х║ФчЪДхЕ╢хоЮх░▒цШпф╕дф╕к<code>EventLoopGroup</code>хоЮф╛ЛуАВ</p> <p>ф╕НхРМчЪД<code>IOцибхЮЛ</code>ф╣ЯцЬЙхп╣х║ФчЪДхоЮчО░я╝Ъ</p> <table><thead><tr><th style="text-align:center;">BIO</th> <th style="text-align:center;">NIO</th> <th style="text-align:center;">AIO</th></tr></thead> <tbody><tr><td style="text-align:center;">ThreadPerChannelEventLoopGroup</td> <td style="text-align:center;">NioEventLoopGroup</td> <td style="text-align:center;">AioEventLoopGroup</td></tr></tbody></table> <h3 id="serversocketchannel"><a href="#serversocketchannel" class="header-anchor">#</a> ServerSocketChannel</h3> <p>чФиф║ОNettyцЬНхКбчлпф╜┐чФичЪД<code>ServerSocketChannel</code>я╝Мхп╣х║Фф║Оф╕КчпЗцЦЗчлацПРхИ░чЪД<code>чЫСхРмSocket</code>я╝Мш┤Яш┤гч╗СхоЪчЫСхРмчлпхПгхЬ░хЭАя╝МцОецФ╢ховцИ╖члпш┐ЮцОех╣╢хИЫх╗║чФиф║Оф╕ОховцИ╖члпщАЪф┐бчЪД<code>SocketChannel</code>уАВ</p> <p>ф╕НхРМчЪД<code>IOцибхЮЛ</code>ф╕ЛчЪДхоЮчО░я╝Ъ</p> <table><thead><tr><th style="text-align:center;">BIO</th> <th style="text-align:center;">NIO</th> <th style="text-align:center;">AIO</th></tr></thead> <tbody><tr><td style="text-align:center;">OioServerSocketChannel</td> <td style="text-align:center;">NioServerSocketChannel</td> <td style="text-align:center;">AioServerSocketChannel</td></tr></tbody></table> <h3 id="socketchannel"><a href="#socketchannel" class="header-anchor">#</a> SocketChannel</h3> <p>чФиф║Оф╕ОховцИ╖члпщАЪф┐бчЪД<code>SocketChannel</code>я╝Мхп╣х║Фф║Оф╕КчпЗцЦЗчлацПРхИ░чЪД<code>ховцИ╖члпш┐ЮцОеSocket</code>я╝Мх╜УховцИ╖члпхоМцИРф╕ЙцмбцПбцЙЛхРОя╝МчФ▒ч│╗ч╗Яш░ГчФи<code>accept</code>хЗ╜цХ░ца╣цНо<code>чЫСхРмSocket</code>хИЫх╗║уАВ</p> <p>ф╕НхРМчЪД<code>IOцибхЮЛ</code>ф╕ЛчЪДхоЮчО░я╝Ъ</p> <table><thead><tr><th style="text-align:center;">BIO</th> <th style="text-align:center;">NIO</th> <th style="text-align:center;">AIO</th></tr></thead> <tbody><tr><td style="text-align:center;">OioSocketChannel</td> <td style="text-align:center;">NioSocketChannel</td> <td style="text-align:center;">AioSocketChannel</td></tr></tbody></table> <p>цИСф╗мчЬЛхИ░хЬи<code>ф╕НхРМIOцибхЮЛ</code>чЪДхоЮчО░ф╕ня╝МNettyш┐Щф║ЫхЫ┤ч╗Х<code>IOцибхЮЛ</code>чЪДца╕х┐Гч▒╗хПкцШпхЙНч╝АчЪДф╕НхРМя╝Ъ</p> <ul><li>BIOхп╣х║ФчЪДхЙНч╝Аф╕║<code>Oio</code>я╝Мшбичд║<code>old io</code>я╝МчО░хЬих╖▓ч╗Пх║Ях╝Гф╕НцОишНРф╜┐чФиуАВ</li> <li>NIOхп╣х║ФчЪДхЙНч╝Аф╕║<code>Nio</code>я╝МцнгцШпNettyцОишНРф╣ЯцШпцИСф╗мх╕╕чФичЪД<code>щЭЮщШ╗хбЮIOцибхЮЛ</code>уАВ</li> <li>AIOхп╣х║ФчЪДхЙНч╝Аф╕║<code>Aio</code>я╝МчФ▒ф║ОLinuxф╕ЛчЪД<code>х╝ВцнеIO</code>цЬ║хИ╢хоЮчО░чЪДх╣╢ф╕НцИРчЖЯя╝МцАзшГ╜цПРхНЗшбичО░ф╕Кф╣Яф╕НцШОцШ╛я╝МчО░х╖▓швлхИащЩдуАВ</li></ul> <p>цИСф╗мхПкщЬАшжБх░Ж<code>IOцибхЮЛ</code>чЪДш┐Щф║Ыца╕х┐ГцОехПгхп╣х║ФчЪДхоЮчО░ч▒╗<code>хЙНч╝А</code>цФ╣ф╕║хп╣х║Ф<code>IOцибхЮЛ</code>чЪДхЙНч╝Ая╝Мх░▒хПпф╗еш╜╗цЭ╛хЬиNettyф╕нхоМцИРхп╣<code>IOцибхЮЛ</code>чЪДхИЗцНвуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191007627.png" alt="хЫ╛чЙЗ"></p> <h3 id="хдЪчзНnioчЪДхоЮчО░"><a href="#хдЪчзНnioчЪДхоЮчО░" class="header-anchor">#</a> хдЪчзНNIOчЪДхоЮчО░</h3> <table><thead><tr><th style="text-align:center;">Common</th> <th style="text-align:center;">Linux</th> <th style="text-align:center;">Mac</th></tr></thead> <tbody><tr><td style="text-align:center;">NioEventLoopGroup</td> <td style="text-align:center;">EpollEventLoopGroup</td> <td style="text-align:center;">KQueueEventLoopGroup</td></tr> <tr><td style="text-align:center;">NioEventLoop</td> <td style="text-align:center;">EpollEventLoop</td> <td style="text-align:center;">KQueueEventLoop</td></tr> <tr><td style="text-align:center;">NioServerSocketChannel</td> <td style="text-align:center;">EpollServerSocketChannel</td> <td style="text-align:center;">KQueueServerSocketChannel</td></tr> <tr><td style="text-align:center;">NioSocketChannel</td> <td style="text-align:center;">EpollSocketChannel</td> <td style="text-align:center;">KQueueSocketChannel</td></tr></tbody></table> <p>цИСф╗мщАЪх╕╕хЬиф╜┐чФи<code>NIOцибхЮЛ</code>чЪДцЧ╢хАЩф╝Ъф╜┐чФи<code>CommonхИЧ</code>ф╕ЛчЪДш┐Щф║Ы<code>IOцибхЮЛ</code>ца╕х┐Гч▒╗я╝М<code>Commonч▒╗</code>ф╣Яф╝Ъца╣цНоцУНф╜Ьч│╗ч╗ЯчЪДф╕НхРМшЗкхКищАЙцЛй<code>JDK</code>хЬихп╣х║Фх╣│хП░ф╕ЛчЪД<code>IOхдЪш╖пхдНчФицКАцЬп</code>чЪДхоЮчО░уАВ</p> <p>шАМNettyшЗкш║лф╣Яца╣цНоцУНф╜Ьч│╗ч╗ЯчЪДф╕НхРМцПРф╛Ыф║ЖшЗкх╖▒хп╣<code>IOхдЪш╖пхдНчФицКАцЬп</code>чЪДхоЮчО░я╝МцпФ<code>JDK</code>чЪДхоЮчО░цАзшГ╜цЫ┤ф╝ШуАВцпФхжВя╝Ъ</p> <ul><li><code>JDK</code>чЪД NIO <code>щ╗Шшод</code>хоЮчО░цШп<code>ц░┤х╣│шзжхПС</code>я╝МNetty цШп<code>ш╛╣ч╝ШшзжхПС(щ╗Шшод)</code>хТМц░┤х╣│шзжхПСхПпхИЗцНвуАВуАВ</li> <li>Netty хоЮчО░чЪДхЮГхЬ╛хЫЮцФ╢цЫ┤х░СуАБцАзшГ╜цЫ┤хе╜уАВ</li></ul> <p>цИСф╗мч╝ЦхЖЩNettyцЬНхКбчлпчиЛх║ПчЪДцЧ╢хАЩф╣ЯхПпф╗еца╣цНоцУНф╜Ьч│╗ч╗ЯчЪДф╕НхРМя╝МщЗЗчФиNettyшЗкш║лчЪДхоЮчО░цЭеш┐Ыф╕Ацнеф╝ШхМЦчиЛх║ПуАВхБЪц│Хф╣Ях╛ИчоАхНХя╝МчЫ┤цОех░Жф╕КхЫ╛ф╕нч║вцбЖщЗМчЪДхоЮчО░ч▒╗цЫ┐цНвцИРNettyчЪДшЗкш║лхоЮчО░ч▒╗хН│хПпхоМцИРхИЗцНвуАВ</p> <hr> <p>ч╗Пш┐Зф╗еф╕Кхп╣NettyцЬНхКбчлпф╗гчаБч╝ЦхЖЩцибцЭ┐ф╗ехПК<code>IOцибхЮЛ</code>чЫ╕хЕ│ца╕х┐Гч▒╗чЪДчоАхНХф╗Лч╗Ня╝МцИСф╗мхп╣NettyчЪДхИЫх╗║ц╡БчиЛцЬЙф║Жф╕Аф╕кчоАхНХч▓ЧчХечЪДцА╗ф╜УшодшпЖя╝Мф╕ЛщЭвцИСф╗мцЭец╖▒хЕехЙЦцЮРф╕ЛхИЫх╗║ц╡БчиЛш┐ЗчиЛф╕нчЪДцпПф╕Аф╕кцнещкдф╗ехПКш┐Щф╕кш┐ЗчиЛф╕нц╢ЙхПКхИ░чЪДца╕х┐Гч▒╗хоЮчО░уАВ</p> <p><strong>ф╗еф╕Лц║РчаБшзгцЮРщГихИЖцИСф╗мхЭЗщЗЗчФи<code>CommonхИЧ</code>ф╕Л<code>NIO</code>чЫ╕хЕ│чЪДхоЮчО░ш┐ЫшбМшзгцЮРуАВ</strong></p> <h2 id="хИЫх╗║ф╕╗ф╗Оreactorч║┐чиЛч╗Д"><a href="#хИЫх╗║ф╕╗ф╗Оreactorч║┐чиЛч╗Д" class="header-anchor">#</a> хИЫх╗║ф╕╗ф╗ОReactorч║┐чиЛч╗Д</h2> <p>хЬи Netty цЬНхКбчлпчиЛх║Пч╝ЦхЖЩцибцЭ┐чЪДх╝АхзЛя╝МцИСф╗мщжЦхЕИф╝ЪхИЫх╗║ф╕дф╕кReactorч║┐чиЛч╗Дя╝Ъ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191009527.png" alt="хЫ╛чЙЗ"></p> <ul><li>ф╕Аф╕кцШпф╕╗Reactorч║┐чиЛч╗Д<code>bossGroup</code>чФиф║ОчЫСхРмховцИ╖члпш┐ЮцОея╝МхИЫх╗║ховцИ╖члпш┐ЮцОе<code>NioSocketChannel</code>я╝Мх╣╢х░ЖхИЫх╗║хе╜чЪДховцИ╖члпш┐ЮцОе<code>NioSocketChannel</code>ц│ихЖМхИ░ф╗ОReactorч║┐чиЛч╗Дф╕нф╕Аф╕кхЫ║хоЪчЪД<code>Reactor</code>ф╕КуАВ</li> <li>ф╕Аф╕кцШпф╗ОReactorч║┐чиЛч╗Д<code>workerGroup</code>я╝М<code>workerGroup</code>ф╕нчЪД<code>Reactor</code>ш┤Яш┤гчЫСхРмч╗СхоЪхЬихЕ╢ф╕КчЪДховцИ╖члпш┐ЮцОе<code>NioSocketChannel</code>ф╕КчЪД<code>IOх░▒ч╗кф║Лф╗╢</code>я╝Мх╣╢хдДчРЖ<code>IOх░▒ч╗кф║Лф╗╢</code>я╝М<code>цЙзшбМх╝Вцнеф╗╗хКб</code>уАВ</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token comment">//хИЫх╗║ф╕╗ф╗ОReactorч║┐чиЛч╗Д</span>
<span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Nettyф╕нReactorч║┐чиЛч╗ДчЪДхоЮчО░ч▒╗ф╕║<code>NioEventLoopGroup</code>я╝МхЬихИЫх╗║<code>bossGroup</code>хТМ<code>workerGroup</code>чЪДцЧ╢хАЩчФихИ░ф║Ж<code>NioEventLoopGroup</code>чЪДф╕дф╕кцЮДщАахЗ╜цХ░я╝Ъ</p> <ul><li>х╕ж<code>nThreads</code>хПВцХ░чЪДцЮДщАахЗ╜цХ░<code>public NioEventLoopGroup(int nThreads)</code>уАВ</li> <li>ф╕Нх╕ж<code>nThreads</code>хПВцХ░чЪД<code>щ╗Шшод</code>цЮДщАахЗ╜цХ░<code>public NioEventLoopGroup()</code></li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioEventLoopGroup</span> <span class="token keyword">extends</span> <span class="token class-name">MultithreadEventLoopGroup</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * Create a new instance using the default number of threads, the default {@link ThreadFactory} and
     * the {@link SelectorProvider} which is returned by {@link SelectorProvider#provider()}.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Create a new instance using the specified number of threads, {@link ThreadFactory} and the
     * {@link SelectorProvider} which is returned by {@link SelectorProvider#provider()}.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Executor</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>nThreads</code>хПВцХ░шбичд║х╜УхЙНшжБхИЫх╗║чЪД<code>Reactorч║┐чиЛч╗Д</code>хЖЕхМЕхРлхдЪх░Сф╕к<code>Reactorч║┐чиЛ</code>уАВф╕НцМЗхоЪ<code>nThreads</code>хПВцХ░чЪДшпЭщЗЗчФищ╗ШшодчЪД<code>Reactorч║┐чиЛ</code>ф╕кцХ░я╝МчФи<code>0</code>шбичд║уАВ</p></blockquote> <p>цЬАч╗Иф╝Ъш░ГчФихИ░цЮДщАахЗ╜цХ░</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">SelectorProvider</span> selectorProvider<span class="token punctuation">,</span>
<span class="token keyword">final</span> <span class="token class-name">SelectStrategyFactory</span> selectStrategyFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> selectorProvider<span class="token punctuation">,</span> selectStrategyFactory<span class="token punctuation">,</span> <span class="token class-name">RejectedExecutionHandlers</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕ЛщЭвчоАхНХф╗Лч╗Нф╕ЛцЮДщАахЗ╜цХ░ф╕нш┐ЩхЗаф╕кхПВцХ░чЪДф╜ЬчФия╝МхРОщЭвцИСф╗мхЬишо▓шзгцЬмцЦЗф╕╗ч║┐чЪДш┐ЗчиЛф╕нш┐Шф╝ЪцПРхПКш┐ЩхЗаф╕кхПВцХ░я╝МхИ░цЧ╢хЬишпжч╗Жф╗Лч╗Ня╝Мш┐ЩщЗМхПкцШпшойхдзхо╢цЬЙф╕кхИЭцнехН░ш▒бя╝Мф╕Нх┐ЕхБЪш┐ЗхдЪчЪДч║ач╝ауАВ</p> <ul><li><code>Executor executorя╝Ъ</code>ш┤Яш┤гхРпхКи<code>Reactorч║┐чиЛ</code>ш┐ЫшАМReactorцЙНхПпф╗ех╝АхзЛх╖еф╜ЬуАВ</li></ul> <blockquote><p>Reactorч║┐чиЛч╗Д<code>NioEventLoopGroup</code>ш┤Яш┤гхИЫх╗║<code>Reactorч║┐чиЛ</code>я╝МхЬихИЫх╗║чЪДцЧ╢хАЩф╝Ъх░Ж<code>executor</code>ф╝ахЕеуАВ</p></blockquote> <ul><li><code>RejectedExecutionHandlerя╝Ъ</code> х╜УхРС<code>Reactor</code>ц╖╗хКах╝Вцнеф╗╗хКбц╖╗хКахд▒ш┤ецЧ╢я╝МщЗЗчФичЪДцЛТч╗ЭчнЦчХеуАВReactorчЪДф╗╗хКбф╕НхПкцШпчЫСхРмIOц┤╗ш╖Гф║Лф╗╢хТМIOф╗╗хКбчЪДхдДчРЖя╝Мш┐ШхМЕцЛмхп╣х╝Вцнеф╗╗хКбчЪДхдДчРЖуАВш┐ЩщЗМхдзхо╢хПкщЬАцЬЙф╕кш┐Щца╖чЪДцжВх┐╡я╝МхРОщЭвчмФшАЕф╝Ъф╕УщЧишпжч╗Жф╗Лч╗НуАВ</li> <li><code>SelectorProvider selectorProviderя╝Ъ</code> Reactorф╕нчЪДIOцибхЮЛф╕║<code>IOхдЪш╖пхдНчФицибхЮЛ</code>я╝Мхп╣х║Фф║ОJDK NIOф╕нчЪДхоЮчО░ф╕║<code>java.nio.channels.Selector</code>я╝Их░▒цШпцИСф╗мф╕КчпЗцЦЗчлаф╕нцПРхИ░чЪД<code>select,poll,epoll</code>я╝Йя╝МцпПф╕кReatorф╕нщГ╜хМЕхРлф╕Аф╕к<code>Selector</code>я╝МчФиф║О<code>ш╜ошпв</code>ц│ихЖМхЬишпеReactorф╕КчЪДцЙАцЬЙ<code>Channel</code>ф╕КчЪД<code>IOф║Лф╗╢</code>уАВ<code>SelectorProvider</code>х░▒цШпчФицЭехИЫх╗║<code>Selector</code>чЪДуАВ</li> <li><code>SelectStrategyFactory selectStrategyFactoryя╝Ъ</code> ReactorцЬАщЗНшжБчЪДф║ЛцГЕх░▒цШп<code>ш╜ошпв</code>ц│ихЖМхЕ╢ф╕КчЪД<code>Channel</code>ф╕КчЪД<code>IOх░▒ч╗кф║Лф╗╢</code>я╝Мш┐ЩщЗМчЪД<code>SelectStrategyFactory</code>чФиф║ОцМЗхоЪ<code>ш╜ошпвчнЦчХе</code>я╝Мщ╗Шшодф╕║<code>DefaultSelectStrategyFactory.INSTANCE</code>уАВ</li></ul> <p>цЬАч╗Иф╝Ъх░Жш┐Щф║ЫхПВцХ░ф║дч╗Щ<code>NioEventLoopGroup</code>чЪДчИ╢ч▒╗цЮДщАахЩия╝Мф╕ЛщЭвцИСф╗мцЭечЬЛф╕Л<code>NioEventLoopGroupч▒╗</code>чЪДч╗зцЙ┐ч╗УцЮДя╝Ъ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191013482.png" alt="хЫ╛чЙЗ"></p> <p><code>NioEventLoopGroupч▒╗</code>чЪДч╗зцЙ┐ч╗УцЮДф╣Нф╕АчЬЛцпФш╛ГхдНцЭВя╝Мхдзхо╢ф╕НшжБцЕМя╝МчмФшАЕф╝ЪщЪПчЭАф╕╗ч║┐чЪДц╖▒хЕецЕвцЕвхЬ░ф╗Лч╗Нш┐Щф║ЫчИ╢ч▒╗цОехПгя╝МцИСф╗мчО░хЬищЗНчВ╣хЕ│ц│и<code>Mutithread</code>хЙНч╝АчЪДч▒╗уАВ</p> <p>цИСф╗мчЯещБУ<code>NioEventLoopGroup</code>цШпNettyф╕нчЪД<code>Reactorч║┐чиЛч╗Д</code>чЪДхоЮчО░я╝МцЧвчД╢цШпч║┐чиЛч╗ДщВгф╣ИшВпхоЪцШпш┤Яш┤гчобчРЖхТМхИЫх╗║<code>хдЪф╕кReactorч║┐чиЛчЪД</code>я╝МцЙАф╗е<code>Mutithread</code>хЙНч╝АчЪДч▒╗хоЪф╣ЙчЪДшбМф╕║шЗкчД╢цШпхп╣<code>Reactorч║┐чиЛч╗Д</code>хЖЕхдЪф╕к<code>Reactorч║┐чиЛ</code>чЪДхИЫх╗║хТМчобчРЖх╖еф╜ЬуАВ</p> <h3 id="multithreadeventloopgroup"><a href="#multithreadeventloopgroup" class="header-anchor">#</a> MultithreadEventLoopGroup</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MultithreadEventLoopGroup</span> <span class="token keyword">extends</span> <span class="token class-name">MultithreadEventExecutorGroup</span> <span class="token keyword">implements</span> <span class="token class-name">EventLoopGroup</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">InternalLogger</span> logger <span class="token operator">=</span> <span class="token class-name">InternalLoggerFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">MultithreadEventLoopGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//щ╗ШшодReactorф╕кцХ░</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_EVENT_LOOP_THREADS</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token constant">DEFAULT_EVENT_LOOP_THREADS</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">SystemPropertyUtil</span><span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>
                <span class="token string">&quot;io.netty.eventLoopThreads&quot;</span><span class="token punctuation">,</span> <span class="token class-name">NettyRuntime</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;-Dio.netty.eventLoopThreads: {}&quot;</span><span class="token punctuation">,</span> <span class="token constant">DEFAULT_EVENT_LOOP_THREADS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @see MultithreadEventExecutorGroup#MultithreadEventExecutorGroup(int, Executor, Object...)
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">MultithreadEventLoopGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>nThreads <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token constant">DEFAULT_EVENT_LOOP_THREADS</span> <span class="token operator">:</span> nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>MultithreadEventLoopGroupч▒╗</code>ф╕╗шжБчЪДхКЯшГ╜х░▒цШпчФицЭечбохоЪ<code>Reactorч║┐чиЛч╗Д</code>хЖЕ<code>Reactor</code>чЪДф╕кцХ░уАВ</p> <p>щ╗ШшодчЪД<code>Reactor</code>чЪДф╕кцХ░хнШцФ╛ф║ОхнЧцо╡<code>DEFAULT_EVENT_LOOP_THREADS</code>ф╕нуАВ</p> <p>ф╗О<code>static {}</code>щЭЩцАБф╗гчаБхЭЧф╕нцИСф╗мхПпф╗ечЬЛхЗ║щ╗Шшод<code>Reactor</code>чЪДф╕кцХ░чЪДшО╖хПЦщА╗ш╛Ся╝Ъ</p> <ul><li>хПпф╗ещАЪш┐Зч│╗ч╗ЯхПШщЗП <code>-D io.netty.eventLoopThreads&quot;</code>цМЗхоЪуАВ</li> <li>хжВцЮЬф╕НцМЗхоЪя╝МщВгф╣Ищ╗ШшодчЪДх░▒цШп<code>NettyRuntime.availableProcessors() * 2</code></li></ul> <p>х╜У<code>nThread</code>хПВцХ░шо╛ч╜оф╕║<code>0</code>щЗЗчФищ╗Шшодшо╛ч╜оцЧ╢я╝М<code>Reactorч║┐чиЛч╗Д</code>хЖЕчЪД<code>Reactor</code>ф╕кцХ░хИЩшо╛ч╜оф╕║<code>DEFAULT_EVENT_LOOP_THREADS</code>уАВ</p> <h3 id="multithreadeventexecutorgroup"><a href="#multithreadeventexecutorgroup" class="header-anchor">#</a> MultithreadEventExecutorGroup</h3> <p><code>MultithreadEventExecutorGroup</code>ш┐ЩщЗМх░▒цШпцЬмх░ПшКВчЪДца╕х┐Гя╝Мф╕╗шжБчФицЭехоЪф╣ЙхИЫх╗║хТМчобчРЖ<code>Reactor</code>чЪДшбМф╕║уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MultithreadEventExecutorGroup</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEventExecutorGroup</span> <span class="token punctuation">{</span>

    <span class="token comment">//Reactorч║┐чиЛч╗Дф╕нчЪДReactorщЫЖхРИ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EventExecutor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> children<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EventExecutor</span><span class="token punctuation">&gt;</span></span> readonlyChildren<span class="token punctuation">;</span>
    <span class="token comment">//ф╗ОReactor groupф╕нщАЙцЛйф╕Аф╕кчЙ╣хоЪчЪДReactorчЪДщАЙцЛйчнЦчХе чФиф║Оchannelц│ихЖМч╗СхоЪхИ░ф╕Аф╕кхЫ║хоЪчЪДReactorф╕К</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EventExecutorChooserFactory<span class="token punctuation">.</span>EventExecutorChooser</span> chooser<span class="token punctuation">;</span>

    <span class="token comment">/**
     * Create a new instance.
     *
     * @param nThreads          the number of threads that will be used by this instance.
     * @param executor          the Executor to use, or {@code null} if the default should be used.
     * @param args              arguments which will passed to each {@link #newChild(Executor, Object...)} call
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">MultithreadEventExecutorGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> <span class="token class-name">DefaultEventExecutorChooserFactory</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>щжЦхЕИф╗Лч╗Нф╕Аф╕кцЦ░чЪДцЮДщАахЩихПВцХ░<code>EventExecutorChooserFactory chooserFactory</code>уАВх╜УховцИ╖члпш┐ЮцОехоМцИРф╕ЙцмбцПбцЙЛхРОя╝М<code>Main Reactor</code>ф╝ЪхИЫх╗║ховцИ╖члпш┐ЮцОе<code>NioSocketChannel</code>я╝Мх╣╢х░ЖхЕ╢ч╗СхоЪхИ░<code>Sub Reactor Group</code>ф╕нчЪДф╕Аф╕кхЫ║хоЪ<code>Reactor</code>я╝МщВгф╣ИхЕ╖ф╜УшжБч╗СхоЪхИ░хУкф╕кхЕ╖ф╜УчЪД<code>Sub Reactor</code>ф╕КхСвя╝Яш┐Щф╕кч╗СхоЪчнЦчХех░▒цШпчФ▒<code>chooserFactory</code>цЭехИЫх╗║чЪДуАВщ╗Шшодф╕║<code>DefaultEventExecutorChooserFactory</code>уАВ</p> <p><strong>ф╕ЛщЭвх░▒цШпцЬмх░ПшКВчЪДф╕╗щвШ<code>Reactorч║┐чиЛч╗Д</code>чЪДхИЫх╗║ш┐ЗчиЛя╝Ъ</strong></p> <div class="language-Java extra-class"><pre class="language-java"><code>    <span class="token keyword">protected</span> <span class="token class-name">MultithreadEventExecutorGroup</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span>
                                            <span class="token class-name">EventExecutorChooserFactory</span> chooserFactory<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nThreads <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;nThreads: %d (expected: &gt; 0)&quot;</span><span class="token punctuation">,</span> nThreads<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//чФиф║ОхИЫх╗║Reactorч║┐чиЛ</span>
            executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token function">newDefaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventExecutor</span><span class="token punctuation">[</span>nThreads<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//х╛кчОпхИЫх╗║reaactor group ф╕нчЪД Reactor</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nThreads<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">boolean</span> success <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//хИЫх╗║reactor</span>
                children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newChild</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;failed to create a child event loop&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//хИЫх╗║channelхИ░ReactorчЪДч╗СхоЪчнЦчХе</span>
        chooser <span class="token operator">=</span> chooserFactory<span class="token punctuation">.</span><span class="token function">newChooser</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EventExecutor</span><span class="token punctuation">&gt;</span></span> childrenSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EventExecutor</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>childrenSet<span class="token punctuation">,</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
        readonlyChildren <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableSet</span><span class="token punctuation">(</span>childrenSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-хИЫх╗║чФиф║ОхРпхКиreactorч║┐чиЛчЪДexecutor"><a href="#_1-хИЫх╗║чФиф║ОхРпхКиreactorч║┐чиЛчЪДexecutor" class="header-anchor">#</a> 1. хИЫх╗║чФиф║ОхРпхКиReactorч║┐чиЛчЪДexecutor</h4> <p>хЬиNetty Reactor Groupф╕нчЪДхНХф╕к<code>Reactor</code>чЪД<code>IOч║┐чиЛцибхЮЛ</code>ф╕║ф╕КчпЗцЦЗчлацПРхИ░чЪД<code>хНХReactorхНХч║┐чиЛцибхЮЛ</code>я╝Мф╕Аф╕к<code>Reactorч║┐чиЛ</code>ш┤Яш┤г<code>ш╜ошпв</code>ц│ихЖМхЕ╢ф╕КчЪДцЙАцЬЙ<code>Channel</code>ф╕нчЪД<code>IOх░▒ч╗кф║Лф╗╢</code>я╝МхдДчРЖIOф║Лф╗╢я╝МцЙзшбМNettyф╕нчЪДх╝Вцнеф╗╗хКбчнЙх╖еф╜ЬуАВцнгцШпш┐Щф╕к<code>Reactorч║┐чиЛ</code>щй▒хКичЭАцХ┤ф╕кNettyчЪДш┐Рш╜мя╝МхПпш░УцШпNettyчЪДца╕х┐Гх╝ХцУОуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191020098.png" alt="хЫ╛чЙЗ"></p> <p>шАМш┐ЩщЗМчЪД<code>executor</code>х░▒цШпш┤Яш┤гхРпхКи<code>Reactorч║┐чиЛ</code>чЪДя╝Мф╗ОхИЫх╗║ц║РчаБф╕нцИСф╗мхПпф╗ечЬЛхИ░<code>executor</code>чЪДч▒╗хЮЛф╕║<code>ThreadPerTaskExecutor</code>уАВ</p> <h5 id="threadpertaskexecutor"><a href="#threadpertaskexecutor" class="header-anchor">#</a> ThreadPerTaskExecutor</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPerTaskExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ThreadPerTaskExecutor</span><span class="token punctuation">(</span><span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>threadFactory <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>threadFactory<span class="token punctuation">,</span> <span class="token string">&quot;threadFactory&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        threadFactory<span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>цИСф╗мчЬЛхИ░<code>ThreadPerTaskExecutor</code>хБЪчЪДф║ЛцГЕх╛ИчоАхНХя╝Мф╗ОхоГчЪДхС╜хРНхЙНч╝А<code>ThreadPerTask</code>цИСф╗мх░▒хПпф╗ечМЬхЗ║хоГчЪДх╖еф╜ЬцЦ╣х╝Пя╝Мх░▒цШпцЭеф╕Аф╕кф╗╗хКбх░▒хИЫх╗║ф╕Аф╕кч║┐чиЛцЙзшбМуАВшАМхИЫх╗║чЪДш┐Щф╕кч║┐чиЛцнгцШпnettyчЪДца╕х┐Гх╝ХцУОReactorч║┐чиЛуАВ</p> <p>хЬи<code>Reactorч║┐чиЛ</code>хРпхКичЪДцЧ╢хАЩя╝МNettyф╝Ъх░Ж<code>Reactorч║┐чиЛ</code>шжБхБЪчЪДф║ЛцГЕх░БшгЕцИР<code>Runnable</code>я╝Мф╕вч╗Щ<code>exexutor</code>хРпхКиуАВ</p> <p>шАМ<code>Reactorч║┐чиЛ</code>чЪДца╕х┐Гх░▒цШпф╕Аф╕к<code>цн╗х╛кчОп</code>ф╕НхБЬчЪД<code>ш╜ошпв</code>IOх░▒ч╗кф║Лф╗╢я╝МхдДчРЖIOф║Лф╗╢я╝МцЙзшбМх╝Вцнеф╗╗хКбуАВф╕АхИ╗ф╣Яф╕НхБЬцнЗя╝Мхакчз░<code>996хЕ╕шМГ</code>уАВ</p> <p>ш┐ЩщЗМхРСхдзхо╢хЕИхНЦф╕кхЕ│хнРя╝М<code>&quot;Reactorч║┐чиЛцШпф╜ХцЧ╢хРпхКичЪДхСвя╝Яя╝Я&quot;</code></p> <h4 id="_2-хИЫх╗║reactor"><a href="#_2-хИЫх╗║reactor" class="header-anchor">#</a> 2. хИЫх╗║Reactor</h4> <p><code>Reactorч║┐чиЛч╗ДNioEventLoopGroup</code>хМЕхРлхдЪф╕к<code>Reactor</code>я╝МхнШцФ╛ф║О<code>private final EventExecutor[] children</code>цХ░ч╗Дф╕нуАВ</p> <p>цЙАф╗еф╕ЛщЭвчЪДф║ЛцГЕх░▒цШпхИЫх╗║<code>nThread</code>ф╕к<code>Reactor</code>я╝Мх╣╢хнШцФ╛ф║О<code>EventExecutor[] children</code>хнЧцо╡ф╕ня╝М</p> <p>цИСф╗мцЭечЬЛф╕ЛчФиф║ОхИЫх╗║<code>Reactor</code>чЪД<code>newChild(executor, args)</code>цЦ╣ц│Хя╝Ъ</p> <h5 id="newchild"><a href="#newchild" class="header-anchor">#</a> newChild</h5> <p><code>newChild</code>цЦ╣ц│ХцШп<code>MultithreadEventExecutorGroup</code>ф╕нчЪДф╕Аф╕кцК╜ш▒бцЦ╣ц│Хя╝МцПРф╛Ыч╗ЩхЕ╖ф╜УхнРч▒╗хоЮчО░уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">EventExecutor</span> <span class="token function">newChild</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
</code></pre></div><p>ш┐ЩщЗМцИСф╗мшзгцЮРчЪДцШп<code>NioEventLoopGroup</code>я╝МцИСф╗мцЭечЬЛф╕Л<code>newChild</code>хЬишпеч▒╗ф╕нчЪДхоЮчО░я╝Ъ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioEventLoopGroup</span> <span class="token keyword">extends</span> <span class="token class-name">MultithreadEventLoopGroup</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">EventLoop</span> <span class="token function">newChild</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">EventLoopTaskQueueFactory</span> queueFactory <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">EventLoopTaskQueueFactory</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoop</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> executor<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">SelectorProvider</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SelectStrategyFactory</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newSelectStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">RejectedExecutionHandler</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>хЙНш╛╣цПРхИ░чЪДф╝ЧхдЪцЮДщАахЩихПВцХ░я╝Мш┐ЩщЗМф╝ЪщАЪш┐ЗхПпхПШхПВцХ░<code>Object... args</code>ф╝ахЕехИ░Reactorч▒╗<code>NioEventLoop</code>чЪДцЮДщАахЩиф╕нуАВ</p> <p>ш┐ЩщЗМф╗Лч╗Нф╕ЛцЦ░чЪДхПВцХ░<code>EventLoopTaskQueueFactory queueFactory</code>я╝МхЙНш╛╣цПРхИ░Nettyф╕нчЪД<code>Reactor</code>ф╕╗шжБх╖еф╜ЬцШп<code>ш╜ошпв</code>ц│ихЖМхЕ╢ф╕КчЪДцЙАцЬЙ<code>Channel</code>ф╕КчЪД<code>IOх░▒ч╗кф║Лф╗╢</code>я╝МхдДчРЖ<code>IOх░▒ч╗кф║Лф╗╢</code>уАВщЩдф║Жш┐Щф║Ыф╕╗шжБчЪДх╖еф╜ЬхдЦя╝МNettyф╕║ф║ЖцЮБшЗ┤чЪДхОЛцжи<code>Reactor</code>чЪДцАзшГ╜я╝Мш┐Шф╝ЪшойхоГхБЪф╕Аф║Ых╝Вцнеф╗╗хКбчЪДцЙзшбМх╖еф╜ЬуАВцЧвчД╢шжБцЙзшбМх╝Вцнеф╗╗хКбя╝МщВгф╣И<code>Reactor</code>ф╕нх░▒щЬАшжБф╕Аф╕к<code>щШЯхИЧ</code>цЭеф┐ЭхнШф╗╗хКбуАВ</p> <p>ш┐ЩщЗМчЪД<code>EventLoopTaskQueueFactory</code>х░▒цШпчФицЭехИЫх╗║ш┐Щца╖чЪДф╕Аф╕кщШЯхИЧцЭеф┐ЭхнШ<code>Reactor</code>ф╕нх╛ЕцЙзшбМчЪДх╝Вцнеф╗╗хКбуАВ</p> <p><strong>хПпф╗ецКК<code>Reactor</code>чРЖшзгцИРф╕║ф╕Аф╕к<code>хНХч║┐чиЛчЪДч║┐чиЛц▒а</code>я╝М<code>ч▒╗ф╝╝</code>ф║О<code>JDK</code>ф╕нчЪД<code>SingleThreadExecutor</code>я╝Мф╗ЕчФиф╕Аф╕кч║┐чиЛцЭецЙзшбМ<code>ш╜ошпвIOх░▒ч╗кф║Лф╗╢</code>я╝М<code>хдДчРЖIOх░▒ч╗кф║Лф╗╢</code>я╝М<code>цЙзшбМх╝Вцнеф╗╗хКб</code>уАВхРМцЧ╢х╛ЕцЙзшбМчЪДх╝Вцнеф╗╗хКбф┐ЭхнШхЬи<code>Reactor</code>щЗМчЪД<code>taskQueue</code>ф╕нуАВ</strong></p> <h5 id="nioeventloop"><a href="#nioeventloop" class="header-anchor">#</a> NioEventLoop</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">NioEventLoop</span> <span class="token keyword">extends</span> <span class="token class-name">SingleThreadEventLoop</span> <span class="token punctuation">{</span>
    <span class="token comment">//чФиф║ОхИЫх╗║JDK NIO Selector,ServerSocketChannel</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SelectorProvider</span> provider<span class="token punctuation">;</span>
    <span class="token comment">//Selectorш╜ошпвчнЦчХе хЖ│хоЪф╗Аф╣ИцЧ╢хАЩш╜ошпвя╝Мф╗Аф╣ИцЧ╢хАЩхдДчРЖIOф║Лф╗╢я╝Мф╗Аф╣ИцЧ╢хАЩцЙзшбМх╝Вцнеф╗╗хКб</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SelectStrategy</span> selectStrategy<span class="token punctuation">;</span>
    <span class="token comment">/**
     * The NIO {@link Selector}.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Selector</span> selector<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Selector</span> unwrappedSelector<span class="token punctuation">;</span>

    <span class="token class-name">NioEventLoop</span><span class="token punctuation">(</span><span class="token class-name">NioEventLoopGroup</span> parent<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">SelectorProvider</span> selectorProvider<span class="token punctuation">,</span>
                 <span class="token class-name">SelectStrategy</span> strategy<span class="token punctuation">,</span> <span class="token class-name">RejectedExecutionHandler</span> rejectedExecutionHandler<span class="token punctuation">,</span>
                 <span class="token class-name">EventLoopTaskQueueFactory</span> queueFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">newTaskQueue</span><span class="token punctuation">(</span>queueFactory<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">newTaskQueue</span><span class="token punctuation">(</span>queueFactory<span class="token punctuation">)</span><span class="token punctuation">,</span>
                rejectedExecutionHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>selectorProvider<span class="token punctuation">,</span> <span class="token string">&quot;selectorProvider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selectStrategy <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>strategy<span class="token punctuation">,</span> <span class="token string">&quot;selectStrategy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">SelectorTuple</span> selectorTuple <span class="token operator">=</span> <span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selector <span class="token operator">=</span> selectorTuple<span class="token punctuation">.</span>selector<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>unwrappedSelector <span class="token operator">=</span> selectorTuple<span class="token punctuation">.</span>unwrappedSelector<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐ЩщЗМх░▒цнгх╝Пх╝АхзЛф║Ж<code>Reactor</code>чЪДхИЫх╗║ш┐ЗчиЛя╝МцИСф╗мчЯещБУ<code>Reactor</code>чЪДца╕х┐ГцШпщЗЗчФичЪД<code>IOхдЪш╖пхдНчФицибхЮЛ</code>цЭехп╣ховцИ╖члпш┐ЮцОеф╕КчЪД<code>IOф║Лф╗╢</code>ш┐ЫшбМ<code>чЫСхРм</code>я╝МцЙАф╗ецЬАщЗНшжБчЪДф║ЛцГЕцШпхИЫх╗║<code>Selector</code>(<code>JDK NIO ф╕нIOхдЪш╖пхдНчФицКАцЬпчЪДхоЮчО░</code>)уАВ</p> <blockquote><p>хПпф╗ецКК<code>Selector</code>чРЖшзгф╕║цИСф╗мф╕КчпЗцЦЗчлаф╗Лч╗НчЪД<code>Select,poll,epoll</code>я╝МхоГцШп<code>JDK NIO</code>хп╣цУНф╜Ьч│╗ч╗ЯхЖЕца╕цПРф╛ЫчЪДш┐Щф║Ы<code>IOхдЪш╖пхдНчФицКАцЬп</code>чЪДх░БшгЕуАВ</p></blockquote> <h5 id="openselector"><a href="#openselector" class="header-anchor">#</a> openSelector</h5> <p><code>openSelector</code>цШп<code>NioEventLoopч▒╗</code>ф╕нчФиф║ОхИЫх╗║<code>IOхдЪш╖пхдНчФи</code>чЪД<code>Selector</code>я╝Мх╣╢хп╣хИЫх╗║хЗ║цЭечЪД<code>JDK NIO</code> хОЯчФЯчЪД<code>Selector</code>ш┐ЫшбМцАзшГ╜ф╝ШхМЦуАВ</p> <p>щжЦхЕИф╝ЪщАЪш┐З<code>SelectorProvider#openSelector</code>хИЫх╗║JDK NIOхОЯчФЯчЪД<code>Selector</code>уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SelectorTuple</span> <span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">Selector</span> unwrappedSelector<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//щАЪш┐ЗJDK NIO SelectorProviderхИЫх╗║Selector</span>
        unwrappedSelector <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ChannelException</span><span class="token punctuation">(</span><span class="token string">&quot;failed to open a new selector&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>SelectorProvider</code>ф╝Ъца╣цНоцУНф╜Ьч│╗ч╗ЯчЪДф╕НхРМщАЙцЛйJDKхЬиф╕НхРМцУНф╜Ьч│╗ч╗ЯчЙИцЬмф╕ЛчЪДхп╣х║Ф<code>Selector</code>чЪДхоЮчО░уАВLinuxф╕Лф╝ЪщАЙцЛй<code>Epoll</code>я╝МMacф╕Лф╝ЪщАЙцЛй<code>Kqueue</code>уАВ</p> <p>ф╕ЛщЭвцИСф╗мх░▒цЭечЬЛф╕Л<code>SelectorProvider</code>цШпхжВф╜ХхБЪхИ░шЗкхКищАВщЕНф╕НхРМцУНф╜Ьч│╗ч╗Яф╕Л<code>IOхдЪш╖пхдНчФи</code>хоЮчО░чЪД</p> <h5 id="selectorprovider"><a href="#selectorprovider" class="header-anchor">#</a> SelectorProvider</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> threadFactory<span class="token punctuation">,</span> <span class="token class-name">SelectorProvider</span><span class="token punctuation">.</span><span class="token function">provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>SelectorProvider</code>цШпхЬихЙНщЭвф╗Лч╗НчЪД<code>NioEventLoopGroupч▒╗</code>цЮДщАахЗ╜цХ░ф╕нщАЪш┐Зш░ГчФи<code>SelectorProvider.provider()</code>швлхКаш╜╜я╝Мх╣╢щАЪш┐З<code>NioEventLoopGroup#newChild</code>цЦ╣ц│Хф╕нчЪДхПпхПШщХ┐хПВцХ░<code>Object... args</code>ф╝ащАТхИ░<code>NioEventLoop</code>ф╕нчЪД<code>private final SelectorProvider provider</code>хнЧцо╡ф╕нуАВ</p> <p><strong>SelectorProviderчЪДхКаш╜╜ш┐ЗчиЛя╝Ъ</strong></p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SelectorProvider</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SelectorProvider</span> <span class="token function">provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>provider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectorProvider</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">public</span> <span class="token class-name">SelectorProvider</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">loadProviderFromProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">loadProviderAsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
                            provider <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span></span>DefaultSelectorProvider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">return</span> provider<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╗О<code>SelectorProvider</code>хКаш╜╜ц║РчаБф╕нцИСф╗мхПпф╗ечЬЛхЗ║я╝М<code>SelectorProvider</code>чЪДхКаш╜╜цЦ╣х╝ПцЬЙф╕ЙчзНя╝Мф╝ШхЕИч║зхжВф╕Ля╝Ъ</p> <ol><li>щАЪш┐Зч│╗ч╗ЯхПШщЗП<code>-D java.nio.channels.spi.SelectorProvider</code>цМЗхоЪ<code>SelectorProvider</code>чЪДшЗкхоЪф╣ЙхоЮчО░ч▒╗<code>хЕищЩРхоЪхРН</code>уАВщАЪш┐З<code>х║ФчФичиЛх║Пч▒╗хКаш╜╜хЩи(Application Classloader)</code>хКаш╜╜уАВ</li></ol> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">loadProviderFromProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> cn <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;java.nio.channels.spi.SelectorProvider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cn <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cn<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        provider <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SelectorProvider</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>щАЪш┐З<code>SPI</code>цЦ╣х╝ПхКаш╜╜уАВхЬих╖ечиЛчЫох╜Х<code>META-INF/services</code>ф╕ЛхоЪф╣ЙхРНф╕║<code>java.nio.channels.spi.SelectorProvider</code>чЪД<code>SPIцЦЗф╗╢</code>я╝МцЦЗф╗╢ф╕нчммф╕Аф╕кхоЪф╣ЙчЪД<code>SelectorProvider</code>хоЮчО░ч▒╗хЕищЩРхоЪхРНх░▒ф╝ЪшвлхКаш╜╜уАВ</li></ol> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">loadProviderAsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectorProvider</span><span class="token punctuation">&gt;</span></span> sl <span class="token operator">=</span>
            <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">SelectorProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                               <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectorProvider</span><span class="token punctuation">&gt;</span></span> i <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                provider <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ServiceConfigurationError</span> sce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sce<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">SecurityException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Ignore the security exception, try the next provider</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">throw</span> sce<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>хжВцЮЬф╗еф╕Кф╕дчзНцЦ╣х╝ПхЭЗцЬкшвлхоЪф╣Йя╝МщВгф╣Их░▒щЗЗчФи<code>SelectorProvider</code>ч│╗ч╗Ящ╗ШшодхоЮчО░<code>sun.nio.ch.DefaultSelectorProvider</code>уАВчмФшАЕх╜УхЙНф╜┐чФичЪДцУНф╜Ьч│╗ч╗ЯцШп<code>MacOS</code>я╝Мф╗Оц║РчаБф╕нцИСф╗мхПпф╗ечЬЛхИ░шЗкхКищАВщЕНф║Ж<code>KQueue</code>хоЮчО░уАВ</li></ol> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultSelectorProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">DefaultSelectorProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SelectorProvider</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">KQueueSelectorProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕ЛщЭвцИСф╗мцОечЭАхЫЮхИ░<code>io.netty.channel.nio.NioEventLoop#openSelector</code>чЪДф╕╗ч║┐ф╕КцЭеуАВ</p> <h5 id="nettyхп╣jdk-nio-хОЯчФЯselectorчЪДф╝ШхМЦ"><a href="#nettyхп╣jdk-nio-хОЯчФЯselectorчЪДф╝ШхМЦ" class="header-anchor">#</a> Nettyхп╣JDK NIO хОЯчФЯSelectorчЪДф╝ШхМЦ</h5> <p>х╗║шооцЯечЬЛ https://mp.weixin.qq.com/s/IuIsUtpiye13L8ZyHWvzXA</p> <h5 id="newtaskqueue"><a href="#newtaskqueue" class="header-anchor">#</a> newTaskQueue</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">NioEventLoop</span><span class="token punctuation">(</span><span class="token class-name">NioEventLoopGroup</span> parent<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span> <span class="token class-name">SelectorProvider</span> selectorProvider<span class="token punctuation">,</span><span class="token class-name">SelectStrategy</span> strategy<span class="token punctuation">,</span> <span class="token class-name">RejectedExecutionHandler</span> rejectedExecutionHandler<span class="token punctuation">,</span><span class="token class-name">EventLoopTaskQueueFactory</span> queueFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>		  	<span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">newTaskQueue</span><span class="token punctuation">(</span>queueFactory<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">newTaskQueue</span><span class="token punctuation">(</span>queueFactory<span class="token punctuation">)</span><span class="token punctuation">,</span>rejectedExecutionHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>selectorProvider<span class="token punctuation">,</span> <span class="token string">&quot;selectorProvider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selectStrategy <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>strategy<span class="token punctuation">,</span> <span class="token string">&quot;selectStrategy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">SelectorTuple</span> selectorTuple <span class="token operator">=</span> <span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//щАЪш┐ЗчФиSelectedSelectionKeySetшгЕще░хРОчЪДunwrappedSelector</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selector <span class="token operator">=</span> selectorTuple<span class="token punctuation">.</span>selector<span class="token punctuation">;</span>
    <span class="token comment">//Nettyф╝ШхМЦш┐ЗчЪДJDK NIOш┐ЬчиЛSelector</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>unwrappedSelector <span class="token operator">=</span> selectorTuple<span class="token punctuation">.</span>unwrappedSelector<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>цИСф╗мч╗зч╗нхЫЮхИ░хИЫх╗║<code>Reactor</code>чЪДф╕╗ч║┐ф╕Кя╝МхИ░чЫохЙНф╕║цнв<code>Reactor</code>чЪДца╕х┐Г<code>Selector</code>х░▒хИЫх╗║хе╜ф║Жя╝МхЙНш╛╣цИСф╗мцПРхИ░<code>Reactor</code>щЩдф║ЖщЬАшжБ<code>чЫСхРмIOх░▒ч╗кф║Лф╗╢</code>ф╗ехПКхдДчРЖ<code>IOх░▒ч╗кф║Лф╗╢</code>хдЦя╝Мш┐ШщЬАшжБцЙзшбМф╕Аф║Ых╝Вцнеф╗╗хКбя╝Мх╜УхдЦщГич║┐чиЛхРС<code>Reactor</code>цПРф║дх╝Вцнеф╗╗хКбхРОя╝М<code>Reactor</code>х░▒щЬАшжБф╕Аф╕кщШЯхИЧцЭеф┐ЭхнШш┐Щф║Ых╝Вцнеф╗╗хКбя╝МчнЙх╛Е<code>Reactorч║┐чиЛ</code>цЙзшбМуАВ</p> <p>ф╕ЛщЭвцИСф╗мцЭечЬЛф╕Л<code>Reactor</code>ф╕нф╗╗хКбщШЯхИЧчЪДхИЫх╗║ш┐ЗчиЛя╝Ъ</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">//ф╗╗хКбщШЯхИЧхдзх░Пя╝Мщ╗ШшодцШпцЧачХМщШЯхИЧ</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_MAX_PENDING_TASKS</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span>
            <span class="token class-name">SystemPropertyUtil</span><span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;io.netty.eventLoop.maxPendingTasks&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> <span class="token function">newTaskQueue</span><span class="token punctuation">(</span>
            <span class="token class-name">EventLoopTaskQueueFactory</span> queueFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>queueFactory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">newTaskQueue0</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_MAX_PENDING_TASKS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> queueFactory<span class="token punctuation">.</span><span class="token function">newTaskQueue</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_MAX_PENDING_TASKS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> <span class="token function">newTaskQueue0</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxPendingTasks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// This event loop never calls takeTask()</span>
        <span class="token keyword">return</span> maxPendingTasks <span class="token operator">==</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span> <span class="token operator">?</span> <span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token function">newMpscQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">:</span> <span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token function">newMpscQueue</span><span class="token punctuation">(</span>maxPendingTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
</code></pre></div><ul><li><p>хЬи<code>NioEventLoop</code>чЪДчИ╢ч▒╗<code>SingleThreadEventLoop</code>ф╕нцПРф╛Ыф║Жф╕Аф╕кщЭЩцАБхПШщЗП<code>DEFAULT_MAX_PENDING_TASKS</code>чФицЭецМЗхоЪ<code>Reactor</code>ф╗╗хКбщШЯхИЧчЪДхдзх░ПуАВхПпф╗ещАЪш┐Зч│╗ч╗ЯхПШщЗП<code>-D io.netty.eventLoop.maxPendingTasks</code>ш┐ЫшбМшо╛ч╜оя╝Мщ╗Шшодф╕║<code>Integer.MAX_VALUE</code>я╝Мшбичд║ф╗╗хКбщШЯхИЧщ╗Шшодф╕║<code>цЧачХМщШЯхИЧ</code>уАВ</p></li> <li><p>ца╣цНо<code>DEFAULT_MAX_PENDING_TASKS</code>хПШщЗПчЪДшо╛хоЪя╝МцЭехЖ│хоЪхИЫх╗║цЧачХМф╗╗хКбщШЯхИЧш┐ШцШпцЬЙчХМф╗╗хКбщШЯхИЧуАВ</p></li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token comment">//хИЫх╗║цЧачХМф╗╗хКбщШЯхИЧ</span>
<span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token function">newMpscQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//хИЫх╗║цЬЙчХМф╗╗хКбщШЯхИЧ</span>
<span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token function">newMpscQueue</span><span class="token punctuation">(</span>maxPendingTasks<span class="token punctuation">)</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">newMpscQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">Mpsc</span><span class="token punctuation">.</span><span class="token function">newMpscQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">newMpscQueue</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token keyword">int</span> maxCapacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">Mpsc</span><span class="token punctuation">.</span><span class="token function">newMpscQueue</span><span class="token punctuation">(</span>maxCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>Reactor</code>хЖЕчЪДх╝Вцнеф╗╗хКбщШЯхИЧчЪДч▒╗хЮЛф╕║<code>MpscQueue</code>,хоГцШпчФ▒<code>JCTools</code>цПРф╛ЫчЪДф╕Аф╕кщлШцАзшГ╜цЧащФБщШЯхИЧя╝Мф╗ОхС╜хРНхЙНч╝А<code>Mpsc</code>хПпф╗ечЬЛхЗ║я╝МхоГщАВчФиф║О<code>хдЪчФЯф║зшАЕхНХц╢Иш┤╣шАЕ</code>чЪДхЬ║цЩпя╝МхоГцФпцМБхдЪф╕кчФЯф║зшАЕч║┐чиЛхоЙхЕичЪДшо┐щЧощШЯхИЧя╝МхРМф╕АцЧ╢хИ╗хПкхЕБшо╕ф╕Аф╕кц╢Иш┤╣шАЕч║┐чиЛшп╗хПЦщШЯхИЧф╕нчЪДхЕГч┤ауАВ</p></blockquote> <blockquote><p>цИСф╗мчЯещБУNettyф╕нчЪД<code>Reactor</code>хПпф╗е<code>ч║┐чиЛхоЙхЕи</code>чЪДхдДчРЖц│ихЖМхЕ╢ф╕КчЪДхдЪф╕к<code>SocketChannel</code>ф╕КчЪД<code>IOцХ░цНо</code>я╝Мф┐ЭшпБ<code>Reactorч║┐чиЛхоЙхЕи</code>чЪДца╕х┐ГхОЯхЫацнгцШпхЫаф╕║ш┐Щф╕к<code>MpscQueue</code>я╝МхоГхПпф╗ецФпцМБхдЪф╕кф╕ЪхКбч║┐чиЛхЬихдДчРЖхоМф╕ЪхКбщА╗ш╛СхРОя╝Мч║┐чиЛхоЙхЕичЪДхРС<code>MpscQueue</code>ц╖╗хКа<code>х╝ВцнехЖЩф╗╗хКб</code>я╝МчД╢хРОчФ▒хНХф╕к<code>Reactorч║┐чиЛ</code>цЭецЙзшбМш┐Щф║Ы<code>хЖЩф╗╗хКб</code>уАВцЧвчД╢цШпхНХч║┐чиЛцЙзшбМя╝МщВгшВпхоЪцШпч║┐чиЛхоЙхЕичЪДф║ЖуАВ</p></blockquote> <h5 id="reactorхп╣х║ФчЪДnioeventloopч▒╗хЮЛч╗зцЙ┐ч╗УцЮД"><a href="#reactorхп╣х║ФчЪДnioeventloopч▒╗хЮЛч╗зцЙ┐ч╗УцЮД" class="header-anchor">#</a> Reactorхп╣х║ФчЪДNioEventLoopч▒╗хЮЛч╗зцЙ┐ч╗УцЮД</h5> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191039019.png" alt="хЫ╛чЙЗ"></p> <p><code>NioEventLoop</code>чЪДч╗зцЙ┐ч╗УцЮДф╣ЯцШпцпФш╛ГхдНцЭВя╝Мш┐ЩщЗМцИСф╗мхПкхЕ│ц│ихЬи<code>Reactor</code>хИЫх╗║ш┐ЗчиЛф╕нц╢ЙхПКчЪДхИ░ф╕дф╕кчИ╢ч▒╗<code>SingleThreadEventLoop</code>,<code>SingleThreadEventExecutor</code>уАВ</p> <p>хЙйф╕ЛчЪДч╗зцЙ┐ф╜Уч│╗я╝МцИСф╗мхЬихРОш╛╣щЪПчЭА<code>Netty</code>ц║РчаБчЪДц╖▒хЕехЬицЕвцЕвф╗Лч╗НуАВ</p> <p>хЙНш╛╣цИСф╗мцПРхИ░я╝МхЕ╢хоЮ<code>Reactor</code>цИСф╗мхПпф╗ечЬЛф╜ЬцШпф╕Аф╕кхНХч║┐чиЛчЪДч║┐чиЛц▒ая╝МхПкцЬЙф╕Аф╕кч║┐чиЛчФицЭецЙзшбМ<code>IOх░▒ч╗кф║Лф╗╢чЪДчЫСхРм</code>я╝М<code>IOф║Лф╗╢чЪДхдДчРЖ</code>я╝М<code>х╝Вцнеф╗╗хКбчЪДцЙзшбМ</code>уАВчФи<code>MpscQueue</code>цЭехнШхВих╛ЕцЙзшбМчЪДх╝Вцнеф╗╗хКбуАВ</p> <p>хС╜хРНхЙНч╝Аф╕║<code>SingleThread</code>чЪДчИ╢ч▒╗щГ╜цШпхп╣<code>Reactor</code>ш┐Щф║ЫшбМф╕║чЪДхИЖх▒ВхоЪф╣ЙуАВф╣ЯцШпцЬмх░ПшКВшжБф╗Лч╗НчЪДхп╣ш▒б</p> <h6 id="singlethreadeventloop"><a href="#singlethreadeventloop" class="header-anchor">#</a> SingleThreadEventLoop</h6> <p><code>Reactor</code>ш┤Яш┤гцЙзшбМчЪДх╝Вцнеф╗╗хКбхИЖф╕║ф╕Йч▒╗я╝Ъ</p> <ul><li><code>цЩощАЪф╗╗хКбя╝Ъ</code>ш┐ЩцШпNettyцЬАф╕╗шжБцЙзшбМчЪДх╝Вцнеф╗╗хКбя╝МхнШцФ╛хЬицЩощАЪф╗╗хКбщШЯхИЧ<code>taskQueue</code>ф╕нуАВхЬи<code>NioEventLoop</code>цЮДщАахЗ╜цХ░ф╕нхИЫх╗║уАВ</li> <li><code>хоЪцЧ╢ф╗╗хКбя╝Ъ</code> хнШцФ╛хЬиф╝ШхЕИч║зщШЯхИЧф╕нуАВхРОч╗нцИСф╗мф╗Лч╗НуАВ</li> <li><code>х░╛щГиф╗╗хКбя╝Ъ</code> хнШцФ╛ф║Ох░╛щГиф╗╗хКбщШЯхИЧ<code>tailTasks</code>ф╕ня╝Мх░╛щГиф╗╗хКбф╕АшИмф╕Нх╕╕чФия╝МхЬицЩощАЪф╗╗хКбцЙзшбМхоМхРО Reactorч║┐чиЛф╝ЪцЙзшбМх░╛щГиф╗╗хКбуАВ**ф╜┐чФихЬ║цЩпя╝Ъ**цпФхжВхп╣Netty чЪДш┐РшбМчК╢цАБхБЪф╕Аф║Ыч╗ЯшобцХ░цНоя╝Мф╛ЛхжВф╗╗хКбх╛кчОпчЪДшАЧцЧ╢уАБхНачФичЙйчРЖхЖЕхнШчЪДхдзх░ПчнЙчнЙщГ╜хПпф╗ехРСх░╛щГищШЯхИЧц╖╗хКаф╕Аф╕кцФ╢х░╛ф╗╗хКбхоМцИРч╗ЯшобцХ░цНочЪДхоЮцЧ╢цЫ┤цЦ░уАВ</li></ul> <p><code>SingleThreadEventLoop</code>ш┤Яш┤гхп╣<code>х░╛щГиф╗╗хКбщШЯхИЧtailTasks</code>ш┐ЫшбМчобчРЖуАВх╣╢ф╕ФцПРф╛Ы<code>Channel</code>хРС<code>Reactor</code>ц│ихЖМчЪДшбМф╕║уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadEventLoop</span> <span class="token keyword">extends</span> <span class="token class-name">SingleThreadEventExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">EventLoop</span> <span class="token punctuation">{</span>

    <span class="token comment">//ф╗╗хКбщШЯхИЧхдзх░Пя╝Мщ╗ШшодцШпцЧачХМщШЯхИЧ</span>
    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_MAX_PENDING_TASKS</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span>
            <span class="token class-name">SystemPropertyUtil</span><span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">&quot;io.netty.eventLoop.maxPendingTasks&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//х░╛щГиф╗╗хКбщШЯхИЧ</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> tailTasks<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">SingleThreadEventLoop</span><span class="token punctuation">(</span><span class="token class-name">EventLoopGroup</span> parent<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span>
                                    <span class="token keyword">boolean</span> addTaskWakesUp<span class="token punctuation">,</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> taskQueue<span class="token punctuation">,</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> tailTaskQueue<span class="token punctuation">,</span>
                                    <span class="token class-name">RejectedExecutionHandler</span> rejectedExecutionHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> addTaskWakesUp<span class="token punctuation">,</span> taskQueue<span class="token punctuation">,</span> rejectedExecutionHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//х░╛щГищШЯхИЧ цЙзшбМф╕Аф║Ыч╗Яшобф╗╗хКб ф╕Нх╕╕чФи</span>
        tailTasks <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>tailTaskQueue<span class="token punctuation">,</span> <span class="token string">&quot;tailTaskQueue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ChannelFuture</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//ц│ихЖМchannelхИ░ч╗СхоЪчЪДReactorф╕К</span>
        <span class="token keyword">return</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultChannelPromise</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h6 id="singlethreadeventexecutor"><a href="#singlethreadeventexecutor" class="header-anchor">#</a> SingleThreadEventExecutor</h6> <p><code>SingleThreadEventExecutor</code>ф╕╗шжБш┤Яш┤гхп╣<code>цЩощАЪф╗╗хКбщШЯхИЧ</code>чЪДчобчРЖя╝Мф╗ехПК<code>х╝Вцнеф╗╗хКбчЪДцЙзшбМ</code>я╝М<code>Reactorч║┐чиЛчЪДхРпхБЬ</code>уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadEventExecutor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractScheduledEventExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">OrderedEventExecutor</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token class-name">SingleThreadEventExecutor</span><span class="token punctuation">(</span><span class="token class-name">EventExecutorGroup</span> parent<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">,</span>
                                        <span class="token keyword">boolean</span> addTaskWakesUp<span class="token punctuation">,</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> taskQueue<span class="token punctuation">,</span> <span class="token class-name">RejectedExecutionHandler</span> rejectedHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//parentф╕║ReactorцЙАх▒ЮчЪДNioEventLoopGroup Reactorч║┐чиЛч╗Д</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//хРСReactorц╖╗хКаф╗╗хКбцЧ╢я╝МцШпхРжхФдщЖТSelectorхБЬцнвш╜ошпвIOх░▒ч╗кф║Лф╗╢я╝Мщймф╕КцЙзшбМх╝Вцнеф╗╗хКб</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>addTaskWakesUp <span class="token operator">=</span> addTaskWakesUp<span class="token punctuation">;</span>
        <span class="token comment">//Reactorх╝Вцнеф╗╗хКбщШЯхИЧчЪДхдзх░П</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxPendingTasks <span class="token operator">=</span> <span class="token constant">DEFAULT_MAX_PENDING_EXECUTOR_TASKS</span><span class="token punctuation">;</span>
        <span class="token comment">//чФиф║ОхРпхКиReactorч║┐чиЛчЪДexecutor -&gt; ThreadPerTaskExecutor</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>executor <span class="token operator">=</span> <span class="token class-name">ThreadExecutorMap</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//цЩощАЪф╗╗хКбщШЯхИЧ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>taskQueue <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>taskQueue<span class="token punctuation">,</span> <span class="token string">&quot;taskQueue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ф╗╗хКбщШЯхИЧц╗бцЧ╢чЪДцЛТч╗ЭчнЦчХе</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rejectedExecutionHandler <span class="token operator">=</span> <span class="token class-name">ObjectUtil</span><span class="token punctuation">.</span><span class="token function">checkNotNull</span><span class="token punctuation">(</span>rejectedHandler<span class="token punctuation">,</span> <span class="token string">&quot;rejectedHandler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>хИ░чО░хЬиф╕║цнвя╝Мф╕Аф╕кхоМцХ┤чЪД<code>ReactorцЮ╢цЮД</code>х░▒швлхИЫх╗║хЗ║цЭеф║ЖуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191043689.png" alt="хЫ╛чЙЗ"></p> <h4 id="_3-хИЫх╗║channelхИ░reactorчЪДч╗СхоЪчнЦчХе"><a href="#_3-хИЫх╗║channelхИ░reactorчЪДч╗СхоЪчнЦчХе" class="header-anchor">#</a> 3. хИЫх╗║ChannelхИ░ReactorчЪДч╗СхоЪчнЦчХе</h4> <p>хИ░ш┐Щф╕Ацнея╝МReactorч║┐чиЛч╗Д<code>NioEventLoopGroup</code>щЗМш╛╣чЪДцЙАцЬЙ<code>Reactor</code>х░▒х╖▓ч╗ПхЕищГихИЫх╗║хоМцпХуАВ</p> <p>цЧашо║цШпNettyцЬНхКбчлп<code>NioServerSocketChannel</code>хЕ│ц│ичЪД<code>OP_ACCEPT</code>ф║Лф╗╢ф╣Яхе╜я╝Мш┐ШцШпNettyховцИ╖члп<code>NioSocketChannel</code>хЕ│ц│ичЪД<code>OP_READ</code>хТМ<code>OP_WRITE</code>ф║Лф╗╢ф╣Яхе╜я╝МщГ╜щЬАшжБхЕИц│ихЖМхИ░<code>Reactor</code>ф╕Кя╝М<code>Reactor</code>цЙНшГ╜чЫСхРм<code>Channel</code>ф╕КхЕ│ц│ичЪД<code>IOф║Лф╗╢</code>хоЮчО░<code>IOхдЪш╖пхдНчФи</code>уАВ</p> <p><code>NioEventLoopGroup</code>я╝ИReactorч║┐чиЛч╗Дя╝ЙщЗМш╛╣цЬЙф╝ЧхдЪчЪД<code>Reactor</code>я╝МщВгф╣Иф╗еф╕КцПРхИ░чЪДш┐Щф║Ы<code>Channel</code>чй╢члЯх║Фшпец│ихЖМхИ░хУкф╕к<code>Reactor</code>ф╕КхСвя╝Яш┐Щх░▒щЬАшжБф╕Аф╕кч╗СхоЪчЪДчнЦчХецЭех╣│хЭЗхИЖщЕНуАВ</p> <p>ш┐Шшо░х╛ЧцИСф╗мхЙНш╛╣ф╗Лч╗Н<code>MultithreadEventExecutorGroupч▒╗</code>чЪДцЧ╢хАЩцПРхИ░чЪДцЮДщАахЩихПВцХ░<code>EventExecutorChooserFactory</code>хРЧя╝Я</p> <p>ш┐ЩцЧ╢хАЩхоГх░▒ц┤╛ф╕КчФихЬ║ф║Жя╝МхоГф╕╗шжБчФицЭехИЫх╗║<code>Channel</code>хИ░<code>Reactor</code>чЪДч╗СхоЪчнЦчХеуАВщ╗Шшодф╕║<code>DefaultEventExecutorChooserFactory.INSTANCE</code>уАВ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MultithreadEventExecutorGroup</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEventExecutorGroup</span> <span class="token punctuation">{</span>
   <span class="token comment">//ф╗ОReactorщЫЖхРИф╕нщАЙцЛйф╕Аф╕кчЙ╣хоЪчЪДReactorчЪДч╗СхоЪчнЦчХе чФиф║Оchannelц│ихЖМч╗СхоЪхИ░ф╕Аф╕кхЫ║хоЪчЪДReactorф╕К</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EventExecutorChooserFactory<span class="token punctuation">.</span>EventExecutorChooser</span> chooser<span class="token punctuation">;</span>

    chooser <span class="token operator">=</span> chooserFactory<span class="token punctuation">.</span><span class="token function">newChooser</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕ЛщЭвцИСф╗мцЭечЬЛф╕ЛхЕ╖ф╜УчЪДч╗СхоЪчнЦчХея╝Ъ</p> <h5 id="defaulteventexecutorchooserfactory"><a href="#defaulteventexecutorchooserfactory" class="header-anchor">#</a> DefaultEventExecutorChooserFactory</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DefaultEventExecutorChooserFactory</span> <span class="token keyword">implements</span> <span class="token class-name">EventExecutorChooserFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DefaultEventExecutorChooserFactory</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEventExecutorChooserFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">DefaultEventExecutorChooserFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">EventExecutorChooser</span> <span class="token function">newChooser</span><span class="token punctuation">(</span><span class="token class-name">EventExecutor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> executors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPowerOfTwo</span><span class="token punctuation">(</span>executors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PowerOfTwoEventExecutorChooser</span><span class="token punctuation">(</span>executors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GenericEventExecutorChooser</span><span class="token punctuation">(</span>executors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isPowerOfTwo</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;</span> <span class="token operator">-</span>val<span class="token punctuation">)</span> <span class="token operator">==</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>цИСф╗мчЬЛхИ░хЬи<code>newChooser</code>цЦ╣ц│Хч╗СхоЪчнЦчХецЬЙф╕дф╕кхИЖцФпя╝Мф╕НхРМф╣ЛхдДхЬиф║ОщЬАшжБхИдцЦнReactorч║┐чиЛч╗Дф╕нчЪД<code>Reactor</code>ф╕кцХ░цШпхРжф╕║<code>2чЪДцмбх╣В</code>уАВ</p> <p>Nettyф╕нчЪДч╗СхоЪчнЦчХех░▒цШпщЗЗчФи<code>round-robin</code>ш╜ошпвчЪДцЦ╣х╝ПцЭецМиф╕кщАЙцЛй<code>Reactor</code>ш┐ЫшбМч╗СхоЪуАВ</p> <p>щЗЗчФи<code>round-robin</code>чЪДцЦ╣х╝Пш┐ЫшбМш┤Яш╜╜хЭЗшббя╝МцИСф╗мф╕АшИмф╝ЪчФи<code>round % reactor.length</code>хПЦф╜ЩчЪДцЦ╣х╝ПцЭецМиф╕кх╣│хЭЗчЪДхоЪф╜НхИ░хп╣х║ФчЪД<code>Reactor</code>ф╕КуАВ</p> <p>хжВцЮЬ<code>Reactor</code>чЪДф╕кцХ░<code>reactor.length</code>цБ░хе╜цШп<code>2чЪДцмбх╣В</code>я╝МщВгф╣Их░▒хПпф╗ечФиф╜НцУНф╜Ь<code>&amp;</code>ш┐РчоЧ<code>round &amp; reactor.length -1</code>цЭеф╗гцЫ┐<code>%</code>ш┐РчоЧ<code>round % reactor.length</code>я╝МхЫаф╕║ф╜Нш┐РчоЧчЪДцАзшГ╜цЫ┤щлШуАВхЕ╖ф╜Уф╕║ф╗Аф╣И<code>&amp;</code>ш┐РчоЧшГ╜хдЯф╗гцЫ┐<code>%</code>ш┐РчоЧя╝МчмФшАЕф╝ЪхЬихРОщЭвшо▓ш┐░цЧ╢щЧ┤ш╜очЪДцЧ╢хАЩф╕║хдзхо╢шпжч╗ЖшпБцШОя╝Мш┐ЩщЗМхдзхо╢хПкщЬАшо░ф╜Пш┐Щф╕кхЕмх╝Пя╝МцИСф╗мш┐ШцШпшБЪчДжцЬмцЦЗчЪДф╕╗ч║┐уАВ</p> <p>ф║Жшзгф║Жф╝ШхМЦхОЯчРЖя╝МцИСф╗мхЬичЬЛф╗гчаБхоЮчО░х░▒х╛Ихо╣цШУчРЖшзгф║ЖуАВ</p> <p><strong>хИйчФи<code>%</code>ш┐РчоЧчЪДцЦ╣х╝П<code>Math.abs(idx.getAndIncrement() % executors.length)</code>цЭеш┐ЫшбМч╗СхоЪуАВ</strong></p> <div class="language-Java extra-class"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GenericEventExecutorChooser</span> <span class="token keyword">implements</span> <span class="token class-name">EventExecutorChooser</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicLong</span> idx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EventExecutor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> executors<span class="token punctuation">;</span>

        <span class="token class-name">GenericEventExecutorChooser</span><span class="token punctuation">(</span><span class="token class-name">EventExecutor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> executors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>executors <span class="token operator">=</span> executors<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">EventExecutor</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> executors<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>idx<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> executors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>хИйчФи<code>&amp;</code>ш┐РчоЧчЪДцЦ╣х╝П<code>idx.getAndIncrement() &amp; executors.length - 1</code>цЭеш┐ЫшбМч╗СхоЪуАВ</strong></p> <div class="language-Java extra-class"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PowerOfTwoEventExecutorChooser</span> <span class="token keyword">implements</span> <span class="token class-name">EventExecutorChooser</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> idx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EventExecutor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> executors<span class="token punctuation">;</span>

        <span class="token class-name">PowerOfTwoEventExecutorChooser</span><span class="token punctuation">(</span><span class="token class-name">EventExecutor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> executors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>executors <span class="token operator">=</span> executors<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">EventExecutor</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> executors<span class="token punctuation">[</span>idx<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> executors<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><blockquote><p>хПИф╕АцмбшвлNettyхп╣цАзшГ╜чЪДцЮБшЗ┤ш┐╜ц▒ВцЙАцКШцЬН~~~~</p></blockquote> <h4 id="_4-хРСreactorч║┐чиЛч╗Дф╕нцЙАцЬЙчЪДreactorц│ихЖМterminatedхЫЮш░ГхЗ╜цХ░"><a href="#_4-хРСreactorч║┐чиЛч╗Дф╕нцЙАцЬЙчЪДreactorц│ихЖМterminatedхЫЮш░ГхЗ╜цХ░" class="header-anchor">#</a> 4. хРСReactorч║┐чиЛч╗Дф╕нцЙАцЬЙчЪДReactorц│ихЖМterminatedхЫЮш░ГхЗ╜цХ░</h4> <p>х╜УReactorч║┐чиЛч╗Д<code>NioEventLoopGroup</code>ф╕нцЙАцЬЙчЪД<code>Reactor</code>х╖▓ч╗ПхИЫх╗║хоМцпХя╝М<code>Channel</code>хИ░<code>Reactor</code>чЪДч╗СхоЪчнЦчХеф╣ЯхИЫх╗║хоМцпХхРОя╝МцИСф╗мх░▒цЭехИ░ф║ЖхИЫх╗║<code>NioEventGroup</code>чЪДцЬАхРОф╕АцнеуАВ</p> <p>ф┐ЧшпЭшп┤чЪДхе╜я╝МцЬЙхИЫх╗║х░▒цЬЙхРпхКия╝МцЬЙхРпхКих░▒цЬЙхЕ│щЧня╝Мш┐ЩщЗМф╝ЪхИЫх╗║<code>ReactorхЕ│щЧн</code>чЪДхЫЮш░ГхЗ╜цХ░<code>terminationListener</code>я╝МхЬи<code>Reactor</code>хЕ│щЧнцЧ╢хЫЮш░ГуАВ</p> <p><code>terminationListener</code>хЫЮш░ГчЪДщА╗ш╛Сх╛ИчоАхНХя╝Ъ</p> <ul><li>щАЪш┐З<code>AtomicInteger terminatedChildren</code>хПШщЗПшо░х╜Хх╖▓ч╗ПхЕ│щЧнчЪД<code>Reactor</code>ф╕кцХ░я╝МчФицЭехИдцЦн<code>NioEventLoopGroup</code>ф╕нчЪД<code>Reactor</code>цШпхРжх╖▓ч╗ПхЕищГихЕ│щЧнуАВ</li> <li>хжВцЮЬцЙАцЬЙ<code>Reactor</code>хЭЗх╖▓хЕ│щЧня╝Мшо╛ч╜о<code>NioEventLoopGroup</code>ф╕нчЪД<code>terminationFuture</code>ф╕║<code>success</code>уАВшбичд║<code>Reactorч║┐чиЛч╗Д</code>хЕ│щЧнцИРхКЯуАВ</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code>       <span class="token comment">//шо░х╜ХхЕ│щЧнчЪДReactorф╕кцХ░я╝Мх╜УReactorхЕищГихЕ│щЧнхРОя╝МцЙНхПпф╗ешодф╕║хЕ│щЧнцИРхКЯ</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> terminatedChildren <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//хЕ│щЧнfuture</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Promise</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> terminationFuture <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPromise</span><span class="token punctuation">(</span><span class="token class-name">GlobalEventExecutor</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">FutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> terminationListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operationComplete</span><span class="token punctuation">(</span><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>terminatedChildren<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//х╜УцЙАцЬЙReactorхЕ│щЧнхРО цЙНшодф╕║цШпхЕ│щЧнцИРхКЯ</span>
                    terminationFuture<span class="token punctuation">.</span><span class="token function">setSuccess</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token comment">//ф╕║цЙАцЬЙReactorц╖╗хКаterminationListener</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">EventExecutor</span> e<span class="token operator">:</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">terminationFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>terminationListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><hr> <p>цИСф╗мхЬихЫЮхИ░цЦЗчлах╝Ахд┤<code>NettyцЬНхКбчлпф╗гчаБцибцЭ┐</code></p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">EchoServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;8007&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// Configure the server.</span>
        <span class="token comment">//хИЫх╗║ф╕╗ф╗ОReactorч║┐чиЛч╗Д</span>
        <span class="token class-name">EventLoopGroup</span> bossGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EventLoopGroup</span> workerGroup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NioEventLoopGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>чЬБчХе<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>чО░хЬиNettyчЪД<code>ф╕╗ф╗ОReactorч║┐чиЛч╗Д</code>х░▒х╖▓ч╗ПхИЫх╗║хоМцпХя╝МцндцЧ╢NettyцЬНхКбчлпчЪДщкицЮ╢х╖▓ч╗ПцРнх╗║хоМцпХя╝МщкицЮ╢хжВф╕Ля╝Ъ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409191048915.png" alt="хЫ╛чЙЗ"></p> <h2 id="цА╗ч╗У"><a href="#цА╗ч╗У" class="header-anchor">#</a> цА╗ч╗У</h2> <p>цЬмцЦЗф╗Лч╗Нф║ЖщжЦхЕИф╗Лч╗Нф║ЖNettyхп╣хРДчзН<code>IOцибхЮЛ</code>чЪДцФпцМБф╗ехПКхжВф╜Хш╜╗цЭ╛хИЗцНвхРДчзН<code>IOцибхЮЛ</code>уАВ</p> <p>ш┐ШшК▒ф║ЖхдзщЗПчЪДчпЗх╣Еф╗Лч╗НNettyцЬНхКбчлпчЪДца╕х┐Гх╝ХцУО<code>ф╕╗ф╗ОReactorч║┐чиЛч╗Д</code>чЪДхИЫх╗║ш┐ЗчиЛуАВхЬиш┐Щф╕кш┐ЗчиЛф╕ня╝МцИСф╗мш┐ШцПРхИ░ф║ЖNettyхп╣хРДчзНч╗ЖшКВш┐ЫшбМчЪДф╝ШхМЦя╝Мх▒ХчО░ф║ЖNettyхп╣цАзшГ╜цЮБшЗ┤чЪДш┐╜ц▒ВуАВ</p> <p>хе╜ф║Жя╝МNettyцЬНхКбчлпчЪДщкицЮ╢х╖▓ч╗ПцРнхе╜я╝МхЙйф╕ЛчЪДф║ЛцГЕх░▒шпеч╗СхоЪчлпхПгхЬ░хЭАчД╢хРОцОецФ╢ш┐ЮцОеф║Жя╝МцИСф╗мф╕ЛчпЗцЦЗчлахЖНшзБ~~~</p> <h2 id="хПВшАГш╡ДцЦЩ"><a href="#хПВшАГш╡ДцЦЩ" class="header-anchor">#</a> хПВшАГш╡ДцЦЩ</h2> <p>https://mp.weixin.qq.com/s/IuIsUtpiye13L8ZyHWvzXA</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Netty ч│╗ч╗Яшо╛шоб/25.хЫЫуАБц╖▒хЕе Netty ца╕х┐Г/10.чммф║Мшп╛я╝ЪReactorхЬиNettyф╕нчЪДхоЮчО░я╝ИхИЫх╗║чпЗя╝Й.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/19, 08:16:36</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/65674f/" class="prev">чммф╕Ашп╛я╝ЪщАПш┐З Netty чЬЛ IO цибхЮЛ</a></span> <span class="next"><a href="/pages/bb668a/">чммф╕Йшп╛я╝ЪNetty ца╕х┐Гх╝ХцУО Reactor чЪДш┐Рш╜мцЮ╢цЮД</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.bdcc6820.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/52.24cc5c91.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
