<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Channel æºç è§£æ | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/echo-system-design/img/favicon.ico">
    <meta name="description" content="ç³»ç»Ÿè®¾è®¡ä¹‹ã€Œè®²è§£ + é¢è¯•æŒ‡å—ã€ï¼Œæ°´æ»´çŸ³ç©¿ï¼Œè®¾è®¡æ— é“¶å¼¹ï¼">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/echo-system-design/assets/css/0.styles.744b3760.css" as="style"><link rel="preload" href="/echo-system-design/assets/js/app.68fbe714.js" as="script"><link rel="preload" href="/echo-system-design/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/echo-system-design/assets/js/46.7624d38c.js" as="script"><link rel="preload" href="/echo-system-design/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/echo-system-design/assets/js/10.b313d17c.js"><link rel="prefetch" href="/echo-system-design/assets/js/100.2b21dce5.js"><link rel="prefetch" href="/echo-system-design/assets/js/101.96ca71f6.js"><link rel="prefetch" href="/echo-system-design/assets/js/11.71fe9642.js"><link rel="prefetch" href="/echo-system-design/assets/js/12.38d1989d.js"><link rel="prefetch" href="/echo-system-design/assets/js/13.850793b0.js"><link rel="prefetch" href="/echo-system-design/assets/js/14.1141ec27.js"><link rel="prefetch" href="/echo-system-design/assets/js/15.8f1b4081.js"><link rel="prefetch" href="/echo-system-design/assets/js/16.e52ba8b4.js"><link rel="prefetch" href="/echo-system-design/assets/js/17.acb3bf3d.js"><link rel="prefetch" href="/echo-system-design/assets/js/18.e491edb6.js"><link rel="prefetch" href="/echo-system-design/assets/js/19.daf31819.js"><link rel="prefetch" href="/echo-system-design/assets/js/20.d70e5281.js"><link rel="prefetch" href="/echo-system-design/assets/js/21.0e0ed140.js"><link rel="prefetch" href="/echo-system-design/assets/js/22.dd779f94.js"><link rel="prefetch" href="/echo-system-design/assets/js/23.4d814163.js"><link rel="prefetch" href="/echo-system-design/assets/js/24.891fe6fb.js"><link rel="prefetch" href="/echo-system-design/assets/js/25.41dca26b.js"><link rel="prefetch" href="/echo-system-design/assets/js/26.6337eac0.js"><link rel="prefetch" href="/echo-system-design/assets/js/27.eeee1d20.js"><link rel="prefetch" href="/echo-system-design/assets/js/28.6fa848cf.js"><link rel="prefetch" href="/echo-system-design/assets/js/29.371a40e1.js"><link rel="prefetch" href="/echo-system-design/assets/js/3.e62a71e4.js"><link rel="prefetch" href="/echo-system-design/assets/js/30.e32f6b31.js"><link rel="prefetch" href="/echo-system-design/assets/js/31.a532917f.js"><link rel="prefetch" href="/echo-system-design/assets/js/32.13b70e91.js"><link rel="prefetch" href="/echo-system-design/assets/js/33.d10d51bb.js"><link rel="prefetch" href="/echo-system-design/assets/js/34.6671ead6.js"><link rel="prefetch" href="/echo-system-design/assets/js/35.2760ed8d.js"><link rel="prefetch" href="/echo-system-design/assets/js/36.be98cc35.js"><link rel="prefetch" href="/echo-system-design/assets/js/37.82be3556.js"><link rel="prefetch" href="/echo-system-design/assets/js/38.0bb63012.js"><link rel="prefetch" href="/echo-system-design/assets/js/39.9b34b9f9.js"><link rel="prefetch" href="/echo-system-design/assets/js/4.73518a0f.js"><link rel="prefetch" href="/echo-system-design/assets/js/40.0ada49bd.js"><link rel="prefetch" href="/echo-system-design/assets/js/41.f961e422.js"><link rel="prefetch" href="/echo-system-design/assets/js/42.b34f1599.js"><link rel="prefetch" href="/echo-system-design/assets/js/43.5a509601.js"><link rel="prefetch" href="/echo-system-design/assets/js/44.64fd3383.js"><link rel="prefetch" href="/echo-system-design/assets/js/45.685623ac.js"><link rel="prefetch" href="/echo-system-design/assets/js/47.86be3d8d.js"><link rel="prefetch" href="/echo-system-design/assets/js/48.ba7dfd47.js"><link rel="prefetch" href="/echo-system-design/assets/js/49.ee9681bc.js"><link rel="prefetch" href="/echo-system-design/assets/js/5.94727770.js"><link rel="prefetch" href="/echo-system-design/assets/js/50.b424b2c0.js"><link rel="prefetch" href="/echo-system-design/assets/js/51.ef213b56.js"><link rel="prefetch" href="/echo-system-design/assets/js/52.18c75eba.js"><link rel="prefetch" href="/echo-system-design/assets/js/53.f76e624c.js"><link rel="prefetch" href="/echo-system-design/assets/js/54.3098ec9f.js"><link rel="prefetch" href="/echo-system-design/assets/js/55.78a9171b.js"><link rel="prefetch" href="/echo-system-design/assets/js/56.af9697f4.js"><link rel="prefetch" href="/echo-system-design/assets/js/57.6175a0b4.js"><link rel="prefetch" href="/echo-system-design/assets/js/58.24008d78.js"><link rel="prefetch" href="/echo-system-design/assets/js/59.28ca51b4.js"><link rel="prefetch" href="/echo-system-design/assets/js/6.0b558b79.js"><link rel="prefetch" href="/echo-system-design/assets/js/60.1714dba8.js"><link rel="prefetch" href="/echo-system-design/assets/js/61.08b4acf0.js"><link rel="prefetch" href="/echo-system-design/assets/js/62.cc8fdced.js"><link rel="prefetch" href="/echo-system-design/assets/js/63.41ff19e4.js"><link rel="prefetch" href="/echo-system-design/assets/js/64.9b3def35.js"><link rel="prefetch" href="/echo-system-design/assets/js/65.0b2ab47d.js"><link rel="prefetch" href="/echo-system-design/assets/js/66.2ae7a107.js"><link rel="prefetch" href="/echo-system-design/assets/js/67.79dd6daf.js"><link rel="prefetch" href="/echo-system-design/assets/js/68.1b76c178.js"><link rel="prefetch" href="/echo-system-design/assets/js/69.7ac52a2f.js"><link rel="prefetch" href="/echo-system-design/assets/js/70.7279b1df.js"><link rel="prefetch" href="/echo-system-design/assets/js/71.4f744076.js"><link rel="prefetch" href="/echo-system-design/assets/js/72.44c999da.js"><link rel="prefetch" href="/echo-system-design/assets/js/73.526febf1.js"><link rel="prefetch" href="/echo-system-design/assets/js/74.26f8d9a5.js"><link rel="prefetch" href="/echo-system-design/assets/js/75.dc7fdd0f.js"><link rel="prefetch" href="/echo-system-design/assets/js/76.32858593.js"><link rel="prefetch" href="/echo-system-design/assets/js/77.7b3f6980.js"><link rel="prefetch" href="/echo-system-design/assets/js/78.31a353ef.js"><link rel="prefetch" href="/echo-system-design/assets/js/79.173bbc8c.js"><link rel="prefetch" href="/echo-system-design/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/echo-system-design/assets/js/80.78a31e84.js"><link rel="prefetch" href="/echo-system-design/assets/js/81.8d6c43d2.js"><link rel="prefetch" href="/echo-system-design/assets/js/82.cabbfc4d.js"><link rel="prefetch" href="/echo-system-design/assets/js/83.65db62ac.js"><link rel="prefetch" href="/echo-system-design/assets/js/84.e5207e82.js"><link rel="prefetch" href="/echo-system-design/assets/js/85.4cd3a775.js"><link rel="prefetch" href="/echo-system-design/assets/js/86.931cbb70.js"><link rel="prefetch" href="/echo-system-design/assets/js/87.78b2eebd.js"><link rel="prefetch" href="/echo-system-design/assets/js/88.605444aa.js"><link rel="prefetch" href="/echo-system-design/assets/js/89.e05e3a70.js"><link rel="prefetch" href="/echo-system-design/assets/js/9.2ac86403.js"><link rel="prefetch" href="/echo-system-design/assets/js/90.ca1ff100.js"><link rel="prefetch" href="/echo-system-design/assets/js/91.8ad18b18.js"><link rel="prefetch" href="/echo-system-design/assets/js/92.b554f1c7.js"><link rel="prefetch" href="/echo-system-design/assets/js/93.fb2397b7.js"><link rel="prefetch" href="/echo-system-design/assets/js/94.1eade7f0.js"><link rel="prefetch" href="/echo-system-design/assets/js/95.96f5db04.js"><link rel="prefetch" href="/echo-system-design/assets/js/96.5ed2d348.js"><link rel="prefetch" href="/echo-system-design/assets/js/97.4d4bfff5.js"><link rel="prefetch" href="/echo-system-design/assets/js/98.10f4b27a.js"><link rel="prefetch" href="/echo-system-design/assets/js/99.4a895015.js">
    <link rel="stylesheet" href="/echo-system-design/assets/css/0.styles.744b3760.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/echo-system-design/" class="home-link router-link-active"><img src="/echo-system-design/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/echo-system-design/" class="nav-link">ğŸ é¦–é¡µ</a></div><div class="nav-item"><a href="/echo-system-design/pages/fccd91/" class="nav-link">âœ’ï¸çƒ­é—¨ç®—æ³•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ–ï¸èµæç»å…¸è®¾è®¡" class="dropdown-title"><!----> <span class="title" style="display:;">ğŸ–ï¸èµæç»å…¸è®¾è®¡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/252196/" class="nav-link">Redis ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/b9733b/" class="nav-link">Kafka ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/bfab10/" class="nav-link">Netty ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/4601ca/" class="nav-link">Nginx ç³»ç»Ÿè®¾è®¡</a></li></ul></div></div><div class="nav-item"><a href="/echo-system-design/pages/84cb49/" class="nav-link">ğŸ§‘â€ğŸ’»å®æˆ˜ç³»ç»Ÿè®¾è®¡</a></div><div class="nav-item"><a href="/echo-system-design/pages/92b2ee/" class="nav-link">â“é—®ç­”</a></div><div class="nav-item"><a href="/echo-system-design/pages/52ebd8/" class="nav-link">ğŸ‘€åŠ¨æ€</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/echo-system-design/" class="nav-link">ğŸ é¦–é¡µ</a></div><div class="nav-item"><a href="/echo-system-design/pages/fccd91/" class="nav-link">âœ’ï¸çƒ­é—¨ç®—æ³•</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ğŸ–ï¸èµæç»å…¸è®¾è®¡" class="dropdown-title"><!----> <span class="title" style="display:;">ğŸ–ï¸èµæç»å…¸è®¾è®¡</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/252196/" class="nav-link">Redis ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/b9733b/" class="nav-link">Kafka ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/bfab10/" class="nav-link">Netty ç³»ç»Ÿè®¾è®¡</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/4601ca/" class="nav-link">Nginx ç³»ç»Ÿè®¾è®¡</a></li></ul></div></div><div class="nav-item"><a href="/echo-system-design/pages/84cb49/" class="nav-link">ğŸ§‘â€ğŸ’»å®æˆ˜ç³»ç»Ÿè®¾è®¡</a></div><div class="nav-item"><a href="/echo-system-design/pages/92b2ee/" class="nav-link">â“é—®ç­”</a></div><div class="nav-item"><a href="/echo-system-design/pages/52ebd8/" class="nav-link">ğŸ‘€åŠ¨æ€</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä¸€ã€å‰è¨€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>äºŒã€åŸºç¡€çŸ¥è¯†</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ä¸‰ã€ä¸»çº¿ä»»åŠ¡</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/echo-system-design/pages/b0bc66/" class="sidebar-link">Netty æ¡†æ¶æ¦‚è¿°</a></li><li><a href="/echo-system-design/pages/9582d0/" class="sidebar-link">Bootstrapï¼ˆclientï¼‰æºç è§£æ</a></li><li><a href="/echo-system-design/pages/b2a14a/" class="sidebar-link">Bootstrapï¼ˆserverï¼‰æºç è§£æ</a></li><li><a href="/echo-system-design/pages/8d1ba9/Channel/" aria-current="page" class="active sidebar-link">Channel æºç è§£æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#nio-å’Œ-io-çš„å¯¹æ¯”" class="sidebar-link">NIO å’Œ IO çš„å¯¹æ¯”</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#java-nio-channel" class="sidebar-link">Java NIO Channel</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#java-nio-buffer" class="sidebar-link">Java NIO Buffer</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#selector-2" class="sidebar-link">Selector</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a></li></ul></li><li><a href="/echo-system-design/pages/397456/" class="sidebar-link">EventLoop æºç è§£æ</a></li><li><a href="/echo-system-design/pages/ce1f78/" class="sidebar-link">ChannelHandler æºç è§£æ</a></li><li><a href="/echo-system-design/pages/4234c0/" class="sidebar-link">ChannelPipeline æºç è§£æ</a></li><li><a href="/echo-system-design/pages/43eb30/" class="sidebar-link">ByteBuf æºç è§£æ</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å››ã€æ·±å…¥ Netty æ ¸å¿ƒ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>äº”ã€æ·±å…¥ Netty å†…å­˜ç®¡ç†</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/echo-system-design/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Netty ç³»ç»Ÿè®¾è®¡</span></li><li data-v-06225672><span data-v-06225672>ä¸‰ã€ä¸»çº¿ä»»åŠ¡</span></li></ul> <div class="info" data-v-06225672><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ä½œè€…" class="beLink" data-v-06225672>echo</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ç›®å½•</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Channel æºç è§£æ<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h2> <p>Java NIO æ˜¯ç”± Java 1.4 å¼•è¿›çš„å¼‚æ­¥ IO
Java NIO ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆ:</p> <ul><li>Channel</li> <li>Buffer</li> <li>Selector</li></ul> <h2 id="nio-å’Œ-io-çš„å¯¹æ¯”"><a href="#nio-å’Œ-io-çš„å¯¹æ¯”" class="header-anchor">#</a> NIO å’Œ IO çš„å¯¹æ¯”</h2> <p>IO å’Œ NIO çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢:</p> <ul><li>IO åŸºäºæµ(Stream oriented)ï¼Œè€Œ NIO åŸºäº Buffer (Buffer oriented)</li> <li>IO æ“ä½œæ˜¯é˜»å¡çš„, è€Œ NIO æ“ä½œæ˜¯éé˜»å¡çš„</li> <li>IO æ²¡æœ‰ selector æ¦‚å¿µ, è€Œ NIO æœ‰ selector æ¦‚å¿µ.</li></ul> <h4 id="åŸºäº-stream-ä¸-åŸºäº-buffer"><a href="#åŸºäº-stream-ä¸-åŸºäº-buffer" class="header-anchor">#</a> åŸºäº Stream ä¸ åŸºäº Buffer</h4> <p>ä¼ ç»Ÿçš„ IO æ˜¯é¢å‘å­—èŠ‚æµæˆ–å­—ç¬¦æµçš„, è€Œåœ¨ NIO ä¸­, æˆ‘ä»¬æŠ›å¼ƒäº†ä¼ ç»Ÿçš„ IO æµ, è€Œæ˜¯å¼•å…¥äº† <strong>Channel</strong> å’Œ <strong>Buffer</strong> çš„æ¦‚å¿µ.</p> <p>åœ¨ NIO ä¸­, æˆ‘åªèƒ½ä» Channel ä¸­è¯»å–æ•°æ®åˆ° Buffer ä¸­æˆ–å°†æ•°æ®ä» Buffer ä¸­å†™å…¥åˆ° Channel</p> <p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ <strong>åŸºäºæµ</strong> å‘¢? åœ¨ä¸€èˆ¬çš„ Java IO æ“ä½œä¸­, æˆ‘ä»¬ä»¥æµå¼çš„æ–¹å¼é¡ºåºåœ°ä»ä¸€ä¸ª Stream ä¸­è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚, å› æ­¤æˆ‘ä»¬ä¹Ÿå°±ä¸èƒ½éšæ„æ”¹å˜è¯»å–æŒ‡é’ˆçš„ä½ç½®</p> <p>è€Œ <strong>åŸºäº Buffer</strong> å°±æ˜¾å¾—æœ‰ç‚¹ä¸åŒäº†ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä» Channel ä¸­è¯»å–æ•°æ®åˆ° Buffer ä¸­, å½“ Buffer ä¸­æœ‰æ•°æ®åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™äº›æ•°æ®è¿›è¡Œæ“ä½œäº†ï¼Œä¸åƒ IO é‚£æ ·æ˜¯é¡ºåºæ“ä½œï¼ŒNIO ä¸­æˆ‘ä»¬å¯ä»¥éšæ„åœ°è¯»å–ä»»æ„ä½ç½®çš„æ•°æ®</p> <h4 id="é˜»å¡-å’Œ-éé˜»å¡"><a href="#é˜»å¡-å’Œ-éé˜»å¡" class="header-anchor">#</a> é˜»å¡ å’Œ éé˜»å¡</h4> <p>Java æä¾›çš„å„ç§ Stream æ“ä½œéƒ½æ˜¯é˜»å¡çš„, ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ª read æ–¹æ³•è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹, é‚£ä¹ˆè°ƒç”¨ read çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ä½, ç›´åˆ° read æ“ä½œå®Œæˆ</p> <p>è€Œ  NIO çš„éé˜»å¡æ¨¡å¼å…è®¸æˆ‘ä»¬éé˜»å¡åœ°è¿›è¡Œ IO æ“ä½œï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦ä»ç½‘ç»œä¸­è¯»å–æ•°æ®, åœ¨ NIO çš„éé˜»å¡æ¨¡å¼ä¸­ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ read æ–¹æ³•æ—¶ï¼Œå¦‚æœæ­¤æ—¶æœ‰æ•°æ®ï¼Œåˆ™ read è¯»å–å¹¶è¿”å›ï¼›å¦‚æœæ­¤æ—¶æ²¡æœ‰æ•°æ®ï¼Œ åˆ™ read ç›´æ¥è¿”å›ï¼Œè€Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</p> <h4 id="selector"><a href="#selector" class="header-anchor">#</a> selector</h4> <p>selector æ˜¯ NIO ä¸­æ‰æœ‰çš„æ¦‚å¿µ, å®ƒæ˜¯ Java NIO ä¹‹æ‰€ä»¥å¯ä»¥éé˜»å¡åœ°è¿›è¡Œ IO æ“ä½œçš„å…³é”®</p> <p>é€šè¿‡ Selectorï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ª Channel çš„ IO äº‹ä»¶ï¼Œå½“æˆ‘ä»¬å‘ä¸€ä¸ª Selector ä¸­æ³¨å†Œäº† Channel åï¼ŒSelector å†…éƒ¨çš„æœºåˆ¶å°±å¯ä»¥è‡ªåŠ¨åœ°ä¸ºæˆ‘ä»¬ä¸æ–­åœ°æŸ¥è¯¢ï¼ˆselectï¼‰è¿™äº›æ³¨å†Œçš„ Channel æ˜¯å¦æœ‰å·²å°±ç»ªçš„ IO äº‹ä»¶ï¼ˆä¾‹å¦‚å¯è¯», å¯å†™, ç½‘ç»œè¿æ¥å®Œæˆç­‰ï¼‰ã€‚é€šè¿‡è¿™æ ·çš„ Selector æœºåˆ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ª Channel äº†</p> <h2 id="java-nio-channel"><a href="#java-nio-channel" class="header-anchor">#</a> Java NIO Channel</h2> <p>é€šå¸¸æ¥è¯´ï¼Œæ‰€æœ‰çš„ NIO çš„ I/O æ“ä½œéƒ½æ˜¯ä» Channel å¼€å§‹çš„ã€‚ä¸€ä¸ª channel ç±»ä¼¼äºä¸€ä¸ª stream
java Stream å’Œ NIO Channel å¯¹æ¯”</p> <ul><li>æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ª Channel ä¸­æ‰§è¡Œè¯»å’Œå†™æ“ä½œï¼Œç„¶è€ŒåŒä¸€ä¸ª Stream ä»…ä»…æ”¯æŒè¯»æˆ–å†™.</li> <li>Channel å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ï¼Œè€Œ Stream æ˜¯é˜»å¡çš„åŒæ­¥è¯»å†™</li> <li>Channel æ€»æ˜¯ä» Buffer ä¸­è¯»å–æ•°æ®ï¼Œæˆ–å°†æ•°æ®å†™å…¥åˆ° Buffer ä¸­</li></ul> <p>Channel ç±»å‹æœ‰ï¼š</p> <ul><li>FileChannelï¼Œæ–‡ä»¶æ“ä½œ</li> <li>DatagramChannelï¼ŒUDP æ“ä½œ</li> <li>SocketChannelï¼ŒTCP æ“ä½œ</li> <li>ServerSocketChannelï¼ŒTCP æ“ä½œï¼Œä½¿ç”¨åœ¨æœåŠ¡å™¨ç«¯</li></ul> <p>è¿™äº›é€šé“æ¶µç›–äº† UDP å’Œ TCPç½‘ç»œ IOä»¥åŠæ–‡ä»¶ IO
åŸºæœ¬çš„ Channel ä½¿ç”¨ä¾‹å­ï¼š</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{</span>
    <span class="token class-name">RandomAccessFile</span> aFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/echo/settings.xml&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileChannel</span> inChannel <span class="token operator">=</span> aFile<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    aFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="filechannel"><a href="#filechannel" class="header-anchor">#</a> FileChannel</h3> <p>FileChannel æ˜¯æ“ä½œæ–‡ä»¶çš„ Channel, æˆ‘ä»¬å¯ä»¥é€šè¿‡ FileChannel ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®, ä¹Ÿå¯ä»¥å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­</p> <p><strong><code>æ³¨æ„</code></strong>, FileChannel ä¸èƒ½è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</p> <h4 id="æ‰“å¼€-filechannel"><a href="#æ‰“å¼€-filechannel" class="header-anchor">#</a> æ‰“å¼€ FileChannel</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">RandomAccessFile</span> aFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">&quot;data/nio-data.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FileChannel</span>  inChannel <span class="token operator">=</span> aFile<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ä»-filechannel-ä¸­è¯»å–æ•°æ®"><a href="#ä»-filechannel-ä¸­è¯»å–æ•°æ®" class="header-anchor">#</a> ä» FileChannel ä¸­è¯»å–æ•°æ®</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="å†™å…¥æ•°æ®"><a href="#å†™å…¥æ•°æ®" class="header-anchor">#</a> å†™å…¥æ•°æ®</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> newData <span class="token operator">=</span> <span class="token string">&quot;New String to write to file...&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="å…³é—­"><a href="#å…³é—­" class="header-anchor">#</a> å…³é—­</h4> <p>å½“æˆ‘ä»¬å¯¹ FileChannel çš„æ“ä½œå®Œæˆå, å¿…é¡»å°†å…¶å…³é—­</p> <div class="language-java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="è®¾ç½®-position"><a href="#è®¾ç½®-position" class="header-anchor">#</a> è®¾ç½® position</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">long</span> pos channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="æ–‡ä»¶å¤§å°"><a href="#æ–‡ä»¶å¤§å°" class="header-anchor">#</a> æ–‡ä»¶å¤§å°</h4> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ channel.size()è·å–å…³è”åˆ°è¿™ä¸ª Channel ä¸­çš„æ–‡ä»¶çš„å¤§å°. <strong>æ³¨æ„</strong>, è¿™é‡Œè¿”å›çš„æ˜¯æ–‡ä»¶çš„å¤§å°, è€Œä¸æ˜¯ Channel ä¸­å‰©ä½™çš„å…ƒç´ ä¸ªæ•°.</p> <h4 id="æˆªæ–­æ–‡ä»¶"><a href="#æˆªæ–­æ–‡ä»¶" class="header-anchor">#</a> æˆªæ–­æ–‡ä»¶</h4> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">truncate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å°†æ–‡ä»¶çš„å¤§å°æˆªæ–­ä¸º1024å­—èŠ‚.</p> <h4 id="å¼ºåˆ¶å†™å…¥"><a href="#å¼ºåˆ¶å†™å…¥" class="header-anchor">#</a> å¼ºåˆ¶å†™å…¥</h4> <p>æˆ‘ä»¬å¯ä»¥å¼ºåˆ¶å°†ç¼“å­˜çš„æœªå†™å…¥çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­:</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="socketchannel"><a href="#socketchannel" class="header-anchor">#</a> SocketChannel</h3> <p>SocketChannel æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç”¨æ¥è¿›è¡Œ TCP è¿æ¥çš„ Channel.
åˆ›å»ºä¸€ä¸ª SocketChannel çš„æ–¹æ³•æœ‰ä¸¤ç§:</p> <ul><li>æ‰“å¼€ä¸€ä¸ª SocketChannel, ç„¶åå°†å…¶è¿æ¥åˆ°æŸä¸ªæœåŠ¡å™¨ä¸­</li> <li>å½“ä¸€ä¸ª ServerSocketChannel æ¥å—åˆ°è¿æ¥è¯·æ±‚æ—¶, ä¼šè¿”å›ä¸€ä¸ª SocketChannel å¯¹è±¡.</li></ul> <h4 id="æ‰“å¼€-socketchannel"><a href="#æ‰“å¼€-socketchannel" class="header-anchor">#</a> æ‰“å¼€ SocketChannel</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="å…³é—­-2"><a href="#å…³é—­-2" class="header-anchor">#</a> å…³é—­</h4> <div class="language-Java extra-class"><pre class="language-java"><code>socketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="header-anchor">#</a> è¯»å–æ•°æ®</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> bytesRead <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>å¦‚æœ read()è¿”å› <strong>-1</strong>, é‚£ä¹ˆè¡¨ç¤ºè¿æ¥ä¸­æ–­äº†.</p> <h4 id="å†™å…¥æ•°æ®-2"><a href="#å†™å…¥æ•°æ®-2" class="header-anchor">#</a> å†™å…¥æ•°æ®</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> newData <span class="token operator">=</span> <span class="token string">&quot;New String to write to file...&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="éé˜»å¡æ¨¡å¼"><a href="#éé˜»å¡æ¨¡å¼" class="header-anchor">#</a> éé˜»å¡æ¨¡å¼</h4> <p>æˆ‘ä»¬å¯ä»¥è®¾ç½® SocketChannel ä¸ºå¼‚æ­¥æ¨¡å¼, è¿™æ ·æˆ‘ä»¬çš„ connect, read, write éƒ½æ˜¯å¼‚æ­¥çš„äº†.</p> <h5 id="è¿æ¥"><a href="#è¿æ¥" class="header-anchor">#</a> è¿æ¥</h5> <div class="language-Java extra-class"><pre class="language-java"><code>socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span> socketChannel<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//wait, or do something else...    </span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨å¼‚æ­¥æ¨¡å¼ä¸­, æˆ–è®¸è¿æ¥è¿˜æ²¡æœ‰å»ºç«‹, connect æ–¹æ³•å°±è¿”å›äº†, å› æ­¤æˆ‘ä»¬éœ€è¦æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¯è¿æ¥åˆ°äº†ä¸»æœº, å› æ­¤é€šè¿‡ä¸€ä¸ª while å¾ªç¯æ¥åˆ¤æ–­.</p> <h5 id="è¯»å†™"><a href="#è¯»å†™" class="header-anchor">#</a> è¯»å†™</h5> <p>åœ¨å¼‚æ­¥æ¨¡å¼ä¸‹, è¯»å†™çš„æ–¹å¼æ˜¯ä¸€æ ·çš„.
åœ¨è¯»å–æ—¶, å› ä¸ºæ˜¯å¼‚æ­¥çš„, å› æ­¤æˆ‘ä»¬å¿…é¡»æ£€æŸ¥ read çš„è¿”å›å€¼, æ¥åˆ¤æ–­å½“å‰æ˜¯å¦è¯»å–åˆ°äº†æ•°æ®.</p> <h3 id="serversocketchannel"><a href="#serversocketchannel" class="header-anchor">#</a> ServerSocketChannel</h3> <p>ServerSocketChannel é¡¾åæ€ä¹‰, æ˜¯ç”¨åœ¨æœåŠ¡å™¨ä¸ºç«¯çš„, å¯ä»¥ç›‘å¬å®¢æˆ·ç«¯çš„ TCP è¿æ¥, ä¾‹å¦‚:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//do something with socketChannel...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æ‰“å¼€-å…³é—­"><a href="#æ‰“å¼€-å…³é—­" class="header-anchor">#</a> æ‰“å¼€ å…³é—­</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-Java extra-class"><pre class="language-java"><code>serverSocketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ç›‘å¬è¿æ¥"><a href="#ç›‘å¬è¿æ¥" class="header-anchor">#</a> ç›‘å¬è¿æ¥</h4> <p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ServerSocketChannel.accept()æ–¹æ³•æ¥ç›‘å¬å®¢æˆ·ç«¯çš„ TCP è¿æ¥è¯·æ±‚, accept()æ–¹æ³•ä¼šé˜»å¡, ç›´åˆ°æœ‰è¿æ¥åˆ°æ¥, å½“æœ‰è¿æ¥æ—¶, è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª SocketChannel å¯¹è±¡:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//do something with socketChannel...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="éé˜»å¡æ¨¡å¼-2"><a href="#éé˜»å¡æ¨¡å¼-2" class="header-anchor">#</a> éé˜»å¡æ¨¡å¼</h4> <p>åœ¨éé˜»å¡æ¨¡å¼ä¸‹, accept()æ˜¯éé˜»å¡çš„, å› æ­¤å¦‚æœæ­¤æ—¶æ²¡æœ‰è¿æ¥åˆ°æ¥, é‚£ä¹ˆ accept()æ–¹æ³•ä¼šè¿”å›null:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>socketChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//do something with socketChannel...</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="datagramchannel"><a href="#datagramchannel" class="header-anchor">#</a> DatagramChannel</h3> <p>DatagramChannel æ˜¯ç”¨æ¥å¤„ç† UDP è¿æ¥çš„.</p> <h4 id="æ‰“å¼€"><a href="#æ‰“å¼€" class="header-anchor">#</a> æ‰“å¼€</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">DatagramChannel</span> channel <span class="token operator">=</span> <span class="token class-name">DatagramChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="è¯»å–æ•°æ®-2"><a href="#è¯»å–æ•°æ®-2" class="header-anchor">#</a> è¯»å–æ•°æ®</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

channel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="å‘é€æ•°æ®"><a href="#å‘é€æ•°æ®" class="header-anchor">#</a> å‘é€æ•°æ®</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> newData <span class="token operator">=</span> <span class="token string">&quot;New String to write to file...&quot;</span>
                    <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> bytesSent <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="è¿æ¥åˆ°æŒ‡å®šåœ°å€"><a href="#è¿æ¥åˆ°æŒ‡å®šåœ°å€" class="header-anchor">#</a> è¿æ¥åˆ°æŒ‡å®šåœ°å€</h4> <p>å› ä¸º UDP æ˜¯éè¿æ¥çš„, å› æ­¤è¿™ä¸ªçš„ connect å¹¶ä¸æ˜¯å‘ TCP ä¸€æ ·çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥, è€Œæ˜¯å®ƒä¼šè®² DatagramChannel é”ä½, å› æ­¤æˆ‘ä»¬ä»…ä»…å¯ä»¥ä»æŒ‡å®šçš„åœ°å€ä¸­è¯»å–æˆ–å†™å…¥æ•°æ®.</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="java-nio-buffer"><a href="#java-nio-buffer" class="header-anchor">#</a> Java NIO Buffer</h2> <p>å½“æˆ‘ä»¬éœ€è¦ä¸ NIO Channel è¿›è¡Œäº¤äº’æ—¶, æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ° NIO Buffer, å³æ•°æ®ä» Bufferè¯»å–åˆ° Channel ä¸­, å¹¶ä¸”ä» Channel ä¸­å†™å…¥åˆ° Buffer ä¸­.
å®é™…ä¸Š, ä¸€ä¸ª Buffer å…¶å®å°±æ˜¯ä¸€å—å†…å­˜åŒºåŸŸ, æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå†…å­˜åŒºåŸŸä¸­è¿›è¡Œæ•°æ®çš„è¯»å†™. NIO Buffer å…¶å®æ˜¯è¿™æ ·çš„å†…å­˜å—çš„ä¸€ä¸ªå°è£…, å¹¶æä¾›äº†ä¸€äº›æ“ä½œæ–¹æ³•è®©æˆ‘ä»¬èƒ½å¤Ÿæ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®çš„è¯»å†™.
Buffer ç±»å‹æœ‰:</p> <ul><li>ByteBuffer</li> <li>CharBuffer</li> <li>DoubleBuffer</li> <li>FloatBuffer</li> <li>IntBuffer</li> <li>LongBuffer</li> <li>ShortBuffer</li></ul> <p>è¿™äº› Buffer è¦†ç›–äº†èƒ½ä» IO ä¸­ä¼ è¾“çš„æ‰€æœ‰çš„ Java åŸºæœ¬æ•°æ®ç±»å‹.</p> <h3 id="nio-buffer-çš„åŸºæœ¬ä½¿ç”¨"><a href="#nio-buffer-çš„åŸºæœ¬ä½¿ç”¨" class="header-anchor">#</a> NIO Buffer çš„åŸºæœ¬ä½¿ç”¨</h3> <p>ä½¿ç”¨ NIO Buffer çš„æ­¥éª¤å¦‚ä¸‹:</p> <ul><li>å°†æ•°æ®å†™å…¥åˆ° Buffer ä¸­.</li> <li>è°ƒç”¨ Buffer.flip() æ–¹æ³•, å°† NIO Buffer è½¬æ¢ä¸ºè¯»æ¨¡å¼.</li> <li>ä» Buffer ä¸­è¯»å–æ•°æ®</li> <li>è°ƒç”¨ Buffer.clear() æˆ– Buffer.compact()æ–¹æ³•, å°† Buffer è½¬æ¢ä¸ºå†™æ¨¡å¼.</li></ul> <p>å½“æˆ‘ä»¬å°†æ•°æ®å†™å…¥åˆ° Buffer ä¸­æ—¶, Buffer ä¼šè®°å½•æˆ‘ä»¬å·²ç»å†™äº†å¤šå°‘çš„æ•°æ®, å½“æˆ‘ä»¬éœ€è¦ä» Buffer ä¸­è¯»å–æ•°æ®æ—¶, å¿…é¡»è°ƒç”¨ Buffer.flip()å°† Buffer åˆ‡æ¢ä¸ºè¯»æ¨¡å¼.
ä¸€æ—¦è¯»å–äº†æ‰€æœ‰çš„ Buffer æ•°æ®, é‚£ä¹ˆæˆ‘ä»¬å¿…é¡»æ¸…ç† Buffer, è®©å…¶ä»æ–°å¯å†™, æ¸…ç† Buffer å¯ä»¥è°ƒç”¨ Buffer.clear() æˆ– Buffer.compact().
ä¾‹å¦‚:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12345678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šè¿°ä¸­, æˆ‘ä»¬åˆ†é…ä¸¤ä¸ªå•ä½å¤§å°çš„ IntBuffer, å› æ­¤å®ƒå¯ä»¥å†™å…¥ä¸¤ä¸ª int å€¼.
æˆ‘ä»¬ä½¿ç”¨ put æ–¹æ³•å°† int å€¼å†™å…¥, ç„¶åä½¿ç”¨ flip æ–¹æ³•å°† buffer è½¬æ¢ä¸ºè¯»æ¨¡å¼, ç„¶åè¿ç»­ä½¿ç”¨ get æ–¹æ³•ä» buffer ä¸­è·å–è¿™ä¸¤ä¸ª int å€¼.
<code>æ¯å½“è°ƒç”¨ä¸€æ¬¡ get æ–¹æ³•è¯»å–æ•°æ®æ—¶, buffer çš„è¯»æŒ‡é’ˆéƒ½ä¼šå‘å‰ç§»åŠ¨ä¸€ä¸ªå•ä½é•¿åº¦(åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ª int é•¿åº¦)</code></p> <h3 id="buffer-å±æ€§"><a href="#buffer-å±æ€§" class="header-anchor">#</a> Buffer å±æ€§</h3> <p>ä¸€ä¸ª Buffer æœ‰ä¸‰ä¸ªå±æ€§:</p> <ul><li>capacity</li> <li>position</li> <li>limit</li></ul> <p>å…¶ä¸­ <strong>position</strong> å’Œ <strong>limit</strong> çš„å«ä¹‰ä¸ Buffer å¤„äºè¯»æ¨¡å¼æˆ–å†™æ¨¡å¼æœ‰å…³, è€Œ capacity çš„å«ä¹‰ä¸ Buffer æ‰€å¤„çš„æ¨¡å¼æ— å…³.</p> <h4 id="capacity"><a href="#capacity" class="header-anchor">#</a> Capacity</h4> <p>ä¸€ä¸ªå†…å­˜å—ä¼šæœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°, å³å®¹é‡(capacity), æˆ‘ä»¬æœ€å¤šå†™å…¥<strong>capacity</strong> ä¸ªå•ä½çš„æ•°æ®åˆ° Buffer ä¸­, ä¾‹å¦‚ä¸€ä¸ª DoubleBuffer, å…¶ Capacity æ˜¯100, é‚£ä¹ˆæˆ‘ä»¬æœ€å¤šå¯ä»¥å†™å…¥100ä¸ª double æ•°æ®.</p> <h4 id="position"><a href="#position" class="header-anchor">#</a> Position</h4> <p>å½“ä»ä¸€ä¸ª Buffer ä¸­å†™å…¥æ•°æ®æ—¶, æˆ‘ä»¬æ˜¯ä» Buffer çš„ä¸€ä¸ªç¡®å®šçš„ä½ç½®(position)å¼€å§‹å†™å…¥çš„. åœ¨æœ€åˆçš„çŠ¶æ€æ—¶, position çš„å€¼æ˜¯0. æ¯å½“æˆ‘ä»¬å†™å…¥äº†ä¸€ä¸ªå•ä½çš„æ•°æ®å, position å°±ä¼šé€’å¢ä¸€.
å½“æˆ‘ä»¬ä» Buffer ä¸­è¯»å–æ•°æ®æ—¶, æˆ‘ä»¬ä¹Ÿæ˜¯ä»æŸä¸ªç‰¹å®šçš„ä½ç½®å¼€å§‹è¯»å–çš„. <strong>å½“æˆ‘ä»¬è°ƒç”¨äº† filp()æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼è½¬æ¢åˆ°è¯»æ¨¡å¼æ—¶, position çš„å€¼ä¼šè‡ªåŠ¨è¢«è®¾ç½®ä¸º0,</strong> æ¯å½“æˆ‘ä»¬è¯»å–ä¸€ä¸ªå•ä½çš„æ•°æ®, position çš„å€¼é€’å¢1.
<strong>position</strong> è¡¨ç¤ºäº†è¯»å†™æ“ä½œçš„ä½ç½®æŒ‡é’ˆ.</p> <h4 id="limit"><a href="#limit" class="header-anchor">#</a> limit</h4> <p><code>limit - position è¡¨ç¤ºæ­¤æ—¶è¿˜å¯ä»¥å†™å…¥/è¯»å–å¤šå°‘å•ä½çš„æ•°æ®.</code>
ä¾‹å¦‚åœ¨å†™æ¨¡å¼, å¦‚æœæ­¤æ—¶ limit æ˜¯10, position æ˜¯2, åˆ™è¡¨ç¤ºå·²ç»å†™å…¥äº†2ä¸ªå•ä½çš„æ•°æ®, è¿˜å¯ä»¥å†™å…¥ 10 - 2 = 8 ä¸ªå•ä½çš„æ•°æ®.</p> <h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="header-anchor">#</a> ä¾‹å­:</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Write mode: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tCapacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tPosition: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tLimit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Read mode: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tCapacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tPosition: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tLimit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå†™å…¥ä¸¤ä¸ª int å€¼, æ­¤æ—¶ capacity = 10, position = 2, limit = 10.
ç„¶åæˆ‘ä»¬è°ƒç”¨ flip è½¬æ¢ä¸ºè¯»æ¨¡å¼, æ­¤æ—¶ capacity = 10, position = 0, limit = 2;</p> <h3 id="åˆ†é…-buffer"><a href="#åˆ†é…-buffer" class="header-anchor">#</a> åˆ†é… Buffer</h3> <p>ä¸ºäº†è·å–ä¸€ä¸ª Buffer å¯¹è±¡, æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ†é…å†…å­˜ç©ºé—´. æ¯ä¸ªç±»å‹çš„ Buffer éƒ½æœ‰ä¸€ä¸ª allocate()æ–¹æ³•, æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•åˆ†é… Buffer:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬åˆ†é…äº†48 * sizeof(Byte)å­—èŠ‚çš„å†…å­˜ç©ºé—´.</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">CharBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">CharBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬åˆ†é…äº†å¤§å°ä¸º1024ä¸ªå­—ç¬¦çš„ Buffer, å³ è¿™ä¸ª Buffer å¯ä»¥å­˜å‚¨1024 ä¸ª Char, å…¶å¤§å°ä¸º 1024 * 2 ä¸ªå­—èŠ‚.</p> <h3 id="å…³äº-direct-buffer-å’Œ-non-direct-buffer-çš„åŒºåˆ«"><a href="#å…³äº-direct-buffer-å’Œ-non-direct-buffer-çš„åŒºåˆ«" class="header-anchor">#</a> å…³äº Direct Buffer å’Œ Non-Direct Buffer çš„åŒºåˆ«</h3> <p><strong>Direct Buffer:</strong></p> <ul><li>æ‰€åˆ†é…çš„å†…å­˜ä¸åœ¨ JVM å †ä¸Š, ä¸å— GC çš„ç®¡ç†.(ä½†æ˜¯ Direct Buffer çš„ Java å¯¹è±¡æ˜¯ç”± GC ç®¡ç†çš„, å› æ­¤å½“å‘ç”Ÿ GC, å¯¹è±¡è¢«å›æ”¶æ—¶, Direct Buffer ä¹Ÿä¼šè¢«é‡Šæ”¾)</li> <li>å› ä¸º Direct Buffer  ä¸åœ¨ JVM å †ä¸Šåˆ†é…, å› æ­¤ Direct Buffer å¯¹åº”ç”¨ç¨‹åºçš„å†…å­˜å ç”¨çš„å½±å“å°±ä¸é‚£ä¹ˆæ˜æ˜¾(å®é™…ä¸Šè¿˜æ˜¯å ç”¨äº†è¿™ä¹ˆå¤šå†…å­˜, ä½†æ˜¯ JVM ä¸å¥½ç»Ÿè®¡åˆ°é JVM ç®¡ç†çš„å†…å­˜.)</li> <li>ç”³è¯·å’Œé‡Šæ”¾ Direct Buffer çš„å¼€é”€æ¯”è¾ƒå¤§. å› æ­¤æ­£ç¡®çš„ä½¿ç”¨ Direct Buffer çš„æ–¹å¼æ˜¯åœ¨åˆå§‹åŒ–æ—¶ç”³è¯·ä¸€ä¸ª Buffer, ç„¶åä¸æ–­å¤ç”¨æ­¤ buffer, åœ¨ç¨‹åºç»“æŸåæ‰é‡Šæ”¾æ­¤ buffer.</li> <li>ä½¿ç”¨ Direct Buffer æ—¶, å½“è¿›è¡Œä¸€äº›åº•å±‚çš„ç³»ç»Ÿ IO æ“ä½œæ—¶, æ•ˆç‡ä¼šæ¯”è¾ƒé«˜, å› ä¸ºæ­¤æ—¶ JVM ä¸éœ€è¦æ‹·è´ buffer ä¸­çš„å†…å­˜åˆ°ä¸­é—´ä¸´æ—¶ç¼“å†²åŒºä¸­.</li></ul> <p><strong>Non-Direct Buffer:</strong></p> <ul><li>ç›´æ¥åœ¨ JVM å †ä¸Šè¿›è¡Œå†…å­˜çš„åˆ†é…, æœ¬è´¨ä¸Šæ˜¯ byte[] æ•°ç»„çš„å°è£….</li> <li>å› ä¸º Non-Direct Buffer åœ¨ JVM å †ä¸­, å› æ­¤å½“è¿›è¡Œæ“ä½œç³»ç»Ÿåº•å±‚ IO æ“ä½œä¸­æ—¶, ä¼šå°†æ­¤ buffer çš„å†…å­˜å¤åˆ¶åˆ°ä¸­é—´ä¸´æ—¶ç¼“å†²åŒºä¸­. å› æ­¤ Non-Direct Buffer çš„æ•ˆç‡å°±è¾ƒä½.</li></ul> <h3 id="å†™å…¥æ•°æ®åˆ°-buffer"><a href="#å†™å…¥æ•°æ®åˆ°-buffer" class="header-anchor">#</a> å†™å…¥æ•°æ®åˆ° Buffer</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//read into buffer.</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ä»-buffer-ä¸­è¯»å–æ•°æ®"><a href="#ä»-buffer-ä¸­è¯»å–æ•°æ®" class="header-anchor">#</a> ä» Buffer ä¸­è¯»å–æ•°æ®</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token comment">//read from buffer into channel.</span>
<span class="token keyword">int</span> bytesWritten <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span> aByte <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="é‡ç½®-position"><a href="#é‡ç½®-position" class="header-anchor">#</a> é‡ç½® position</h3> <p>Buffer.rewind()æ–¹æ³•å¯ä»¥é‡ç½® position çš„å€¼ä¸º0, å› æ­¤æˆ‘ä»¬å¯ä»¥é‡æ–°è¯»å–/å†™å…¥ Buffer äº†.
å¦‚æœæ˜¯è¯»æ¨¡å¼, åˆ™é‡ç½®çš„æ˜¯è¯»æ¨¡å¼çš„ position, å¦‚æœæ˜¯å†™æ¨¡å¼, åˆ™é‡ç½®çš„æ˜¯å†™æ¨¡å¼çš„ position.
ä¾‹å¦‚:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        intBuffer<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        intBuffer<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>rewind() ä¸»è¦é’ˆå¯¹äºè¯»æ¨¡å¼. åœ¨è¯»æ¨¡å¼æ—¶, è¯»å–åˆ° limit å, å¯ä»¥è°ƒç”¨ rewind() æ–¹æ³•, å°†è¯» position ç½®ä¸º0.</code></p> <h3 id="å…³äº-mark-å’Œ-reset"><a href="#å…³äº-mark-å’Œ-reset" class="header-anchor">#</a> å…³äº mark()å’Œ reset()</h3> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ Buffer.mark()å°†å½“å‰çš„ position çš„å€¼ä¿å­˜èµ·æ¥, éšåå¯ä»¥é€šè¿‡è°ƒç”¨ Buffer.reset()æ–¹æ³•å°† position çš„å€¼å›å¤å›æ¥.
ä¾‹å¦‚:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬å†™å…¥ä¸¤ä¸ª int å€¼, ç„¶åé¦–å…ˆè¯»å–äº†ä¸€ä¸ªå€¼. æ­¤æ—¶è¯» position çš„å€¼ä¸º1.
æ¥ç€æˆ‘ä»¬è°ƒç”¨ mark() æ–¹æ³•å°†å½“å‰çš„ position ä¿å­˜èµ·æ¥(åœ¨è¯»æ¨¡å¼, å› æ­¤ä¿å­˜çš„æ˜¯è¯»çš„ position), ç„¶åå†æ¬¡è¯»å–, æ­¤æ—¶ position å°±æ˜¯2äº†.
æ¥ç€ä½¿ç”¨ reset() æ¢å¤åŸæ¥çš„è¯» position, å› æ­¤è¯» position å°±ä¸º1, å¯ä»¥å†æ¬¡è¯»å–æ•°æ®.</p> <h3 id="flip-rewind-å’Œ-clear-çš„åŒºåˆ«"><a href="#flip-rewind-å’Œ-clear-çš„åŒºåˆ«" class="header-anchor">#</a> flip, rewind å’Œ clear çš„åŒºåˆ«</h3> <h4 id="flip"><a href="#flip" class="header-anchor">#</a> flip</h4> <p>æ–¹æ³•æºç :</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    limit <span class="token operator">=</span> position<span class="token punctuation">;</span>
    position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    mark <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Buffer çš„è¯»/å†™æ¨¡å¼å…±ç”¨ä¸€ä¸ª position å’Œ limit å˜é‡.
å½“ä»å†™æ¨¡å¼å˜ä¸ºè¯»æ¨¡å¼æ—¶, åŸå…ˆçš„ <strong>å†™ position</strong> å°±å˜æˆäº†è¯»æ¨¡å¼çš„ <strong>limit</strong>.</p> <h4 id="rewind"><a href="#rewind" class="header-anchor">#</a> rewind</h4> <p>æ–¹æ³•æºç </p> <div class="language- extra-class"><pre class="language-text"><code>public final Buffer rewind() {
    position = 0;
    mark = -1;
    return this;
}
</code></pre></div><p>rewind, å³å€’å¸¦, è¿™ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å°† position ç½®ä¸º0.</p> <h4 id="clear"><a href="#clear" class="header-anchor">#</a> clear</h4> <p>æ–¹æ³•æºç :</p> <div class="language- extra-class"><pre class="language-text"><code>public final Buffer clear() {
    position = 0;
    limit = capacity;
    mark = -1;
    return this;
}
</code></pre></div><p>æ ¹æ®æºç æˆ‘ä»¬å¯ä»¥çŸ¥é“, clear å°† positin è®¾ç½®ä¸º0, å°† limit è®¾ç½®ä¸º capacity.
clear æ–¹æ³•ä½¿ç”¨åœºæ™¯:</p> <ul><li>åœ¨ä¸€ä¸ªå·²ç»å†™æ»¡æ•°æ®çš„ buffer ä¸­, è°ƒç”¨ clear, å¯ä»¥ä»å¤´è¯»å– buffer çš„æ•°æ®.</li> <li>ä¸ºäº†å°†ä¸€ä¸ª buffer å¡«å……æ»¡æ•°æ®, å¯ä»¥è°ƒç”¨ clear, ç„¶åä¸€ç›´å†™å…¥, ç›´åˆ°è¾¾åˆ° limit.</li></ul> <h5 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="header-anchor">#</a> ä¾‹å­:</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;limit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™é‡Œä¸èƒ½è¯», å› ä¸º limit == position == 0, æ²¡æœ‰æ•°æ®.</span>
<span class="token comment">//System.err.println(intBuffer.get());</span>

intBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;limit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™é‡Œå¯ä»¥è¯»å–æ•°æ®äº†, å› ä¸º clear å, limit == capacity == 2, position == 0,</span>
<span class="token comment">// å³ä½¿æˆ‘ä»¬æ²¡æœ‰å†™å…¥ä»»ä½•çš„æ•°æ®åˆ° buffer ä¸­.</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–åˆ°0</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–åˆ°0</span>
</code></pre></div><h3 id="buffer-çš„æ¯”è¾ƒ"><a href="#buffer-çš„æ¯”è¾ƒ" class="header-anchor">#</a> Buffer çš„æ¯”è¾ƒ</h3> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ equals() æˆ– compareTo() æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ª Buffer, å½“ä¸”ä»…å½“å¦‚ä¸‹æ¡ä»¶æ»¡è¶³æ—¶, ä¸¤ä¸ª Buffer æ˜¯ç›¸ç­‰çš„:</p> <ul><li>ä¸¤ä¸ª Buffer æ˜¯ç›¸åŒç±»å‹çš„</li> <li>ä¸¤ä¸ª Buffer çš„å‰©ä½™çš„æ•°æ®ä¸ªæ•°æ˜¯ç›¸åŒçš„</li> <li>ä¸¤ä¸ª Buffer çš„å‰©ä½™çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„.</li></ul> <p>é€šè¿‡ä¸Šè¿°æ¡ä»¶æˆ‘ä»¬å¯ä»¥å‘ç°, æ¯”è¾ƒä¸¤ä¸ª Buffer æ—¶, å¹¶ä¸æ˜¯ Buffer ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è¿›è¡Œæ¯”è¾ƒ, è€Œæ˜¯æ¯”è¾ƒ Buffer ä¸­å‰©ä½™çš„å…ƒç´ .</p> <h2 id="selector-2"><a href="#selector-2" class="header-anchor">#</a> Selector</h2> <p>Selector å…è®¸ä¸€ä¸ªå•ä¸€çš„çº¿ç¨‹æ¥æ“ä½œå¤šä¸ª Channel. å¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº†å¤šä¸ª Channel, é‚£ä¹ˆä½¿ç”¨ Selector å¾ˆæ–¹ä¾¿çš„å®ç°è¿™æ ·çš„ç›®çš„, ä½†æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨äº†å¤šä¸ª Channel, å› æ­¤ä¹Ÿä¼šé€ æˆäº†æ¯ä¸ª Channel ä¼ è¾“æ•ˆç‡çš„é™ä½.
ä½¿ç”¨ Selector çš„å›¾è§£å¦‚ä¸‹:</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182145772.png" alt="image-20240918214545698"></p> <p>ä¸ºäº†ä½¿ç”¨ Selector, æˆ‘ä»¬é¦–å…ˆéœ€è¦å°† Channel æ³¨å†Œåˆ° Selector ä¸­, éšåè°ƒç”¨ Selector çš„ select() æ–¹æ³•, è¿™ä¸ªæ–¹æ³•ä¼šé˜»å¡, ç›´åˆ°æ³¨å†Œåœ¨ Selector ä¸­çš„ Channel å‘é€å¯è¯»å†™äº‹ä»¶. å½“è¿™ä¸ªæ–¹æ³•è¿”å›å, å½“å‰çš„è¿™ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç† Channel çš„äº‹ä»¶äº†.</p> <h3 id="åˆ›å»ºé€‰æ‹©å™¨"><a href="#åˆ›å»ºé€‰æ‹©å™¨" class="header-anchor">#</a> åˆ›å»ºé€‰æ‹©å™¨</h3> <p>é€šè¿‡ Selector.open()æ–¹æ³•, æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="å°†-channel-æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸­"><a href="#å°†-channel-æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸­" class="header-anchor">#</a> å°† Channel æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸­</h3> <p>ä¸ºäº†ä½¿ç”¨é€‰æ‹©å™¨ç®¡ç† Channel, æˆ‘ä»¬éœ€è¦å°† Channel æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸­:</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong><code>æ³¨æ„</code></strong>, å¦‚æœä¸€ä¸ª Channel è¦æ³¨å†Œåˆ° Selector ä¸­, é‚£ä¹ˆè¿™ä¸ª Channel å¿…é¡»æ˜¯éé˜»å¡çš„, å³channel.configureBlocking(false);
å› ä¸º Channel å¿…é¡»è¦æ˜¯éé˜»å¡çš„, å› æ­¤ FileChannel æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨é€‰æ‹©å™¨çš„, å› ä¸º FileChannel éƒ½æ˜¯é˜»å¡çš„.</p></blockquote> <p>æ³¨æ„åˆ°, åœ¨ä½¿ç”¨ Channel.register()æ–¹æ³•æ—¶, ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šäº†æˆ‘ä»¬å¯¹ Channel çš„ä»€ä¹ˆç±»å‹çš„äº‹ä»¶æ„Ÿå…´è¶£, è¿™äº›äº‹ä»¶æœ‰:</p> <ul><li>Connect, å³è¿æ¥äº‹ä»¶(TCP è¿æ¥), å¯¹åº”äºSelectionKey.OP_CONNECT</li> <li>Accept, å³ç¡®è®¤äº‹ä»¶, å¯¹åº”äºSelectionKey.OP_ACCEPT</li> <li>Read, å³è¯»äº‹ä»¶, å¯¹åº”äºSelectionKey.OP_READ, è¡¨ç¤º buffer å¯è¯».</li> <li>Write, å³å†™äº‹ä»¶, å¯¹åº”äºSelectionKey.OP_WRITE, è¡¨ç¤º buffer å¯å†™.</li></ul> <p>ä¸€ä¸ª Channelå‘å‡ºä¸€ä¸ªäº‹ä»¶ä¹Ÿå¯ä»¥ç§°ä¸º** å¯¹äºæŸä¸ªäº‹ä»¶, Channel å‡†å¤‡å¥½äº†**. å› æ­¤ä¸€ä¸ª Channel æˆåŠŸè¿æ¥åˆ°äº†å¦ä¸€ä¸ªæœåŠ¡å™¨ä¹Ÿå¯ä»¥è¢«ç§°ä¸º** connect ready**.
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ–è¿ç®—**|**æ¥ç»„åˆå¤šä¸ªäº‹ä»¶, ä¾‹å¦‚:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> interestSet <span class="token operator">=</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">;</span>    
</code></pre></div><p><code>æ³¨æ„, ä¸€ä¸ª Channel ä»…ä»…å¯ä»¥è¢«æ³¨å†Œåˆ°ä¸€ä¸ª Selector ä¸€æ¬¡, å¦‚æœå°† Channel æ³¨å†Œåˆ° Selector å¤šæ¬¡, é‚£ä¹ˆå…¶å®å°±æ˜¯ç›¸å½“äºæ›´æ–° SelectionKey çš„ interest set</code>. ä¾‹å¦‚:</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¸Šé¢çš„ channel æ³¨å†Œåˆ°åŒä¸€ä¸ª Selector ä¸¤æ¬¡äº†, é‚£ä¹ˆç¬¬äºŒæ¬¡çš„æ³¨å†Œå…¶å®å°±æ˜¯ç›¸å½“äºæ›´æ–°è¿™ä¸ª Channel çš„ interest set ä¸º SelectionKey.OP_READ | SelectionKey.OP_WRITE.</p> <h3 id="å…³äº-selectionkey"><a href="#å…³äº-selectionkey" class="header-anchor">#</a> å…³äº SelectionKey</h3> <p>å¦‚ä¸Šæ‰€ç¤º, å½“æˆ‘ä»¬ä½¿ç”¨ register æ³¨å†Œä¸€ä¸ª Channel æ—¶, ä¼šè¿”å›ä¸€ä¸ª SelectionKey å¯¹è±¡, è¿™ä¸ªå¯¹è±¡åŒ…å«äº†å¦‚ä¸‹å†…å®¹:</p> <ul><li>interest set, å³æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶é›†, å³åœ¨è°ƒç”¨ register æ³¨å†Œ channel æ—¶æ‰€è®¾ç½®çš„ interest set.</li> <li>ready set</li> <li>channel</li> <li>selector</li> <li>attached object, å¯é€‰çš„é™„åŠ å¯¹è±¡</li></ul> <h4 id="interest-set"><a href="#interest-set" class="header-anchor">#</a> interest set</h4> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è·å– interest set:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> interestSet <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> isInterestedInAccept  <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isInterestedInConnect <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isInterestedInRead    <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isInterestedInWrite   <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">;</span>    
</code></pre></div><h4 id="ready-set"><a href="#ready-set" class="header-anchor">#</a> ready set</h4> <p>ä»£è¡¨äº† Channel æ‰€å‡†å¤‡å¥½äº†çš„æ“ä½œ.
æˆ‘ä»¬å¯ä»¥åƒåˆ¤æ–­ interest set ä¸€æ ·æ“ä½œ Ready set, ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•è¿›è¡Œåˆ¤æ–­:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> readySet <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">readyOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

selectionKey<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectionKey<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectionKey<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectionKey<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="channel-å’Œ-selector"><a href="#channel-å’Œ-selector" class="header-anchor">#</a> Channel å’Œ Selector</h4> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ SelectionKey è·å–ç›¸å¯¹åº”çš„ Channel å’Œ Selector:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Channel</span>  channel  <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Selector</span> selector <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><h4 id="attaching-object"><a href="#attaching-object" class="header-anchor">#</a> Attaching Object</h4> <p>æˆ‘ä»¬å¯ä»¥åœ¨selectionKeyä¸­é™„åŠ ä¸€ä¸ªå¯¹è±¡:</p> <div class="language-Java extra-class"><pre class="language-java"><code>selectionKey<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>theObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> attachedObj <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ–è€…åœ¨æ³¨å†Œæ—¶ç›´æ¥é™„åŠ :</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">,</span> theObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="é€šè¿‡-selector-é€‰æ‹©-channel"><a href="#é€šè¿‡-selector-é€‰æ‹©-channel" class="header-anchor">#</a> é€šè¿‡ Selector é€‰æ‹© Channel</h3> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Selector.select()æ–¹æ³•è·å–å¯¹æŸä»¶äº‹ä»¶å‡†å¤‡å¥½äº†çš„ Channel, å³å¦‚æœæˆ‘ä»¬åœ¨æ³¨å†Œ Channel æ—¶, å¯¹å…¶çš„<strong>å¯å†™</strong>äº‹ä»¶æ„Ÿå…´è¶£, é‚£ä¹ˆå½“ select()è¿”å›æ—¶, æˆ‘ä»¬å°±å¯ä»¥è·å– Channel äº†.</p> <blockquote><p><strong><code>æ³¨æ„</code></strong>, select()æ–¹æ³•è¿”å›çš„å€¼è¡¨ç¤ºæœ‰å¤šå°‘ä¸ª Channel å¯æ“ä½œ.</p></blockquote> <h3 id="è·å–å¯æ“ä½œçš„-channel"><a href="#è·å–å¯æ“ä½œçš„-channel" class="header-anchor">#</a> è·å–å¯æ“ä½œçš„ Channel</h3> <p>å¦‚æœ select()æ–¹æ³•è¿”å›å€¼è¡¨ç¤ºæœ‰å¤šä¸ª Channel å‡†å¤‡å¥½äº†, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ Selected key set è®¿é—®è¿™ä¸ª Channel:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectedKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> selectedKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a connection was accepted by a ServerSocketChannel.</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a connection was established with a remote server.</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a channel is ready for reading</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a channel is ready for writing</span>
    <span class="token punctuation">}</span>

    keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>æ³¨æ„, åœ¨æ¯æ¬¡è¿­ä»£æ—¶, æˆ‘ä»¬éƒ½è°ƒç”¨ &quot;keyIterator.remove()&quot; å°†è¿™ä¸ª key ä»è¿­ä»£å™¨ä¸­åˆ é™¤, å› ä¸º select() æ–¹æ³•ä»…ä»…æ˜¯ç®€å•åœ°å°†å°±ç»ªçš„ IO æ“ä½œæ”¾åˆ° selectedKeys é›†åˆä¸­, å› æ­¤å¦‚æœæˆ‘ä»¬ä» selectedKeys è·å–åˆ°ä¸€ä¸ª key, ä½†æ˜¯æ²¡æœ‰å°†å®ƒåˆ é™¤, é‚£ä¹ˆä¸‹ä¸€æ¬¡ select æ—¶, è¿™ä¸ª key æ‰€å¯¹åº”çš„ IO äº‹ä»¶è¿˜åœ¨ selectedKeys ä¸­.</code></p> <p>ä¾‹å¦‚æ­¤æ—¶æˆ‘ä»¬æ”¶åˆ° OP_ACCEPT é€šçŸ¥, ç„¶åæˆ‘ä»¬è¿›è¡Œç›¸å…³å¤„ç†, ä½†æ˜¯å¹¶æ²¡æœ‰å°†è¿™ä¸ª Key ä» SelectedKeys ä¸­åˆ é™¤, é‚£ä¹ˆä¸‹ä¸€æ¬¡ select() è¿”å›æ—¶ æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ SelectedKeys ä¸­è·å–åˆ° OP_ACCEPT çš„ key.</p> <p><code>æ³¨æ„, æˆ‘ä»¬å¯ä»¥åŠ¨æ€æ›´æ”¹ SekectedKeys ä¸­çš„ key çš„ interest set.</code></p> <p>ä¾‹å¦‚åœ¨ OP_ACCEPT ä¸­, æˆ‘ä»¬å¯ä»¥å°† interest set æ›´æ–°ä¸º OP_READ, è¿™æ · Selector å°±ä¼šå°†è¿™ä¸ª Channel çš„ è¯» IO å°±ç»ªäº‹ä»¶åŒ…å«è¿›æ¥äº†.</p> <h3 id="selector-çš„åŸºæœ¬ä½¿ç”¨æµç¨‹"><a href="#selector-çš„åŸºæœ¬ä½¿ç”¨æµç¨‹" class="header-anchor">#</a> Selector çš„åŸºæœ¬ä½¿ç”¨æµç¨‹</h3> <ol><li>é€šè¿‡ Selector.open() æ‰“å¼€ä¸€ä¸ª Selector.</li> <li>å°† Channel æ³¨å†Œåˆ° Selector ä¸­, å¹¶è®¾ç½®éœ€è¦ç›‘å¬çš„äº‹ä»¶(interest set)</li> <li>ä¸æ–­é‡å¤:</li></ol> <ul><li>è°ƒç”¨ select() æ–¹æ³•</li> <li>è°ƒç”¨ selector.selectedKeys() è·å– selected keys</li> <li>è¿­ä»£æ¯ä¸ª selected key:</li> <li>*ä» selected key ä¸­è·å– å¯¹åº”çš„ Channel å’Œé™„åŠ ä¿¡æ¯(å¦‚æœæœ‰çš„è¯)</li> <li>*åˆ¤æ–­æ˜¯å“ªäº› IO äº‹ä»¶å·²ç»å°±ç»ªäº†, ç„¶åå¤„ç†å®ƒä»¬. <strong>å¦‚æœæ˜¯ OP_ACCEPT äº‹ä»¶, åˆ™è°ƒç”¨ &quot;SocketChannel clientChannel = ((ServerSocketChannel) key.channel()).accept()&quot; è·å– SocketChannel, å¹¶å°†å®ƒè®¾ç½®ä¸º éé˜»å¡çš„, ç„¶åå°†è¿™ä¸ª Channel æ³¨å†Œåˆ° Selector ä¸­.</strong></li> <li>*æ ¹æ®éœ€è¦æ›´æ”¹ selected key çš„ç›‘å¬äº‹ä»¶.</li> <li>*å°†å·²ç»å¤„ç†è¿‡çš„ key ä» selected keys é›†åˆä¸­åˆ é™¤.</li></ul> <h3 id="å…³é—­-selector"><a href="#å…³é—­-selector" class="header-anchor">#</a> å…³é—­ Selector</h3> <p>å½“è°ƒç”¨äº† Selector.close()æ–¹æ³•æ—¶, æˆ‘ä»¬å…¶å®æ˜¯å…³é—­äº† Selector æœ¬èº«å¹¶ä¸”å°†æ‰€æœ‰çš„ SelectionKey å¤±æ•ˆ, ä½†æ˜¯å¹¶ä¸ä¼šå…³é—­ Channel.</p> <h3 id="å®Œæ•´çš„-selector-ä¾‹å­"><a href="#å®Œæ•´çš„-selector-ä¾‹å­" class="header-anchor">#</a> å®Œæ•´çš„ Selector ä¾‹å­</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioEchoServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUF_SIZE</span> <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TIMEOUT</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰“å¼€æœåŠ¡ç«¯ Socket</span>
        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰“å¼€ Selector</span>
        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æœåŠ¡ç«¯ Socket ç›‘å¬8080ç«¯å£, å¹¶é…ç½®ä¸ºéé˜»å¡æ¨¡å¼</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°† channel æ³¨å†Œåˆ° selector ä¸­.</span>
        <span class="token comment">// é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯å…ˆæ³¨å†Œä¸€ä¸ª OP_ACCEPT äº‹ä»¶, ç„¶ååœ¨ OP_ACCEPT åˆ°æ¥æ—¶, å†å°†è¿™ä¸ª Channel çš„ OP_READ</span>
        <span class="token comment">// æ³¨å†Œåˆ° Selector ä¸­.</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// é€šè¿‡è°ƒç”¨ select æ–¹æ³•, é˜»å¡åœ°ç­‰å¾… channel I/O å¯æ“ä½œ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token constant">TIMEOUT</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// è·å– I/O æ“ä½œå°±ç»ªçš„ SelectionKey, é€šè¿‡ SelectionKey å¯ä»¥çŸ¥é“å“ªäº› Channel çš„å“ªç±» I/O æ“ä½œå·²ç»å°±ç»ª.</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// å½“è·å–ä¸€ä¸ª SelectionKey å, å°±è¦å°†å®ƒåˆ é™¤, è¡¨ç¤ºæˆ‘ä»¬å·²ç»å¯¹è¿™ä¸ª IO äº‹ä»¶è¿›è¡Œäº†å¤„ç†.</span>
                keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å½“ OP_ACCEPT äº‹ä»¶åˆ°æ¥æ—¶, æˆ‘ä»¬å°±æœ‰ä» ServerSocketChannel ä¸­è·å–ä¸€ä¸ª SocketChannel,</span>
                    <span class="token comment">// ä»£è¡¨å®¢æˆ·ç«¯çš„è¿æ¥</span>
                    <span class="token comment">// æ³¨æ„, åœ¨ OP_ACCEPT äº‹ä»¶ä¸­, ä» key.channel() è¿”å›çš„ Channel æ˜¯ ServerSocketChannel.</span>
                    <span class="token comment">// è€Œåœ¨ OP_WRITE å’Œ OP_READ ä¸­, ä» key.channel() è¿”å›çš„æ˜¯ SocketChannel.</span>
                    <span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    clientChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//åœ¨ OP_ACCEPT åˆ°æ¥æ—¶, å†å°†è¿™ä¸ª Channel çš„ OP_READ æ³¨å†Œåˆ° Selector ä¸­.</span>
                    <span class="token comment">// æ³¨æ„, è¿™é‡Œæˆ‘ä»¬å¦‚æœæ²¡æœ‰è®¾ç½® OP_READ çš„è¯, å³ interest set ä»ç„¶æ˜¯ OP_CONNECT çš„è¯, é‚£ä¹ˆ select æ–¹æ³•ä¼šä¸€ç›´ç›´æ¥è¿”å›.</span>
                    clientChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">OP_READ</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token constant">BUF_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">long</span> bytesRead <span class="token operator">=</span> clientChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        clientChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Get data length: &quot;</span> <span class="token operator">+</span> bytesRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    clientChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    buf<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li>https://github.com/yongshun/learn_netty_source_code</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Netty ç³»ç»Ÿè®¾è®¡/20.ä¸‰ã€ä¸»çº¿ä»»åŠ¡/05.Channel æºç è§£æ.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°äº:</span> <span class="time">2024/09/18, 16:19:18</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/echo-system-design/pages/b2a14a/" class="prev">Bootstrapï¼ˆserverï¼‰æºç è§£æ</a></span> <span class="next"><a href="/echo-system-design/pages/397456/">EventLoop æºç è§£æ</a>â†’
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/echo-system-design/assets/js/app.68fbe714.js" defer></script><script src="/echo-system-design/assets/js/2.933750c6.js" defer></script><script src="/echo-system-design/assets/js/46.7624d38c.js" defer></script><script src="/echo-system-design/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
