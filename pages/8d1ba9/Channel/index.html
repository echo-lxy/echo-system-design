<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Channel ц║РчаБшзгцЮР | EchoDesign</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/echo-system-design/img/favicon.ico">
    <meta name="description" content="ч│╗ч╗Яшо╛шобф╣ЛуАМшо▓шзг + щЭвшпХцМЗхНЧуАНя╝Мц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣я╝Б">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/echo-system-design/assets/css/0.styles.744b3760.css" as="style"><link rel="preload" href="/echo-system-design/assets/js/app.68fbe714.js" as="script"><link rel="preload" href="/echo-system-design/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/echo-system-design/assets/js/46.7624d38c.js" as="script"><link rel="preload" href="/echo-system-design/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/echo-system-design/assets/js/10.b313d17c.js"><link rel="prefetch" href="/echo-system-design/assets/js/100.2b21dce5.js"><link rel="prefetch" href="/echo-system-design/assets/js/101.96ca71f6.js"><link rel="prefetch" href="/echo-system-design/assets/js/11.71fe9642.js"><link rel="prefetch" href="/echo-system-design/assets/js/12.38d1989d.js"><link rel="prefetch" href="/echo-system-design/assets/js/13.850793b0.js"><link rel="prefetch" href="/echo-system-design/assets/js/14.1141ec27.js"><link rel="prefetch" href="/echo-system-design/assets/js/15.8f1b4081.js"><link rel="prefetch" href="/echo-system-design/assets/js/16.e52ba8b4.js"><link rel="prefetch" href="/echo-system-design/assets/js/17.acb3bf3d.js"><link rel="prefetch" href="/echo-system-design/assets/js/18.e491edb6.js"><link rel="prefetch" href="/echo-system-design/assets/js/19.daf31819.js"><link rel="prefetch" href="/echo-system-design/assets/js/20.d70e5281.js"><link rel="prefetch" href="/echo-system-design/assets/js/21.0e0ed140.js"><link rel="prefetch" href="/echo-system-design/assets/js/22.dd779f94.js"><link rel="prefetch" href="/echo-system-design/assets/js/23.4d814163.js"><link rel="prefetch" href="/echo-system-design/assets/js/24.891fe6fb.js"><link rel="prefetch" href="/echo-system-design/assets/js/25.41dca26b.js"><link rel="prefetch" href="/echo-system-design/assets/js/26.6337eac0.js"><link rel="prefetch" href="/echo-system-design/assets/js/27.eeee1d20.js"><link rel="prefetch" href="/echo-system-design/assets/js/28.6fa848cf.js"><link rel="prefetch" href="/echo-system-design/assets/js/29.371a40e1.js"><link rel="prefetch" href="/echo-system-design/assets/js/3.e62a71e4.js"><link rel="prefetch" href="/echo-system-design/assets/js/30.e32f6b31.js"><link rel="prefetch" href="/echo-system-design/assets/js/31.a532917f.js"><link rel="prefetch" href="/echo-system-design/assets/js/32.13b70e91.js"><link rel="prefetch" href="/echo-system-design/assets/js/33.d10d51bb.js"><link rel="prefetch" href="/echo-system-design/assets/js/34.6671ead6.js"><link rel="prefetch" href="/echo-system-design/assets/js/35.2760ed8d.js"><link rel="prefetch" href="/echo-system-design/assets/js/36.be98cc35.js"><link rel="prefetch" href="/echo-system-design/assets/js/37.82be3556.js"><link rel="prefetch" href="/echo-system-design/assets/js/38.0bb63012.js"><link rel="prefetch" href="/echo-system-design/assets/js/39.9b34b9f9.js"><link rel="prefetch" href="/echo-system-design/assets/js/4.73518a0f.js"><link rel="prefetch" href="/echo-system-design/assets/js/40.0ada49bd.js"><link rel="prefetch" href="/echo-system-design/assets/js/41.f961e422.js"><link rel="prefetch" href="/echo-system-design/assets/js/42.b34f1599.js"><link rel="prefetch" href="/echo-system-design/assets/js/43.5a509601.js"><link rel="prefetch" href="/echo-system-design/assets/js/44.64fd3383.js"><link rel="prefetch" href="/echo-system-design/assets/js/45.685623ac.js"><link rel="prefetch" href="/echo-system-design/assets/js/47.86be3d8d.js"><link rel="prefetch" href="/echo-system-design/assets/js/48.ba7dfd47.js"><link rel="prefetch" href="/echo-system-design/assets/js/49.ee9681bc.js"><link rel="prefetch" href="/echo-system-design/assets/js/5.94727770.js"><link rel="prefetch" href="/echo-system-design/assets/js/50.b424b2c0.js"><link rel="prefetch" href="/echo-system-design/assets/js/51.ef213b56.js"><link rel="prefetch" href="/echo-system-design/assets/js/52.18c75eba.js"><link rel="prefetch" href="/echo-system-design/assets/js/53.f76e624c.js"><link rel="prefetch" href="/echo-system-design/assets/js/54.3098ec9f.js"><link rel="prefetch" href="/echo-system-design/assets/js/55.78a9171b.js"><link rel="prefetch" href="/echo-system-design/assets/js/56.af9697f4.js"><link rel="prefetch" href="/echo-system-design/assets/js/57.6175a0b4.js"><link rel="prefetch" href="/echo-system-design/assets/js/58.24008d78.js"><link rel="prefetch" href="/echo-system-design/assets/js/59.28ca51b4.js"><link rel="prefetch" href="/echo-system-design/assets/js/6.0b558b79.js"><link rel="prefetch" href="/echo-system-design/assets/js/60.1714dba8.js"><link rel="prefetch" href="/echo-system-design/assets/js/61.08b4acf0.js"><link rel="prefetch" href="/echo-system-design/assets/js/62.cc8fdced.js"><link rel="prefetch" href="/echo-system-design/assets/js/63.41ff19e4.js"><link rel="prefetch" href="/echo-system-design/assets/js/64.9b3def35.js"><link rel="prefetch" href="/echo-system-design/assets/js/65.0b2ab47d.js"><link rel="prefetch" href="/echo-system-design/assets/js/66.2ae7a107.js"><link rel="prefetch" href="/echo-system-design/assets/js/67.79dd6daf.js"><link rel="prefetch" href="/echo-system-design/assets/js/68.1b76c178.js"><link rel="prefetch" href="/echo-system-design/assets/js/69.7ac52a2f.js"><link rel="prefetch" href="/echo-system-design/assets/js/70.7279b1df.js"><link rel="prefetch" href="/echo-system-design/assets/js/71.4f744076.js"><link rel="prefetch" href="/echo-system-design/assets/js/72.44c999da.js"><link rel="prefetch" href="/echo-system-design/assets/js/73.526febf1.js"><link rel="prefetch" href="/echo-system-design/assets/js/74.26f8d9a5.js"><link rel="prefetch" href="/echo-system-design/assets/js/75.dc7fdd0f.js"><link rel="prefetch" href="/echo-system-design/assets/js/76.32858593.js"><link rel="prefetch" href="/echo-system-design/assets/js/77.7b3f6980.js"><link rel="prefetch" href="/echo-system-design/assets/js/78.31a353ef.js"><link rel="prefetch" href="/echo-system-design/assets/js/79.173bbc8c.js"><link rel="prefetch" href="/echo-system-design/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/echo-system-design/assets/js/80.78a31e84.js"><link rel="prefetch" href="/echo-system-design/assets/js/81.8d6c43d2.js"><link rel="prefetch" href="/echo-system-design/assets/js/82.cabbfc4d.js"><link rel="prefetch" href="/echo-system-design/assets/js/83.65db62ac.js"><link rel="prefetch" href="/echo-system-design/assets/js/84.e5207e82.js"><link rel="prefetch" href="/echo-system-design/assets/js/85.4cd3a775.js"><link rel="prefetch" href="/echo-system-design/assets/js/86.931cbb70.js"><link rel="prefetch" href="/echo-system-design/assets/js/87.78b2eebd.js"><link rel="prefetch" href="/echo-system-design/assets/js/88.605444aa.js"><link rel="prefetch" href="/echo-system-design/assets/js/89.e05e3a70.js"><link rel="prefetch" href="/echo-system-design/assets/js/9.2ac86403.js"><link rel="prefetch" href="/echo-system-design/assets/js/90.ca1ff100.js"><link rel="prefetch" href="/echo-system-design/assets/js/91.8ad18b18.js"><link rel="prefetch" href="/echo-system-design/assets/js/92.b554f1c7.js"><link rel="prefetch" href="/echo-system-design/assets/js/93.fb2397b7.js"><link rel="prefetch" href="/echo-system-design/assets/js/94.1eade7f0.js"><link rel="prefetch" href="/echo-system-design/assets/js/95.96f5db04.js"><link rel="prefetch" href="/echo-system-design/assets/js/96.5ed2d348.js"><link rel="prefetch" href="/echo-system-design/assets/js/97.4d4bfff5.js"><link rel="prefetch" href="/echo-system-design/assets/js/98.10f4b27a.js"><link rel="prefetch" href="/echo-system-design/assets/js/99.4a895015.js">
    <link rel="stylesheet" href="/echo-system-design/assets/css/0.styles.744b3760.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/echo-system-design/" class="home-link router-link-active"><img src="/echo-system-design/img/logo.png" alt="EchoDesign" class="logo"> <span class="site-name can-hide">EchoDesign</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/echo-system-design/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/echo-system-design/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/echo-system-design/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/echo-system-design/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/echo-system-design/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/echo-system-design/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/echo-system-design/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕шо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/bfab10/" class="nav-link">Netty ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/echo-system-design/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/echo-system-design/pages/84cb49/" class="nav-link">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</a></div><div class="nav-item"><a href="/echo-system-design/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/echo-system-design/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф╕АуАБхЙНшиА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║МуАБхЯ║чбАчЯешпЖ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/echo-system-design/pages/b0bc66/" class="sidebar-link">Netty цбЖцЮ╢цжВш┐░</a></li><li><a href="/echo-system-design/pages/9582d0/" class="sidebar-link">Bootstrapя╝Иclientя╝Йц║РчаБшзгцЮР</a></li><li><a href="/echo-system-design/pages/b2a14a/" class="sidebar-link">Bootstrapя╝Иserverя╝Йц║РчаБшзгцЮР</a></li><li><a href="/echo-system-design/pages/8d1ba9/Channel/" aria-current="page" class="active sidebar-link">Channel ц║РчаБшзгцЮР</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#чоАф╗Л" class="sidebar-link">чоАф╗Л</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#nio-хТМ-io-чЪДхп╣цпФ" class="sidebar-link">NIO хТМ IO чЪДхп╣цпФ</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#java-nio-channel" class="sidebar-link">Java NIO Channel</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#java-nio-buffer" class="sidebar-link">Java NIO Buffer</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#selector-2" class="sidebar-link">Selector</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#цА╗ч╗У" class="sidebar-link">цА╗ч╗У</a></li><li class="sidebar-sub-header level2"><a href="/echo-system-design/pages/8d1ba9/Channel/#хПВшАГш╡ДцЦЩ" class="sidebar-link">хПВшАГш╡ДцЦЩ</a></li></ul></li><li><a href="/echo-system-design/pages/397456/" class="sidebar-link">EventLoop ц║РчаБшзгцЮР</a></li><li><a href="/echo-system-design/pages/ce1f78/" class="sidebar-link">ChannelHandler ц║РчаБшзгцЮР</a></li><li><a href="/echo-system-design/pages/4234c0/" class="sidebar-link">ChannelPipeline ц║РчаБшзгцЮР</a></li><li><a href="/echo-system-design/pages/43eb30/" class="sidebar-link">ByteBuf ц║РчаБшзгцЮР</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>хЫЫуАБц╖▒хЕе Netty ца╕х┐Г</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ф║ФуАБц╖▒хЕе Netty хЖЕхнШчобчРЖ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/echo-system-design/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Netty ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>ф╕ЙуАБф╕╗ч║┐ф╗╗хКб</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Channel ц║РчаБшзгцЮР<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h2 id="чоАф╗Л"><a href="#чоАф╗Л" class="header-anchor">#</a> чоАф╗Л</h2> <p>Java NIO цШпчФ▒ Java 1.4 х╝Хш┐ЫчЪДх╝Вцне IO
Java NIO чФ▒ф╗еф╕ЛхЗаф╕кца╕х┐ГщГихИЖч╗ДцИР:</p> <ul><li>Channel</li> <li>Buffer</li> <li>Selector</li></ul> <h2 id="nio-хТМ-io-чЪДхп╣цпФ"><a href="#nio-хТМ-io-чЪДхп╣цпФ" class="header-anchor">#</a> NIO хТМ IO чЪДхп╣цпФ</h2> <p>IO хТМ NIO чЪДхМ║хИлф╕╗шжБф╜УчО░хЬиф╕Йф╕кцЦ╣щЭв:</p> <ul><li>IO хЯ║ф║Оц╡Б(Stream oriented)я╝МшАМ NIO хЯ║ф║О Buffer (Buffer oriented)</li> <li>IO цУНф╜ЬцШпщШ╗хбЮчЪД, шАМ NIO цУНф╜ЬцШпщЭЮщШ╗хбЮчЪД</li> <li>IO ц▓бцЬЙ selector цжВх┐╡, шАМ NIO цЬЙ selector цжВх┐╡.</li></ul> <h4 id="хЯ║ф║О-stream-ф╕О-хЯ║ф║О-buffer"><a href="#хЯ║ф║О-stream-ф╕О-хЯ║ф║О-buffer" class="header-anchor">#</a> хЯ║ф║О Stream ф╕О хЯ║ф║О Buffer</h4> <p>ф╝ач╗ЯчЪД IO цШпщЭвхРСхнЧшКВц╡БцИЦхнЧчмжц╡БчЪД, шАМхЬи NIO ф╕н, цИСф╗мцКЫх╝Гф║Жф╝ач╗ЯчЪД IO ц╡Б, шАМцШпх╝ХхЕеф║Ж <strong>Channel</strong> хТМ <strong>Buffer</strong> чЪДцжВх┐╡.</p> <p>хЬи NIO ф╕н, цИСхПкшГ╜ф╗О Channel ф╕ншп╗хПЦцХ░цНохИ░ Buffer ф╕нцИЦх░ЖцХ░цНоф╗О Buffer ф╕нхЖЩхЕехИ░ Channel</p> <p>щВгф╣Иф╗Аф╣ИцШп <strong>хЯ║ф║Оц╡Б</strong> хСв? хЬиф╕АшИмчЪД Java IO цУНф╜Ьф╕н, цИСф╗мф╗ец╡Бх╝ПчЪДцЦ╣х╝Пщб║х║ПхЬ░ф╗Оф╕Аф╕к Stream ф╕ншп╗хПЦф╕Аф╕кцИЦхдЪф╕кхнЧшКВ, хЫацндцИСф╗мф╣Ях░▒ф╕НшГ╜щЪПцДПцФ╣хПШшп╗хПЦцМЗщТИчЪДф╜Нч╜о</p> <p>шАМ <strong>хЯ║ф║О Buffer</strong> х░▒цШ╛х╛ЧцЬЙчВ╣ф╕НхРМф║Жя╝МцИСф╗мщжЦхЕИщЬАшжБф╗О Channel ф╕ншп╗хПЦцХ░цНохИ░ Buffer ф╕н, х╜У Buffer ф╕нцЬЙцХ░цНохРОя╝МцИСф╗мх░▒хПпф╗ехп╣ш┐Щф║ЫцХ░цНош┐ЫшбМцУНф╜Ьф║Жя╝Мф╕НхГП IO щВгца╖цШпщб║х║ПцУНф╜Ья╝МNIO ф╕нцИСф╗мхПпф╗ещЪПцДПхЬ░шп╗хПЦф╗╗цДПф╜Нч╜очЪДцХ░цНо</p> <h4 id="щШ╗хбЮ-хТМ-щЭЮщШ╗хбЮ"><a href="#щШ╗хбЮ-хТМ-щЭЮщШ╗хбЮ" class="header-anchor">#</a> щШ╗хбЮ хТМ щЭЮщШ╗хбЮ</h4> <p>Java цПРф╛ЫчЪДхРДчзН Stream цУНф╜ЬщГ╜цШпщШ╗хбЮчЪД, ф╛ЛхжВцИСф╗мш░ГчФиф╕Аф╕к read цЦ╣ц│Хшп╗хПЦф╕Аф╕кцЦЗф╗╢чЪДхЖЕхо╣, щВгф╣Иш░ГчФи read чЪДч║┐чиЛф╝ЪшвлщШ╗хбЮф╜П, чЫ┤хИ░ read цУНф╜ЬхоМцИР</p> <p>шАМ  NIO чЪДщЭЮщШ╗хбЮцибх╝ПхЕБшо╕цИСф╗мщЭЮщШ╗хбЮхЬ░ш┐ЫшбМ IO цУНф╜Ья╝Мф╛ЛхжВцИСф╗мщЬАшжБф╗Оч╜Сч╗Ьф╕ншп╗хПЦцХ░цНо, хЬи NIO чЪДщЭЮщШ╗хбЮцибх╝Пф╕ня╝Мх╜УцИСф╗мш░ГчФи read цЦ╣ц│ХцЧ╢я╝МхжВцЮЬцндцЧ╢цЬЙцХ░цНоя╝МхИЩ read шп╗хПЦх╣╢ш┐ФхЫЮя╝ЫхжВцЮЬцндцЧ╢ц▓бцЬЙцХ░цНоя╝М хИЩ read чЫ┤цОеш┐ФхЫЮя╝МшАМф╕Нф╝ЪщШ╗хбЮх╜УхЙНч║┐чиЛуАВ</p> <h4 id="selector"><a href="#selector" class="header-anchor">#</a> selector</h4> <p>selector цШп NIO ф╕нцЙНцЬЙчЪДцжВх┐╡, хоГцШп Java NIO ф╣ЛцЙАф╗ехПпф╗ещЭЮщШ╗хбЮхЬ░ш┐ЫшбМ IO цУНф╜ЬчЪДхЕ│щФо</p> <p>щАЪш┐З Selectorя╝Мф╕Аф╕кч║┐чиЛхПпф╗ечЫСхРмхдЪф╕к Channel чЪД IO ф║Лф╗╢я╝Мх╜УцИСф╗мхРСф╕Аф╕к Selector ф╕нц│ихЖМф║Ж Channel хРОя╝МSelector хЖЕщГичЪДцЬ║хИ╢х░▒хПпф╗ешЗкхКихЬ░ф╕║цИСф╗мф╕НцЦнхЬ░цЯешпвя╝Иselectя╝Йш┐Щф║Ыц│ихЖМчЪД Channel цШпхРжцЬЙх╖▓х░▒ч╗кчЪД IO ф║Лф╗╢я╝Иф╛ЛхжВхПпшп╗, хПпхЖЩ, ч╜Сч╗Ьш┐ЮцОехоМцИРчнЙя╝ЙуАВщАЪш┐Зш┐Щца╖чЪД Selector цЬ║хИ╢я╝МцИСф╗мх░▒хПпф╗ех╛ИчоАхНХхЬ░ф╜┐чФиф╕Аф╕кч║┐чиЛщлШцХИхЬ░чобчРЖхдЪф╕к Channel ф║Ж</p> <h2 id="java-nio-channel"><a href="#java-nio-channel" class="header-anchor">#</a> Java NIO Channel</h2> <p>щАЪх╕╕цЭешп┤я╝МцЙАцЬЙчЪД NIO чЪД I/O цУНф╜ЬщГ╜цШпф╗О Channel х╝АхзЛчЪДуАВф╕Аф╕к channel ч▒╗ф╝╝ф║Оф╕Аф╕к stream
java Stream хТМ NIO Channel хп╣цпФ</p> <ul><li>цИСф╗мхПпф╗ехЬихРМф╕Аф╕к Channel ф╕нцЙзшбМшп╗хТМхЖЩцУНф╜Ья╝МчД╢шАМхРМф╕Аф╕к Stream ф╗Еф╗ЕцФпцМБшп╗цИЦхЖЩ.</li> <li>Channel хПпф╗ех╝ВцнехЬ░шп╗хЖЩя╝МшАМ Stream цШпщШ╗хбЮчЪДхРМцнешп╗хЖЩ</li> <li>Channel цА╗цШпф╗О Buffer ф╕ншп╗хПЦцХ░цНоя╝МцИЦх░ЖцХ░цНохЖЩхЕехИ░ Buffer ф╕н</li></ul> <p>Channel ч▒╗хЮЛцЬЙя╝Ъ</p> <ul><li>FileChannelя╝МцЦЗф╗╢цУНф╜Ь</li> <li>DatagramChannelя╝МUDP цУНф╜Ь</li> <li>SocketChannelя╝МTCP цУНф╜Ь</li> <li>ServerSocketChannelя╝МTCP цУНф╜Ья╝Мф╜┐чФихЬицЬНхКбхЩичлп</li></ul> <p>ш┐Щф║ЫщАЪщБУц╢╡чЫЦф║Ж UDP хТМ TCPч╜Сч╗Ь IOф╗ехПКцЦЗф╗╢ IO
хЯ║цЬмчЪД Channel ф╜┐чФиф╛ЛхнРя╝Ъ</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{</span>
    <span class="token class-name">RandomAccessFile</span> aFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">&quot;/Users/echo/settings.xml&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileChannel</span> inChannel <span class="token operator">=</span> aFile<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    aFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="filechannel"><a href="#filechannel" class="header-anchor">#</a> FileChannel</h3> <p>FileChannel цШпцУНф╜ЬцЦЗф╗╢чЪД Channel, цИСф╗мхПпф╗ещАЪш┐З FileChannel ф╗Оф╕Аф╕кцЦЗф╗╢ф╕ншп╗хПЦцХ░цНо, ф╣ЯхПпф╗ех░ЖцХ░цНохЖЩхЕехИ░цЦЗф╗╢ф╕н</p> <p><strong><code>ц│ицДП</code></strong>, FileChannel ф╕НшГ╜шо╛ч╜оф╕║щЭЮщШ╗хбЮцибх╝П</p> <h4 id="цЙУх╝А-filechannel"><a href="#цЙУх╝А-filechannel" class="header-anchor">#</a> цЙУх╝А FileChannel</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">RandomAccessFile</span> aFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span><span class="token string">&quot;data/nio-data.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FileChannel</span>  inChannel <span class="token operator">=</span> aFile<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ф╗О-filechannel-ф╕ншп╗хПЦцХ░цНо"><a href="#ф╗О-filechannel-ф╕ншп╗хПЦцХ░цНо" class="header-anchor">#</a> ф╗О FileChannel ф╕ншп╗хПЦцХ░цНо</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="хЖЩхЕецХ░цНо"><a href="#хЖЩхЕецХ░цНо" class="header-anchor">#</a> хЖЩхЕецХ░цНо</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> newData <span class="token operator">=</span> <span class="token string">&quot;New String to write to file...&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="хЕ│щЧн"><a href="#хЕ│щЧн" class="header-anchor">#</a> хЕ│щЧн</h4> <p>х╜УцИСф╗мхп╣ FileChannel чЪДцУНф╜ЬхоМцИРхРО, х┐Ещб╗х░ЖхЕ╢хЕ│щЧн</p> <div class="language-java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="шо╛ч╜о-position"><a href="#шо╛ч╜о-position" class="header-anchor">#</a> шо╛ч╜о position</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">long</span> pos channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="цЦЗф╗╢хдзх░П"><a href="#цЦЗф╗╢хдзх░П" class="header-anchor">#</a> цЦЗф╗╢хдзх░П</h4> <p>цИСф╗мхПпф╗ещАЪш┐З channel.size()шО╖хПЦхЕ│шБФхИ░ш┐Щф╕к Channel ф╕нчЪДцЦЗф╗╢чЪДхдзх░П. <strong>ц│ицДП</strong>, ш┐ЩщЗМш┐ФхЫЮчЪДцШпцЦЗф╗╢чЪДхдзх░П, шАМф╕НцШп Channel ф╕нхЙйф╜ЩчЪДхЕГч┤аф╕кцХ░.</p> <h4 id="цИкцЦнцЦЗф╗╢"><a href="#цИкцЦнцЦЗф╗╢" class="header-anchor">#</a> цИкцЦнцЦЗф╗╢</h4> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">truncate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>х░ЖцЦЗф╗╢чЪДхдзх░ПцИкцЦнф╕║1024хнЧшКВ.</p> <h4 id="х╝║хИ╢хЖЩхЕе"><a href="#х╝║хИ╢хЖЩхЕе" class="header-anchor">#</a> х╝║хИ╢хЖЩхЕе</h4> <p>цИСф╗мхПпф╗ех╝║хИ╢х░Жч╝УхнШчЪДцЬкхЖЩхЕечЪДцХ░цНохЖЩхЕехИ░цЦЗф╗╢ф╕н:</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">force</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="socketchannel"><a href="#socketchannel" class="header-anchor">#</a> SocketChannel</h3> <p>SocketChannel цШпф╕Аф╕кховцИ╖члпчФицЭеш┐ЫшбМ TCP ш┐ЮцОечЪД Channel.
хИЫх╗║ф╕Аф╕к SocketChannel чЪДцЦ╣ц│ХцЬЙф╕дчзН:</p> <ul><li>цЙУх╝Аф╕Аф╕к SocketChannel, чД╢хРОх░ЖхЕ╢ш┐ЮцОехИ░цЯРф╕кцЬНхКбхЩиф╕н</li> <li>х╜Уф╕Аф╕к ServerSocketChannel цОехПЧхИ░ш┐ЮцОешп╖ц▒ВцЧ╢, ф╝Ъш┐ФхЫЮф╕Аф╕к SocketChannel хп╣ш▒б.</li></ul> <h4 id="цЙУх╝А-socketchannel"><a href="#цЙУх╝А-socketchannel" class="header-anchor">#</a> цЙУх╝А SocketChannel</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span> <span class="token class-name">SocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="хЕ│щЧн-2"><a href="#хЕ│щЧн-2" class="header-anchor">#</a> хЕ│щЧн</h4> <div class="language-Java extra-class"><pre class="language-java"><code>socketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h4 id="шп╗хПЦцХ░цНо"><a href="#шп╗хПЦцХ░цНо" class="header-anchor">#</a> шп╗хПЦцХ░цНо</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> bytesRead <span class="token operator">=</span> socketChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>хжВцЮЬ read()ш┐ФхЫЮ <strong>-1</strong>, щВгф╣Ишбичд║ш┐ЮцОеф╕нцЦнф║Ж.</p> <h4 id="хЖЩхЕецХ░цНо-2"><a href="#хЖЩхЕецХ░цНо-2" class="header-anchor">#</a> хЖЩхЕецХ░цНо</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> newData <span class="token operator">=</span> <span class="token string">&quot;New String to write to file...&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    channel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="щЭЮщШ╗хбЮцибх╝П"><a href="#щЭЮщШ╗хбЮцибх╝П" class="header-anchor">#</a> щЭЮщШ╗хбЮцибх╝П</h4> <p>цИСф╗мхПпф╗ешо╛ч╜о SocketChannel ф╕║х╝Вцнецибх╝П, ш┐Щца╖цИСф╗мчЪД connect, read, write щГ╜цШпх╝ВцнечЪДф║Ж.</p> <h5 id="ш┐ЮцОе"><a href="#ш┐ЮцОе" class="header-anchor">#</a> ш┐ЮцОе</h5> <div class="language-Java extra-class"><pre class="language-java"><code>socketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socketChannel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;http://example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span> socketChannel<span class="token punctuation">.</span><span class="token function">finishConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//wait, or do something else...    </span>
<span class="token punctuation">}</span>
</code></pre></div><p>хЬих╝Вцнецибх╝Пф╕н, цИЦшо╕ш┐ЮцОеш┐Шц▓бцЬЙх╗║члЛ, connect цЦ╣ц│Хх░▒ш┐ФхЫЮф║Ж, хЫацндцИСф╗мщЬАшжБцгАцЯех╜УхЙНцШпхРжцШпш┐ЮцОехИ░ф║Жф╕╗цЬ║, хЫацндщАЪш┐Зф╕Аф╕к while х╛кчОпцЭехИдцЦн.</p> <h5 id="шп╗хЖЩ"><a href="#шп╗хЖЩ" class="header-anchor">#</a> шп╗хЖЩ</h5> <p>хЬих╝Вцнецибх╝Пф╕Л, шп╗хЖЩчЪДцЦ╣х╝ПцШпф╕Аца╖чЪД.
хЬишп╗хПЦцЧ╢, хЫаф╕║цШпх╝ВцнечЪД, хЫацндцИСф╗мх┐Ещб╗цгАцЯе read чЪДш┐ФхЫЮхА╝, цЭехИдцЦнх╜УхЙНцШпхРжшп╗хПЦхИ░ф║ЖцХ░цНо.</p> <h3 id="serversocketchannel"><a href="#serversocketchannel" class="header-anchor">#</a> ServerSocketChannel</h3> <p>ServerSocketChannel щб╛хРНцАЭф╣Й, цШпчФихЬицЬНхКбхЩиф╕║члпчЪД, хПпф╗ечЫСхРмховцИ╖члпчЪД TCP ш┐ЮцОе, ф╛ЛхжВ:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//do something with socketChannel...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="цЙУх╝А-хЕ│щЧн"><a href="#цЙУх╝А-хЕ│щЧн" class="header-anchor">#</a> цЙУх╝А хЕ│щЧн</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-Java extra-class"><pre class="language-java"><code>serverSocketChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="чЫСхРмш┐ЮцОе"><a href="#чЫСхРмш┐ЮцОе" class="header-anchor">#</a> чЫСхРмш┐ЮцОе</h4> <p>цИСф╗мхПпф╗еф╜┐чФиServerSocketChannel.accept()цЦ╣ц│ХцЭечЫСхРмховцИ╖члпчЪД TCP ш┐ЮцОешп╖ц▒В, accept()цЦ╣ц│Хф╝ЪщШ╗хбЮ, чЫ┤хИ░цЬЙш┐ЮцОехИ░цЭе, х╜УцЬЙш┐ЮцОецЧ╢, ш┐Щф╕кцЦ╣ц│Хф╝Ъш┐ФхЫЮф╕Аф╕к SocketChannel хп╣ш▒б:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//do something with socketChannel...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="щЭЮщШ╗хбЮцибх╝П-2"><a href="#щЭЮщШ╗хбЮцибх╝П-2" class="header-anchor">#</a> щЭЮщШ╗хбЮцибх╝П</h4> <p>хЬищЭЮщШ╗хбЮцибх╝Пф╕Л, accept()цШпщЭЮщШ╗хбЮчЪД, хЫацндхжВцЮЬцндцЧ╢ц▓бцЬЙш┐ЮцОехИ░цЭе, щВгф╣И accept()цЦ╣ц│Хф╝Ъш┐ФхЫЮnull:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">SocketChannel</span> socketChannel <span class="token operator">=</span>
            serverSocketChannel<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>socketChannel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//do something with socketChannel...</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="datagramchannel"><a href="#datagramchannel" class="header-anchor">#</a> DatagramChannel</h3> <p>DatagramChannel цШпчФицЭехдДчРЖ UDP ш┐ЮцОечЪД.</p> <h4 id="цЙУх╝А"><a href="#цЙУх╝А" class="header-anchor">#</a> цЙУх╝А</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">DatagramChannel</span> channel <span class="token operator">=</span> <span class="token class-name">DatagramChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="шп╗хПЦцХ░цНо-2"><a href="#шп╗хПЦцХ░цНо-2" class="header-anchor">#</a> шп╗хПЦцХ░цНо</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

channel<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="хПСщАБцХ░цНо"><a href="#хПСщАБцХ░цНо" class="header-anchor">#</a> хПСщАБцХ░цНо</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> newData <span class="token operator">=</span> <span class="token string">&quot;New String to write to file...&quot;</span>
                    <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>newData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> bytesSent <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ш┐ЮцОехИ░цМЗхоЪхЬ░хЭА"><a href="#ш┐ЮцОехИ░цМЗхоЪхЬ░хЭА" class="header-anchor">#</a> ш┐ЮцОехИ░цМЗхоЪхЬ░хЭА</h4> <p>хЫаф╕║ UDP цШпщЭЮш┐ЮцОечЪД, хЫацндш┐Щф╕кчЪД connect х╣╢ф╕НцШпхРС TCP ф╕Аца╖чЬЯцнгцДПф╣Йф╕КчЪДш┐ЮцОе, шАМцШпхоГф╝Ъшо▓ DatagramChannel щФБф╜П, хЫацндцИСф╗мф╗Еф╗ЕхПпф╗еф╗ОцМЗхоЪчЪДхЬ░хЭАф╕ншп╗хПЦцИЦхЖЩхЕецХ░цНо.</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;example.com&quot;</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="java-nio-buffer"><a href="#java-nio-buffer" class="header-anchor">#</a> Java NIO Buffer</h2> <p>х╜УцИСф╗мщЬАшжБф╕О NIO Channel ш┐ЫшбМф║дф║ТцЧ╢, цИСф╗мх░▒щЬАшжБф╜┐чФихИ░ NIO Buffer, хН│цХ░цНоф╗О Bufferшп╗хПЦхИ░ Channel ф╕н, х╣╢ф╕Фф╗О Channel ф╕нхЖЩхЕехИ░ Buffer ф╕н.
хоЮщЩЕф╕К, ф╕Аф╕к Buffer хЕ╢хоЮх░▒цШпф╕АхЭЧхЖЕхнШхМ║хЯЯ, цИСф╗мхПпф╗ехЬиш┐Щф╕кхЖЕхнШхМ║хЯЯф╕нш┐ЫшбМцХ░цНочЪДшп╗хЖЩ. NIO Buffer хЕ╢хоЮцШпш┐Щца╖чЪДхЖЕхнШхЭЧчЪДф╕Аф╕кх░БшгЕ, х╣╢цПРф╛Ыф║Жф╕Аф║ЫцУНф╜ЬцЦ╣ц│ХшойцИСф╗мшГ╜хдЯцЦ╣ф╛┐хЬ░ш┐ЫшбМцХ░цНочЪДшп╗хЖЩ.
Buffer ч▒╗хЮЛцЬЙ:</p> <ul><li>ByteBuffer</li> <li>CharBuffer</li> <li>DoubleBuffer</li> <li>FloatBuffer</li> <li>IntBuffer</li> <li>LongBuffer</li> <li>ShortBuffer</li></ul> <p>ш┐Щф║Ы Buffer шжЖчЫЦф║ЖшГ╜ф╗О IO ф╕нф╝аш╛УчЪДцЙАцЬЙчЪД Java хЯ║цЬмцХ░цНоч▒╗хЮЛ.</p> <h3 id="nio-buffer-чЪДхЯ║цЬмф╜┐чФи"><a href="#nio-buffer-чЪДхЯ║цЬмф╜┐чФи" class="header-anchor">#</a> NIO Buffer чЪДхЯ║цЬмф╜┐чФи</h3> <p>ф╜┐чФи NIO Buffer чЪДцнещкдхжВф╕Л:</p> <ul><li>х░ЖцХ░цНохЖЩхЕехИ░ Buffer ф╕н.</li> <li>ш░ГчФи Buffer.flip() цЦ╣ц│Х, х░Ж NIO Buffer ш╜мцНвф╕║шп╗цибх╝П.</li> <li>ф╗О Buffer ф╕ншп╗хПЦцХ░цНо</li> <li>ш░ГчФи Buffer.clear() цИЦ Buffer.compact()цЦ╣ц│Х, х░Ж Buffer ш╜мцНвф╕║хЖЩцибх╝П.</li></ul> <p>х╜УцИСф╗мх░ЖцХ░цНохЖЩхЕехИ░ Buffer ф╕нцЧ╢, Buffer ф╝Ъшо░х╜ХцИСф╗мх╖▓ч╗ПхЖЩф║ЖхдЪх░СчЪДцХ░цНо, х╜УцИСф╗мщЬАшжБф╗О Buffer ф╕ншп╗хПЦцХ░цНоцЧ╢, х┐Ещб╗ш░ГчФи Buffer.flip()х░Ж Buffer хИЗцНвф╕║шп╗цибх╝П.
ф╕АцЧжшп╗хПЦф║ЖцЙАцЬЙчЪД Buffer цХ░цНо, щВгф╣ИцИСф╗мх┐Ещб╗ц╕ЕчРЖ Buffer, шойхЕ╢ф╗ОцЦ░хПпхЖЩ, ц╕ЕчРЖ Buffer хПпф╗еш░ГчФи Buffer.clear() цИЦ Buffer.compact().
ф╛ЛхжВ:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12345678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕Кш┐░ф╕н, цИСф╗мхИЖщЕНф╕дф╕кхНХф╜Нхдзх░ПчЪД IntBuffer, хЫацндхоГхПпф╗ехЖЩхЕеф╕дф╕к int хА╝.
цИСф╗мф╜┐чФи put цЦ╣ц│Хх░Ж int хА╝хЖЩхЕе, чД╢хРОф╜┐чФи flip цЦ╣ц│Хх░Ж buffer ш╜мцНвф╕║шп╗цибх╝П, чД╢хРОш┐Юч╗нф╜┐чФи get цЦ╣ц│Хф╗О buffer ф╕ншО╖хПЦш┐Щф╕дф╕к int хА╝.
<code>цпПх╜Уш░ГчФиф╕Ацмб get цЦ╣ц│Хшп╗хПЦцХ░цНоцЧ╢, buffer чЪДшп╗цМЗщТИщГ╜ф╝ЪхРСхЙНчз╗хКиф╕Аф╕кхНХф╜НщХ┐х║ж(хЬиш┐ЩщЗМцШпф╕Аф╕к int щХ┐х║ж)</code></p> <h3 id="buffer-х▒ЮцАз"><a href="#buffer-х▒ЮцАз" class="header-anchor">#</a> Buffer х▒ЮцАз</h3> <p>ф╕Аф╕к Buffer цЬЙф╕Йф╕кх▒ЮцАз:</p> <ul><li>capacity</li> <li>position</li> <li>limit</li></ul> <p>хЕ╢ф╕н <strong>position</strong> хТМ <strong>limit</strong> чЪДхРлф╣Йф╕О Buffer хдДф║Ошп╗цибх╝ПцИЦхЖЩцибх╝ПцЬЙхЕ│, шАМ capacity чЪДхРлф╣Йф╕О Buffer цЙАхдДчЪДцибх╝ПцЧахЕ│.</p> <h4 id="capacity"><a href="#capacity" class="header-anchor">#</a> Capacity</h4> <p>ф╕Аф╕кхЖЕхнШхЭЧф╝ЪцЬЙф╕Аф╕кхЫ║хоЪчЪДхдзх░П, хН│хо╣щЗП(capacity), цИСф╗мцЬАхдЪхЖЩхЕе<strong>capacity</strong> ф╕кхНХф╜НчЪДцХ░цНохИ░ Buffer ф╕н, ф╛ЛхжВф╕Аф╕к DoubleBuffer, хЕ╢ Capacity цШп100, щВгф╣ИцИСф╗мцЬАхдЪхПпф╗ехЖЩхЕе100ф╕к double цХ░цНо.</p> <h4 id="position"><a href="#position" class="header-anchor">#</a> Position</h4> <p>х╜Уф╗Оф╕Аф╕к Buffer ф╕нхЖЩхЕецХ░цНоцЧ╢, цИСф╗мцШпф╗О Buffer чЪДф╕Аф╕кчбохоЪчЪДф╜Нч╜о(position)х╝АхзЛхЖЩхЕечЪД. хЬицЬАхИЭчЪДчК╢цАБцЧ╢, position чЪДхА╝цШп0. цпПх╜УцИСф╗мхЖЩхЕеф║Жф╕Аф╕кхНХф╜НчЪДцХ░цНохРО, position х░▒ф╝ЪщАТхвЮф╕А.
х╜УцИСф╗мф╗О Buffer ф╕ншп╗хПЦцХ░цНоцЧ╢, цИСф╗мф╣ЯцШпф╗ОцЯРф╕кчЙ╣хоЪчЪДф╜Нч╜ох╝АхзЛшп╗хПЦчЪД. <strong>х╜УцИСф╗мш░ГчФиф║Ж filp()цЦ╣ц│Хх░Ж Buffer ф╗ОхЖЩцибх╝Пш╜мцНвхИ░шп╗цибх╝ПцЧ╢, position чЪДхА╝ф╝ЪшЗкхКишвлшо╛ч╜оф╕║0,</strong> цпПх╜УцИСф╗мшп╗хПЦф╕Аф╕кхНХф╜НчЪДцХ░цНо, position чЪДхА╝щАТхвЮ1.
<strong>position</strong> шбичд║ф║Жшп╗хЖЩцУНф╜ЬчЪДф╜Нч╜оцМЗщТИ.</p> <h4 id="limit"><a href="#limit" class="header-anchor">#</a> limit</h4> <p><code>limit - position шбичд║цндцЧ╢ш┐ШхПпф╗ехЖЩхЕе/шп╗хПЦхдЪх░СхНХф╜НчЪДцХ░цНо.</code>
ф╛ЛхжВхЬихЖЩцибх╝П, хжВцЮЬцндцЧ╢ limit цШп10, position цШп2, хИЩшбичд║х╖▓ч╗ПхЖЩхЕеф║Ж2ф╕кхНХф╜НчЪДцХ░цНо, ш┐ШхПпф╗ехЖЩхЕе 10 - 2 = 8 ф╕кхНХф╜НчЪДцХ░цНо.</p> <h4 id="ф╛ЛхнР"><a href="#ф╛ЛхнР" class="header-anchor">#</a> ф╛ЛхнР:</h4> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Write mode: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tCapacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tPosition: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tLimit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Read mode: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tCapacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tPosition: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\tLimit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐ЩщЗМцИСф╗мщжЦхЕИхЖЩхЕеф╕дф╕к int хА╝, цндцЧ╢ capacity = 10, position = 2, limit = 10.
чД╢хРОцИСф╗мш░ГчФи flip ш╜мцНвф╕║шп╗цибх╝П, цндцЧ╢ capacity = 10, position = 0, limit = 2;</p> <h3 id="хИЖщЕН-buffer"><a href="#хИЖщЕН-buffer" class="header-anchor">#</a> хИЖщЕН Buffer</h3> <p>ф╕║ф║ЖшО╖хПЦф╕Аф╕к Buffer хп╣ш▒б, цИСф╗мщжЦхЕИщЬАшжБхИЖщЕНхЖЕхнШчй║щЧ┤. цпПф╕кч▒╗хЮЛчЪД Buffer щГ╜цЬЙф╕Аф╕к allocate()цЦ╣ц│Х, цИСф╗мхПпф╗ещАЪш┐Зш┐Щф╕кцЦ╣ц│ХхИЖщЕН Buffer:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ш┐ЩщЗМцИСф╗мхИЖщЕНф║Ж48 * sizeof(Byte)хнЧшКВчЪДхЖЕхнШчй║щЧ┤.</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">CharBuffer</span> buf <span class="token operator">=</span> <span class="token class-name">CharBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ш┐ЩщЗМцИСф╗мхИЖщЕНф║Жхдзх░Пф╕║1024ф╕кхнЧчмжчЪД Buffer, хН│ ш┐Щф╕к Buffer хПпф╗ехнШхВи1024 ф╕к Char, хЕ╢хдзх░Пф╕║ 1024 * 2 ф╕кхнЧшКВ.</p> <h3 id="хЕ│ф║О-direct-buffer-хТМ-non-direct-buffer-чЪДхМ║хИл"><a href="#хЕ│ф║О-direct-buffer-хТМ-non-direct-buffer-чЪДхМ║хИл" class="header-anchor">#</a> хЕ│ф║О Direct Buffer хТМ Non-Direct Buffer чЪДхМ║хИл</h3> <p><strong>Direct Buffer:</strong></p> <ul><li>цЙАхИЖщЕНчЪДхЖЕхнШф╕НхЬи JVM хаЖф╕К, ф╕НхПЧ GC чЪДчобчРЖ.(ф╜ЖцШп Direct Buffer чЪД Java хп╣ш▒бцШпчФ▒ GC чобчРЖчЪД, хЫацндх╜УхПСчФЯ GC, хп╣ш▒бшвлхЫЮцФ╢цЧ╢, Direct Buffer ф╣Яф╝ЪшвлщЗКцФ╛)</li> <li>хЫаф╕║ Direct Buffer  ф╕НхЬи JVM хаЖф╕КхИЖщЕН, хЫацнд Direct Buffer хп╣х║ФчФичиЛх║ПчЪДхЖЕхнШхНачФичЪДх╜▒хУНх░▒ф╕НщВгф╣ИцШОцШ╛(хоЮщЩЕф╕Кш┐ШцШпхНачФиф║Жш┐Щф╣ИхдЪхЖЕхнШ, ф╜ЖцШп JVM ф╕Нхе╜ч╗ЯшобхИ░щЭЮ JVM чобчРЖчЪДхЖЕхнШ.)</li> <li>чФ│шп╖хТМщЗКцФ╛ Direct Buffer чЪДх╝АщФАцпФш╛Гхдз. хЫацндцнгчбочЪДф╜┐чФи Direct Buffer чЪДцЦ╣х╝ПцШпхЬихИЭхзЛхМЦцЧ╢чФ│шп╖ф╕Аф╕к Buffer, чД╢хРОф╕НцЦнхдНчФицнд buffer, хЬичиЛх║Пч╗УцЭЯхРОцЙНщЗКцФ╛цнд buffer.</li> <li>ф╜┐чФи Direct Buffer цЧ╢, х╜Уш┐ЫшбМф╕Аф║Ых║Хх▒ВчЪДч│╗ч╗Я IO цУНф╜ЬцЧ╢, цХИчОЗф╝ЪцпФш╛ГщлШ, хЫаф╕║цндцЧ╢ JVM ф╕НщЬАшжБцЛ╖ш┤Э buffer ф╕нчЪДхЖЕхнШхИ░ф╕нщЧ┤ф╕┤цЧ╢ч╝УхЖ▓хМ║ф╕н.</li></ul> <p><strong>Non-Direct Buffer:</strong></p> <ul><li>чЫ┤цОехЬи JVM хаЖф╕Кш┐ЫшбМхЖЕхнШчЪДхИЖщЕН, цЬмш┤иф╕КцШп byte[] цХ░ч╗ДчЪДх░БшгЕ.</li> <li>хЫаф╕║ Non-Direct Buffer хЬи JVM хаЖф╕н, хЫацндх╜Уш┐ЫшбМцУНф╜Ьч│╗ч╗Ях║Хх▒В IO цУНф╜Ьф╕нцЧ╢, ф╝Ъх░Жцнд buffer чЪДхЖЕхнШхдНхИ╢хИ░ф╕нщЧ┤ф╕┤цЧ╢ч╝УхЖ▓хМ║ф╕н. хЫацнд Non-Direct Buffer чЪДцХИчОЗх░▒ш╛Гф╜О.</li></ul> <h3 id="хЖЩхЕецХ░цНохИ░-buffer"><a href="#хЖЩхЕецХ░цНохИ░-buffer" class="header-anchor">#</a> хЖЩхЕецХ░цНохИ░ Buffer</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> bytesRead <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//read into buffer.</span>
buf<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ф╗О-buffer-ф╕ншп╗хПЦцХ░цНо"><a href="#ф╗О-buffer-ф╕ншп╗хПЦцХ░цНо" class="header-anchor">#</a> ф╗О Buffer ф╕ншп╗хПЦцХ░цНо</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token comment">//read from buffer into channel.</span>
<span class="token keyword">int</span> bytesWritten <span class="token operator">=</span> inChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span> aByte <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="щЗНч╜о-position"><a href="#щЗНч╜о-position" class="header-anchor">#</a> щЗНч╜о position</h3> <p>Buffer.rewind()цЦ╣ц│ХхПпф╗ещЗНч╜о position чЪДхА╝ф╕║0, хЫацндцИСф╗мхПпф╗ещЗНцЦ░шп╗хПЦ/хЖЩхЕе Buffer ф║Ж.
хжВцЮЬцШпшп╗цибх╝П, хИЩщЗНч╜очЪДцШпшп╗цибх╝ПчЪД position, хжВцЮЬцШпхЖЩцибх╝П, хИЩщЗНч╜очЪДцШпхЖЩцибх╝ПчЪД position.
ф╛ЛхжВ:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        intBuffer<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        intBuffer<span class="token punctuation">.</span><span class="token function">rewind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>rewind() ф╕╗шжБщТИхп╣ф║Ошп╗цибх╝П. хЬишп╗цибх╝ПцЧ╢, шп╗хПЦхИ░ limit хРО, хПпф╗еш░ГчФи rewind() цЦ╣ц│Х, х░Жшп╗ position ч╜оф╕║0.</code></p> <h3 id="хЕ│ф║О-mark-хТМ-reset"><a href="#хЕ│ф║О-mark-хТМ-reset" class="header-anchor">#</a> хЕ│ф║О mark()хТМ reset()</h3> <p>цИСф╗мхПпф╗ещАЪш┐Зш░ГчФи Buffer.mark()х░Жх╜УхЙНчЪД position чЪДхА╝ф┐ЭхнШш╡╖цЭе, щЪПхРОхПпф╗ещАЪш┐Зш░ГчФи Buffer.reset()цЦ╣ц│Хх░Ж position чЪДхА╝хЫЮхдНхЫЮцЭе.
ф╛ЛхжВ:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">mark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intBuffer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐ЩщЗМцИСф╗мхЖЩхЕеф╕дф╕к int хА╝, чД╢хРОщжЦхЕИшп╗хПЦф║Жф╕Аф╕кхА╝. цндцЧ╢шп╗ position чЪДхА╝ф╕║1.
цОечЭАцИСф╗мш░ГчФи mark() цЦ╣ц│Хх░Жх╜УхЙНчЪД position ф┐ЭхнШш╡╖цЭе(хЬишп╗цибх╝П, хЫацндф┐ЭхнШчЪДцШпшп╗чЪД position), чД╢хРОхЖНцмбшп╗хПЦ, цндцЧ╢ position х░▒цШп2ф║Ж.
цОечЭАф╜┐чФи reset() цБвхдНхОЯцЭечЪДшп╗ position, хЫацндшп╗ position х░▒ф╕║1, хПпф╗ехЖНцмбшп╗хПЦцХ░цНо.</p> <h3 id="flip-rewind-хТМ-clear-чЪДхМ║хИл"><a href="#flip-rewind-хТМ-clear-чЪДхМ║хИл" class="header-anchor">#</a> flip, rewind хТМ clear чЪДхМ║хИл</h3> <h4 id="flip"><a href="#flip" class="header-anchor">#</a> flip</h4> <p>цЦ╣ц│Хц║РчаБ:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Buffer</span> <span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    limit <span class="token operator">=</span> position<span class="token punctuation">;</span>
    position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    mark <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Buffer чЪДшп╗/хЖЩцибх╝ПхЕ▒чФиф╕Аф╕к position хТМ limit хПШщЗП.
х╜Уф╗ОхЖЩцибх╝ПхПШф╕║шп╗цибх╝ПцЧ╢, хОЯхЕИчЪД <strong>хЖЩ position</strong> х░▒хПШцИРф║Жшп╗цибх╝ПчЪД <strong>limit</strong>.</p> <h4 id="rewind"><a href="#rewind" class="header-anchor">#</a> rewind</h4> <p>цЦ╣ц│Хц║РчаБ</p> <div class="language- extra-class"><pre class="language-text"><code>public final Buffer rewind() {
    position = 0;
    mark = -1;
    return this;
}
</code></pre></div><p>rewind, хН│хАТх╕ж, ш┐Щф╕кцЦ╣ц│Хф╗Еф╗ЕцШпх░Ж position ч╜оф╕║0.</p> <h4 id="clear"><a href="#clear" class="header-anchor">#</a> clear</h4> <p>цЦ╣ц│Хц║РчаБ:</p> <div class="language- extra-class"><pre class="language-text"><code>public final Buffer clear() {
    position = 0;
    limit = capacity;
    mark = -1;
    return this;
}
</code></pre></div><p>ца╣цНоц║РчаБцИСф╗мхПпф╗ечЯещБУ, clear х░Ж positin шо╛ч╜оф╕║0, х░Ж limit шо╛ч╜оф╕║ capacity.
clear цЦ╣ц│Хф╜┐чФихЬ║цЩп:</p> <ul><li>хЬиф╕Аф╕кх╖▓ч╗ПхЖЩц╗бцХ░цНочЪД buffer ф╕н, ш░ГчФи clear, хПпф╗еф╗Охд┤шп╗хПЦ buffer чЪДцХ░цНо.</li> <li>ф╕║ф║Жх░Жф╕Аф╕к buffer хблхЕЕц╗бцХ░цНо, хПпф╗еш░ГчФи clear, чД╢хРОф╕АчЫ┤хЖЩхЕе, чЫ┤хИ░ш╛╛хИ░ limit.</li></ul> <h5 id="ф╛ЛхнР-2"><a href="#ф╛ЛхнР-2" class="header-anchor">#</a> ф╛ЛхнР:</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">IntBuffer</span> intBuffer <span class="token operator">=</span> <span class="token class-name">IntBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intBuffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;limit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ш┐ЩщЗМф╕НшГ╜шп╗, хЫаф╕║ limit == position == 0, ц▓бцЬЙцХ░цНо.</span>
<span class="token comment">//System.err.println(intBuffer.get());</span>

intBuffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;position: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;limit: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;capacity: &quot;</span> <span class="token operator">+</span> intBuffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ш┐ЩщЗМхПпф╗ешп╗хПЦцХ░цНоф║Ж, хЫаф╕║ clear хРО, limit == capacity == 2, position == 0,</span>
<span class="token comment">// хН│ф╜┐цИСф╗мц▓бцЬЙхЖЩхЕеф╗╗ф╜ХчЪДцХ░цНохИ░ buffer ф╕н.</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// шп╗хПЦхИ░0</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intBuffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// шп╗хПЦхИ░0</span>
</code></pre></div><h3 id="buffer-чЪДцпФш╛Г"><a href="#buffer-чЪДцпФш╛Г" class="header-anchor">#</a> Buffer чЪДцпФш╛Г</h3> <p>цИСф╗мхПпф╗ещАЪш┐З equals() цИЦ compareTo() цЦ╣ц│ХцпФш╛Гф╕дф╕к Buffer, х╜Уф╕Фф╗Ех╜УхжВф╕ЛцЭбф╗╢ц╗бш╢│цЧ╢, ф╕дф╕к Buffer цШпчЫ╕чнЙчЪД:</p> <ul><li>ф╕дф╕к Buffer цШпчЫ╕хРМч▒╗хЮЛчЪД</li> <li>ф╕дф╕к Buffer чЪДхЙйф╜ЩчЪДцХ░цНоф╕кцХ░цШпчЫ╕хРМчЪД</li> <li>ф╕дф╕к Buffer чЪДхЙйф╜ЩчЪДцХ░цНощГ╜цШпчЫ╕хРМчЪД.</li></ul> <p>щАЪш┐Зф╕Кш┐░цЭбф╗╢цИСф╗мхПпф╗ехПСчО░, цпФш╛Гф╕дф╕к Buffer цЧ╢, х╣╢ф╕НцШп Buffer ф╕нчЪДцпПф╕кхЕГч┤ащГ╜ш┐ЫшбМцпФш╛Г, шАМцШпцпФш╛Г Buffer ф╕нхЙйф╜ЩчЪДхЕГч┤а.</p> <h2 id="selector-2"><a href="#selector-2" class="header-anchor">#</a> Selector</h2> <p>Selector хЕБшо╕ф╕Аф╕кхНХф╕АчЪДч║┐чиЛцЭецУНф╜ЬхдЪф╕к Channel. хжВцЮЬцИСф╗мчЪДх║ФчФичиЛх║Пф╕нф╜┐чФиф║ЖхдЪф╕к Channel, щВгф╣Иф╜┐чФи Selector х╛ИцЦ╣ф╛┐чЪДхоЮчО░ш┐Щца╖чЪДчЫочЪД, ф╜ЖцШпхЫаф╕║хЬиф╕Аф╕кч║┐чиЛф╕нф╜┐чФиф║ЖхдЪф╕к Channel, хЫацндф╣Яф╝ЪщАацИРф║ЖцпПф╕к Channel ф╝аш╛УцХИчОЗчЪДщЩНф╜О.
ф╜┐чФи Selector чЪДхЫ╛шзгхжВф╕Л:</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409182145772.png" alt="image-20240918214545698"></p> <p>ф╕║ф║Жф╜┐чФи Selector, цИСф╗мщжЦхЕИщЬАшжБх░Ж Channel ц│ихЖМхИ░ Selector ф╕н, щЪПхРОш░ГчФи Selector чЪД select() цЦ╣ц│Х, ш┐Щф╕кцЦ╣ц│Хф╝ЪщШ╗хбЮ, чЫ┤хИ░ц│ихЖМхЬи Selector ф╕нчЪД Channel хПСщАБхПпшп╗хЖЩф║Лф╗╢. х╜Уш┐Щф╕кцЦ╣ц│Хш┐ФхЫЮхРО, х╜УхЙНчЪДш┐Щф╕кч║┐чиЛх░▒хПпф╗ехдДчРЖ Channel чЪДф║Лф╗╢ф║Ж.</p> <h3 id="хИЫх╗║щАЙцЛйхЩи"><a href="#хИЫх╗║щАЙцЛйхЩи" class="header-anchor">#</a> хИЫх╗║щАЙцЛйхЩи</h3> <p>щАЪш┐З Selector.open()цЦ╣ц│Х, цИСф╗мхПпф╗ехИЫх╗║ф╕Аф╕кщАЙцЛйхЩи:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="х░Ж-channel-ц│ихЖМхИ░щАЙцЛйхЩиф╕н"><a href="#х░Ж-channel-ц│ихЖМхИ░щАЙцЛйхЩиф╕н" class="header-anchor">#</a> х░Ж Channel ц│ихЖМхИ░щАЙцЛйхЩиф╕н</h3> <p>ф╕║ф║Жф╜┐чФищАЙцЛйхЩичобчРЖ Channel, цИСф╗мщЬАшжБх░Ж Channel ц│ихЖМхИ░щАЙцЛйхЩиф╕н:</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><strong><code>ц│ицДП</code></strong>, хжВцЮЬф╕Аф╕к Channel шжБц│ихЖМхИ░ Selector ф╕н, щВгф╣Иш┐Щф╕к Channel х┐Ещб╗цШпщЭЮщШ╗хбЮчЪД, хН│channel.configureBlocking(false);
хЫаф╕║ Channel х┐Ещб╗шжБцШпщЭЮщШ╗хбЮчЪД, хЫацнд FileChannel цШпф╕НшГ╜хдЯф╜┐чФищАЙцЛйхЩичЪД, хЫаф╕║ FileChannel щГ╜цШпщШ╗хбЮчЪД.</p></blockquote> <p>ц│ицДПхИ░, хЬиф╜┐чФи Channel.register()цЦ╣ц│ХцЧ╢, чммф║Мф╕кхПВцХ░цМЗхоЪф║ЖцИСф╗мхп╣ Channel чЪДф╗Аф╣Ич▒╗хЮЛчЪДф║Лф╗╢цДЯхЕ┤ш╢г, ш┐Щф║Ыф║Лф╗╢цЬЙ:</p> <ul><li>Connect, хН│ш┐ЮцОеф║Лф╗╢(TCP ш┐ЮцОе), хп╣х║Фф║ОSelectionKey.OP_CONNECT</li> <li>Accept, хН│чбошодф║Лф╗╢, хп╣х║Фф║ОSelectionKey.OP_ACCEPT</li> <li>Read, хН│шп╗ф║Лф╗╢, хп╣х║Фф║ОSelectionKey.OP_READ, шбичд║ buffer хПпшп╗.</li> <li>Write, хН│хЖЩф║Лф╗╢, хп╣х║Фф║ОSelectionKey.OP_WRITE, шбичд║ buffer хПпхЖЩ.</li></ul> <p>ф╕Аф╕к ChannelхПСхЗ║ф╕Аф╕кф║Лф╗╢ф╣ЯхПпф╗ечз░ф╕║** хп╣ф║ОцЯРф╕кф║Лф╗╢, Channel хЗЖхдЗхе╜ф║Ж**. хЫацндф╕Аф╕к Channel цИРхКЯш┐ЮцОехИ░ф║ЖхПжф╕Аф╕кцЬНхКбхЩиф╣ЯхПпф╗ешвлчз░ф╕║** connect ready**.
цИСф╗мхПпф╗еф╜┐чФицИЦш┐РчоЧ**|**цЭеч╗ДхРИхдЪф╕кф║Лф╗╢, ф╛ЛхжВ:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> interestSet <span class="token operator">=</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">;</span>    
</code></pre></div><p><code>ц│ицДП, ф╕Аф╕к Channel ф╗Еф╗ЕхПпф╗ешвлц│ихЖМхИ░ф╕Аф╕к Selector ф╕Ацмб, хжВцЮЬх░Ж Channel ц│ихЖМхИ░ Selector хдЪцмб, щВгф╣ИхЕ╢хоЮх░▒цШпчЫ╕х╜Уф║ОцЫ┤цЦ░ SelectionKey чЪД interest set</code>. ф╛ЛхжВ:</p> <div class="language-Java extra-class"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ф╕КщЭвчЪД channel ц│ихЖМхИ░хРМф╕Аф╕к Selector ф╕дцмбф║Ж, щВгф╣Ичммф║МцмбчЪДц│ихЖМхЕ╢хоЮх░▒цШпчЫ╕х╜Уф║ОцЫ┤цЦ░ш┐Щф╕к Channel чЪД interest set ф╕║ SelectionKey.OP_READ | SelectionKey.OP_WRITE.</p> <h3 id="хЕ│ф║О-selectionkey"><a href="#хЕ│ф║О-selectionkey" class="header-anchor">#</a> хЕ│ф║О SelectionKey</h3> <p>хжВф╕КцЙАчд║, х╜УцИСф╗мф╜┐чФи register ц│ихЖМф╕Аф╕к Channel цЧ╢, ф╝Ъш┐ФхЫЮф╕Аф╕к SelectionKey хп╣ш▒б, ш┐Щф╕кхп╣ш▒бхМЕхРлф║ЖхжВф╕ЛхЖЕхо╣:</p> <ul><li>interest set, хН│цИСф╗мцДЯхЕ┤ш╢гчЪДф║Лф╗╢щЫЖ, хН│хЬиш░ГчФи register ц│ихЖМ channel цЧ╢цЙАшо╛ч╜очЪД interest set.</li> <li>ready set</li> <li>channel</li> <li>selector</li> <li>attached object, хПпщАЙчЪДщЩДхКахп╣ш▒б</li></ul> <h4 id="interest-set"><a href="#interest-set" class="header-anchor">#</a> interest set</h4> <p>цИСф╗мхПпф╗ещАЪш┐ЗхжВф╕ЛцЦ╣х╝ПшО╖хПЦ interest set:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> interestSet <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> isInterestedInAccept  <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isInterestedInConnect <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_CONNECT</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isInterestedInRead    <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isInterestedInWrite   <span class="token operator">=</span> interestSet <span class="token operator">&amp;</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">;</span>    
</code></pre></div><h4 id="ready-set"><a href="#ready-set" class="header-anchor">#</a> ready set</h4> <p>ф╗гшбиф║Ж Channel цЙАхЗЖхдЗхе╜ф║ЖчЪДцУНф╜Ь.
цИСф╗мхПпф╗ехГПхИдцЦн interest set ф╕Аца╖цУНф╜Ь Ready set, ф╜ЖцШпцИСф╗мш┐ШхПпф╗еф╜┐чФихжВф╕ЛцЦ╣ц│Хш┐ЫшбМхИдцЦн:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> readySet <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">readyOps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

selectionKey<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectionKey<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectionKey<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectionKey<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="channel-хТМ-selector"><a href="#channel-хТМ-selector" class="header-anchor">#</a> Channel хТМ Selector</h4> <p>цИСф╗мхПпф╗ещАЪш┐З SelectionKey шО╖хПЦчЫ╕хп╣х║ФчЪД Channel хТМ Selector:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Channel</span>  channel  <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Selector</span> selector <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><h4 id="attaching-object"><a href="#attaching-object" class="header-anchor">#</a> Attaching Object</h4> <p>цИСф╗мхПпф╗ехЬиselectionKeyф╕нщЩДхКаф╕Аф╕кхп╣ш▒б:</p> <div class="language-Java extra-class"><pre class="language-java"><code>selectionKey<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>theObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> attachedObj <span class="token operator">=</span> selectionKey<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>цИЦшАЕхЬиц│ихЖМцЧ╢чЫ┤цОещЩДхКа:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_READ</span><span class="token punctuation">,</span> theObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="щАЪш┐З-selector-щАЙцЛй-channel"><a href="#щАЪш┐З-selector-щАЙцЛй-channel" class="header-anchor">#</a> щАЪш┐З Selector щАЙцЛй Channel</h3> <p>цИСф╗мхПпф╗ещАЪш┐З Selector.select()цЦ╣ц│ХшО╖хПЦхп╣цЯРф╗╢ф║Лф╗╢хЗЖхдЗхе╜ф║ЖчЪД Channel, хН│хжВцЮЬцИСф╗мхЬиц│ихЖМ Channel цЧ╢, хп╣хЕ╢чЪД<strong>хПпхЖЩ</strong>ф║Лф╗╢цДЯхЕ┤ш╢г, щВгф╣Их╜У select()ш┐ФхЫЮцЧ╢, цИСф╗мх░▒хПпф╗ешО╖хПЦ Channel ф║Ж.</p> <blockquote><p><strong><code>ц│ицДП</code></strong>, select()цЦ╣ц│Хш┐ФхЫЮчЪДхА╝шбичд║цЬЙхдЪх░Сф╕к Channel хПпцУНф╜Ь.</p></blockquote> <h3 id="шО╖хПЦхПпцУНф╜ЬчЪД-channel"><a href="#шО╖хПЦхПпцУНф╜ЬчЪД-channel" class="header-anchor">#</a> шО╖хПЦхПпцУНф╜ЬчЪД Channel</h3> <p>хжВцЮЬ select()цЦ╣ц│Хш┐ФхЫЮхА╝шбичд║цЬЙхдЪф╕к Channel хЗЖхдЗхе╜ф║Ж, щВгф╣ИцИСф╗мхПпф╗ещАЪш┐З Selected key set шо┐щЧош┐Щф╕к Channel:</p> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectedKeys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> selectedKeys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a connection was accepted by a ServerSocketChannel.</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isConnectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a connection was established with a remote server.</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a channel is ready for reading</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a channel is ready for writing</span>
    <span class="token punctuation">}</span>

    keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>ц│ицДП, хЬицпПцмбш┐нф╗гцЧ╢, цИСф╗мщГ╜ш░ГчФи &quot;keyIterator.remove()&quot; х░Жш┐Щф╕к key ф╗Ош┐нф╗гхЩиф╕нхИащЩд, хЫаф╕║ select() цЦ╣ц│Хф╗Еф╗ЕцШпчоАхНХхЬ░х░Жх░▒ч╗кчЪД IO цУНф╜ЬцФ╛хИ░ selectedKeys щЫЖхРИф╕н, хЫацндхжВцЮЬцИСф╗мф╗О selectedKeys шО╖хПЦхИ░ф╕Аф╕к key, ф╜ЖцШпц▓бцЬЙх░ЖхоГхИащЩд, щВгф╣Иф╕Лф╕Ацмб select цЧ╢, ш┐Щф╕к key цЙАхп╣х║ФчЪД IO ф║Лф╗╢ш┐ШхЬи selectedKeys ф╕н.</code></p> <p>ф╛ЛхжВцндцЧ╢цИСф╗мцФ╢хИ░ OP_ACCEPT щАЪчЯе, чД╢хРОцИСф╗мш┐ЫшбМчЫ╕хЕ│хдДчРЖ, ф╜ЖцШпх╣╢ц▓бцЬЙх░Жш┐Щф╕к Key ф╗О SelectedKeys ф╕нхИащЩд, щВгф╣Иф╕Лф╕Ацмб select() ш┐ФхЫЮцЧ╢ цИСф╗мш┐ШхПпф╗ехЬи SelectedKeys ф╕ншО╖хПЦхИ░ OP_ACCEPT чЪД key.</p> <p><code>ц│ицДП, цИСф╗мхПпф╗ехКицАБцЫ┤цФ╣ SekectedKeys ф╕нчЪД key чЪД interest set.</code></p> <p>ф╛ЛхжВхЬи OP_ACCEPT ф╕н, цИСф╗мхПпф╗ех░Ж interest set цЫ┤цЦ░ф╕║ OP_READ, ш┐Щца╖ Selector х░▒ф╝Ъх░Жш┐Щф╕к Channel чЪД шп╗ IO х░▒ч╗кф║Лф╗╢хМЕхРлш┐ЫцЭеф║Ж.</p> <h3 id="selector-чЪДхЯ║цЬмф╜┐чФиц╡БчиЛ"><a href="#selector-чЪДхЯ║цЬмф╜┐чФиц╡БчиЛ" class="header-anchor">#</a> Selector чЪДхЯ║цЬмф╜┐чФиц╡БчиЛ</h3> <ol><li>щАЪш┐З Selector.open() цЙУх╝Аф╕Аф╕к Selector.</li> <li>х░Ж Channel ц│ихЖМхИ░ Selector ф╕н, х╣╢шо╛ч╜ощЬАшжБчЫСхРмчЪДф║Лф╗╢(interest set)</li> <li>ф╕НцЦнщЗНхдН:</li></ol> <ul><li>ш░ГчФи select() цЦ╣ц│Х</li> <li>ш░ГчФи selector.selectedKeys() шО╖хПЦ selected keys</li> <li>ш┐нф╗гцпПф╕к selected key:</li> <li>*ф╗О selected key ф╕ншО╖хПЦ хп╣х║ФчЪД Channel хТМщЩДхКаф┐бцБп(хжВцЮЬцЬЙчЪДшпЭ)</li> <li>*хИдцЦнцШпхУкф║Ы IO ф║Лф╗╢х╖▓ч╗Пх░▒ч╗кф║Ж, чД╢хРОхдДчРЖхоГф╗м. <strong>хжВцЮЬцШп OP_ACCEPT ф║Лф╗╢, хИЩш░ГчФи &quot;SocketChannel clientChannel = ((ServerSocketChannel) key.channel()).accept()&quot; шО╖хПЦ SocketChannel, х╣╢х░ЖхоГшо╛ч╜оф╕║ щЭЮщШ╗хбЮчЪД, чД╢хРОх░Жш┐Щф╕к Channel ц│ихЖМхИ░ Selector ф╕н.</strong></li> <li>*ца╣цНощЬАшжБцЫ┤цФ╣ selected key чЪДчЫСхРмф║Лф╗╢.</li> <li>*х░Жх╖▓ч╗ПхдДчРЖш┐ЗчЪД key ф╗О selected keys щЫЖхРИф╕нхИащЩд.</li></ul> <h3 id="хЕ│щЧн-selector"><a href="#хЕ│щЧн-selector" class="header-anchor">#</a> хЕ│щЧн Selector</h3> <p>х╜Уш░ГчФиф║Ж Selector.close()цЦ╣ц│ХцЧ╢, цИСф╗мхЕ╢хоЮцШпхЕ│щЧнф║Ж Selector цЬмш║лх╣╢ф╕Фх░ЖцЙАцЬЙчЪД SelectionKey хд▒цХИ, ф╜ЖцШпх╣╢ф╕Нф╝ЪхЕ│щЧн Channel.</p> <h3 id="хоМцХ┤чЪД-selector-ф╛ЛхнР"><a href="#хоМцХ┤чЪД-selector-ф╛ЛхнР" class="header-anchor">#</a> хоМцХ┤чЪД Selector ф╛ЛхнР</h3> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NioEchoServer</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">BUF_SIZE</span> <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TIMEOUT</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// цЙУх╝АцЬНхКбчлп Socket</span>
        <span class="token class-name">ServerSocketChannel</span> serverSocketChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// цЙУх╝А Selector</span>
        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// цЬНхКбчлп Socket чЫСхРм8080члпхПг, х╣╢щЕНч╜оф╕║щЭЮщШ╗хбЮцибх╝П</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// х░Ж channel ц│ихЖМхИ░ selector ф╕н.</span>
        <span class="token comment">// щАЪх╕╕цИСф╗мщГ╜цШпхЕИц│ихЖМф╕Аф╕к OP_ACCEPT ф║Лф╗╢, чД╢хРОхЬи OP_ACCEPT хИ░цЭецЧ╢, хЖНх░Жш┐Щф╕к Channel чЪД OP_READ</span>
        <span class="token comment">// ц│ихЖМхИ░ Selector ф╕н.</span>
        serverSocketChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_ACCEPT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// щАЪш┐Зш░ГчФи select цЦ╣ц│Х, щШ╗хбЮхЬ░чнЙх╛Е channel I/O хПпцУНф╜Ь</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token constant">TIMEOUT</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// шО╖хПЦ I/O цУНф╜Ьх░▒ч╗кчЪД SelectionKey, щАЪш┐З SelectionKey хПпф╗ечЯещБУхУкф║Ы Channel чЪДхУкч▒╗ I/O цУНф╜Ьх╖▓ч╗Пх░▒ч╗к.</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keyIterator <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// х╜УшО╖хПЦф╕Аф╕к SelectionKey хРО, х░▒шжБх░ЖхоГхИащЩд, шбичд║цИСф╗мх╖▓ч╗Пхп╣ш┐Щф╕к IO ф║Лф╗╢ш┐ЫшбМф║ЖхдДчРЖ.</span>
                keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// х╜У OP_ACCEPT ф║Лф╗╢хИ░цЭецЧ╢, цИСф╗мх░▒цЬЙф╗О ServerSocketChannel ф╕ншО╖хПЦф╕Аф╕к SocketChannel,</span>
                    <span class="token comment">// ф╗гшбиховцИ╖члпчЪДш┐ЮцОе</span>
                    <span class="token comment">// ц│ицДП, хЬи OP_ACCEPT ф║Лф╗╢ф╕н, ф╗О key.channel() ш┐ФхЫЮчЪД Channel цШп ServerSocketChannel.</span>
                    <span class="token comment">// шАМхЬи OP_WRITE хТМ OP_READ ф╕н, ф╗О key.channel() ш┐ФхЫЮчЪДцШп SocketChannel.</span>
                    <span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    clientChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//хЬи OP_ACCEPT хИ░цЭецЧ╢, хЖНх░Жш┐Щф╕к Channel чЪД OP_READ ц│ихЖМхИ░ Selector ф╕н.</span>
                    <span class="token comment">// ц│ицДП, ш┐ЩщЗМцИСф╗мхжВцЮЬц▓бцЬЙшо╛ч╜о OP_READ чЪДшпЭ, хН│ interest set ф╗НчД╢цШп OP_CONNECT чЪДшпЭ, щВгф╣И select цЦ╣ц│Хф╝Ъф╕АчЫ┤чЫ┤цОеш┐ФхЫЮ.</span>
                    clientChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">OP_READ</span><span class="token punctuation">,</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token constant">BUF_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">long</span> bytesRead <span class="token operator">=</span> clientChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        clientChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bytesRead <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token constant">OP_READ</span> <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span><span class="token constant">OP_WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Get data length: &quot;</span> <span class="token operator">+</span> bytesRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">isWritable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ByteBuffer</span> buf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    buf<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">SocketChannel</span> clientChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    clientChannel<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>buf<span class="token punctuation">.</span><span class="token function">hasRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        key<span class="token punctuation">.</span><span class="token function">interestOps</span><span class="token punctuation">(</span><span class="token constant">OP_READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    buf<span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="цА╗ч╗У"><a href="#цА╗ч╗У" class="header-anchor">#</a> цА╗ч╗У</h2> <h2 id="хПВшАГш╡ДцЦЩ"><a href="#хПВшАГш╡ДцЦЩ" class="header-anchor">#</a> хПВшАГш╡ДцЦЩ</h2> <ul><li>https://github.com/yongshun/learn_netty_source_code</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Netty ч│╗ч╗Яшо╛шоб/20.ф╕ЙуАБф╕╗ч║┐ф╗╗хКб/05.Channel ц║РчаБшзгцЮР.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/18, 16:19:18</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/echo-system-design/pages/b2a14a/" class="prev">Bootstrapя╝Иserverя╝Йц║РчаБшзгцЮР</a></span> <span class="next"><a href="/echo-system-design/pages/397456/">EventLoop ц║РчаБшзгцЮР</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/echo-system-design/assets/js/app.68fbe714.js" defer></script><script src="/echo-system-design/assets/js/2.933750c6.js" defer></script><script src="/echo-system-design/assets/js/46.7624d38c.js" defer></script><script src="/echo-system-design/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
