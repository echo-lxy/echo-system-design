<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis чЪД Reactor цибхЮЛ | Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.473bdd25.css" as="style"><link rel="preload" href="/assets/js/app.f1bdf1ca.js" as="script"><link rel="preload" href="/assets/js/2.933750c6.js" as="script"><link rel="preload" href="/assets/js/46.7ddc3ffa.js" as="script"><link rel="preload" href="/assets/js/7.7eb70372.js" as="script"><link rel="prefetch" href="/assets/js/10.b313d17c.js"><link rel="prefetch" href="/assets/js/11.c7521a10.js"><link rel="prefetch" href="/assets/js/12.38d1989d.js"><link rel="prefetch" href="/assets/js/13.850793b0.js"><link rel="prefetch" href="/assets/js/14.1141ec27.js"><link rel="prefetch" href="/assets/js/15.13af8159.js"><link rel="prefetch" href="/assets/js/16.9c3f8295.js"><link rel="prefetch" href="/assets/js/17.1bd2c772.js"><link rel="prefetch" href="/assets/js/18.e689f555.js"><link rel="prefetch" href="/assets/js/19.68db5844.js"><link rel="prefetch" href="/assets/js/20.b5e0fdf1.js"><link rel="prefetch" href="/assets/js/21.af1069aa.js"><link rel="prefetch" href="/assets/js/22.98d9538a.js"><link rel="prefetch" href="/assets/js/23.80625400.js"><link rel="prefetch" href="/assets/js/24.88b84218.js"><link rel="prefetch" href="/assets/js/25.db0f299d.js"><link rel="prefetch" href="/assets/js/26.dc5ac22f.js"><link rel="prefetch" href="/assets/js/27.e82ff876.js"><link rel="prefetch" href="/assets/js/28.6b737928.js"><link rel="prefetch" href="/assets/js/29.ebd14054.js"><link rel="prefetch" href="/assets/js/3.aa815192.js"><link rel="prefetch" href="/assets/js/30.8e70b90d.js"><link rel="prefetch" href="/assets/js/31.833f9b33.js"><link rel="prefetch" href="/assets/js/32.f1016cda.js"><link rel="prefetch" href="/assets/js/33.39471dd3.js"><link rel="prefetch" href="/assets/js/34.9740832c.js"><link rel="prefetch" href="/assets/js/35.ac8dd46f.js"><link rel="prefetch" href="/assets/js/36.8aa375d9.js"><link rel="prefetch" href="/assets/js/37.07cad209.js"><link rel="prefetch" href="/assets/js/38.42e2eab6.js"><link rel="prefetch" href="/assets/js/39.ccf686b4.js"><link rel="prefetch" href="/assets/js/4.73518a0f.js"><link rel="prefetch" href="/assets/js/40.38653c0f.js"><link rel="prefetch" href="/assets/js/41.5525b2c4.js"><link rel="prefetch" href="/assets/js/42.825c6423.js"><link rel="prefetch" href="/assets/js/43.ba91706f.js"><link rel="prefetch" href="/assets/js/44.f4a3c564.js"><link rel="prefetch" href="/assets/js/45.4dc327b0.js"><link rel="prefetch" href="/assets/js/47.f3a2643a.js"><link rel="prefetch" href="/assets/js/48.0fdc5aae.js"><link rel="prefetch" href="/assets/js/49.449593cb.js"><link rel="prefetch" href="/assets/js/5.1875cdb3.js"><link rel="prefetch" href="/assets/js/50.009e4919.js"><link rel="prefetch" href="/assets/js/51.88874359.js"><link rel="prefetch" href="/assets/js/52.a2af2e28.js"><link rel="prefetch" href="/assets/js/53.c391ee9d.js"><link rel="prefetch" href="/assets/js/54.89dcf983.js"><link rel="prefetch" href="/assets/js/55.2f20af86.js"><link rel="prefetch" href="/assets/js/56.bee4259d.js"><link rel="prefetch" href="/assets/js/57.b6ba41a5.js"><link rel="prefetch" href="/assets/js/6.0b558b79.js"><link rel="prefetch" href="/assets/js/8.0ec7f6e8.js"><link rel="prefetch" href="/assets/js/9.b55932ba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.473bdd25.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Echo ч│╗ч╗Яшо╛шобф╣Лч╛О" class="logo"> <span class="site-name can-hide">Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>цМЗхНЧ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>хЯ║чбА</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ф╕╗ч║┐</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/34fa27/" class="sidebar-link">Linux ф╕нчЪД IO хдЪш╖пхдНчФи</a></li><li><a href="/pages/d4ecb9/" class="sidebar-link">Redis Server хИЭхзЛхМЦ</a></li><li><a href="/pages/d6b00d/" aria-current="page" class="active sidebar-link">Redis чЪД Reactor цибхЮЛ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d6b00d/#хЙНшиА" class="sidebar-link">хЙНшиА</a></li><li class="sidebar-sub-header level2"><a href="/pages/d6b00d/#reactor-цибхЮЛчЪДх╖еф╜ЬцЬ║хИ╢" class="sidebar-link">Reactor цибхЮЛчЪДх╖еф╜ЬцЬ║хИ╢</a></li><li class="sidebar-sub-header level2"><a href="/pages/d6b00d/#redis-хп╣-reactor-цибхЮЛчЪДхоЮчО░" class="sidebar-link">Redis хп╣ Reactor цибхЮЛчЪДхоЮчО░</a></li><li class="sidebar-sub-header level2"><a href="/pages/d6b00d/#цА╗ч╗У" class="sidebar-link">цА╗ч╗У</a></li><li class="sidebar-sub-header level2"><a href="/pages/d6b00d/#хПВшАГцЦЗчМо" class="sidebar-link">хПВшАГцЦЗчМо</a></li></ul></li><li><a href="/pages/264b06/" class="sidebar-link">ц╖▒хЕе Redis ф║Лф╗╢щй▒хКицбЖцЮ╢</a></li><li><a href="/pages/e6d8ef/" class="sidebar-link">Redis чЪДцЙзшбМцибх╝П</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>цФпч║┐</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>щЫЖч╛д</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Redis ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>ф╕╗ч║┐</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-15</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Redis чЪД Reactor цибхЮЛ<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><div class="custom-block danger"><p class="custom-block-title">цПРхЗ║щЧощвШцШпф╕АхИЗцЩ║цЕзчЪДх╝Ачлп</p> <ul><li>Reactor цибхЮЛф╕нцЬЙхУкф║Ыч╗Дф╗╢я╝Я</li> <li>Reactor цибхЮЛф╕нцЬЙхУкф║Ыф║Лф╗╢ч▒╗хЮЛя╝Я</li> <li>Reactor цибхЮЛф╕нцЬЙхУкф║ЫхЕ│щФошзТшЙ▓я╝ЯцпПф╕кшзТшЙ▓чЪДф╜ЬчФия╝Я</li> <li>ф╗гчаБцХ┤ф╜УцОзхИ╢щА╗ш╛СцЬЙхУкф║ЫщЗНшжБщГихИЖя╝Я</li> <li>Redis хжВф╜ХхоЮчО░ Reactor цибхЮЛя╝Я</li> <li>хжВф╜Хц│ихЖМф║Лф╗╢я╝ЯхжВф╜Хх╛кчОпчЫСхРмф║Лф╗╢я╝Я</li></ul></div> <h2 id="хЙНшиА"><a href="#хЙНшиА" class="header-anchor">#</a> хЙНшиА</h2> <p><strong>RedisчЪДч╜Сч╗ЬцбЖцЮ╢цШпхоЮчО░ф║ЖReactorцибхЮЛхРЧя╝Я</strong></p> <p>х╗║шоохИЖф╕║ф╕дщГихИЖцЭехЫЮчнФя╝Ъ</p> <ul><li>ф╗Лч╗НReactorцибхЮЛцШпф╗Аф╣И</li> <li>шп┤цШОRedisф╗гчаБхоЮчО░цШпхжВф╜Хф╕ОReactorцибхЮЛчЫ╕хп╣х║ФчЪД</li></ul> <p>Reactor цибхЮЛцШпщлШцАзшГ╜ч╜Сч╗Ьч│╗ч╗ЯхоЮчО░щлШх╣╢хПСшп╖ц▒ВхдДчРЖчЪДф╕Аф╕кщЗНшжБцКАцЬпцЦ╣цбИуАВцОМцПбReactorцибхЮЛчЪДшо╛шобцАЭцГ│ф╕ОхоЮчО░цЦ╣ц│Хя╝МхПпф╗ецМЗхп╝ф╜ашо╛шобхТМхоЮчО░шЗкх╖▒чЪДщлШх╣╢хПСч│╗ч╗ЯуАВх╜Уф╜ашжБхдДчРЖцИРхНГф╕Кф╕ЗчЪДч╜Сч╗Ьш┐ЮцОецЧ╢я╝Мх░▒ф╕Нф╝Ъф╕Ачн╣шОлх▒Хф║ЖуАВ</p> <h2 id="reactor-цибхЮЛчЪДх╖еф╜ЬцЬ║хИ╢"><a href="#reactor-цибхЮЛчЪДх╖еф╜ЬцЬ║хИ╢" class="header-anchor">#</a> Reactor цибхЮЛчЪДх╖еф╜ЬцЬ║хИ╢</h2> <p>хоЮщЩЕф╕Кя╝М<strong>ReactorцибхЮЛх░▒цШпч╜Сч╗ЬцЬНхКбхЩичлпчФицЭехдДчРЖщлШх╣╢хПСч╜Сч╗ЬIOшп╖ц▒ВчЪДф╕АчзНч╝ЦчиЛцибхЮЛ</strong>уАВцИСцККш┐Щф╕кцибхЮЛчЪДчЙ╣х╛БчФиф╕дф╕ктАЬф╕ЙтАЭцЭецА╗ч╗Уя╝Мф╣Ях░▒цШпя╝Ъ</p> <ul><li>ф╕Йч▒╗хдДчРЖф║Лф╗╢я╝Мш┐ЮцОеф║Лф╗╢уАБхЖЩф║Лф╗╢уАБшп╗ф║Лф╗╢я╝Ы</li> <li>ф╕Йф╕кхЕ│щФошзТшЙ▓я╝МхН│ reactorуАБacceptorуАБhandlerуАВ</li></ul> <p>щВгф╣Ия╝МReactorцибхЮЛцШпхжВф╜ХхЯ║ф║Ош┐Щф╕Йч▒╗ф║Лф╗╢хТМф╕Йф╕кшзТшЙ▓цЭехдДчРЖщлШх╣╢хПСшп╖ц▒ВчЪДхСвя╝Яф╕ЛщЭвцИСф╗мх░▒цЭехЕ╖ф╜Уф║Жшзгф╕ЛуАВ</p> <h3 id="ф║Лф╗╢ч▒╗хЮЛ"><a href="#ф║Лф╗╢ч▒╗хЮЛ" class="header-anchor">#</a> ф║Лф╗╢ч▒╗хЮЛ</h3> <p>цИСф╗мхЕИцЭечЬЛчЬЛш┐Щф╕Йч▒╗ф║Лф╗╢хТМReactorцибхЮЛчЪДхЕ│ч│╗уАВ</p> <p>хЕ╢хоЮя╝МReactor цибхЮЛхдДчРЖчЪДцШпховцИ╖члпхТМцЬНхКбхЩичлпчЪД<strong>ф║дф║Тш┐ЗчиЛ</strong>я╝МшАМш┐Щф╕Йч▒╗ф║Лф╗╢цнгхе╜хп╣х║Фф║ЖховцИ╖члпхТМцЬНхКбхЩичлпф║дф║Тш┐ЗчиЛф╕ня╝Мф╕НхРМч▒╗шп╖ц▒ВхЬицЬНхКбхЩичлпх╝ХхПСчЪДх╛ЕхдДчРЖф║Лф╗╢я╝Ъ</p> <ul><li>ш┐ЮцОеф║Лф╗╢
<ul><li>х╜Уф╕Аф╕кховцИ╖члпшжБхТМцЬНхКбхЩичлпш┐ЫшбМф║дф║ТцЧ╢я╝МховцИ╖члпф╝ЪхРСцЬНхКбхЩичлпхПСщАБш┐ЮцОешп╖ц▒Вя╝Мф╗ех╗║члЛш┐ЮцОея╝Мш┐Щх░▒хп╣х║Фф║ЖцЬНхКбхЩичлпчЪДф╕Аф╕к<strong>ш┐ЮцОеф║Лф╗╢</strong></li></ul></li> <li>хЖЩф║Лф╗╢
<ul><li>ф╕АцЧжш┐ЮцОех╗║члЛхРОя╝МховцИ╖члпф╝Ъч╗ЩцЬНхКбхЩичлпхПСщАБшп╗шп╖ц▒Вя╝Мф╗еф╛┐шп╗хПЦцХ░цНоуАВцЬНхКбхЩичлпхЬихдДчРЖшп╗шп╖ц▒ВцЧ╢я╝МщЬАшжБхРСховцИ╖члпхЖЩхЫЮцХ░цНоя╝Мш┐Щхп╣х║Фф║ЖцЬНхКбхЩичлпчЪД<strong>хЖЩф║Лф╗╢</strong></li></ul></li> <li>шп╗ф║Лф╗╢
<ul><li>цЧашо║ховцИ╖члпч╗ЩцЬНхКбхЩичлпхПСщАБшп╗цИЦхЖЩшп╖ц▒Вя╝МцЬНхКбхЩичлпщГ╜щЬАшжБф╗ОховцИ╖члпшп╗хПЦшп╖ц▒ВхЖЕхо╣я╝МцЙАф╗ехЬиш┐ЩщЗМя╝Мшп╗цИЦхЖЩшп╖ц▒ВчЪДшп╗хПЦх░▒хп╣х║Фф║ЖцЬНхКбхЩичлпчЪД<strong>шп╗ф║Лф╗╢</strong></li></ul></li></ul> <p>хжВф╕ЛцЙАчд║чЪДхЫ╛ф╛Лф╕ня╝Мх░▒х▒Хчд║ф║ЖховцИ╖члпхТМцЬНхКбхЩичлпхЬиф║дф║Тш┐ЗчиЛф╕ня╝Мф╕НхРМч▒╗шп╖ц▒ВхТМReactorцибхЮЛф║Лф╗╢чЪДхп╣х║ФхЕ│ч│╗я╝Мф╜ахПпф╗ечЬЛф╕ЛуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409151209488.png" alt="image-20240915120925427"></p> <p>хе╜я╝МхЬиф║Жшзгф║ЖReactorцибхЮЛчЪДф╕Йч▒╗ф║Лф╗╢хРОя╝Мф╜ачО░хЬихПпшГ╜ш┐ШцЬЙф╕Аф╕кчЦСщЧоя╝Ъш┐Щф╕Йч▒╗ф║Лф╗╢цШпчФ▒ш░БцЭехдДчРЖчЪДхСвя╝Я</p> <h3 id="хЕ│щФошзТшЙ▓"><a href="#хЕ│щФошзТшЙ▓" class="header-anchor">#</a> хЕ│щФошзТшЙ▓</h3> <p>ш┐ЩхЕ╢хоЮх░▒цШпцибхЮЛф╕н<strong>ф╕Йф╕кхЕ│щФошзТшЙ▓</strong>чЪДф╜ЬчФиф║Жя╝Ъ</p> <ul><li>acceptor я╝Ъш┐ЮцОеф║Лф╗╢чФ▒ acceptor цЭехдДчРЖя╝Мш┤Яш┤гцОецФ╢ш┐ЮцОея╝Ыacceptor хЬицОецФ╢ш┐ЮцОехРОя╝Мф╝ЪхИЫх╗║ handlerя╝МчФиф║Оч╜Сч╗Ьш┐ЮцОеф╕Кхп╣хРОч╗ншп╗хЖЩф║Лф╗╢чЪДхдДчРЖя╝Ы</li> <li>handlerя╝Ъшп╗хЖЩф║Лф╗╢чФ▒ handler хдДчРЖя╝Ы</li> <li>reactorя╝ЪхЬищлШх╣╢хПСхЬ║цЩпф╕ня╝Мш┐ЮцОеф║Лф╗╢уАБшп╗хЖЩф║Лф╗╢ф╝ЪхРМцЧ╢хПСчФЯя╝МцЙАф╗ея╝МцИСф╗мщЬАшжБцЬЙф╕Аф╕кшзТшЙ▓ф╕УщЧичЫСхРмхТМхИЖщЕНф║Лф╗╢я╝Мш┐Щх░▒цШп reactor шзТшЙ▓уАВх╜УцЬЙш┐ЮцОешп╖ц▒ВцЧ╢я╝Мreactor х░Жф║зчФЯчЪДш┐ЮцОеф║Лф╗╢ф║дчФ▒ acceptor хдДчРЖя╝Ых╜УцЬЙшп╗хЖЩшп╖ц▒ВцЧ╢я╝Мreactor х░Жшп╗хЖЩф║Лф╗╢ф║дчФ▒ handler хдДчРЖуАВ</li></ul> <p>ф╕ЛхЫ╛х░▒х▒Хчд║ф║Жш┐Щф╕Йф╕кшзТшЙ▓ф╣ЛщЧ┤чЪДхЕ│ч│╗я╝Мф╗ехПКхоГф╗мхТМф║Лф╗╢чЪДхЕ│ч│╗я╝Мф╜ахПпф╗ечЬЛф╕Л</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409151209413.png" alt="image-20240915120823439"></p> <p>ф║ЛхоЮф╕Кя╝Мш┐Щф╕Йф╕кшзТшЙ▓щГ╜цШпReactorцибхЮЛф╕ншжБхоЮчО░чЪДхКЯшГ╜чЪДцК╜ш▒буАВ</p> <p><strong>х╜УцИСф╗мщБ╡х╛кReactorцибхЮЛх╝АхПСцЬНхКбхЩичлпчЪДч╜Сч╗ЬцбЖцЮ╢цЧ╢я╝Мх░▒щЬАшжБхЬич╝ЦчиЛчЪДцЧ╢хАЩя╝МхЬиф╗гчаБхКЯшГ╜цибхЭЧф╕нхоЮчО░reactorуАБacceptorхТМhandler чЪДщА╗ш╛С</strong></p> <p>щВгф╣Ия╝МчО░хЬицИСф╗мх╖▓ч╗ПчЯещБУя╝Мш┐Щф╕Йф╕кшзТшЙ▓цШпхЫ┤ч╗Хф║Лф╗╢чЪДчЫСхРмуАБш╜мхПСхТМхдДчРЖцЭеш┐ЫшбМф║дф║ТчЪДя╝МщВгф╣ИхЬич╝ЦчиЛцЧ╢я╝МцИСф╗мхПИшпехжВф╜ХхоЮчО░ш┐Щф╕ЙшАЕчЪД<strong>ф║дф║Т</strong>хСвя╝Яш┐Щх░▒чж╗ф╕Нх╝А <strong>ф║Лф╗╢щй▒хКицбЖцЮ╢</strong>ф║Ж</p> <h3 id="ф║Лф╗╢щй▒хКицбЖцЮ╢"><a href="#ф║Лф╗╢щй▒хКицбЖцЮ╢" class="header-anchor">#</a> ф║Лф╗╢щй▒хКицбЖцЮ╢</h3> <p>цЙАш░УчЪДф║Лф╗╢щй▒хКицбЖцЮ╢я╝Мх░▒цШпхЬихоЮчО░ Reactor цибхЮЛцЧ╢я╝МщЬАшжБхоЮчО░чЪДф╗гчаБцХ┤ф╜УцОзхИ╢щА╗ш╛СуАВ</p> <p>чоАхНХцЭешп┤я╝Мф║Лф╗╢щй▒хКицбЖцЮ╢хМЕцЛмф║Жф╕дщГихИЖ</p> <ul><li>ф╕АцШп<strong>ф║Лф╗╢хИЭхзЛхМЦ</strong></li> <li>ф║МцШп<strong>ф║Лф╗╢цНХшО╖уАБхИЖхПСхТМхдДчРЖф╕╗х╛кчОп</strong></li></ul> <p>ф║Лф╗╢хИЭхзЛхМЦцШпхЬицЬНхКбхЩичиЛх║ПхРпхКицЧ╢х░▒цЙзшбМчЪДя╝МхоГчЪДф╜ЬчФиф╕╗шжБцШп <strong>хИЫх╗║щЬАшжБчЫСхРмчЪДф║Лф╗╢ч▒╗хЮЛя╝Мф╗ехПКшпеч▒╗ф║Лф╗╢хп╣х║ФчЪДhandler</strong>уАВ</p> <p>шАМф╕АцЧжцЬНхКбхЩихоМцИРхИЭхзЛхМЦхРОя╝Мф║Лф╗╢хИЭхзЛхМЦф╣Ях░▒чЫ╕х║ФхоМцИРф║Жя╝МцЬНхКбхЩичиЛх║Пх░▒щЬАшжБш┐ЫхЕехИ░ф║Лф╗╢цНХшО╖уАБхИЖхПСхТМхдДчРЖчЪДф╕╗х╛кчОпф╕нуАВ</p> <p>хЬих╝АхПСф╗гчаБцЧ╢я╝МцИСф╗мщАЪх╕╕ф╝ЪчФиф╕Аф╕к<strong>whileх╛кчОп</strong>цЭеф╜Ьф╕║ш┐Щф╕кф╕╗х╛кчОпуАВ</p> <p>чД╢хРОхЬиш┐Щф╕кф╕╗х╛кчОпф╕ня╝МцИСф╗мщЬАшжБ</p> <ol><li>цНХшО╖хПСчФЯчЪДф║Лф╗╢</li> <li>хИдцЦнф║Лф╗╢ч▒╗хЮЛ</li> <li>ца╣цНоф║Лф╗╢ч▒╗хЮЛя╝Мш░ГчФихЬихИЭхзЛхМЦцЧ╢хИЫх╗║хе╜чЪДф║Лф╗╢handlerцЭехоЮщЩЕхдДчРЖф║Лф╗╢</li></ol> <p>цпФхжВшп┤я╝Мх╜УцЬЙш┐ЮцОеф║Лф╗╢хПСчФЯцЧ╢я╝МцЬНхКбхЩичиЛх║ПщЬАшжБш░ГчФиacceptorхдДчРЖхЗ╜цХ░я╝МхИЫх╗║хТМховцИ╖члпчЪДш┐ЮцОеуАВшАМх╜УцЬЙшп╗ф║Лф╗╢хПСчФЯцЧ╢я╝Мх░▒шбицШОцЬЙшп╗цИЦхЖЩшп╖ц▒ВхПСщАБхИ░ф║ЖцЬНхКбхЩичлпя╝МцЬНхКбхЩичиЛх║Пх░▒шжБш░ГчФихЕ╖ф╜УчЪДшп╖ц▒ВхдДчРЖхЗ╜цХ░я╝Мф╗ОховцИ╖члпш┐ЮцОеф╕ншп╗хПЦшп╖ц▒ВхЖЕхо╣я╝Мш┐ЫшАМх░▒хоМцИРф║Жшп╗ф║Лф╗╢чЪДхдДчРЖуАВш┐ЩщЗМф╜ахПпф╗ехПВшАГф╕ЛщЭвч╗ЩхЗ║чЪДхЫ╛ф╛Ля╝МхЕ╢ф╕нцШ╛чд║ф║Жф║Лф╗╢щй▒хКицбЖцЮ╢чЪДхЯ║цЬмцЙзшбМш┐ЗчиЛя╝Ъ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409151210395.png" alt="image-20240915121009334"></p> <p>щВгф╣ИхИ░ш┐ЩщЗМя╝Мф╜ах║Фшпех░▒х╖▓ч╗Пф║Жшзгф║Ж<strong>ReactorцибхЮЛчЪДхЯ║цЬмх╖еф╜ЬцЬ║хИ╢</strong>я╝ЪховцИ╖члпчЪДф╕НхРМч▒╗шп╖ц▒Вф╝ЪхЬицЬНхКбхЩичлпшзжхПСш┐ЮцОеуАБшп╗уАБхЖЩф╕Йч▒╗ф║Лф╗╢я╝Мш┐Щф╕Йч▒╗ф║Лф╗╢чЪДчЫСхРмуАБхИЖхПСхТМхдДчРЖхПИцШпчФ▒reactorуАБacceptorуАБhandlerф╕Йч▒╗шзТшЙ▓цЭехоМцИРчЪДя╝МчД╢хРОш┐Щф╕Йч▒╗шзТшЙ▓ф╝ЪщАЪш┐Зф║Лф╗╢щй▒хКицбЖцЮ╢цЭехоЮчО░ф║дф║ТхТМф║Лф╗╢хдДчРЖуАВ</p> <p>цЙАф╗ехПпшзБя╝МхоЮчО░ф╕Аф╕кReactorцибхЮЛчЪД<strong>хЕ│щФо</strong>я╝Мх░▒цШпшжБхоЮчО░ф║Лф╗╢щй▒хКицбЖцЮ╢уАВщВгф╣Ия╝МхжВф╜Хх╝АхПСхоЮчО░ф╕Аф╕кф║Лф╗╢щй▒хКицбЖцЮ╢хСвя╝Я</p> <p>Redis цПРф╛Ыф║Жф╕Аф╕кчоАц┤Бф╜ЖцЬЙцХИчЪДхПВшАГхоЮчО░я╝МщЭЮх╕╕хА╝х╛ЧцИСф╗мхнжф╣ая╝МшАМф╕Фф╣ЯхПпф╗ечФиф║ОшЗкх╖▒чЪДч╜Сч╗Ьч│╗ч╗Ях╝АхПСуАВф╕ЛщЭвя╝МцИСф╗мх░▒ф╕Аш╡╖цЭехнжф╣аф╕ЛRedisф╕нхп╣ Reactor цибхЮЛчЪДхоЮчО░уАВ</p> <h2 id="redis-хп╣-reactor-цибхЮЛчЪДхоЮчО░"><a href="#redis-хп╣-reactor-цибхЮЛчЪДхоЮчО░" class="header-anchor">#</a> Redis хп╣ Reactor цибхЮЛчЪДхоЮчО░</h2> <p>щжЦхЕИцИСф╗мшжБчЯещБУчЪДцШпя╝МRedis чЪДч╜Сч╗ЬцбЖцЮ╢хоЮчО░ф║Ж Reactor цибхЮЛя╝Мх╣╢ф╕ФшЗкшбМх╝АхПСхоЮчО░ф║Жф╕Аф╕кф║Лф╗╢щй▒хКицбЖцЮ╢уАВш┐Щф╕кцбЖцЮ╢хп╣х║ФчЪДRedisф╗гчаБхоЮчО░цЦЗф╗╢цШп<a href="https://github.com/redis/redis/blob/5.0/src/ae.c" target="_blank" rel="noopener noreferrer">ae.c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>я╝Мхп╣х║ФчЪДхд┤цЦЗф╗╢цШп<a href="https://github.com/redis/redis/blob/5.0/src/ae.h" target="_blank" rel="noopener noreferrer">ae.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАВ</p> <p>хЙНщЭвцИСф╗мх╖▓ч╗ПчЯещБУя╝Мф║Лф╗╢щй▒хКицбЖцЮ╢чЪДхоЮчО░чж╗ф╕Нх╝Аф║Лф╗╢чЪДхоЪф╣Йя╝Мф╗ехПКф║Лф╗╢ц│ихЖМуАБцНХшО╖уАБхИЖхПСхТМхдДчРЖчнЙф╕Ач│╗хИЧцУНф╜ЬуАВх╜УчД╢я╝Мхп╣ф║ОцХ┤ф╕кцбЖцЮ╢цЭешп┤я╝Мш┐ШщЬАшжБшГ╜ф╕АчЫ┤ш┐РшбМя╝МцМБч╗нхЬ░хУНх║ФхПСчФЯчЪДф║Лф╗╢уАВ</p> <p>щВгф╣ИчФ▒цндя╝МцИСф╗мф╗Оae.hхд┤цЦЗф╗╢ф╕нх░▒хПпф╗ечЬЛхИ░я╝МRedisф╕║ф║ЖхоЮчО░ф║Лф╗╢щй▒хКицбЖцЮ╢я╝МчЫ╕х║ФхЬ░хоЪф╣Йф║Ж</p> <ul><li><strong>ф║Лф╗╢чЪДцХ░цНоч╗УцЮД</strong></li> <li><strong>цбЖцЮ╢ф╕╗х╛кчОпхЗ╜цХ░</strong></li> <li><strong>ф║Лф╗╢цНХшО╖хИЖхПСхЗ╜цХ░</strong></li> <li><strong>ф║Лф╗╢</strong></li> <li><strong>handlerц│ихЖМхЗ╜цХ░</strong></li></ul> <p>цЙАф╗ецОеф╕ЛцЭея╝МцИСф╗мх░▒ф╛ЭцмбцЭеф║Жшзгхнжф╣аф╕ЛуАВ</p> <h3 id="ф║Лф╗╢чЪДцХ░цНоч╗УцЮДхоЪф╣Й-ф╗е-aefileevent-ф╕║ф╛Л"><a href="#ф║Лф╗╢чЪДцХ░цНоч╗УцЮДхоЪф╣Й-ф╗е-aefileevent-ф╕║ф╛Л" class="header-anchor">#</a> ф║Лф╗╢чЪДцХ░цНоч╗УцЮДхоЪф╣Йя╝Ъф╗е aeFileEvent ф╕║ф╛Л</h3> <p>щжЦхЕИя╝МцИСф╗мшжБцШОчбоф╕АчВ╣я╝Мх░▒цШпхЬиRedisф║Лф╗╢щй▒хКицбЖцЮ╢чЪДхоЮчО░х╜Уф╕ня╝М<strong>ф║Лф╗╢чЪДцХ░цНоч╗УцЮДцШпхЕ│шБФф║Лф╗╢ч▒╗хЮЛхТМф║Лф╗╢хдДчРЖхЗ╜цХ░чЪДхЕ│щФошжБч┤а</strong>уАВшАМRedisчЪДф║Лф╗╢щй▒хКицбЖцЮ╢хоЪф╣Йф║Жф╕дч▒╗ф║Лф╗╢я╝Ъ</p> <ul><li><strong>IOф║Лф╗╢</strong>я╝Ъхп╣х║Ф ховцИ╖члпхПСщАБчЪД ч╜Сч╗Ьшп╖ц▒В</li> <li><strong>цЧ╢щЧ┤ф║Лф╗╢</strong>я╝Ъхп╣х║Ф Redis шЗкш║лчЪДхСицЬЯцАзцУНф╜Ь</li></ul> <p>ш┐Щф╣Ях░▒цШпшп┤я╝М<strong>ф╕НхРМч▒╗хЮЛф║Лф╗╢чЪДцХ░цНоч╗УцЮДхоЪф╣ЙцШпф╕Нф╕Аца╖чЪД</strong>уАВф╕Нш┐Зя╝Мх╜УхЙНцИСф╗мф╕╗шжБхЕ│ц│ичЪДцШпф║Лф╗╢цбЖцЮ╢чЪДцХ┤ф╜Ушо╛шобф╕ОхоЮчО░я╝МцЙАф╗ехп╣ф║Оф╕НхРМч▒╗хЮЛф║Лф╗╢чЪДх╖ох╝ВхТМхЕ╖ф╜УхдДчРЖя╝Мecho хРОщЭвхЖНф╗Лч╗НуАВ</p> <p>щВгф╣Иф╕║ф║Жшойф╜ашГ╜хдЯчРЖшзгф║Лф╗╢цХ░цНоч╗УцЮДхп╣цбЖцЮ╢чЪДф╜ЬчФия╝МцИСх░▒ф╗е IO ф║Лф╗╢aeFileEventф╕║ф╛Ля╝Мч╗Щф╜аф╗Лч╗Нф╕ЛхоГчЪДцХ░цНоч╗УцЮДхоЪф╣Й</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">aeFileEvent</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> mask<span class="token punctuation">;</span> <span class="token comment">/* one of AE_(READABLE|WRITABLE|BARRIER) */</span>
    aeFileProc <span class="token operator">*</span>rfileProc<span class="token punctuation">;</span>
    aeFileProc <span class="token operator">*</span>wfileProc<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>clientData<span class="token punctuation">;</span>
<span class="token punctuation">}</span> aeFileEvent<span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>mask <strong>цШпчФицЭе</strong>шбичд║ф║Лф╗╢ч▒╗хЮЛ</strong>чЪДцОйчаБуАВхп╣ф║Оч╜Сч╗ЬщАЪф┐бчЪДф║Лф╗╢цЭешп┤я╝Мф╕╗шжБцЬЙ AE_READABLEуАБAE_WRITABLE хТМ AE_BARRIER ф╕ЙчзНч▒╗хЮЛф║Лф╗╢уАВцбЖцЮ╢хЬихИЖхПСф║Лф╗╢цЧ╢я╝Мф╛Эш╡ЦчЪДх░▒цШпч╗УцЮДф╜Уф╕нчЪДф║Лф╗╢ч▒╗хЮЛя╝Ы</li> <li><strong>rfileProc хТМ wfileProce</strong> хИЖхИлцШпцМЗхРСAE_READABLEхТМAE_WRITABLEш┐Щф╕дч▒╗ф║Лф╗╢чЪД<strong>хдДчРЖхЗ╜цХ░</strong>я╝Мф╣Ях░▒цШпReactorцибхЮЛф╕нчЪДhandlerуАВцбЖцЮ╢хЬихИЖхПСф║Лф╗╢хРОя╝Мх░▒щЬАшжБш░ГчФич╗УцЮДф╜Уф╕нхоЪф╣ЙчЪДхЗ╜цХ░ш┐ЫшбМф║Лф╗╢хдДчРЖ</li> <li>цЬАхРОф╕Аф╕кцИРхСШхПШщЗП <strong>clientData</strong> цШпчФицЭецМЗхРСховцИ╖члпчзБцЬЙцХ░цНочЪДцМЗщТИ</li></ul> <p>щЩдф║Жф║Лф╗╢чЪДцХ░цНоч╗УцЮДф╗ехдЦя╝МхЙНщЭвцИСш┐ШцПРхИ░ Redis хЬи ae.h цЦЗф╗╢ф╕ня╝МхоЪф╣Йф║ЖцФпцТСцбЖцЮ╢ш┐РшбМчЪДф╕╗шжБхЗ╜цХ░я╝МхМЕцЛмцбЖцЮ╢ф╕╗х╛кчОпчЪДaeMainхЗ╜цХ░уАБш┤Яш┤гф║Лф╗╢цНХшО╖ф╕ОхИЖхПСчЪД aeProcessEvents хЗ╜цХ░я╝Мф╗ехПКш┤Яш┤гф║Лф╗╢хТМ handler ц│ихЖМчЪД aeCreateFileEvent хЗ╜цХ░я╝МхоГф╗мчЪДхОЯхЮЛхоЪф╣ЙхжВф╕Л</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">aeMain</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">aeCreateFileEvent</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">int</span> mask<span class="token punctuation">,</span> aeFileProc <span class="token operator">*</span>proc<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>clientData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">aeProcessEvents</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>шАМш┐Щф╕Йф╕кхЗ╜цХ░чЪДхоЮчО░я╝МщГ╜цШпхЬихп╣х║ФчЪД ae.c цЦЗф╗╢ф╕ня╝МщВгф╣ИцОеф╕ЛцЭея╝МцИСх░▒ч╗Щф╜ахЕ╖ф╜Уф╗Лч╗Нф╕Лш┐Щф╕Йф╕кхЗ╜цХ░чЪДф╕╗ф╜УщА╗ш╛СхТМхЕ│щФоц╡БчиЛ</p> <h3 id="ф╕╗х╛кчОп-aemain-хЗ╜цХ░"><a href="#ф╕╗х╛кчОп-aemain-хЗ╜цХ░" class="header-anchor">#</a> ф╕╗х╛кчОпя╝ЪaeMain хЗ╜цХ░</h3> <p>цИСф╗мхЕИцЭечЬЛф╕Л aeMain хЗ╜цХ░уАВ</p> <p>aeMain хЗ╜цХ░чЪДщА╗ш╛Сх╛ИчоАхНХя╝Мх░▒цШп<strong>чФиф╕Аф╕кх╛кчОпф╕НхБЬхЬ░хИдцЦнф║Лф╗╢х╛кчОпчЪДхБЬцнвцаЗшо░</strong>уАВхжВцЮЬф║Лф╗╢х╛кчОпчЪДхБЬцнвцаЗшо░швлшо╛ч╜оф╕║trueя╝МщВгф╣ИщТИхп╣ф║Лф╗╢цНХшО╖уАБхИЖхПСхТМхдДчРЖчЪДцХ┤ф╕кф╕╗х╛кчОпх░▒хБЬцнвф║Жя╝ЫхРжхИЩя╝Мф╕╗х╛кчОпф╝Ъф╕АчЫ┤цЙзшбМуАВaeMain хЗ╜цХ░чЪДф╕╗ф╜Уф╗гчаБхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">aeMain</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    eventLoop<span class="token operator">-&gt;</span>stop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventLoop<span class="token operator">-&gt;</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        тАж
        <span class="token function">aeProcessEvents</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">,</span> AE_ALL_EVENTS<span class="token operator">|</span>AE_CALL_AFTER_SLEEP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>щВгф╣Иш┐ЩщЗМф╜ахПпшГ╜шжБщЧоф║Жя╝М<strong>aeMain хЗ╜цХ░цШпхЬихУкщЗМшвлш░ГчФичЪДхСвя╝Я</strong></p> <p>цМЙчЕзф║Лф╗╢щй▒хКицбЖцЮ╢чЪДч╝ЦчиЛшзДшМГцЭешп┤я╝М<strong>цбЖцЮ╢ф╕╗х╛кчОпцШпхЬицЬНхКбхЩичиЛх║ПхИЭхзЛхМЦхоМцИРхРОя╝Мх░▒ф╝Ъх╝АхзЛцЙзшбМ</strong>уАВхЫацндя╝МхжВцЮЬцИСф╗мцККчЫохЕЙш╜мхРС Redis цЬНхКбхЩихИЭхзЛхМЦчЪДхЗ╜цХ░я╝Мх░▒ф╝ЪхПСчО░цЬНхКбхЩичиЛх║ПчЪД main хЗ╜цХ░хЬихоМцИР Redis server чЪДхИЭхзЛхМЦхРОя╝Мф╝Ъш░ГчФи aeMain хЗ╜цХ░х╝АхзЛцЙзшбМф║Лф╗╢щй▒хКицбЖцЮ╢уАВхжВцЮЬф╜ацГ│хЕ╖ф╜УцЯечЬЛmainхЗ╜цХ░я╝МmainхЗ╜цХ░хЬи<a href="https://github.com/redis/redis/blob/5.0/src/server.c" target="_blank" rel="noopener noreferrer">server.c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>цЦЗф╗╢ф╕ня╝МцИСф╗мхЬи<a href="https://time.geekbang.org/column/article/406556" target="_blank" rel="noopener noreferrer">чмм8шо▓<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ф╕нф╗Лч╗Нш┐ЗшпецЦЗф╗╢я╝Мserver.cф╕╗шжБчФиф║ОхИЭхзЛхМЦцЬНхКбхЩихТМцЙзшбМцЬНхКбхЩицХ┤ф╜УцОзхИ╢ц╡БчиЛя╝Мф╜ахПпф╗ехЫЮщб╛ф╕ЛуАВ</p> <p>ф╕Нш┐Зя╝МцЧвчД╢aeMainхЗ╜цХ░хМЕхРлф║Жф║Лф╗╢цбЖцЮ╢чЪДф╕╗х╛кчОпя╝М**щВгф╣ИхЬиф╕╗х╛кчОпф╕ня╝Мф║Лф╗╢хПИцШпхжВф╜ХшвлцНХшО╖уАБхИЖхПСхТМхдДчРЖхСвя╝Я**ш┐Щх░▒цШпчФ▒aeProcessEventsхЗ╜цХ░цЭехоМцИРчЪДф║ЖуАВ</p> <h3 id="ф║Лф╗╢цНХшО╖ф╕ОхИЖхПС-aeprocessevents-хЗ╜цХ░"><a href="#ф║Лф╗╢цНХшО╖ф╕ОхИЖхПС-aeprocessevents-хЗ╜цХ░" class="header-anchor">#</a> ф║Лф╗╢цНХшО╖ф╕ОхИЖхПСя╝ЪaeProcessEvents хЗ╜цХ░</h3> <p>aeProcessEvents хЗ╜цХ░хоЮчО░чЪДф╕╗шжБхКЯшГ╜я╝МхМЕцЛм</p> <ul><li>цНХшО╖ф║Лф╗╢</li> <li>хИдцЦнф║Лф╗╢ч▒╗хЮЛ</li> <li>ш░ГчФихЕ╖ф╜УчЪДф║Лф╗╢хдДчРЖхЗ╜цХ░я╝Мф╗ОшАМхоЮчО░ф║Лф╗╢чЪДхдДчРЖ</li></ul> <p>ф╗О aeProcessEvents хЗ╜цХ░чЪДф╕╗ф╜Уч╗УцЮДф╕ня╝МцИСф╗мхПпф╗ечЬЛхИ░ф╕╗шжБцЬЙф╕Йф╕к if цЭбф╗╢хИЖцФпя╝МхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">aeProcessEvents</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> processed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> numevents<span class="token punctuation">;</span>
 
    <span class="token comment">/* шЛец▓бцЬЙф║Лф╗╢хдДчРЖя╝МхИЩчлЛхИ╗ш┐ФхЫЮ*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_TIME_EVENTS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_FILE_EVENTS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token comment">/*хжВцЮЬцЬЙIOф║Лф╗╢хПСчФЯя╝МцИЦшАЕч┤зцАечЪДцЧ╢щЧ┤ф║Лф╗╢хПСчФЯя╝МхИЩх╝АхзЛхдДчРЖ*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token operator">-&gt;</span>maxfd <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_TIME_EVENTS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_DONT_WAIT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       тАж
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* цгАцЯецШпхРжцЬЙцЧ╢щЧ┤ф║Лф╗╢я╝МшЛецЬЙя╝МхИЩш░ГчФиprocessTimeEventsхЗ╜цХ░хдДчРЖ */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_TIME_EVENTS<span class="token punctuation">)</span>
        processed <span class="token operator">+=</span> <span class="token function">processTimeEvents</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* ш┐ФхЫЮх╖▓ч╗ПхдДчРЖчЪДцЦЗф╗╢цИЦцЧ╢щЧ┤*/</span>
    <span class="token keyword">return</span> processed<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>ш┐Щф╕Йф╕кхИЖцФпхИЖхИлхп╣х║Фф║Жф╗еф╕Лф╕ЙчзНцГЕхЖ╡я╝Ъ</p> <ul><li>цГЕхЖ╡ф╕Ая╝ЪцЧвц▓бцЬЙцЧ╢щЧ┤ф║Лф╗╢я╝Мф╣Яц▓бцЬЙч╜Сч╗Ьф║Лф╗╢я╝Ы</li> <li>цГЕхЖ╡ф║Мя╝ЪцЬЙIOф║Лф╗╢цИЦшАЕцЬЙщЬАшжБч┤зцАехдДчРЖчЪДцЧ╢щЧ┤ф║Лф╗╢я╝Ы</li> <li>цГЕхЖ╡ф╕Йя╝ЪхПкцЬЙцЩощАЪчЪДцЧ╢щЧ┤ф║Лф╗╢уАВ</li></ul> <p>щВгф╣Ихп╣ф║Очммф╕АчзНцГЕхЖ╡цЭешп┤я╝МхЫаф╕║ц▓бцЬЙф╗╗ф╜Хф║Лф╗╢щЬАшжБхдДчРЖя╝МaeProcessEventsхЗ╜цХ░х░▒ф╝ЪчЫ┤цОеш┐ФхЫЮхИ░aeMainчЪДф╕╗х╛кчОпя╝Мх╝АхзЛф╕Лф╕Аш╜очЪДх╛кчОпя╝ЫшАМхп╣ф║Очммф╕ЙчзНцГЕхЖ╡цЭешп┤я╝МшпецГЕхЖ╡хПСчФЯцЧ╢хПкцЬЙцЩощАЪцЧ╢щЧ┤ф║Лф╗╢хПСчФЯя╝МцЙАф╗еaeMainхЗ╜цХ░ф╝Ъш░ГчФиф╕УщЧихдДчРЖцЧ╢щЧ┤ф║Лф╗╢чЪДхЗ╜цХ░processTimeEventsя╝Мхп╣цЧ╢щЧ┤ф║Лф╗╢ш┐ЫшбМхдДчРЖуАВ</p> <p>чО░хЬия╝МцИСф╗мхЖНцЭечЬЛчЬЛчммф║МчзНцГЕхЖ╡уАВ</p> <p>щжЦхЕИя╝Мх╜УшпецГЕхЖ╡хПСчФЯцЧ╢я╝МRedisщЬАшжБцНХшО╖хПСчФЯчЪДч╜Сч╗Ьф║Лф╗╢я╝Мх╣╢ш┐ЫшбМчЫ╕х║ФчЪДхдДчРЖуАВщВгф╣Иф╗ОRedisц║РчаБф╕нцИСф╗мхПпф╗ехИЖцЮРх╛ЧхИ░я╝МхЬиш┐ЩчзНцГЕхЖ╡ф╕Ля╝М<strong>aeApiPoll хЗ╜цХ░ф╝Ъшвлш░ГчФия╝МчФицЭецНХшО╖ф║Лф╗╢</strong>я╝МхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">aeProcessEvents</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>eventLoop<span class="token operator">-&gt;</span>maxfd <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_TIME_EVENTS<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> AE_DONT_WAIT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
       <span class="token comment">//ш░ГчФи aeApiPoll хЗ╜цХ░цНХшО╖ф║Лф╗╢</span>
       numevents <span class="token operator">=</span> <span class="token function">aeApiPoll</span><span class="token punctuation">(</span>eventLoop<span class="token punctuation">,</span> tvp<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
уАН
</code></pre></div><p><strong>щВгф╣Ия╝МaeApiPollцШпхжВф╜ХцНХшО╖ф║Лф╗╢хСвя╝Я</strong></p> <p>хоЮщЩЕф╕Кя╝МRedisцШпф╛Эш╡Цф║ОцУНф╜Ьч│╗ч╗Ях║Хх▒ВцПРф╛ЫчЪД <strong>IOхдЪш╖пхдНчФицЬ║хИ╢</strong>я╝МцЭехоЮчО░ф║Лф╗╢цНХшО╖я╝МцгАцЯецШпхРжцЬЙцЦ░чЪДш┐ЮцОеуАБшп╗хЖЩф║Лф╗╢хПСчФЯуАВф╕║ф║ЖщАВщЕНф╕НхРМчЪДцУНф╜Ьч│╗ч╗Яя╝МRedisхп╣ф╕НхРМцУНф╜Ьч│╗ч╗ЯхоЮчО░чЪДч╜Сч╗ЬIOхдЪш╖пхдНчФихЗ╜цХ░я╝МщГ╜ш┐ЫшбМф║Жч╗Яф╕АчЪДх░БшгЕя╝Мх░БшгЕхРОчЪДф╗гчаБхИЖхИлщАЪш┐Зф╗еф╕ЛхЫЫф╕кцЦЗф╗╢ф╕нхоЮчО░я╝Ъ</p> <ul><li>ae_epoll.cя╝Мхп╣х║ФLinuxф╕КчЪДIOхдНчФихЗ╜цХ░epollя╝Ы</li> <li>ae_evport.cя╝Мхп╣х║ФSolarisф╕КчЪДIOхдНчФихЗ╜цХ░evportя╝Ы</li> <li>ae_kqueue.cя╝Мхп╣х║ФmacOSцИЦFreeBSDф╕КчЪДIOхдНчФихЗ╜цХ░kqueueя╝Ы</li> <li>ae_select.cя╝Мхп╣х║ФLinuxя╝ИцИЦWindowsя╝ЙчЪДIOхдНчФихЗ╜цХ░selectуАВ</li></ul> <p>ш┐Щца╖я╝МхЬицЬЙф║Жш┐Щф║Ых░БшгЕф╗гчаБхРОя╝МRedisхЬиф╕НхРМчЪДцУНф╜Ьч│╗ч╗Яф╕Кш░ГчФиIOхдЪш╖пхдНчФиAPIцЧ╢я╝Мх░▒хПпф╗ещАЪш┐Зч╗Яф╕АчЪДцОехПгцЭеш┐ЫшбМш░ГчФиф║ЖуАВ</p> <p>ф╕Нш┐ЗчЬЛхИ░ш┐ЩщЗМя╝Мф╜ахПпшГ╜ш┐ШцШпф╕НхдкцШОчЩ╜Redisх░БшгЕчЪДхЕ╖ф╜УцУНф╜Ья╝МцЙАф╗еш┐ЩщЗМя╝МцИСх░▒ф╗ехЬицЬНхКбхЩичлпцЬАх╕╕чФичЪДLinuxцУНф╜Ьч│╗ч╗Яф╕║ф╛Ля╝Мч╗Щф╜аф╗Лч╗Нф╕ЛRedisцШпхжВф╜Хх░БшгЕLinuxф╕КцПРф╛ЫчЪДIOхдНчФиAPIчЪДуАВ</p> <p>щжЦхЕИя╝МLinuxф╕КцПРф╛Ыф║Ж<strong>epoll_wait API</strong>я╝МчФиф║ОцгАц╡ЛхЖЕца╕ф╕нхПСчФЯчЪДч╜Сч╗ЬIOф║Лф╗╢уАВхЬи<a href="https://github.com/redis/redis/blob/5.0/src/ae_epoll.c" target="_blank" rel="noopener noreferrer">ae_epoll.c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>цЦЗф╗╢ф╕ня╝М<strong>aeApiPollхЗ╜цХ░</strong>х░▒цШпх░БшгЕф║Жхп╣epoll_waitчЪДш░ГчФиуАВ</p> <p>ш┐Щф╕кх░БшгЕчиЛх║ПхжВф╕ЛцЙАчд║я╝МхЕ╢ф╕нф╜ахПпф╗ечЬЛхИ░я╝МхЬиaeApiPollхЗ╜цХ░ф╕нчЫ┤цОеш░ГчФиф║Жepoll_waitхЗ╜цХ░я╝Мх╣╢х░Жepollш┐ФхЫЮчЪДф║Лф╗╢ф┐бцБпф┐ЭхнШш╡╖цЭечЪДщА╗ш╛Ся╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">aeApiPoll</span><span class="token punctuation">(</span>aeEventLoop <span class="token operator">*</span>eventLoop<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">timeval</span> <span class="token operator">*</span>tvp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    тАж
    <span class="token comment">//ш░ГчФиepoll_waitшО╖хПЦчЫСхРмхИ░чЪДф║Лф╗╢</span>
    retval <span class="token operator">=</span> <span class="token function">epoll_wait</span><span class="token punctuation">(</span>state<span class="token operator">-&gt;</span>epfd<span class="token punctuation">,</span>state<span class="token operator">-&gt;</span>events<span class="token punctuation">,</span>eventLoop<span class="token operator">-&gt;</span>setsize<span class="token punctuation">,</span>
            tvp <span class="token operator">?</span> <span class="token punctuation">(</span>tvp<span class="token operator">-&gt;</span>tv_sec<span class="token operator">*</span><span class="token number">1000</span> <span class="token operator">+</span> tvp<span class="token operator">-&gt;</span>tv_usec<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>retval <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> j<span class="token punctuation">;</span>
        <span class="token comment">//шО╖х╛ЧчЫСхРмхИ░чЪДф║Лф╗╢цХ░щЗП</span>
        numevents <span class="token operator">=</span> retval<span class="token punctuation">;</span>
        <span class="token comment">//щТИхп╣цпПф╕Аф╕кф║Лф╗╢я╝Мш┐ЫшбМхдДчРЖ</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> numevents<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             #ф┐ЭхнШф║Лф╗╢ф┐бцБп
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> numevents<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕║ф║Жшойф╜ацЫ┤хКац╕ЕцЩ░хЬ░чРЖшзгя╝Мф║Лф╗╢щй▒хКицбЖцЮ╢цШпхжВф╜ХхоЮчО░цЬАч╗Ихп╣epoll_waitчЪДш░ГчФия╝Мш┐ЩщЗМцИСф╣ЯцФ╛ф║Жф╕Ах╝ачд║цДПхЫ╛я╝Мф╜ахПпф╗ечЬЛчЬЛцХ┤ф╕кш░ГчФищУ╛цШпхжВф╜Хх╖еф╜ЬхТМхоЮчО░чЪДуАВ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409151446771.png" alt="image-20240915144649696"></p> <p>OKя╝МчО░хЬицИСф╗мх░▒х╖▓ч╗ПхЬи aeMain хЗ╜цХ░ф╕ня╝МчЬЛхИ░ф║Ж aeProcessEvents хЗ╜цХ░швлш░ГчФия╝Мх╣╢чФиф║ОцНХшО╖хТМхИЖхПСф║Лф╗╢чЪДхЯ║цЬмхдДчРЖщА╗ш╛СуАВ</p> <p>**щВгф╣Ия╝Мф║Лф╗╢хЕ╖ф╜УцШпчФ▒хУкф╕кхЗ╜цХ░цЭехдДчРЖчЪДхСвя╝Я**ш┐Щх░▒хТМцбЖцЮ╢ф╕нчЪД aeCreateFileEvents хЗ╜цХ░цЬЙхЕ│ф║ЖуАВ</p> <h3 id="ф║Лф╗╢ц│ихЖМ-aecreatefileevent-хЗ╜цХ░"><a href="#ф║Лф╗╢ц│ихЖМ-aecreatefileevent-хЗ╜цХ░" class="header-anchor">#</a> ф║Лф╗╢ц│ихЖМя╝ЪaeCreateFileEvent хЗ╜цХ░</h3> <p>цИСф╗мчЯещБУя╝Мх╜УRedisхРпхКихРОя╝МцЬНхКбхЩичиЛх║ПчЪД main хЗ╜цХ░ф╝Ъш░ГчФи initSever хЗ╜цХ░цЭеш┐ЫшбМхИЭхзЛхМЦя╝МшАМхЬихИЭхзЛхМЦчЪДш┐ЗчиЛф╕ня╝МaeCreateFileEvent х░▒ф╝Ъшвл initServer хЗ╜цХ░ш░ГчФия╝МчФиф║Оц│ихЖМшжБчЫСхРмчЪДф║Лф╗╢я╝Мф╗ехПКчЫ╕х║ФчЪДф║Лф╗╢хдДчРЖхЗ╜цХ░уАВ</p> <p>хЕ╖ф╜УцЭешп┤я╝МхЬи initServer хЗ╜цХ░чЪДцЙзшбМш┐ЗчиЛф╕ня╝МinitServer хЗ╜цХ░ф╝Ъца╣цНохРпчФичЪДIPчлпхПгф╕кцХ░я╝Мф╕║цпПф╕к IP члпхПгф╕КчЪДч╜Сч╗Ьф║Лф╗╢я╝Мш░ГчФиaeCreateFileEventя╝МхИЫх╗║хп╣ AE_READABLE ф║Лф╗╢чЪДчЫСхРмя╝Мх╣╢ф╕Фц│ихЖМ AE_READABLE ф║Лф╗╢чЪДхдДчРЖ handlerя╝Мф╣Ях░▒цШп acceptTcpHandler хЗ╜цХ░уАВш┐Щф╕Аш┐ЗчиЛхжВф╕ЛхЫ╛цЙАчд║я╝Ъ</p> <p><img src="https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409151448913.png" alt="image-20240915144801833"></p> <p>цЙАф╗еш┐ЩщЗМцИСф╗мхПпф╗ечЬЛхИ░я╝М<strong>AE_READABLE ф║Лф╗╢х░▒цШпховцИ╖члпчЪДч╜Сч╗Ьш┐ЮцОеф║Лф╗╢я╝МшАМхп╣х║ФчЪДхдДчРЖхЗ╜цХ░х░▒цШпцОецФ╢TCPш┐ЮцОешп╖ц▒В</strong>уАВф╕ЛщЭвчЪДчд║ф╛Лф╗гчаБф╕ня╝МцШ╛чд║ф║ЖinitServerф╕нш░ГчФиaeCreateFileEventчЪДщГихИЖчЙЗцо╡я╝Мф╜ахПпф╗ечЬЛф╕Ля╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">initServer</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    тАж
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> server<span class="token punctuation">.</span>ipfd_count<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">aeCreateFileEvent</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>el<span class="token punctuation">,</span> server<span class="token punctuation">.</span>ipfd<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> AE_READABLE<span class="token punctuation">,</span>
            acceptTcpHandler<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">==</span> AE_ERR<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token function">serverPanic</span><span class="token punctuation">(</span><span class="token string">&quot;Unrecoverable error creating server.ipfd file event.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	тАж
<span class="token punctuation">}</span>
</code></pre></div><p>**щВгф╣Ия╝МaeCreateFileEvent хжВф╜ХхоЮчО░ф║Лф╗╢хТМхдДчРЖхЗ╜цХ░чЪДц│ихЖМхСвя╝Я **ш┐Щх░▒хТМхИЪцЙНцИСф╗Лч╗НчЪДRedisхп╣х║Хх▒ВIOхдЪш╖пхдНчФихЗ╜цХ░х░БшгЕцЬЙхЕ│ф║Жя╝Мф╕ЛщЭвцИСф╗НчД╢ф╗еLinuxч│╗ч╗Яф╕║ф╛Ля╝МцЭеч╗Щф╜ашп┤цШОф╕Аф╕ЛуАВ</p> <p>щжЦхЕИя╝МLinuxцПРф╛Ыф║Ж<strong>epoll_ctl API</strong>я╝МчФиф║ОхвЮхКацЦ░чЪДшзВхпЯф║Лф╗╢уАВшАМ Redis хЬицндхЯ║чбАф╕Кя╝Мх░БшгЕф║Ж aeApiAddEvent хЗ╜цХ░я╝Мхп╣epoll_ctlш┐ЫшбМш░ГчФиуАВ</p> <p>цЙАф╗еш┐Щца╖ф╕АцЭея╝МaeCreateFileEvent х░▒ф╝Ъш░ГчФиaeApiAddEventя╝МчД╢хРО aeApiAddEvent хЖНщАЪш┐Зш░ГчФи epoll_ctlя╝МцЭец│ихЖМх╕МцЬЫчЫСхРмчЪДф║Лф╗╢хТМчЫ╕х║ФчЪДхдДчРЖхЗ╜цХ░уАВчнЙхИ░ aeProceeEvents хЗ╜цХ░цНХшО╖хИ░хоЮщЩЕф║Лф╗╢цЧ╢я╝МхоГх░▒ф╝Ъш░ГчФиц│ихЖМчЪДхЗ╜цХ░хп╣ф║Лф╗╢ш┐ЫшбМхдДчРЖф║ЖуАВ</p> <p>хе╜ф║Жя╝МхИ░ш┐ЩщЗМя╝МцИСф╗мх░▒х╖▓ч╗ПхЕищГиф║Жшзгф║ЖRedisф╕нхоЮчО░ф║Лф╗╢щй▒хКицбЖцЮ╢чЪДф╕Йф╕кхЕ│щФохЗ╜цХ░я╝ЪaeMainуАБaeProcessEventsя╝Мф╗ехПКaeCreateFileEventуАВх╜Уф╜ашжБхО╗хоЮчО░ф╕Аф╕кф║Лф╗╢щй▒хКицбЖцЮ╢цЧ╢я╝МRedisчЪДшо╛шобцАЭцГ│х░▒хЕ╖цЬЙх╛Ихе╜чЪДхПВшАГцДПф╣ЙуАВ</p> <p>цЬАхРОцИСхЖНх╕жф╜ацЭечоАхНХхЬ░хЫЮщб╛ф╕Ля╝МхЬихоЮчО░ф║Лф╗╢щй▒хКицбЖцЮ╢чЪДцЧ╢хАЩя╝Мф╜ащЬАшжБхЕИхоЮчО░ф╕Аф╕кф╕╗х╛кчОпхЗ╜цХ░я╝Ихп╣х║ФaeMainя╝Йя╝Мш┤Яш┤гф╕АчЫ┤ш┐РшбМцбЖцЮ╢уАВхЕ╢цмбя╝Мф╜ащЬАшжБч╝ЦхЖЩф║Лф╗╢ц│ихЖМхЗ╜цХ░я╝Ихп╣х║ФaeCreateFileEventя╝Йя╝МчФицЭец│ихЖМчЫСхРмчЪДф║Лф╗╢хТМф║Лф╗╢хп╣х║ФчЪДхдДчРЖхЗ╜цХ░уАВ<strong>хПкцЬЙхп╣ф║Лф╗╢хТМхдДчРЖхЗ╜цХ░ш┐ЫшбМф║Жц│ихЖМя╝МцЙНшГ╜хЬиф║Лф╗╢хПСчФЯцЧ╢ш░ГчФичЫ╕х║ФчЪДхЗ╜цХ░ш┐ЫшбМхдДчРЖуАВ</strong></p> <p>цЬАхРОя╝Мф╜ащЬАшжБч╝ЦхЖЩф║Лф╗╢чЫСхРмуАБхИЖхПСхЗ╜цХ░я╝Ихп╣х║ФaeProcessEventsя╝Йя╝Мш┤Яш┤гш░ГчФицУНф╜Ьч│╗ч╗Ях║Хх▒ВхЗ╜цХ░цЭецНХшО╖ч╜Сч╗Ьш┐ЮцОеуАБшп╗уАБхЖЩф║Лф╗╢я╝Мх╣╢хИЖхПСч╗Щф╕НхРМхдДчРЖхЗ╜цХ░ш┐Ыф╕АцнехдДчРЖуАВ</p> <h2 id="цА╗ч╗У"><a href="#цА╗ч╗У" class="header-anchor">#</a> цА╗ч╗У</h2> <p>Redisф╕АчЫ┤швлчз░ф╕║хНХч║┐чиЛцЮ╢цЮДя╝МцМЙчЕзцИСф╗мщАЪх╕╕чЪДчРЖшзгя╝МхНХф╕кч║┐чиЛхПкшГ╜хдДчРЖхНХф╕кховцИ╖члпчЪДшп╖ц▒Вя╝Мф╜ЖцШпхЬихоЮщЩЕф╜┐чФицЧ╢я╝МцИСф╗мф╝ЪчЬЛхИ░RedisшГ╜хРМцЧ╢хТМцИРчЩ╛ф╕КхНГф╕кховцИ╖члпш┐ЫшбМф║дф║Тя╝Мш┐Щх░▒цШпхЫаф╕║RedisхЯ║ф║ОReactorцибхЮЛя╝МхоЮчО░ф║ЖщлШцАзшГ╜чЪДч╜Сч╗ЬцбЖцЮ╢я╝М<strong>щАЪш┐Зф║Лф╗╢щй▒хКицбЖцЮ╢я╝МRedisхПпф╗еф╜┐чФиф╕Аф╕кх╛кчОпцЭеф╕НцЦнцНХшО╖уАБхИЖхПСхТМхдДчРЖховцИ╖члпф║зчФЯчЪДч╜Сч╗Ьш┐ЮцОеуАБцХ░цНошп╗хЖЩф║Лф╗╢уАВ</strong></p> <p>ф╕║ф║ЖцЦ╣ф╛┐ф╜аф╗Оф╗гчаБх▒ВщЭвцОМцПбRedisф║Лф╗╢щй▒хКицбЖцЮ╢чЪДхоЮчО░я╝МцИСцА╗ч╗Уф║Жф╕Аф╕кшбица╝я╝МхЕ╢ф╕нхИЧхЗ║ф║ЖRedisф║Лф╗╢щй▒хКицбЖцЮ╢чЪДф╕╗шжБхЗ╜цХ░хТМхКЯшГ╜уАБхоГф╗мцЙАх▒ЮчЪДCцЦЗф╗╢я╝Мф╗ехПКш┐Щф║ЫхЗ╜цХ░цЬмш║лцШпхЬиRedisф╗гчаБч╗УцЮДф╕нчЪДхУкщЗМшвлш░ГчФиуАВф╜ахПпф╗еф╜┐чФиш┐Щх╝ашбица╝я╝МцЭех╖йхЫ║ф╗Кхдйш┐ЩшКВшп╛хнжф╣ачЪДф║Лф╗╢щй▒хКицбЖцЮ╢уАВ</p> <p>цИСф╣ЯхЖНх╝║ш░Гф╕Ля╝Мш┐ЩшКВшп╛цИСф╗мф╕╗шжБхЕ│ц│ичЪДцШпя╝Мф║Лф╗╢щй▒хКицбЖцЮ╢чЪДхЯ║цЬмш┐РшбМц╡БчиЛя╝Мх╣╢ф╗еховцИ╖члпш┐ЮцОеф║Лф╗╢ф╕║ф╛Ля╝Мх░ЖцбЖцЮ╢ф╕╗х╛кчОпуАБф║Лф╗╢цНХшО╖хИЖхПСхТМф║Лф╗╢ц│ихЖМчЪДхЕ│щФоцнещкдф╕▓ш╡╖цЭея╝Мч╗Щф╜ахБЪф║Жф╗Лч╗НуАВRedisф║Лф╗╢щй▒хКицбЖцЮ╢чЫСхРмхдДчРЖчЪДф║Лф╗╢я╝Мш┐ШхМЕцЛмховцИ╖члпшп╖ц▒ВуАБцЬНхКбхЩичлпхЖЩцХ░цНоф╗ехПКхСицЬЯцАзцУНф╜ЬчнЙя╝Мш┐Щф╣ЯцШпцИСф╕Лф╕АшКВшп╛шжБхТМф╜аф╕Аш╡╖хнжф╣ачЪДф╕╗шжБхЖЕхо╣уАВ</p> <h2 id="хПВшАГцЦЗчМо"><a href="#хПВшАГцЦЗчМо" class="header-anchor">#</a> хПВшАГцЦЗчМо</h2> <p><a href="https://time.geekbang.org/column/intro/100084301?utm_campaign=geektime_search&amp;utm_content=geektime_search&amp;utm_medium=geektime_search&amp;utm_source=geektime_search&amp;utm_term=geektime_search" target="_blank" rel="noopener noreferrer">Redisц║РчаБхЙЦцЮРф╕ОхоЮцИШ_Redis_Redisц║РчаБ_цХ░цНоч╗УцЮД_ф╕╗ф╗ОхдНхИ╢_ч╝УхнШ_щЫЖч╛д_хИЖх╕Гх╝ПцХ░цНох║У_щФохА╝цХ░цНох║У_ф║Лф╗╢щй▒хКицбЖцЮ╢-цЮБховцЧ╢щЧ┤ (geekbang.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://book.douban.com/subject/25900156/" target="_blank" rel="noopener noreferrer">Redisшо╛шобф╕ОхоЮчО░ (ш▒ЖчУг) (douban.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/Redis ч│╗ч╗Яшо╛шоб/03.ф╕╗ч║┐/05.Redis чЪД Reactor цибхЮЛ.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░ф║О:</span> <span class="time">2024/09/16, 13:27:00</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/d4ecb9/" class="prev">Redis Server хИЭхзЛхМЦ</a></span> <span class="next"><a href="/pages/264b06/">ц╖▒хЕе Redis ф║Лф╗╢щй▒хКицбЖцЮ╢</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.f1bdf1ca.js" defer></script><script src="/assets/js/2.933750c6.js" defer></script><script src="/assets/js/46.7ddc3ffa.js" defer></script><script src="/assets/js/7.7eb70372.js" defer></script>
  </body>
</html>
