<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДшпехжВф╜Хч╗ЖхМЦшо╛шобя╝Я | Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="ц░┤ц╗┤чЯ│чй┐я╝Мшо╛шобцЧащУ╢х╝╣">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.3b389ff4.css" as="style"><link rel="preload" href="/assets/js/app.e6c7c0bc.js" as="script"><link rel="preload" href="/assets/js/2.c1dbdf51.js" as="script"><link rel="preload" href="/assets/js/12.2feff802.js" as="script"><link rel="prefetch" href="/assets/js/10.ce9e2824.js"><link rel="prefetch" href="/assets/js/11.4b96b543.js"><link rel="prefetch" href="/assets/js/13.4332a769.js"><link rel="prefetch" href="/assets/js/14.464e0155.js"><link rel="prefetch" href="/assets/js/15.0d61cf57.js"><link rel="prefetch" href="/assets/js/16.506c965c.js"><link rel="prefetch" href="/assets/js/17.0b9e4b65.js"><link rel="prefetch" href="/assets/js/18.c7917c05.js"><link rel="prefetch" href="/assets/js/19.fad48692.js"><link rel="prefetch" href="/assets/js/20.ff68a659.js"><link rel="prefetch" href="/assets/js/21.93b2e430.js"><link rel="prefetch" href="/assets/js/22.e8989777.js"><link rel="prefetch" href="/assets/js/23.de5a9e3c.js"><link rel="prefetch" href="/assets/js/24.914d458e.js"><link rel="prefetch" href="/assets/js/25.b6565a06.js"><link rel="prefetch" href="/assets/js/26.977f0fd3.js"><link rel="prefetch" href="/assets/js/27.7bde72bc.js"><link rel="prefetch" href="/assets/js/28.e34d1ee9.js"><link rel="prefetch" href="/assets/js/29.b4c0912f.js"><link rel="prefetch" href="/assets/js/3.d5abcf7b.js"><link rel="prefetch" href="/assets/js/30.662f616d.js"><link rel="prefetch" href="/assets/js/31.8a8e803f.js"><link rel="prefetch" href="/assets/js/32.b41ef25a.js"><link rel="prefetch" href="/assets/js/33.24569bcc.js"><link rel="prefetch" href="/assets/js/34.dac446b7.js"><link rel="prefetch" href="/assets/js/35.f6fabb4e.js"><link rel="prefetch" href="/assets/js/36.85b2b5dc.js"><link rel="prefetch" href="/assets/js/37.da59a00f.js"><link rel="prefetch" href="/assets/js/38.655f6ff9.js"><link rel="prefetch" href="/assets/js/39.b0056866.js"><link rel="prefetch" href="/assets/js/4.d946b097.js"><link rel="prefetch" href="/assets/js/40.3ddc2c59.js"><link rel="prefetch" href="/assets/js/41.16557a6f.js"><link rel="prefetch" href="/assets/js/42.0e64221c.js"><link rel="prefetch" href="/assets/js/43.7976c385.js"><link rel="prefetch" href="/assets/js/44.71553edf.js"><link rel="prefetch" href="/assets/js/45.1313072b.js"><link rel="prefetch" href="/assets/js/46.c2baf55f.js"><link rel="prefetch" href="/assets/js/47.635abf6e.js"><link rel="prefetch" href="/assets/js/48.c68ae1bc.js"><link rel="prefetch" href="/assets/js/49.0ded727d.js"><link rel="prefetch" href="/assets/js/5.39afb5af.js"><link rel="prefetch" href="/assets/js/50.e00d3a7e.js"><link rel="prefetch" href="/assets/js/51.9da875f4.js"><link rel="prefetch" href="/assets/js/52.d552ff92.js"><link rel="prefetch" href="/assets/js/53.dffecfdc.js"><link rel="prefetch" href="/assets/js/54.e64b0f07.js"><link rel="prefetch" href="/assets/js/55.bf7710d3.js"><link rel="prefetch" href="/assets/js/56.2d336989.js"><link rel="prefetch" href="/assets/js/6.7a2f25e5.js"><link rel="prefetch" href="/assets/js/7.a5188780.js"><link rel="prefetch" href="/assets/js/8.f8705c03.js"><link rel="prefetch" href="/assets/js/9.b279253b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3b389ff4.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="чЫох╜Х" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Echo ч│╗ч╗Яшо╛шобф╣Лч╛О" class="logo"> <span class="site-name can-hide">Echo ч│╗ч╗Яшо╛шобф╣Лч╛О</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ЁЯПащжЦщб╡</a></div><div class="nav-item"><a href="/pages/fccd91/" class="nav-link">тЬТя╕ПчГнщЧичоЧц│Х</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯОЦя╕Пш╡ПцЮРч╗ПхЕ╕</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/252196/" class="nav-link">Redis ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/b9733b/" class="nav-link">Kafka ч│╗ч╗Яшо╛шоб</a></li><li class="dropdown-item"><!----> <a href="/pages/4601ca/" class="nav-link">Nginx ч│╗ч╗Яшо╛шоб</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб" class="dropdown-title"><!----> <span class="title" style="display:;">ЁЯзСтАНЁЯТ╗хоЮцИШч│╗ч╗Яшо╛шоб</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/84cb49/" class="nav-link">шо╛шобхЯ║чбАшо╛цЦ╜</a></li><li class="dropdown-item"><!----> <a href="/pages/a95d7d/" class="nav-link">шо╛шобчГнщЧих║ФчФи</a></li><li class="dropdown-item"><!----> <a href="/pages/def08a/" class="nav-link">хЬ║цЩпшо╛шоб</a></li></ul></div></div><div class="nav-item"><a href="/pages/92b2ee/" class="nav-link">тЭУщЧочнФ</a></div><div class="nav-item"><a href="/pages/52ebd8/" class="nav-link">ЁЯСАхКицАБ</a></div> <a href="https://github.com/echo-lxy/echo-system-design" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>цМЗхНЧ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/252196/" class="sidebar-link">ф╗Лч╗Н</a></li><li><a href="/pages/69fbd7/" class="sidebar-link">Redis ф╝кчаБшУЭхЫ╛уАРх┐ЕчЬЛуАС</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>хЯ║чбА</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ee2b16/" class="sidebar-link">list</a></li><li><a href="/pages/2d4311/" class="sidebar-link">Hash</a></li><li><a href="/pages/c7cf4a/" class="sidebar-link">ZSet</a></li><li><a href="/pages/2ab65e/" aria-current="page" class="active sidebar-link">хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДшпехжВф╜Хч╗ЖхМЦшо╛шобя╝Я</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/2ab65e/#хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮД" class="sidebar-link">хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮД</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/2ab65e/#sds-чЪДхЖЕхнШхПЛхе╜шо╛шоб" class="sidebar-link">SDS чЪДхЖЕхнШхПЛхе╜шо╛шоб</a></li><li class="sidebar-sub-header level4"><a href="/pages/2ab65e/#redisobject-ч╗УцЮДф╜Уф╕Оф╜НхЯЯхоЪф╣ЙцЦ╣ц│Х" class="sidebar-link">redisObject ч╗УцЮДф╜Уф╕Оф╜НхЯЯхоЪф╣ЙцЦ╣ц│Х</a></li><li class="sidebar-sub-header level4"><a href="/pages/2ab65e/#х╡МхЕех╝ПхнЧчмжф╕▓" class="sidebar-link">х╡МхЕех╝ПхнЧчмжф╕▓</a></li><li class="sidebar-sub-header level3"><a href="/pages/2ab65e/#хОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИчЪДшо╛шоб" class="sidebar-link">хОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИчЪДшо╛шоб</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/2ab65e/#шКВчЬБхЖЕхнШчЪДцХ░цНошо┐щЧо" class="sidebar-link">шКВчЬБхЖЕхнШчЪДцХ░цНошо┐щЧо</a></li><li class="sidebar-sub-header level2"><a href="/pages/2ab65e/#х░Пч╗У" class="sidebar-link">х░Пч╗У</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ф╕╗ч║┐</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/d4ecb9/" class="sidebar-link">Redis Server хИЭхзЛхМЦ</a></li><li><a href="/pages/34fa27/" class="sidebar-link">Linux ф╕нчЪД IO хдЪш╖пхдНчФи</a></li><li><a href="/pages/d6b00d/" class="sidebar-link">Redis чЪД Reactor цибхЮЛ</a></li><li><a href="/pages/264b06/" class="sidebar-link">ц╖▒хЕе Redis ф║Лф╗╢щй▒хКицбЖцЮ╢</a></li><li><a href="/pages/e6d8ef/" class="sidebar-link">Redis чЪДцЙзшбМцибх╝П</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>цФпч║┐</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b43a19/" class="sidebar-link">LRU чнЦчХе</a></li><li><a href="/pages/b43a89/" class="sidebar-link">LFU чнЦчХе</a></li><li><a href="/pages/f44fbe/" class="sidebar-link">Redis ш┐ЗцЬЯчнЦчХе</a></li><li><a href="/pages/9b17a6/" class="sidebar-link">RDB цМБф╣ЕхМЦ</a></li><li><a href="/pages/9b17a7/" class="sidebar-link">AOF цМБф╣ЕхМЦ</a></li><li><a href="/pages/aa75e9/" class="sidebar-link">Redis ф╕нчЪДх╗╢ш┐ЯчЫСцОз</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>щЫЖч╛д</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ebc8dc/" class="sidebar-link">ф╕╗ф╗ОхдНхИ╢</a></li><li><a href="/pages/af8752/" class="sidebar-link">хУихЕ╡</a></li><li><a href="/pages/040403/" class="sidebar-link">cluster</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="щжЦщб╡" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Redis ч│╗ч╗Яшо╛шоб</span></li><li data-v-06225672><span data-v-06225672>хЯ║чбА</span></li></ul> <div class="info" data-v-06225672><div title="ф╜ЬшАЕ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/brother-one" target="_blank" title="ф╜ЬшАЕ" class="beLink" data-v-06225672>echo</a></div> <div title="хИЫх╗║цЧ╢щЧ┤" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-09-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">чЫох╜Х</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДшпехжВф╜Хч╗ЖхМЦшо╛шобя╝Я<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><p>ф╗КхдйцИСф╗мцЭешБКшБКя╝МRedis ф╕нцШпхжВф╜ХщАЪш┐Зф╝ШхМЦшо╛шобцХ░цНоч╗УцЮДя╝МцЭецПРхНЗхЖЕхнШхИйчФичОЗчЪДуАВ</p> <p>цИСф╗мчЯещБУ Redis цШпхЖЕхнШцХ░цНох║Уя╝МцЙАф╗ея╝МщлШцХИф╜┐чФихЖЕхнШхп╣ Redis чЪДхоЮчО░цЭешп┤щЭЮх╕╕щЗНшжБуАВшАМхоЮщЩЕф╕Кя╝МRedis ф╕╗шжБцШпщАЪш┐Зф╕дхдзцЦ╣щЭвчЪДцКАцЬпцЭецПРхНЗхЖЕхнШф╜┐чФицХИчОЗчЪДя╝МхИЖхИлцШп<strong>цХ░цНоч╗УцЮДчЪДф╝ШхМЦшо╛шобф╕Оф╜┐чФи</strong>я╝Мф╗ехПК<strong>хЖЕхнШцХ░цНоцМЙф╕АхоЪшзДхИЩц╖Шц▒░</strong>уАВ</p> <p>хЕ│ф║ОхЖЕхнШцХ░цНоцМЙшзДхИЩц╖Шц▒░я╝Мш┐ЩцШпщАЪш┐З Redis хЖЕхнШцЫ┐цНвчнЦчХехоЮчО░чЪДя╝Мф╣Ях░▒цШпх░Жх╛Их░Сф╜┐чФичЪДцХ░цНоф╗ОхЖЕхнШф╕нц╖Шц▒░я╝Мф╗ОшАМцККцЬЙщЩРчЪДхЖЕхнШчй║щЧ┤чФиф║Оф┐ЭхнШф╝ЪшвлщвСч╣Бшо┐щЧочЪДцХ░цНоуАВш┐ЩщГихИЖчЪДшо╛шобф╕ОхоЮчО░я╝Мф╕╗шжБхТМхЖЕхнШцЫ┐цНвчнЦчХецЬЙхЕ│я╝МцИСф╝ЪхЬихРОщЭвчЪДч╝УхнШцибхЭЧч╗Щф╜ашпжч╗Жф╗Лч╗НуАВ</p> <p>цЙАф╗еш┐ЩшКВшп╛я╝МцИСф╕╗шжБцШпх╕жф╜ахнжф╣а Redis цХ░цНоч╗УцЮДхЬищЭвхРСхЖЕхнШф╜┐чФицХИчОЗцЦ╣щЭвчЪДф╝ШхМЦя╝МхЕ╢ф╕нхМЕцЛмф╕дцЦ╣щЭвчЪДшо╛шобцАЭш╖пя╝Ъф╕АцШп<strong>хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДшо╛шоб</strong>я╝Ыф║МцШп<strong>хЖЕхнШхПЛхе╜чЪДцХ░цНоф╜┐чФицЦ╣х╝П</strong>уАВ</p> <p>ш┐Щф╕дцЦ╣щЭвчЪДшо╛шобцАЭш╖пхТМхоЮчО░цЦ╣ц│ХцШпхЕ╖цЬЙщАЪчФицАзчЪДя╝Мх╜Уф╜ахЬишо╛шобч│╗ч╗Яш╜пф╗╢цЧ╢я╝МхжВцЮЬщЬАшжБхп╣хЖЕхнШф╜┐чФич▓╛цЙУч╗ЖчоЧя╝Мф╗еф╛┐шКВчЬБхЖЕхнШх╝АщФАя╝Мш┐Щф╕дчзНшо╛шобцЦ╣ц│ХхТМхоЮчО░шАГшЩСх░▒щЭЮх╕╕хА╝х╛Чхнжф╣ахТМцОМцПбуАВ</p> <p>хе╜я╝МцОеф╕ЛцЭея╝МцИСф╗мх░▒хЕИцЭехнжф╣аф╕ЛхЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДшо╛шобуАВ</p> <h2 id="хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮД"><a href="#хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮД" class="header-anchor">#</a> хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮД</h2> <p>щжЦхЕИшжБчЯещБУя╝МхЬи Redis ф╕ня╝МцЬЙф╕ЙчзНцХ░цНоч╗УцЮДщТИхп╣хЖЕхнШф╜┐чФицХИчОЗхБЪф║Жшо╛шобф╝ШхМЦя╝МхИЖхИлцШпчоАхНХхКицАБхнЧчмжф╕▓я╝ИSDSя╝ЙуАБхОЛч╝йхИЧшбия╝Иziplistя╝ЙхТМцХ┤цХ░щЫЖхРИя╝Иintsetя╝ЙуАВф╕ЛщЭвя╝МцИСф╗мх░▒хИЖхИлцЭехнжф╣аф╕Аф╕ЛуАВ</p> <h3 id="sds-чЪДхЖЕхнШхПЛхе╜шо╛шоб"><a href="#sds-чЪДхЖЕхнШхПЛхе╜шо╛шоб" class="header-anchor">#</a> SDS чЪДхЖЕхнШхПЛхе╜шо╛шоб</h3> <p>хоЮщЩЕф╕Кя╝МцИСхЬиуАРчмм 2 шо▓уАСф╕нх░▒х╖▓ч╗Пч╗Щф╜аф╗Лч╗Нш┐З SDS чЪДч╗УцЮДшо╛шобя╝Мш┐ЩщЗМцИСф╗мхЕИхБЪф╕кчоАхНХчЪДхЫЮщб╛я╝ЪSDS шо╛шобф║Жф╕НхРМч▒╗хЮЛчЪДч╗УцЮДхд┤я╝МхМЕцЛм sdshdr8уАБsdshdr16уАБsdshdr32 хТМ sdshdr64уАВш┐Щф║Ыф╕НхРМч▒╗хЮЛчЪДч╗УцЮДхд┤хПпф╗ещАВщЕНф╕НхРМхдзх░ПчЪДхнЧчмжф╕▓я╝Мф╗ОшАМщБ┐хЕНф║ЖхЖЕхнШц╡кш┤╣уАВ</p> <p>ф╕Нш┐Зя╝МSDS щЩдф║Жф╜┐чФич▓╛х╖зшо╛шобчЪДч╗УцЮДхд┤хдЦя╝МхЬиф┐ЭхнШш╛Гх░ПхнЧчмжф╕▓цЧ╢я╝МхЕ╢хоЮш┐Шф╜┐чФиф║Ж<strong>х╡МхЕех╝ПхнЧчмжф╕▓</strong>чЪДшо╛шобцЦ╣ц│ХуАВш┐ЩчзНцЦ╣ц│ХщБ┐хЕНф║Жч╗ЩхнЧчмжф╕▓хИЖщЕНщвЭхдЦчЪДчй║щЧ┤я╝МшАМцШпхПпф╗ешойхнЧчмжф╕▓чЫ┤цОеф┐ЭхнШхЬи Redis чЪДхЯ║цЬмцХ░цНохп╣ш▒бч╗УцЮДф╜Уф╕нуАВ</p> <p>цЙАф╗еш┐Щф╣Ях░▒цШпшп┤я╝МшжБцГ│чРЖшзгх╡МхЕех╝ПхнЧчмжф╕▓чЪДшо╛шобф╕ОхоЮчО░я╝МцИСф╗мх░▒щЬАшжБхЕИцЭеф║Жшзгф╕Ля╝МRedis ф╜┐чФичЪДхЯ║цЬмцХ░цНохп╣ш▒бч╗УцЮДф╜У redisObject цШпф╗Аф╣Ица╖чЪДуАВ</p> <h4 id="redisobject-ч╗УцЮДф╜Уф╕Оф╜НхЯЯхоЪф╣ЙцЦ╣ц│Х"><a href="#redisobject-ч╗УцЮДф╜Уф╕Оф╜НхЯЯхоЪф╣ЙцЦ╣ц│Х" class="header-anchor">#</a> redisObject ч╗УцЮДф╜Уф╕Оф╜НхЯЯхоЪф╣ЙцЦ╣ц│Х</h4> <p>redisObject ч╗УцЮДф╜УцШпхЬи server.h цЦЗф╗╢ф╕нхоЪф╣ЙчЪДя╝Мф╕╗шжБхКЯшГ╜цШпчФицЭеф┐ЭхнШщФохА╝хп╣ф╕нчЪДхА╝уАВш┐Щф╕кч╗УцЮДф╕АхЕ▒хоЪф╣Йф║Ж 4 ф╕кхЕГцХ░цНохТМф╕Аф╕кцМЗщТИуАВ</p> <ul><li><strong>type</strong>я╝ЪredisObject чЪДцХ░цНоч▒╗хЮЛя╝МцШпх║ФчФичиЛх║ПхЬи Redis ф╕нф┐ЭхнШчЪДцХ░цНоч▒╗хЮЛя╝МхМЕцЛм StringуАБListуАБHash чнЙуАВ</li> <li><strong>encoding</strong>я╝ЪredisObject чЪДч╝ЦчаБч▒╗хЮЛя╝МцШп Redis хЖЕщГихоЮчО░хРДчзНцХ░цНоч▒╗хЮЛцЙАчФичЪДцХ░цНоч╗УцЮДуАВ</li> <li><strong>lru</strong>я╝ЪredisObject чЪД LRU цЧ╢щЧ┤уАВ</li> <li><strong>refcount</strong>я╝ЪredisObject чЪДх╝ХчФишобцХ░уАВ</li> <li><strong>ptr</strong>я╝ЪцМЗхРСхА╝чЪДцМЗщТИуАВ</li></ul> <p>ф╕ЛщЭвчЪДф╗гчаБх▒Хчд║ф║Ж redisObject ч╗УцЮДф╜УчЪДхоЪф╣Йя╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//redisObjectчЪДцХ░цНоч▒╗хЮЛя╝М4ф╕кbits</span>
    <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//redisObjectчЪДч╝ЦчаБч▒╗хЮЛя╝М4ф╕кbits</span>
    <span class="token keyword">unsigned</span> lru<span class="token operator">:</span>LRU_BITS<span class="token punctuation">;</span>  <span class="token comment">//redisObjectчЪДLRUцЧ╢щЧ┤я╝МLRU_BITSф╕║24ф╕кbits</span>
    <span class="token keyword">int</span> refcount<span class="token punctuation">;</span> <span class="token comment">//redisObjectчЪДх╝ХчФишобцХ░я╝М4ф╕кхнЧшКВ</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span> <span class="token comment">//цМЗхРСхА╝чЪДцМЗщТИя╝М8ф╕кхнЧшКВ</span>
<span class="token punctuation">}</span> robj<span class="token punctuation">;</span>
</code></pre></div><p>ф╗Оф╗гчаБф╕нцИСф╗мхПпф╗ечЬЛхИ░я╝МхЬи typeуАБencoding хТМ lru ф╕Йф╕кхПШщЗПхРОщЭвщГ╜цЬЙф╕Аф╕кхЖТхП╖я╝Мх╣╢ч┤зш╖ЯчЭАф╕Аф╕кцХ░хА╝я╝Мшбичд║шпехЕГцХ░цНохНачФичЪДцпФчЙ╣цХ░уАВхЕ╢ф╕ня╝Мtype хТМ encoding хИЖхИлхНа 4bitsуАВшАМ lru хНачФичЪДцпФчЙ╣цХ░я╝МцШпчФ▒ server.h ф╕нчЪДхоПхоЪф╣Й LRU_BITS хЖ│хоЪчЪДя╝МхоГчЪДщ╗ШшодхА╝цШп 24bitsя╝МхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LRU_BITS</span> <span class="token expression"><span class="token number">24</span></span></span>
</code></pre></div><p>шАМш┐ЩщЗМцИСцГ│шойф╜ахнжф╣ацОМцПбчЪДя╝Мх░▒цШпш┐ЩчзН<strong>хПШщЗПхРОф╜┐чФихЖТхП╖хТМцХ░хА╝чЪДхоЪф╣ЙцЦ╣ц│Х</strong>уАВш┐ЩхоЮщЩЕф╕КцШп C шпншиАф╕нчЪД<strong>ф╜НхЯЯхоЪф╣ЙцЦ╣ц│Х</strong>я╝МхПпф╗ечФицЭецЬЙцХИхЬ░шКВчЬБхЖЕхнШх╝АщФАуАВ</p> <p>ш┐ЩчзНцЦ╣ц│ХцпФш╛ГщАВчФичЪДхЬ║цЩпцШпя╝Мх╜Уф╕Аф╕кхПШщЗПхНачФиф╕Нф║Жф╕Аф╕кцХ░цНоч▒╗хЮЛчЪДцЙАцЬЙ bits цЧ╢я╝Мх░▒хПпф╗еф╜┐чФиф╜НхЯЯхоЪф╣ЙцЦ╣ц│Хя╝МцККф╕Аф╕кцХ░цНоч▒╗хЮЛф╕нчЪД bitsя╝МхИТхИЖцИРхдЪф╕кф╜НхЯЯя╝МцпПф╕кф╜НхЯЯхНаф╕АхоЪчЪД bit цХ░уАВш┐Щца╖ф╕АцЭея╝Мф╕Аф╕кцХ░цНоч▒╗хЮЛчЪДцЙАцЬЙ bits х░▒хПпф╗ехоЪф╣ЙхдЪф╕кхПШщЗПф║Жя╝Мф╗ОшАМф╣Ях░▒цЬЙцХИшКВчЬБф║ЖхЖЕхнШх╝АщФАуАВ</p> <p>цндхдЦя╝Мф╜ахПпшГ╜ш┐Шф╝ЪхПСчО░я╝Мхп╣ф║О typeуАБencoding хТМ lru ф╕Йф╕кхПШщЗПцЭешп┤я╝МхоГф╗мчЪДцХ░цНоч▒╗хЮЛщГ╜цШп unsignedуАВх╖▓чЯеф╕Аф╕к unsigned ч▒╗хЮЛцШп 4 хнЧшКВя╝Мф╜Жш┐Щф╕Йф╕кхПШщЗПя╝МцШпхИЖхИлхНачФиф║Жф╕Аф╕к unsigned ч▒╗хЮЛ 4 хнЧшКВф╕нчЪД 4bitsуАБ4bits хТМ 24bitsуАВхЫацндя╝МчЫ╕ш╛Гф║Оф╕Йф╕кхПШщЗПя╝МцпПф╕кхПШщЗПчФиф╕Аф╕к 4 хнЧшКВчЪД unsigned ч▒╗хЮЛхоЪф╣ЙцЭешп┤я╝Мф╜┐чФиф╜НхЯЯхоЪф╣ЙцЦ╣ц│ХхПпф╗ешойф╕Йф╕кхПШщЗПхПкчФи 4 хнЧшКВя╝МцЬАхРОх░▒шГ╜шКВчЬБ 8 хнЧшКВчЪДх╝АщФАуАВ</p> <p>цЙАф╗ея╝Мх╜Уф╜ахЬишо╛шобх╝АхПСхЖЕхнШцХПцДЯхЮЛчЪДш╜пф╗╢цЧ╢я╝Мх░▒хПпф╗ецККш┐ЩчзНф╜НхЯЯхоЪф╣ЙцЦ╣ц│Хф╜┐чФиш╡╖цЭеуАВ</p> <p>хе╜я╝Мф║Жшзгф║Ж redisObject ч╗УцЮДф╜УхТМхоГф╜┐чФичЪДф╜НхЯЯхоЪф╣ЙцЦ╣ц│Хф╗ехРОя╝МцИСф╗мхЖНцЭечЬЛх╡МхЕех╝ПхнЧчмжф╕▓цШпхжВф╜ХхоЮчО░чЪДуАВ</p> <h4 id="х╡МхЕех╝ПхнЧчмжф╕▓"><a href="#х╡МхЕех╝ПхнЧчмжф╕▓" class="header-anchor">#</a> х╡МхЕех╝ПхнЧчмжф╕▓</h4> <p>хЙНщЭвцИСшп┤ш┐Зя╝МSDS хЬиф┐ЭхнШцпФш╛Гх░ПчЪДхнЧчмжф╕▓цЧ╢я╝Мф╝Ъф╜┐чФих╡МхЕех╝ПхнЧчмжф╕▓чЪДшо╛шобцЦ╣ц│Хя╝Мх░ЖхнЧчмжф╕▓чЫ┤цОеф┐ЭхнШхЬи redisObject ч╗УцЮДф╜Уф╕нуАВчД╢хРОхЬи redisObject ч╗УцЮДф╜Уф╕ня╝МхнШхЬиф╕Аф╕кцМЗхРСхА╝чЪДцМЗщТИ ptrя╝МшАМф╕АшИмцЭешп┤я╝Мш┐Щф╕к ptr цМЗщТИф╝ЪцМЗхРСхА╝чЪДцХ░цНоч╗УцЮДуАВ</p> <p>ш┐ЩщЗМцИСф╗мх░▒ф╗ехИЫх╗║ф╕Аф╕к String ч▒╗хЮЛчЪДхА╝ф╕║ф╛Ля╝МRedis ф╝Ъш░ГчФи <strong>createStringObject хЗ╜цХ░</strong>я╝МцЭехИЫх╗║чЫ╕х║ФчЪД redisObjectя╝МшАМш┐Щф╕к redisObject ф╕нчЪД ptr цМЗщТИя╝Мх░▒ф╝ЪцМЗхРС SDS цХ░цНоч╗УцЮДя╝МхжВф╕ЛхЫ╛цЙАчд║уАВ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/f6be6811ea3618a8aae047b29b0bfa23-20221013234844-sbd8yiw.jpg)</p> <p>хЬи Redis ц║РчаБф╕ня╝МcreateStringObject хЗ╜цХ░ф╝Ъца╣цНошжБхИЫх╗║чЪДхнЧчмжф╕▓чЪДщХ┐х║жя╝МхЖ│хоЪхЕ╖ф╜Уш░ГчФихУкф╕кхЗ╜цХ░цЭехоМцИРхИЫх╗║уАВ</p> <p>щВгф╣ИщТИхп╣ш┐Щф╕к createStringObject хЗ╜цХ░цЭешп┤я╝МхоГчЪДхПВцХ░цШп<strong>хнЧчмжф╕▓ ptr</strong> хТМ<strong>хнЧчмжф╕▓щХ┐х║ж len</strong>уАВх╜У len чЪДщХ┐х║жхдзф║О OBJ_ENCODING_EMBSTR_SIZE_LIMIT ш┐Щф╕кхоПхоЪф╣ЙцЧ╢я╝МcreateStringObject хЗ╜цХ░ф╝Ъш░ГчФи createRawStringObject хЗ╜цХ░я╝МхРжхИЩх░▒ш░ГчФи createEmbeddedStringObject хЗ╜цХ░уАВшАМхЬицИСф╗мхИЖцЮРчЪД Redis 5.0.8 ц║РчаБчЙИцЬмф╕ня╝Мш┐Щф╕к OBJ_ENCODING_EMBSTR_SIZE_LIMIT щ╗ШшодхоЪф╣Йф╕║ 44 хнЧшКВуАВ</p> <p>ш┐ЩщГихИЖф╗гчаБхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OBJ_ENCODING_EMBSTR_SIZE_LIMIT</span> <span class="token expression"><span class="token number">44</span></span></span>
robj <span class="token operator">*</span><span class="token function">createStringObject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//хИЫх╗║х╡МхЕех╝ПхнЧчмжф╕▓я╝МхнЧчмжф╕▓щХ┐х║жх░Пф║ОчнЙф║О44хнЧшКВ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> OBJ_ENCODING_EMBSTR_SIZE_LIMIT<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">createEmbeddedStringObject</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//хИЫх╗║цЩощАЪхнЧчмжф╕▓я╝МхнЧчмжф╕▓щХ┐х║жхдзф║О44хнЧшКВ</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> <span class="token function">createRawStringObject</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>чО░хЬия╝МцИСф╗мх░▒цЭехИЖцЮРф╕Аф╕Л createStringObject хЗ╜цХ░чЪДц║РчаБхоЮчО░я╝Мф╗ецндф║Жшзгхдзф║О 44 хнЧшКВчЪДцЩощАЪхнЧчмжф╕▓хТМх░Пф║ОчнЙф║О 44 хнЧшКВчЪДх╡МхЕех╝ПхнЧчмжф╕▓хИЖхИлцШпхжВф╜ХхИЫх╗║чЪДуАВ</p> <p>щжЦхЕИя╝Мхп╣ф║О <strong>createRawStringObject хЗ╜цХ░</strong>цЭешп┤я╝МхоГхЬихИЫх╗║ String ч▒╗хЮЛчЪДхА╝чЪДцЧ╢хАЩя╝Мф╝Ъш░ГчФи createObject хЗ╜цХ░уАВ</p> <blockquote><p>шбехЕЕя╝ЪcreateObject хЗ╜цХ░ф╕╗шжБцШпчФицЭехИЫх╗║ Redis чЪДцХ░цНохп╣ш▒бчЪДуАВхЫаф╕║ Redis чЪДцХ░цНохп╣ш▒бцЬЙх╛ИхдЪч▒╗хЮЛя╝МцпФхжВ StringуАБListуАБHash чнЙя╝МцЙАф╗ехЬи createObject хЗ╜цХ░чЪДф╕дф╕кхПВцХ░ф╕ня╝МцЬЙф╕Аф╕кх░▒цШпчФицЭешбичд║цЙАшжБхИЫх╗║чЪДцХ░цНохп╣ш▒бч▒╗хЮЛя╝МшАМхПжф╕Аф╕кцШпцМЗхРСцХ░цНохп╣ш▒бчЪДцМЗщТИуАВ</p></blockquote> <p>чД╢хРОя╝МcreateRawStringObject хЗ╜цХ░хЬиш░ГчФи createObject хЗ╜цХ░цЧ╢я╝Мф╝Ъф╝ащАТ OBJ_STRING ч▒╗хЮЛя╝Мшбичд║шжБхИЫх╗║ String ч▒╗хЮЛчЪДхп╣ш▒бя╝Мф╗ехПКф╝ащАТцМЗхРС SDS ч╗УцЮДчЪДцМЗщТИя╝МхжВф╗еф╕Лф╗гчаБцЙАчд║уАВш┐ЩщЗМ<strong>щЬАшжБц│ицДП</strong>чЪДцШпя╝МцМЗхРС SDS ч╗УцЮДчЪДцМЗщТИцШпчФ▒ sdsnewlen хЗ╜цХ░ш┐ФхЫЮчЪДя╝МшАМ sdsnewlen хЗ╜цХ░цнгцШпчФицЭехИЫх╗║ SDS ч╗УцЮДчЪДуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code>robj <span class="token operator">*</span><span class="token function">createRawStringObject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createObject</span><span class="token punctuation">(</span>OBJ_STRING<span class="token punctuation">,</span> <span class="token function">sdsnewlen</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>цЬАхРОя╝МцИСф╗мхЖНцЭеш┐Ыф╕АцнечЬЛф╕Л <strong>createObject хЗ╜цХ░</strong>уАВш┐Щф╕кхЗ╜цХ░ф╝ЪцККхПВцХ░ф╕нф╝ахЕечЪДуАБцМЗхРС SDS ч╗УцЮДф╜УчЪДцМЗщТИчЫ┤цОеш╡ЛхА╝ч╗Щ redisObject ф╕нчЪД ptrя╝Мш┐ЩщГихИЖчЪДф╗гчаБхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>robj <span class="token operator">*</span><span class="token function">createObject</span><span class="token punctuation">(</span><span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ч╗ЩredisObjectч╗УцЮДф╜УхИЖщЕНчй║щЧ┤</span>
    robj <span class="token operator">*</span>o <span class="token operator">=</span> <span class="token function">zmalloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//шо╛ч╜оredisObjectчЪДч▒╗хЮЛ</span>
    o<span class="token operator">-&gt;</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
    <span class="token comment">//шо╛ч╜оredisObjectчЪДч╝ЦчаБч▒╗хЮЛя╝МцндхдДцШпOBJ_ENCODING_RAWя╝Мшбичд║х╕╕шзДчЪДSDS</span>
    o<span class="token operator">-&gt;</span>encoding <span class="token operator">=</span> OBJ_ENCODING_RAW<span class="token punctuation">;</span>
    <span class="token comment">//чЫ┤цОех░Жф╝ахЕечЪДцМЗщТИш╡ЛхА╝ч╗ЩredisObjectф╕нчЪДцМЗщТИуАВ</span>
    o<span class="token operator">-&gt;</span>ptr <span class="token operator">=</span> ptr<span class="token punctuation">;</span>
    o<span class="token operator">-&gt;</span>refcount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    тАж
    <span class="token keyword">return</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╕║ф║ЖцЦ╣ф╛┐чРЖшзгцЩощАЪхнЧчмжф╕▓хИЫх╗║цЦ╣ц│Хя╝МцИСчФ╗ф║Жф╕Ах╝ахЫ╛я╝Мф╜ахПпф╗ечЬЛф╕ЛуАВ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/92ba6c70129843d7e48a7c074a5737ba-20221013234844-njod4mk.jpg)</p> <p>ш┐Щф╣Ях░▒цШпшп┤я╝МхЬихИЫх╗║цЩощАЪхнЧчмжф╕▓цЧ╢я╝МRedis щЬАшжБхИЖхИлч╗Щ redisObject хТМ SDS хИЖхИлхИЖщЕНф╕АцмбхЖЕхнШя╝Мш┐Щца╖х░▒цЧвх╕жцЭеф║ЖхЖЕхнШхИЖщЕНх╝АщФАя╝МхРМцЧ╢ф╣Яф╝Ъхп╝шЗ┤хЖЕхнШчвОчЙЗуАВхЫацндя╝Мх╜УхнЧчмжф╕▓х░Пф║ОчнЙф║О 44 хнЧшКВцЧ╢я╝МRedis х░▒ф╜┐чФиф║Жх╡МхЕех╝ПхнЧчмжф╕▓чЪДхИЫх╗║цЦ╣ц│Хя╝Мф╗ецндхЗПх░СхЖЕхнШхИЖщЕНхТМхЖЕхнШчвОчЙЗуАВ</p> <p>шАМш┐Щф╕кхИЫх╗║цЦ╣ц│Хя╝Мх░▒цШпчФ▒цИСф╗мхЙНщЭвцПРхИ░чЪД <strong>createEmbeddedStringObject хЗ╜цХ░</strong>цЭехоМцИРчЪДя╝МшпехЗ╜цХ░ф╝Ъф╜┐чФиф╕АхЭЧш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤я╝МцЭехРМцЧ╢ф┐ЭхнШ redisObject хТМ SDS ч╗УцЮДуАВш┐Щца╖ф╕АцЭея╝МхЖЕхнШхИЖщЕНхПкцЬЙф╕Ацмбя╝МшАМф╕Фф╣ЯщБ┐хЕНф║ЖхЖЕхнШчвОчЙЗуАВ</p> <p>createEmbeddedStringObject хЗ╜цХ░чЪДхОЯхЮЛхоЪф╣ЙхжВф╕Ля╝МхоГчЪДхПВцХ░х░▒цШпф╗О createStringObject хЗ╜цХ░хПВцХ░ф╕ншО╖х╛ЧчЪДхнЧчмжф╕▓цМЗщТИ ptrя╝Мф╗ехПКхнЧчмжф╕▓щХ┐х║ж lenуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code>robj <span class="token operator">*</span><span class="token function">createEmbeddedStringObject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span>
</code></pre></div><p>щВгф╣Иф╕ЛщЭвя╝МцИСф╗мх░▒цЭехЕ╖ф╜УчЬЛчЬЛя╝МcreateEmbeddedStringObject хЗ╜цХ░цШпхжВф╜ХцКК redisObject хТМ SDS цФ╛ч╜охЬиф╕Аш╡╖чЪДуАВ</p> <p>щжЦхЕИя╝МcreateEmbeddedStringObject хЗ╜цХ░ф╝Ъ<strong>хИЖщЕНф╕АхЭЧш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤</strong>я╝Мш┐ЩхЭЧхЖЕхнШчй║щЧ┤чЪДхдзх░ПчнЙф║О redisObject ч╗УцЮДф╜УчЪДхдзх░ПуАБSDS ч╗УцЮДхд┤ sdshdr8 чЪДхдзх░ПхТМхнЧчмжф╕▓хдзх░ПчЪДцА╗хТМя╝Мх╣╢ф╕ФхЖНхКаф╕К 1 хнЧшКВуАВц│ицДПя╝Мш┐ЩщЗМцЬАхРОчЪД 1 хнЧшКВцШп SDS ф╕нхКахЬихнЧчмжф╕▓цЬАхРОчЪДч╗УцЭЯхнЧчмжтАЬ\0тАЭуАВ</p> <p>ш┐ЩхЭЧш┐Юч╗нхЖЕхнШчй║щЧ┤чЪДхИЖщЕНцГЕхЖ╡хжВф╗еф╕Лф╗гчаБцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code>robj <span class="token operator">*</span>o <span class="token operator">=</span> <span class="token function">zmalloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>robj<span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sdshdr8</span><span class="token punctuation">)</span><span class="token operator">+</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ф╜аф╣ЯхПпф╗ехПВшАГф╕ЛхЫ╛я╝МхЕ╢ф╕нх▒Хчд║ф║Жш┐ЩхЭЧхЖЕхнШчй║щЧ┤чЪДх╕Гх▒АуАВ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/ec4aed7402b4d5310c37a468e5e403e1-20221013234844-gqni29p.jpg)</p> <p>хе╜я╝МщВгф╣И createEmbeddedStringObject хЗ╜цХ░хЬихИЖщЕНф║ЖхЖЕхнШчй║щЧ┤ф╣ЛхРОя╝Мх░▒ф╝Ъ<strong>хИЫх╗║ SDS ч╗УцЮДчЪДцМЗщТИ shя╝Мх╣╢цКК sh цМЗхРСш┐ЩхЭЧш┐Юч╗нчй║щЧ┤ф╕н SDS ч╗УцЮДхд┤цЙАхЬичЪДф╜Нч╜о</strong>я╝Мф╕ЛщЭвчЪДф╗гчаБцШ╛чд║ф║Жш┐ЩцнецУНф╜ЬуАВхЕ╢ф╕ня╝Мo цШп redisObject ч╗УцЮДф╜УчЪДхПШщЗПя╝Мo+1 шбичд║х░ЖхЖЕхнШхЬ░хЭАф╗ОхПШщЗП o х╝АхзЛчз╗хКиф╕Ацо╡ш╖Эчж╗я╝МшАМчз╗хКичЪДш╖Эчж╗чнЙф║О redisObject ш┐Щф╕кч╗УцЮДф╜УчЪДхдзх░ПуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sdshdr8</span> <span class="token operator">*</span>sh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>o<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ч╗Пш┐Зш┐ЩцнецУНф╜ЬхРОя╝Мsh цМЗхРСчЪДф╜Нч╜ох░▒хжВф╕ЛхЫ╛цЙАчд║я╝Ъ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/cdf446e96d90ff03db1083a0bd557056-20221013234844-u7yw89t.jpg)</p> <p>ч┤зцОечЭАя╝МcreateEmbeddedStringObject хЗ╜цХ░ф╝Ъ<strong>цКК redisObject ф╕нчЪДцМЗщТИ ptrя╝МцМЗхРС SDS ч╗УцЮДф╕нчЪДхнЧчмжцХ░ч╗Д</strong>уАВ</p> <p>хжВф╗еф╕Лф╗гчаБцЙАчд║я╝МхЕ╢ф╕н sh цШпхИЪцЙНф╗Лч╗НчЪДцМЗхРС SDS ч╗УцЮДчЪДцМЗщТИя╝Мх▒Юф║О sdshdr8 ч▒╗хЮЛуАВшАМ sh+1 шбичд║цККхЖЕхнШхЬ░хЭАф╗О sh ш╡╖хзЛхЬ░хЭАх╝АхзЛчз╗хКиф╕АхоЪчЪДхдзх░Пя╝Мчз╗хКичЪДш╖Эчж╗чнЙф║О sdshdr8 ч╗УцЮДф╜УчЪДхдзх░ПуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code>o<span class="token operator">-&gt;</span>ptr <span class="token operator">=</span> sh<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>ш┐ЩцнецУНф╜ЬхоМцИРхРОя╝МredisObject ч╗УцЮДф╜Уф╕нчЪДцМЗщТИ ptr чЪДцМЗхРСф╜Нч╜ох░▒хжВф╕ЛхЫ╛цЙАчд║я╝МхоГф╝ЪцМЗхРС SDS ч╗УцЮДхд┤чЪДцЬлх░╛я╝МхРМцЧ╢ф╣ЯцШпхнЧчмжцХ░ч╗ДчЪДш╡╖хзЛф╜Нч╜оя╝Ъ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/2e8f1387e6e7b7a6c6b9e431e53dd60d-20221013234844-lca9qxs.jpg)</p> <p>цЬАхРОя╝МcreateEmbeddedStringObject хЗ╜цХ░ф╝Ъ<strong>цККхПВцХ░ф╕нф╝ахЕечЪДцМЗщТИ ptr цМЗхРСчЪДхнЧчмжф╕▓я╝МцЛ╖ш┤ЭхИ░ SDS ч╗УцЮДф╜Уф╕нчЪДхнЧчмжцХ░ч╗Дя╝Мх╣╢хЬицХ░ч╗ДцЬАхРОц╖╗хКач╗УцЭЯхнЧчмж</strong>уАВш┐ЩщГихИЖф╗гчаБхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token function">memcpy</span><span class="token punctuation">(</span>sh<span class="token operator">-&gt;</span>buf<span class="token punctuation">,</span>ptr<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
sh<span class="token operator">-&gt;</span>buf<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
</code></pre></div><p>ф╕ЛщЭвш┐Щх╝ахЫ╛я╝Мф╣Ях▒Хчд║ф║Ж createEmbeddedStringObject хИЫх╗║х╡МхЕех╝ПхнЧчмжф╕▓чЪДш┐ЗчиЛя╝Мф╜ахПпф╗ехЖНцХ┤ф╜УцЭечЬЛчЬЛуАВ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/b3153b3064e8edea801c5b1b4f6d9372-20221013234844-sf19jzg.jpg)</p> <p>цА╗ф╣Ля╝Мф╜ахПпф╗ешо░ф╜Пя╝МRedis ф╝ЪщАЪш┐Зшо╛шобхоЮчО░ф╕АхЭЧш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤я╝МцКК redisObject ч╗УцЮДф╜УхТМ SDS ч╗УцЮДф╜Уч┤зхЗСхЬ░цФ╛ч╜охЬиф╕Аш╡╖уАВш┐Щца╖ф╕АцЭея╝Мхп╣ф║Оф╕Нш╢Еш┐З 44 хнЧшКВчЪДхнЧчмжф╕▓цЭешп┤я╝Мх░▒хПпф╗ещБ┐хЕНхЖЕхнШчвОчЙЗхТМф╕дцмбхЖЕхнШхИЖщЕНчЪДх╝АщФАф║ЖуАВ</p> <p>шАМщЩдф║Жх╡МхЕех╝ПхнЧчмжф╕▓ф╣ЛхдЦя╝МRedis ш┐Шшо╛шобф║ЖхОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИя╝Мш┐Щф╣ЯцШпф╕дчзНч┤зхЗСхЮЛчЪДхЖЕхнШцХ░цНоч╗УцЮДя╝МцЙАф╗еф╕ЛщЭвцИСф╗мхЖНцЭехнжф╣аф╕ЛхоГф╗мчЪДшо╛шобцАЭш╖пуАВ</p> <h3 id="хОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИчЪДшо╛шоб"><a href="#хОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИчЪДшо╛шоб" class="header-anchor">#</a> хОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИчЪДшо╛шоб</h3> <p>щжЦхЕИф╜ашжБчЯещБУя╝МListуАБHash хТМ Sorted Set ш┐Щф╕ЙчзНцХ░цНоч▒╗хЮЛя╝МщГ╜хПпф╗еф╜┐чФихОЛч╝йхИЧшбия╝Иziplistя╝ЙцЭеф┐ЭхнШцХ░цНоуАВхОЛч╝йхИЧшбичЪДхЗ╜цХ░хоЪф╣ЙхТМхоЮчО░ф╗гчаБхИЖхИлхЬи ziplist.h хТМ ziplist.c ф╕нуАВ</p> <p>ф╕Нш┐Зя╝МцИСф╗мхЬи ziplist.h цЦЗф╗╢ф╕нхЕ╢хоЮца╣цЬмчЬЛф╕НхИ░хОЛч╝йхИЧшбичЪДч╗УцЮДф╜УхоЪф╣ЙуАВш┐ЩцШпхЫаф╕║хОЛч╝йхИЧшбицЬмш║лх░▒цШпф╕АхЭЧш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤я╝МхоГщАЪш┐Зф╜┐чФиф╕НхРМчЪДч╝ЦчаБцЭеф┐ЭхнШцХ░цНоуАВ</p> <p>ш┐ЩщЗМф╕║ф║ЖцЦ╣ф╛┐чРЖшзгхОЛч╝йхИЧшбичЪДшо╛шобф╕ОхоЮчО░я╝МцИСф╗мхЕИцЭечЬЛчЬЛхоГчЪД<strong>хИЫх╗║хЗ╜цХ░ ziplistNew</strong>я╝МхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">ziplistNew</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//хИЭхзЛхИЖщЕНчЪДхдзх░П</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> bytes <span class="token operator">=</span> ZIPLIST_HEADER_SIZE<span class="token operator">+</span>ZIPLIST_END_SIZE<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zl <span class="token operator">=</span> <span class="token function">zmalloc</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    тАж
   <span class="token comment">//х░ЖхИЧшбих░╛шо╛ч╜оф╕║ZIP_END</span>
    zl<span class="token punctuation">[</span>bytes<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ZIP_END<span class="token punctuation">;</span>
    <span class="token keyword">return</span> zl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>хоЮщЩЕф╕Кя╝МziplistNew хЗ╜цХ░чЪДщА╗ш╛Сх╛ИчоАхНХя╝Мх░▒цШпхИЫх╗║ф╕АхЭЧш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤я╝Мхдзх░Пф╕║ ZIPLIST_HEADER_SIZE хТМ ZIPLIST_END_SIZE чЪДцА╗хТМя╝МчД╢хРОхЖНцККшпеш┐Юч╗нчй║щЧ┤чЪДцЬАхРОф╕Аф╕кхнЧшКВш╡ЛхА╝ф╕║ ZIP_ENDя╝Мшбичд║хИЧшбич╗УцЭЯуАВ</p> <p>хПжхдЦф╜ашжБц│ицДПчЪДцШпя╝МхЬиф╕КщЭвф╗гчаБф╕нхоЪф╣ЙчЪДф╕Йф╕кхоП ZIPLIST_HEADER_SIZEуАБZIPLIST_END_SIZE хТМ ZIP_ENDя╝МхЬи ziplist.c ф╕нф╣ЯхИЖхИлцЬЙхоЪф╣Йя╝МхИЖхИлшбичд║ ziplist чЪДхИЧшбихд┤хдзх░ПуАБхИЧшбих░╛хдзх░ПхТМхИЧшбих░╛хнЧшКВхЖЕхо╣я╝МхжВф╕ЛцЙАчд║уАВ</p> <p>//ziplist чЪДхИЧшбихд┤хдзх░Пя╝МхМЕцЛм 2 ф╕к 32 bits цХ┤цХ░хТМ 1 ф╕к 16bits цХ┤цХ░я╝МхИЖхИлшбичд║хОЛч╝йхИЧшбичЪДцА╗хнЧшКВцХ░я╝МхИЧшбицЬАхРОф╕Аф╕кхЕГч┤ачЪДчж╗хИЧшбихд┤чЪДхБПчз╗я╝Мф╗ехПКхИЧшбиф╕нчЪДхЕГч┤аф╕кцХ░</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//ziplistчЪДхИЧшбихд┤хдзх░Пя╝МхМЕцЛм2ф╕к32 bitsцХ┤цХ░хТМ1ф╕к16bitsцХ┤цХ░я╝МхИЖхИлшбичд║хОЛч╝йхИЧшбичЪДцА╗хнЧшКВцХ░я╝МхИЧшбицЬАхРОф╕Аф╕кхЕГч┤ачЪДчж╗хИЧшбихд┤чЪДхБПчз╗я╝Мф╗ехПКхИЧшбиф╕нчЪДхЕГч┤аф╕кцХ░</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ZIPLIST_HEADER_SIZE</span>     <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token comment">//ziplistчЪДхИЧшбих░╛хдзх░Пя╝МхМЕцЛм1ф╕к8 bitsцХ┤цХ░я╝Мшбичд║хИЧшбич╗УцЭЯуАВ</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ZIPLIST_END_SIZE</span>        <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token comment">//ziplistчЪДхИЧшбих░╛хнЧшКВхЖЕхо╣</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ZIP_END</span> <span class="token expression"><span class="token number">255</span></span></span>
</code></pre></div><p>щВгф╣Ия╝МхЬихИЫх╗║ф╕Аф╕кцЦ░чЪД ziplist хРОя╝МшпехИЧшбичЪДхЖЕхнШх╕Гх▒Ах░▒хжВф╕ЛхЫ╛цЙАчд║уАВц│ицДПя╝МцндцЧ╢хИЧшбиф╕нш┐Шц▓бцЬЙхоЮщЩЕчЪДцХ░цНоуАВ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/a09c893fe8bbafca9ec61b38165f3810-20221013234844-cnupvsu.jpg)</p> <p>чД╢хРОя╝Мх╜УцИСф╗мх╛А ziplist ф╕нцПТхЕецХ░цНоцЧ╢я╝Мziplist х░▒ф╝Ъца╣цНоцХ░цНоцШпхнЧчмжф╕▓ш┐ШцШпцХ┤цХ░я╝Мф╗ехПКхоГф╗мчЪДхдзх░Пш┐ЫшбМф╕НхРМчЪДч╝ЦчаБуАВш┐ЩчзНца╣цНоцХ░цНохдзх░Пш┐ЫшбМчЫ╕х║Фч╝ЦчаБчЪДшо╛шобцАЭцГ│я╝МцнгцШп Redis ф╕║ф║ЖшКВчЬБхЖЕхнШшАМщЗЗчФичЪДуАВ</p> <p>**щВгф╣Ия╝Мziplist цШпхжВф╜Хш┐ЫшбМч╝ЦчаБхСвя╝Я**шжБхнжф╣ач╝ЦчаБчЪДхоЮчО░я╝МцИСф╗мшжБхЕИф║Жшзг ziplist ф╕нхИЧшбищб╣чЪДч╗УцЮДуАВ</p> <p>ziplist хИЧшбищб╣хМЕцЛмф╕ЙщГихИЖхЖЕхо╣я╝МхИЖхИлцШп<strong>хЙНф╕Ащб╣чЪДщХ┐х║жя╝Иprevlenя╝Й</strong>уАБ<strong>х╜УхЙНщб╣щХ┐х║жф┐бцБпчЪДч╝ЦчаБч╗УцЮЬя╝Иencodingя╝Й</strong>я╝Мф╗ехПК<strong>х╜УхЙНщб╣чЪДхоЮщЩЕцХ░цНоя╝Иdataя╝Й</strong>уАВф╕ЛщЭвчЪДхЫ╛х▒Хчд║ф║ЖхИЧшбищб╣чЪДч╗УцЮДя╝ИхЫ╛ф╕нщЩдхИЧшбищб╣ф╣ЛхдЦчЪДхЖЕхо╣хИЖхИлцШп ziplist хЖЕхнШчй║щЧ┤чЪДш╡╖хзЛхТМх░╛щГия╝ЙуАВ</p> <p><img src="https://learn.lianglianglee.com/%e4%b8%93%e6%a0%8f/Redis%20%e6%ba%90%e7%a0%81%e5%89%96%e6%9e%90%e4%b8%8e%e5%ae%9e%e6%88%98/assets/864539a743ab9911fde71366463fc8d5-20221013234844-2kt59o8.jpg" alt="img"></p> <p>хоЮщЩЕф╕Кя╝МцЙАш░УчЪДч╝ЦчаБцКАцЬпя╝Мх░▒цШпцМЗ<strong>чФиф╕НхРМцХ░щЗПчЪДхнЧшКВцЭешбичд║ф┐ЭхнШчЪДф┐бцБп</strong>уАВхЬи ziplist ф╕ня╝Мч╝ЦчаБцКАцЬпф╕╗шжБх║ФчФихЬихИЧшбищб╣ф╕нчЪД prevlen хТМ encoding ш┐Щф╕дф╕кхЕГцХ░цНоф╕КуАВшАМх╜УхЙНщб╣чЪДхоЮщЩЕцХ░цНо dataя╝МхИЩцнгх╕╕чФицХ┤цХ░цИЦцШпхнЧчмжф╕▓цЭешбичд║уАВ</p> <p>цЙАф╗еш┐ЩщЗМя╝МцИСф╗мх░▒хЕИцЭечЬЛф╕Л <strong>prevlen чЪДч╝ЦчаБшо╛шоб</strong>уАВziplist ф╕нф╝ЪхМЕхРлхдЪф╕кхИЧшбищб╣я╝МцпПф╕кхИЧшбищб╣щГ╜цШпч┤зцМичЭАх╜╝цндхнШцФ╛чЪДя╝МхжВф╕ЛхЫ╛цЙАчд║уАВ</p> <p>![img](https://learn.lianglianglee.com/ф╕УцаП/Redis ц║РчаБхЙЦцЮРф╕ОхоЮцИШ/assets/eb734ed4a3718b28404ba90fdbe1a5fc-20221013234844-b2b4yfq.jpg)</p> <p>шАМф╕║ф║ЖцЦ╣ф╛┐цЯецЙ╛я╝МцпПф╕кхИЧшбищб╣ф╕нщГ╜ф╝Ъшо░х╜ХхЙНф╕Ащб╣чЪДщХ┐х║жуАВхЫаф╕║цпПф╕кхИЧшбищб╣чЪДщХ┐х║жф╕Нф╕Аца╖я╝МцЙАф╗ехжВцЮЬф╜┐чФичЫ╕хРМчЪДхнЧшКВхдзх░ПцЭешо░х╜Х prevlenя╝Мх░▒ф╝ЪщАацИРхЖЕхнШчй║щЧ┤ц╡кш┤╣уАВ</p> <p>цИСч╗Щф╜аф╕╛ф╕кф╛ЛхнРя╝МхБЗшо╛цИСф╗мч╗Яф╕Аф╜┐чФи 4 хнЧшКВшо░х╜Х prevlenя╝МхжВцЮЬхЙНф╕Аф╕кхИЧшбищб╣хПкцШпф╕Аф╕кхнЧчмжф╕▓тАЬredisтАЭя╝МщХ┐х║жф╕║ 5 ф╕кхнЧшКВя╝МщВгф╣ИцИСф╗мчФи 1 ф╕кхнЧшКВя╝И8 bitsя╝Йх░▒шГ╜шбичд║ 256 хнЧшКВщХ┐х║жя╝И2 чЪД 8 цмбцЦ╣чнЙф║О 256я╝ЙчЪДхнЧчмжф╕▓ф║ЖуАВцндцЧ╢я╝Мprevlen чФи 4 хнЧшКВшо░х╜Хя╝МхЕ╢ф╕нх░▒цЬЙ 3 хнЧшКВцШпц╡кш┤╣цОЙф║ЖуАВ</p> <p>хе╜я╝МцИСф╗мхЖНхЫЮш┐Зхд┤цЭечЬЛя╝Мziplist хЬихп╣ prevlen ч╝ЦчаБцЧ╢я╝Мф╝ЪхЕИш░ГчФи <strong>zipStorePrevEntryLength хЗ╜цХ░</strong>я╝МчФиф║ОхИдцЦнхЙНф╕Аф╕кхИЧшбищб╣цШпхРжх░Пф║О 254 хнЧшКВуАВхжВцЮЬцШпчЪДшпЭя╝МщВгф╣И prevlen х░▒ф╜┐чФи 1 хнЧшКВшбичд║я╝ЫхРжхИЩя╝МzipStorePrevEntryLength хЗ╜цХ░х░▒ш░ГчФи zipStorePrevEntryLengthLarge хЗ╜цХ░ш┐Ыф╕Ацнеч╝ЦчаБуАВш┐ЩщГихИЖф╗гчаБхжВф╕ЛцЙАчд║я╝Ъ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//хИдцЦнprevlenчЪДщХ┐х║жцШпхРжх░Пф║ОZIP_BIG_PREVLENя╝МZIP_BIG_PREVLENчнЙф║О254</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> ZIP_BIG_PREVLEN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//хжВцЮЬх░Пф║О254хнЧшКВя╝МщВгф╣Иш┐ФхЫЮprevlenф╕║1хнЧшКВ</span>
   p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   <span class="token comment">//хРжхИЩя╝Мш░ГчФиzipStorePrevEntryLengthLargeш┐ЫшбМч╝ЦчаБ</span>
   <span class="token keyword">return</span> <span class="token function">zipStorePrevEntryLengthLarge</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ф╣Ях░▒цШпшп┤я╝М<strong>zipStorePrevEntryLengthLarge хЗ╜цХ░</strong>ф╝ЪхЕИх░Ж prevlen чЪДчмм 1 хнЧшКВшо╛ч╜оф╕║ 254я╝МчД╢хРОф╜┐чФихЖЕхнШцЛ╖ш┤ЭхЗ╜цХ░ memcpyя╝Мх░ЖхЙНф╕Аф╕кхИЧшбищб╣чЪДщХ┐х║жхА╝цЛ╖ш┤ЭшЗ│ prevlen чЪДчмм 2 шЗ│чмм 5 хнЧшКВуАВцЬАхРОя╝МzipStorePrevEntryLengthLarge хЗ╜цХ░ш┐ФхЫЮ prevlen чЪДхдзх░Пя╝Мф╕║ 5 хнЧшКВуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//х░ЖprevlenчЪДчмм1хнЧшКВшо╛ч╜оф╕║ZIP_BIG_PREVLENя╝МхН│254</span>
    p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> ZIP_BIG_PREVLEN<span class="token punctuation">;</span>
  <span class="token comment">//х░ЖхЙНф╕Аф╕кхИЧшбищб╣чЪДщХ┐х║жхА╝цЛ╖ш┤ЭшЗ│prevlenчЪДчмм2шЗ│чмм5хнЧшКВя╝МхЕ╢ф╕нsizeof(len)чЪДхА╝ф╕║4</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>len<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    тАж
<span class="token punctuation">}</span>
<span class="token comment">//ш┐ФхЫЮprevlenчЪДхдзх░Пя╝Мф╕║5хнЧшКВ</span>
<span class="token keyword">return</span> <span class="token number">1</span><span class="token operator">+</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>хе╜я╝МхЬиф║Жшзгф║Ж prevlen ф╜┐чФи 1 хнЧшКВхТМ 5 хнЧшКВф╕дчзНч╝ЦчаБцЦ╣х╝ПхРОя╝МцИСф╗мхЖНцЭехнжф╣аф╕Л <strong>encoding чЪДч╝ЦчаБцЦ╣ц│Х</strong>уАВ</p> <p>цИСф╗мчЯещБУя╝Мф╕Аф╕кхИЧшбищб╣чЪДхоЮщЩЕцХ░цНоя╝МцЧвхПпф╗ецШпцХ┤цХ░ф╣ЯхПпф╗ецШпхнЧчмжф╕▓уАВцХ┤цХ░хПпф╗ецШп 16уАБ32уАБ64 чнЙхнЧшКВщХ┐х║жя╝МхРМцЧ╢хнЧчмжф╕▓чЪДщХ┐х║жф╣ЯхПпф╗ехдзх░Пф╕Нф╕АуАВ</p> <p>цЙАф╗ея╝Мziplist хЬи zipStoreEntryEncoding хЗ╜цХ░ф╕ня╝МщТИхп╣цХ┤цХ░хТМхнЧчмжф╕▓я╝Мх░▒хИЖхИлф╜┐чФиф║Жф╕НхРМхнЧшКВщХ┐х║жчЪДч╝ЦчаБч╗УцЮЬуАВф╕ЛщЭвчЪДф╗гчаБх▒Хчд║ф║Ж zipStoreEntryEncoding хЗ╜цХ░чЪДщГихИЖф╗гчаБя╝Мф╜ахПпф╗ечЬЛхИ░х╜УцХ░цНоцШпф╕НхРМщХ┐х║жхнЧчмжф╕▓цИЦцШпцХ┤цХ░цЧ╢я╝Мч╝ЦчаБч╗УцЮЬчЪДщХ┐х║ж len хдзх░Пф╕НхРМуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//щ╗Шшодч╝ЦчаБч╗УцЮЬцШп1хнЧшКВ</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">//хжВцЮЬцШпхнЧчмжф╕▓цХ░цНо</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ZIP_IS_STR</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//хнЧчмжф╕▓щХ┐х║жх░Пф║ОчнЙф║О63хнЧшКВя╝И16ш┐ЫхИ╢ф╕║0x3fя╝Й</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rawlen <span class="token operator">&lt;=</span> <span class="token number">0x3f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//щ╗Шшодч╝ЦчаБч╗УцЮЬцШп1хнЧшКВ</span>
            тАж
        <span class="token punctuation">}</span>
    <span class="token comment">//хнЧчмжф╕▓щХ┐х║жх░Пф║ОчнЙф║О16383хнЧшКВя╝И16ш┐ЫхИ╢ф╕║0x3fffя╝Й</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rawlen <span class="token operator">&lt;=</span> <span class="token number">0x3fff</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//ч╝ЦчаБч╗УцЮЬцШп2хнЧшКВ</span>
            len <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            тАж
        <span class="token punctuation">}</span>
    <span class="token comment">//хнЧчмжф╕▓щХ┐х║жхдзф║О16383хнЧшКВ</span>

        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//ч╝ЦчаБч╗УцЮЬцШп5хнЧшКВ</span>
            len <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            тАж
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">/* хжВцЮЬцХ░цНоцШпцХ┤цХ░я╝Мч╝ЦчаБч╗УцЮЬцШп1хнЧшКВ*/</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">)</span> <span class="token keyword">return</span> len<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>чоАшАМшиАф╣Ля╝МщТИхп╣ф╕НхРМщХ┐х║жчЪДцХ░цНоя╝Мф╜┐чФиф╕НхРМхдзх░ПчЪДхЕГцХ░цНоф┐бцБпя╝Иprevlen хТМ encodingя╝Йя╝Мш┐ЩчзНцЦ╣ц│ХхПпф╗ецЬЙцХИхЬ░шКВчЬБхЖЕхнШх╝АщФАуАВх╜УчД╢я╝МщЩдф║Ж ziplist ф╣ЛхдЦя╝МRedis ш┐Шшо╛шобф║Жф╕Аф╕кхЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДя╝Мш┐Щх░▒цШп<strong>цХ┤цХ░щЫЖхРИя╝Иintsetя╝Й</strong>я╝МхоГцШпф╜Ьф╕║х║Хх▒Вч╗УцЮДцЭехоЮчО░ Set цХ░цНоч▒╗хЮЛчЪДуАВ</p> <p>хТМ SDS х╡МхЕех╝ПхнЧчмжф╕▓уАБziplist ч▒╗ф╝╝я╝МцХ┤цХ░щЫЖхРИф╣ЯцШпф╕АхЭЧш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤я╝Мш┐Щф╕АчВ╣цИСф╗мф╗ОцХ┤цХ░щЫЖхРИчЪДхоЪф╣Йф╕нх░▒хПпф╗ечЬЛхИ░уАВintset.h хТМ intset.c хИЖхИлхМЕцЛмф║ЖцХ┤цХ░щЫЖхРИчЪДхоЪф╣ЙхТМхоЮчО░уАВ</p> <p>ф╕ЛщЭвчЪДф╗гчаБх▒Хчд║ф║Ж intset чЪДч╗УцЮДхоЪф╣ЙуАВцИСф╗мхПпф╗ечЬЛхИ░я╝МцХ┤цХ░щЫЖхРИч╗УцЮДф╜Уф╕ншо░х╜ХцХ░цНочЪДщГихИЖя╝Мх░▒цШпф╕Аф╕к int8_t ч▒╗хЮЛчЪДцХ┤цХ░цХ░ч╗Д contentsуАВф╗ОхЖЕхнШф╜┐чФичЪДшзТх║жцЭечЬЛя╝МцХ┤цХ░цХ░ч╗Дх░▒цШпф╕АхЭЧш┐Юч╗нхЖЕхнШчй║щЧ┤я╝МцЙАф╗еш┐Щца╖х░▒щБ┐хЕНф║ЖхЖЕхнШчвОчЙЗя╝Мх╣╢цПРхНЗф║ЖхЖЕхнШф╜┐чФицХИчОЗуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">intset</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint32_t</span> encoding<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> length<span class="token punctuation">;</span>
    <span class="token class-name">int8_t</span> contents<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> intset<span class="token punctuation">;</span>
</code></pre></div><p>хе╜ф║Жя╝МхИ░ш┐ЩщЗМя╝МцИСф╗мх░▒х╖▓ч╗Пф║Жшзгф║Ж Redis щТИхп╣хЖЕхнШх╝АщФАцЙАхБЪчЪДцХ░цНоч╗УцЮДф╝ШхМЦя╝МхИЖхИлцШп SDS х╡МхЕех╝ПхнЧчмжф╕▓уАБхОЛч╝йхИЧшбихТМцХ┤цХ░щЫЖхРИуАВ</p> <p>шАМщЩдф║Жхп╣цХ░цНоч╗УцЮДхБЪф╝ШхМЦя╝МRedis хЬицХ░цНошо┐щЧоф╕Кя╝Мф╣Яф╝Ъх░╜щЗПшКВчЬБхЖЕхнШх╝АщФАя╝МцОеф╕ЛцЭецИСф╗мх░▒ф╕Аш╡╖цЭехнжф╣аф╕ЛуАВ</p> <h2 id="шКВчЬБхЖЕхнШчЪДцХ░цНошо┐щЧо"><a href="#шКВчЬБхЖЕхнШчЪДцХ░цНошо┐щЧо" class="header-anchor">#</a> шКВчЬБхЖЕхнШчЪДцХ░цНошо┐щЧо</h2> <p>цИСф╗мчЯещБУя╝МхЬи Redis хоЮф╛Лш┐РшбМцЧ╢я╝МцЬЙф║ЫцХ░цНоцШпф╝Ъшвлч╗Пх╕╕шо┐щЧочЪДя╝МцпФхжВх╕╕шзБчЪДцХ┤цХ░я╝МRedis хНПшооф╕нх╕╕шзБчЪДхЫЮхдНф┐бцБпя╝МхМЕцЛмцУНф╜ЬцИРхКЯя╝ИтАЬOKтАЭхнЧчмжф╕▓я╝ЙуАБцУНф╜Ьхд▒ш┤ея╝ИERRя╝Йя╝Мф╗ехПКх╕╕шзБчЪДцКещФЩф┐бцБпуАВ</p> <p>цЙАф╗ея╝Мф╕║ф║ЖщБ┐хЕНхЬихЖЕхнШф╕нхПНхдНхИЫх╗║ш┐Щф║Ыч╗Пх╕╕швлшо┐щЧочЪДцХ░цНоя╝МRedis х░▒щЗЗчФиф║Ж<strong>хЕ▒ф║лхп╣ш▒б</strong>чЪДшо╛шобцАЭцГ│уАВш┐Щф╕кшо╛шобцАЭцГ│х╛ИчоАхНХя╝Мх░▒цШпцККш┐Щф║Ых╕╕чФицХ░цНохИЫх╗║ф╕║хЕ▒ф║лхп╣ш▒бя╝Мх╜Уф╕Кх▒Вх║ФчФищЬАшжБшо┐щЧохоГф╗мцЧ╢я╝МчЫ┤цОешп╗хПЦх░▒шбМуАВ</p> <p>чО░хЬицИСф╗мх░▒цЭехБЪф╕кхБЗшо╛уАВцЬЙ 1000 ф╕кховцИ╖члпя╝МщГ╜шжБф┐ЭхнШтАЬ3тАЭш┐Щф╕кцХ┤цХ░уАВхжВцЮЬ Redis ф╕║цпПф╕кховцИ╖члпя╝МщГ╜хИЫх╗║ф║Жф╕Аф╕кхА╝ф╕║ 3 чЪД redisObjectя╝МщВгф╣ИхЖЕхнШф╕нх░▒ф╝ЪцЬЙхдзщЗПчЪДхЖЧф╜ЩуАВшАМф╜┐чФиф║ЖхЕ▒ф║лхп╣ш▒бцЦ╣ц│ХхРОя╝МRedis хЬихЖЕхнШф╕нхПкчФиф┐ЭхнШф╕Аф╕к 3 чЪД redisObject х░▒шбМя╝Мш┐Щца╖х░▒цЬЙцХИшКВчЬБф║ЖхЖЕхнШчй║щЧ┤уАВ</p> <p>ф╗еф╕Лф╗гчаБх▒Хчд║чЪДцШп server.c цЦЗф╗╢ф╕ня╝М<strong>хИЫх╗║хЕ▒ф║лхп╣ш▒бчЪДхЗ╜цХ░ createSharedObjects</strong>я╝Мф╜ахПпф╗ечЬЛф╕ЛуАВ</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">createSharedObjects</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   тАж
   <span class="token comment">//х╕╕шзБхЫЮхдНф┐бцБп</span>
   shared<span class="token punctuation">.</span>ok <span class="token operator">=</span> <span class="token function">createObject</span><span class="token punctuation">(</span>OBJ_STRING<span class="token punctuation">,</span><span class="token function">sdsnew</span><span class="token punctuation">(</span><span class="token string">&quot;+OK\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   shared<span class="token punctuation">.</span>err <span class="token operator">=</span> <span class="token function">createObject</span><span class="token punctuation">(</span>OBJ_STRING<span class="token punctuation">,</span><span class="token function">sdsnew</span><span class="token punctuation">(</span><span class="token string">&quot;-ERR\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   тАж
   <span class="token comment">//х╕╕шзБцКещФЩф┐бцБп</span>
 shared<span class="token punctuation">.</span>nokeyerr <span class="token operator">=</span> <span class="token function">createObject</span><span class="token punctuation">(</span>OBJ_STRING<span class="token punctuation">,</span><span class="token function">sdsnew</span><span class="token punctuation">(</span><span class="token string">&quot;-ERR no such key\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 shared<span class="token punctuation">.</span>syntaxerr <span class="token operator">=</span> <span class="token function">createObject</span><span class="token punctuation">(</span>OBJ_STRING<span class="token punctuation">,</span><span class="token function">sdsnew</span><span class="token punctuation">(</span><span class="token string">&quot;-ERR syntax error\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//0хИ░9999чЪДцХ┤цХ░</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> OBJ_SHARED_INTEGERS<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        shared<span class="token punctuation">.</span>integers<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span>
          <span class="token function">makeObjectShared</span><span class="token punctuation">(</span><span class="token function">createObject</span><span class="token punctuation">(</span>OBJ_STRING<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        тАж
    <span class="token punctuation">}</span>
   тАж
<span class="token punctuation">}</span>
</code></pre></div><h2 id="х░Пч╗У"><a href="#х░Пч╗У" class="header-anchor">#</a> х░Пч╗У</h2> <p>щЩНф╜ОхЖЕхнШх╝АщФАя╝Мхп╣ф║О Redis ш┐Щца╖чЪДхЖЕхнШцХ░цНох║УцЭешп┤щЭЮх╕╕щЗНшжБуАВф╗Кхдйш┐ЩшКВшп╛я╝МцИСф╗мф║Жшзгф║Ж Redis чФиф║Оф╝ШхМЦхЖЕхнШф╜┐чФицХИчОЗчЪДф╕дчзНцЦ╣ц│Хя╝ЪхЖЕхнШф╝ШхМЦчЪДцХ░цНоч╗УцЮДшо╛шобхТМшКВчЬБхЖЕхнШчЪДхЕ▒ф║лцХ░цНошо┐щЧоуАВ</p> <p>щВгф╣Ия╝Мхп╣ф║ОхоЮчО░цХ░цНоч╗УцЮДцЭешп┤я╝МхжВцЮЬцГ│шжБшКВчЬБхЖЕхнШя╝МRedis х░▒ч╗ЩцИСф╗мцПРф╛Ыф║Жф╕дф╕кф╝ШчзАчЪДшо╛шобцАЭцГ│я╝Ъф╕Аф╕кцШп<strong>ф╜┐чФиш┐Юч╗нчЪДхЖЕхнШчй║щЧ┤</strong>я╝МщБ┐хЕНхЖЕхнШчвОчЙЗх╝АщФАя╝Ыф║Мф╕кцШп<strong>щТИхп╣ф╕НхРМщХ┐х║жчЪДцХ░цНоя╝МщЗЗчФиф╕НхРМхдзх░ПчЪДхЕГцХ░цНо</strong>я╝Мф╗ещБ┐хЕНф╜┐чФич╗Яф╕Ахдзх░ПчЪДхЕГцХ░цНоя╝МщАацИРхЖЕхнШчй║щЧ┤чЪДц╡кш┤╣уАВ</p> <p>хПжхдЦхЬицХ░цНошо┐щЧоцЦ╣щЭвя╝Мф╜аф╣ЯшжБчЯещБУя╝М<strong>ф╜┐чФихЕ▒ф║лхп╣ш▒б</strong>хЕ╢хоЮхПпф╗ещБ┐хЕНщЗНхдНхИЫх╗║хЖЧф╜ЩчЪДцХ░цНоя╝Мф╗ОшАМф╣ЯхПпф╗ецЬЙцХИхЬ░шКВчЬБхЖЕхнШчй║щЧ┤уАВф╕Нш┐Зя╝МхЕ▒ф║лхп╣ш▒бф╕╗шжБщАВчФиф║О<strong>хПкшп╗хЬ║цЩп</strong>я╝МхжВцЮЬф╕Аф╕кхнЧчмжф╕▓швлхПНхдНхЬ░ф┐оцФ╣я╝Мх░▒цЧац│ХшвлхдЪф╕кшп╖ц▒ВхЕ▒ф║лшо┐щЧоф║ЖуАВцЙАф╗еш┐Щф╕АчВ╣я╝Мф╜ахЬих║ФчФицЧ╢ф╣ЯщЬАшжБц│ицДПф╕Аф╕ЛуАВ</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/echo-lxy/echo-system-design/edit/master/docs/01.Redis ч│╗ч╗Яшо╛шоб/02.хЯ║чбА/20.хЖЕхнШхПЛхе╜чЪДцХ░цНоч╗УцЮДшпехжВф╜Хч╗ЖхМЦшо╛шобя╝Я.md" target="_blank" rel="noopener noreferrer">ч╝Цш╛С</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░:</span> <span class="time">2024/09/16, 10:01:40</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        тЖР
        <a href="/pages/c7cf4a/" class="prev">ZSet</a></span> <span class="next"><a href="/pages/d4ecb9/">Redis Server хИЭхзЛхМЦ</a>тЖТ
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:lixinyang2002@163.com" title="хПСщВоф╗╢" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/echo-lxy" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="хРмщЯ│ф╣Р" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="цЬмчлЩф╕╗щвШ">Vdoing</a> 
    | Copyright ┬й 2024-2024
    <span>Xinyang Li | MIT License</span></div> <div class="buttons"><div title="ш┐ФхЫЮщб╢щГи" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="хО╗шпДшо║" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ф╕╗щвШцибх╝П" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          ш╖ЯщЪПч│╗ч╗Я
        </li><li class="iconfont icon-rijianmoshi">
          ц╡ЕшЙ▓цибх╝П
        </li><li class="iconfont icon-yejianmoshi">
          ц╖▒шЙ▓цибх╝П
        </li><li class="iconfont icon-yuedu">
          щШЕшп╗цибх╝П
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e6c7c0bc.js" defer></script><script src="/assets/js/2.c1dbdf51.js" defer></script><script src="/assets/js/12.2feff802.js" defer></script>
  </body>
</html>
