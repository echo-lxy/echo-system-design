(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{375:function(e,t,r){"use strict";r.r(t);var s=r(4),a=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"前置知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前置知识"}},[e._v("#")]),e._v(" 前置知识")]),e._v(" "),t("ul",[t("li",[e._v("常用数据结构：数组、链表、哈希表、跳表")]),e._v(" "),t("li",[e._v("网络协议：TCP 协议")]),e._v(" "),t("li",[e._v("网络 IO 模型：IO 多路复用、非阻塞 IO、Reactor 网络模型")]),e._v(" "),t("li",[e._v("操作系统：写时复制（Copy On Write）、常见系统调用、磁盘 IO 机制")]),e._v(" "),t("li",[e._v("C 语言基础：循环、分支、结构体、指针")])]),e._v(" "),t("h2",{attrs:{id:"阅读方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阅读方法"}},[e._v("#")]),e._v(" 阅读方法")]),e._v(" "),t("h3",{attrs:{id:"伪码蓝图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#伪码蓝图"}},[e._v("#")]),e._v(" 伪码蓝图")]),e._v(" "),t("p",[t("strong",[e._v("特别重要！务必反复观看")])]),e._v(" "),t("h3",{attrs:{id:"基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础"}},[e._v("#")]),e._v(" 基础")]),e._v(" "),t("p",[t("strong",[e._v("这些基础模块就相当于一座大厦的地基，地基打好了，才能做到高楼耸立。")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409160249936.png",alt:"img"}})]),e._v(" "),t("h3",{attrs:{id:"主线"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主线"}},[e._v("#")]),e._v(" 主线")]),e._v(" "),t("p",[e._v("掌握了数据结构模块之后，这时我们的重点就需要放在「"),t("strong",[e._v("核心主线")]),e._v("」上来了。")]),e._v(" "),t("p",[e._v("那么在读 Redis 源码时，什么才是它的核心主线呢？")]),e._v(" "),t("p",[e._v("这里我分享一个非常好用的技巧，就是根据「"),t("strong",[e._v("Redis 究竟是怎么处理客户端发来的命令的？")]),e._v("」为主线来梳理。")]),e._v(" "),t("p",[e._v("举个例子，当我们在执行 SET testkey testval EX 60 这样一条命令时，就需要搞清楚 Redis 是怎么执行这条命令的")]),e._v(" "),t("p",[e._v("也就是要明确，"),t("strong",[e._v("Redis 从收到客户端请求，到把数据存到 Redis 中、设置过期时间，最后把响应结果返回给客户端")]),e._v("，整个过程的每一个环节，到底是如何处理的。")]),e._v(" "),t("p",[e._v("有了这条主线，我们就有了非常明确的目标，而且沿着这条主线去读代码，我们还可以很清晰地把多个模块「"),t("strong",[e._v("串联")]),e._v("」起来。比如从前面的例子中，我们会看到一条命令的执行，主要包含了这样几个阶段")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("Redis Server 初始化")]),e._v("：加载配置、监听端口、注册连接建立事件、启动事件循环")]),e._v(" "),t("li",[t("strong",[e._v("接收、解析客户端请求")]),e._v("：初始化 client、注册读事件、读客户端")]),e._v(" "),t("li",[t("strong",[e._v("处理具体的命令")]),e._v("：找到对应的命令函数、执行命令")]),e._v(" "),t("li",[t("strong",[e._v("返回响应给客户端")]),e._v("：写客户端缓冲区、注册写事件、写客户端 socket")])]),e._v(" "),t("p",[t("a",{attrs:{href:"https://kaito-blog-1253469779.cos.ap-beijing.myqcloud.com/2021/09/16323108140155.jpg",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://echo798.oss-cn-shenzhen.aliyuncs.com/img/202409160249039.jpeg",alt:"img"}}),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("沿着这条主线去读代码，我们就可以掌握一条命令的执行全过程")]),e._v(" "),t("h3",{attrs:{id:"支线"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支线"}},[e._v("#")]),e._v(" 支线")]),e._v(" "),t("p",[e._v("不过，在攻打主线的过程中，我们肯定还会遇到各种「支线」逻辑，比如"),t("strong",[e._v("数据过期、替换淘汰、持久化、主从复制")]),e._v("等。")]),e._v(" "),t("p",[e._v("其实，在阅读主线逻辑的时候，我们并"),t("strong",[e._v("不需要去重点关注")]),e._v("这些支线，而当整个主线逻辑「清晰」起来之后，我们再去读这些支线模块，就会容易很多了。")]),e._v(" "),t("p",[e._v("这时，我们就可以从这些支线中，选取下一个「目标」，带着这个目标去阅读，比如说：")]),e._v(" "),t("ul",[t("li",[e._v("过期策略是怎么实现的？（expire.c、lazyfree.c）")]),e._v(" "),t("li",[e._v("淘汰策略是如何实现的？（evict.c）")]),e._v(" "),t("li",[e._v("持久化 RDB、AOF 是怎么做的？（rdb.c、aof.c）")]),e._v(" "),t("li",[e._v("主从复制是怎么做的？（replication.c）")]),e._v(" "),t("li",[e._v("哨兵如何完成故障自动切换？（sentinel.c）")]),e._v(" "),t("li",[e._v("分片逻辑如何实现？（cluster.c）")]),e._v(" "),t("li",[e._v("…")])]),e._v(" "),t("p",[e._v("有了新的支线目标后，我们依旧可以采用前面提到的「先整体后细节」的思路阅读相关模块，这样下来，整个项目的每个模块，就可以被「逐一击破」了")]),e._v(" "),t("h2",{attrs:{id:"学习资料推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#学习资料推荐"}},[e._v("#")]),e._v(" 学习资料推荐")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://time.geekbang.org/column/intro/100084301?utm_campaign=geektime_search&utm_content=geektime_search&utm_medium=geektime_search&utm_source=geektime_search&utm_term=geektime_search",target:"_blank",rel:"noopener noreferrer"}},[e._v("极客时间：Redis源码剖析与实战"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://book.douban.com/subject/25900156/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis设计与实现 "),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/redis/redis/blob/5.0/src/ae.c",target:"_blank",rel:"noopener noreferrer"}},[e._v("Github：redis 源码"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://imzye.com/NoSQL/Redis/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis Basics & Notes - Yves Wiki (imzye.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"http://zhangtielei.com/posts/server.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("栏目：服务端技术 - 铁蕾的个人博客 (zhangtielei.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.linjiangxiong.com/categories/Redis-Source-Code-Analysis/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Category: Redis Source Code Analysis | Johnson Lin (linjiangxiong.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://tech.youzan.com/redisyuan-ma-jie-xi/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis源码解析 (youzan.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/JasonLai256/the-little-redis-book/tree/master",target:"_blank",rel:"noopener noreferrer"}},[e._v("JasonLai256/the-little-redis-book (github.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/huangzworks/redis-3.0-annotated",target:"_blank",rel:"noopener noreferrer"}},[e._v("huangzworks/redis-3.0-annotated: 带有详细注释的 Redis 3.0 代码（annotated Redis 3.0 source code）。 (github.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://help.aliyun.com/zh/redis/use-cases/best-practices-for-all-editions/?spm=a2c4g.11186623.0.0.46eb9ca1Up7yEk",target:"_blank",rel:"noopener noreferrer"}},[e._v("通用业务场景_云数据库 Redis 版(Redis)-阿里云帮助中心 (aliyun.com)"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://stackoverflow.com/questions/tagged/redis?tab=Votes",target:"_blank",rel:"noopener noreferrer"}},[e._v("得分最高的 'redis' 问题 - Stack Overflow --- Highest scored 'redis' questions - Stack Overflow"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=a.exports}}]);